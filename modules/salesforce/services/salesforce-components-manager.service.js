const a127_0x537432=a127_0x3652;(function(_0x3faa56,_0x4024da){const _0x5e30ea=a127_0x3652,_0x1feb25=_0x3faa56();while(!![]){try{const _0x2977df=-parseInt(_0x5e30ea(0xf6))/0x1*(parseInt(_0x5e30ea(0x112))/0x2)+-parseInt(_0x5e30ea(0xbb))/0x3*(-parseInt(_0x5e30ea(0xd2))/0x4)+parseInt(_0x5e30ea(0x10a))/0x5*(-parseInt(_0x5e30ea(0x110))/0x6)+parseInt(_0x5e30ea(0xcb))/0x7+-parseInt(_0x5e30ea(0xde))/0x8*(parseInt(_0x5e30ea(0xdd))/0x9)+parseInt(_0x5e30ea(0xd1))/0xa*(-parseInt(_0x5e30ea(0xdc))/0xb)+parseInt(_0x5e30ea(0x105))/0xc;if(_0x2977df===_0x4024da)break;else _0x1feb25['push'](_0x1feb25['shift']());}catch(_0x51d0fc){_0x1feb25['push'](_0x1feb25['shift']());}}}(a127_0x2493,0x9263d));function a127_0x3652(_0x119599,_0x4fe70b){const _0x372b22=a127_0x2493();return a127_0x3652=function(_0x80817d,_0x6da58c){_0x80817d=_0x80817d-0xb3;let _0x2493c0=_0x372b22[_0x80817d];return _0x2493c0;},a127_0x3652(_0x119599,_0x4fe70b);}const a127_0x6da58c=function(){let _0x478132=!![];return function(_0x193767,_0x93a879){const _0x241ec9=_0x478132?function(){if(_0x93a879){const _0x4eddbe=_0x93a879['apply'](_0x193767,arguments);return _0x93a879=null,_0x4eddbe;}}:function(){};return _0x478132=![],_0x241ec9;};}(),a127_0x80817d=a127_0x6da58c(this,function(){const _0x355439=a127_0x3652;return a127_0x80817d[_0x355439(0x103)]()['search'](_0x355439(0x119))[_0x355439(0x103)]()[_0x355439(0x10d)](a127_0x80817d)[_0x355439(0x10b)](_0x355439(0x119));});function a127_0x2493(){const _0x1a2303=['DEFLATE','../utils/flosum-naming.utils',']\x20-\x20meta\x20not\x20found','9710scsHwi','search','username','constructor','ParentId','SalesforceComponentsManager','3306dagWUx','prepareComponentRecord','1726dRsTHv','name','prepareComponentHistoryRecord','FLOSUM_ATTACHMENT','Repository','SalesforceError','delete','(((.+)+)+)+$','generateAsync','Source__c','CRC32__c','application/zip','Component_Type__c','FLOSUM_NAMESPACE','Component_Name__c','Component__c','body','files','typedi','258fpCnIm','componentType','componentName','__importDefault','FLOSUM_GIT_NAMESPACE','Deletion_By_Agent__c','filePath','componentId','crc','File_Name__c','gitSync','../../parsers/utils/zip','createDeleteRequest','find','../../../constants','fetchCommitManifestsByComponentIds','8038310dcguTl','toISOString','type','recordTypes','base64','Branch','10oSRTEo','45412piAJcR','Last_Modified_By__c','Last_Modified_Date__c','Committed_On__c','FLOSUM_COMPONENT','branchId','createZip','Could\x20not\x20find\x20meta\x20data\x20for\x20','logger','get','10380865RxaYiE','9477711mFbAiZ','8DgfQeC','repositoryId','Zip','push','Changed_By__c','FLOSUM_COMPONENT_HISTORY','SalesforceGitSyncService','__esModule','Branch__c','update','reference','.id}','prepareCommitManifest','Could\x20not\x20proceed\x20component\x20','Description','error','Is_From_Agent__c','FLOSUM_COMMIT_MANIFEST','getProceededComponentsMeta','request','keys','proceededComponentsMeta','Name','prepareComponentAttachmentRecord','761UOJUMw','manifests','version','../utils/composite.utils','proceedComponentMeta','Logger','insert','../errors/salesforce.error','ContentType','map','RecordTypeId','createPostRequest','Commit__c','toString','Version__c','26382048LQYeqX','../../../core'];a127_0x2493=function(){return _0x1a2303;};return a127_0x2493();}a127_0x80817d();'use strict';var __importDefault=this&&this[a127_0x537432(0xbe)]||function(_0x1eb91d){const _0x23f3f8=a127_0x537432;return _0x1eb91d&&_0x1eb91d[_0x23f3f8(0xe5)]?_0x1eb91d:{'default':_0x1eb91d};};Object['defineProperty'](exports,a127_0x537432(0xe5),{'value':!![]}),exports['SalesforceComponentsManager']=void 0x0;const constants_1=require(a127_0x537432(0xc9)),core_1=require(a127_0x537432(0x106)),zip_1=require(a127_0x537432(0xc6)),typedi_1=__importDefault(require(a127_0x537432(0xba))),salesforce_error_1=require(a127_0x537432(0xfd)),composite_utils_1=require(a127_0x537432(0xf9)),flosum_naming_utils_1=require(a127_0x537432(0x108)),salesforce_git_sync_service_1=require('./salesforce-git-sync.service');class SalesforceComponentsManager{constructor(_0x29b296,_0x2abbca,_0x13667b,_0x5e2ab4,_0x588982){const _0x2d6756=a127_0x537432;this['repositoryId']=_0x29b296,this[_0x2d6756(0xd7)]=_0x2abbca,this[_0x2d6756(0x10c)]=_0x13667b,this[_0x2d6756(0xce)]=_0x5e2ab4,this['proceededComponentsMeta']=_0x588982,this[_0x2d6756(0xda)]=new core_1[(_0x2d6756(0xfb))](SalesforceComponentsManager[_0x2d6756(0x113)]),this[_0x2d6756(0xc5)]=typedi_1['default'][_0x2d6756(0xdb)](salesforce_git_sync_service_1[_0x2d6756(0xe4)]);}[a127_0x537432(0xfa)](_0x6d3412,_0x1da118){const _0x25b9db=a127_0x537432,_0x192cf6=flosum_naming_utils_1['extractFieldsFromRecord'](_0x6d3412,['Component_Type__c',_0x25b9db(0xb6),'Version__c']);this[_0x25b9db(0xf3)][_0x25b9db(0xe1)]({'componentId':'','reference':_0x1da118,'version':_0x192cf6[_0x25b9db(0x104)],'componentName':_0x192cf6[_0x25b9db(0xb6)],'componentType':_0x192cf6['Component_Type__c']});}[a127_0x537432(0xea)](_0x36ca73,_0x4e40d5){const _0x444757=a127_0x537432,{request:_0x1aa90a}=composite_utils_1[_0x444757(0x101)](constants_1[_0x444757(0xef)],{[constants_1[_0x444757(0xb5)]+_0x444757(0x102)]:_0x36ca73,[constants_1[_0x444757(0xb5)]+'Component_History__c']:_0x4e40d5});return _0x1aa90a;}async[a127_0x537432(0xf5)](_0x3c95c0,_0x589a4b){const _0x170dcf=a127_0x537432,_0x5ad507={},_0x1bdcc1=zip_1[_0x170dcf(0xe0)][_0x170dcf(0xd8)]();for(const _0x3f5a82 of Object[_0x170dcf(0xf2)](_0x3c95c0[_0x170dcf(0xb9)])){_0x1bdcc1['file'](_0x3f5a82,_0x3c95c0[_0x170dcf(0xb9)][_0x3f5a82],{'createFolders':!![]});}return _0x5ad507[_0x170dcf(0xfe)]=_0x170dcf(0xb3),_0x5ad507[_0x170dcf(0xf4)]=_0x3c95c0[_0x170dcf(0xcd)],_0x5ad507[_0x170dcf(0xec)]=_0x3c95c0[_0x170dcf(0xcd)],_0x5ad507[_0x170dcf(0x10e)]=_0x589a4b,_0x5ad507['Body']=await _0x1bdcc1[_0x170dcf(0x11a)]({'type':_0x170dcf(0xcf),'compression':_0x170dcf(0x107),'compressionOptions':{'level':0x6}}),_0x5ad507;}[a127_0x537432(0x114)](_0x5beab7,_0x16c45c,_0x511d53){const _0x29a468=a127_0x537432,_0x5d0bf7=new Date()[_0x29a468(0xcc)](),_0x3bb3aa={};return _0x3bb3aa[constants_1[_0x29a468(0xb5)]+_0x29a468(0xb7)]=_0x16c45c,_0x3bb3aa[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x5beab7[_0x29a468(0xc3)],_0x3bb3aa[constants_1[_0x29a468(0xb5)]+'Changed_On__c']=_0x5d0bf7,_0x3bb3aa[constants_1[_0x29a468(0xb5)]+_0x29a468(0xe2)]=this[_0x29a468(0x10c)],_0x3bb3aa[constants_1['FLOSUM_NAMESPACE']+_0x29a468(0x104)]=_0x511d53?_0x511d53+0x1:0x1,_0x3bb3aa[constants_1[_0x29a468(0xbf)]+_0x29a468(0xee)]=!![],_0x3bb3aa;}['prepareComponentRecord'](_0x366bf5,_0x54f038){const _0xe3cb9c=a127_0x537432;var _0x17edad,_0x432cc3;const _0x261a29=new Date()[_0xe3cb9c(0xcc)](),_0x7ea22c={};return!_0x54f038?(this['branchId']?(_0x7ea22c[constants_1['FLOSUM_NAMESPACE']+_0xe3cb9c(0xe6)]=this[_0xe3cb9c(0xd7)],_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0x11b)]=_0xe3cb9c(0xd0),_0x7ea22c[_0xe3cb9c(0x100)]=(_0x17edad=this[_0xe3cb9c(0xce)][_0xe3cb9c(0xc8)](_0x25c3fb=>_0x25c3fb[_0xe3cb9c(0x113)]==='Branch'))===null||_0x17edad===void 0x0?void 0x0:_0x17edad['id']):(_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+'Repository__c']=this[_0xe3cb9c(0xdf)],_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0x11b)]=_0xe3cb9c(0x116),_0x7ea22c[_0xe3cb9c(0x100)]=(_0x432cc3=this[_0xe3cb9c(0xce)][_0xe3cb9c(0xc8)](_0x15f460=>_0x15f460[_0xe3cb9c(0x113)]==='Repository'))===null||_0x432cc3===void 0x0?void 0x0:_0x432cc3['id']),_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+'Version__c']=0x1):_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0x104)]=_0x54f038[_0xe3cb9c(0xf8)]+0x1,_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0xb4)]=_0x366bf5[_0xe3cb9c(0xcd)],_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0xb6)]=_0x366bf5[_0xe3cb9c(0x113)],_0x7ea22c[constants_1['FLOSUM_NAMESPACE']+_0xe3cb9c(0xc4)]=_0x366bf5[_0xe3cb9c(0xc1)],_0x7ea22c[constants_1['FLOSUM_NAMESPACE']+'Last_Updated_By__c']=this['username'],_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0xd3)]=this[_0xe3cb9c(0x10c)],_0x7ea22c[constants_1['FLOSUM_NAMESPACE']+_0xe3cb9c(0xd4)]=_0x261a29,_0x7ea22c[constants_1[_0xe3cb9c(0xb5)]+_0xe3cb9c(0xd5)]=_0x261a29,_0x7ea22c[constants_1['FLOSUM_NAMESPACE']+_0xe3cb9c(0x11c)]=_0x366bf5[_0xe3cb9c(0xc3)],_0x7ea22c;}[a127_0x537432(0xf0)](){const _0x314655=a127_0x537432;return this[_0x314655(0xf3)];}async[a127_0x537432(0xfc)](_0x2c8e7b,_0x19e432=''){const _0x3673a6=a127_0x537432,_0x133494=[];for(const _0x58efc3 of _0x2c8e7b){const _0x4b1cd6=composite_utils_1[_0x3673a6(0x101)](constants_1[_0x3673a6(0xd6)],this['prepareComponentRecord'](_0x58efc3)),_0x2cfbde=composite_utils_1[_0x3673a6(0x101)](constants_1[_0x3673a6(0xe3)],this['prepareComponentHistoryRecord'](_0x58efc3,'@{'+_0x4b1cd6['reference']+'.id}')),_0x274e1b=composite_utils_1['createPostRequest'](constants_1[_0x3673a6(0x115)],await this[_0x3673a6(0xf5)](_0x58efc3,'@{'+_0x2cfbde[_0x3673a6(0xe8)]+_0x3673a6(0xe9)));this[_0x3673a6(0xfa)](_0x4b1cd6[_0x3673a6(0xf1)][_0x3673a6(0xb8)],_0x4b1cd6['reference']),_0x133494[_0x3673a6(0xe1)](_0x4b1cd6[_0x3673a6(0xf1)],_0x2cfbde[_0x3673a6(0xf1)],_0x274e1b['request']),_0x19e432&&_0x133494[_0x3673a6(0xe1)](this[_0x3673a6(0xea)](_0x19e432,'@{'+_0x2cfbde[_0x3673a6(0xe8)]+'.id}'));}return _0x133494;}async[a127_0x537432(0xe7)](_0x2342d2,_0x42992e=''){const _0x37951b=a127_0x537432,_0x32b9de=[];for(const {component:_0x43f9b2,meta:_0x1dfb51}of _0x2342d2){if(!_0x1dfb51['id']){const _0x3615c0=this['proceededComponentsMeta'][_0x37951b(0xc8)](_0x23304c=>_0x23304c[_0x37951b(0xbd)]===_0x43f9b2[_0x37951b(0x113)]&&_0x23304c[_0x37951b(0xbc)]===_0x43f9b2[_0x37951b(0xcd)]);if(!_0x3615c0)throw new salesforce_error_1[(_0x37951b(0x117))](new Error(_0x37951b(0xeb)+_0x43f9b2['name']+'\x20['+_0x43f9b2['type']+_0x37951b(0x109)));_0x1dfb51['id']=_0x3615c0[_0x37951b(0xc2)];}const _0x314a80=composite_utils_1['createPatchRequest'](constants_1['FLOSUM_COMPONENT'],_0x1dfb51['id'],this[_0x37951b(0x111)](_0x43f9b2,_0x1dfb51)),_0x49bff7=composite_utils_1[_0x37951b(0x101)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x37951b(0x114)](_0x43f9b2,_0x1dfb51['id'],_0x1dfb51['version'])),_0x3fc364=composite_utils_1[_0x37951b(0x101)](constants_1[_0x37951b(0x115)],await this['prepareComponentAttachmentRecord'](_0x43f9b2,'@{'+_0x49bff7['reference']+_0x37951b(0xe9)));this[_0x37951b(0xfa)](_0x314a80[_0x37951b(0xf1)][_0x37951b(0xb8)],_0x314a80['reference']),_0x32b9de[_0x37951b(0xe1)](_0x314a80[_0x37951b(0xf1)],_0x49bff7[_0x37951b(0xf1)],_0x3fc364[_0x37951b(0xf1)]),_0x42992e&&_0x32b9de['push'](this[_0x37951b(0xea)](_0x42992e,'@{'+_0x49bff7[_0x37951b(0xe8)]+'.id}'));}return _0x32b9de;}async[a127_0x537432(0x118)](_0x1fa6fb,_0x2d001b=![]){const _0x3a61a4=a127_0x537432,_0x51f928={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x453569=[];for(const _0x2f34d3 of _0x1fa6fb){if(_0x2f34d3[_0x3a61a4(0xc2)])_0x453569[_0x3a61a4(0xe1)](_0x2f34d3[_0x3a61a4(0xc2)]);else{const _0x229f97=this['proceededComponentsMeta'][_0x3a61a4(0xc8)](_0x225322=>_0x225322[_0x3a61a4(0xbd)]===_0x2f34d3[_0x3a61a4(0xbd)]&&_0x225322[_0x3a61a4(0xbc)]===_0x2f34d3[_0x3a61a4(0xbc)]);if(!_0x229f97||!_0x229f97['componentId']){this['logger'][_0x3a61a4(0xed)](_0x3a61a4(0xd9)+_0x2f34d3[_0x3a61a4(0xbd)]+'\x20['+_0x2f34d3['componentType']+']');continue;}_0x453569[_0x3a61a4(0xe1)](_0x229f97['componentId']);}}if(_0x2d001b){const _0x39d277=await this['gitSync'][_0x3a61a4(0xca)](_0x453569);_0x51f928[_0x3a61a4(0xf7)]=_0x39d277[_0x3a61a4(0xff)](_0xa548a9=>composite_utils_1[_0x3a61a4(0xc7)](constants_1[_0x3a61a4(0xef)],_0xa548a9)[_0x3a61a4(0xf1)]);}return _0x51f928['componentsToUpdate']=_0x453569[_0x3a61a4(0xff)](_0x5518da=>composite_utils_1['createPatchRequest'](constants_1[_0x3a61a4(0xd6)],_0x5518da,{[constants_1[_0x3a61a4(0xbf)]+_0x3a61a4(0xc0)]:!![]})[_0x3a61a4(0xf1)]),_0x51f928['componentsToDelete']=_0x453569[_0x3a61a4(0xff)](_0x290d27=>composite_utils_1[_0x3a61a4(0xc7)](constants_1[_0x3a61a4(0xd6)],_0x290d27)[_0x3a61a4(0xf1)]),_0x51f928;}}exports[a127_0x537432(0x10f)]=SalesforceComponentsManager;