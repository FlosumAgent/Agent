const a127_0x14da08=a127_0x211e;(function(_0x5cf916,_0x1acc9b){const _0x14a7f2=a127_0x211e,_0x3b7227=_0x5cf916();while(!![]){try{const _0x476f46=parseInt(_0x14a7f2(0x205))/0x1+parseInt(_0x14a7f2(0x230))/0x2*(parseInt(_0x14a7f2(0x22c))/0x3)+-parseInt(_0x14a7f2(0x24a))/0x4+parseInt(_0x14a7f2(0x232))/0x5*(parseInt(_0x14a7f2(0x23a))/0x6)+-parseInt(_0x14a7f2(0x253))/0x7+parseInt(_0x14a7f2(0x20e))/0x8*(-parseInt(_0x14a7f2(0x204))/0x9)+parseInt(_0x14a7f2(0x20a))/0xa;if(_0x476f46===_0x1acc9b)break;else _0x3b7227['push'](_0x3b7227['shift']());}catch(_0x5f5513){_0x3b7227['push'](_0x3b7227['shift']());}}}(a127_0x1058,0x66b4f));const a127_0x1f9adf=function(){let _0x414810=!![];return function(_0x29d657,_0x1506af){const _0x511421=_0x414810?function(){const _0x4642c5=a127_0x211e;if(_0x1506af){const _0x4e35ed=_0x1506af[_0x4642c5(0x24f)](_0x29d657,arguments);return _0x1506af=null,_0x4e35ed;}}:function(){};return _0x414810=![],_0x511421;};}(),a127_0x464a48=a127_0x1f9adf(this,function(){const _0x4e71ac=a127_0x211e;return a127_0x464a48[_0x4e71ac(0x1fd)]()[_0x4e71ac(0x21e)](_0x4e71ac(0x243))[_0x4e71ac(0x1fd)]()[_0x4e71ac(0x23e)](a127_0x464a48)[_0x4e71ac(0x21e)]('(((.+)+)+)+$');});a127_0x464a48();'use strict';var __importDefault=this&&this[a127_0x14da08(0x203)]||function(_0x2d2590){const _0x22c8c2=a127_0x14da08;return _0x2d2590&&_0x2d2590[_0x22c8c2(0x214)]?_0x2d2590:{'default':_0x2d2590};};Object[a127_0x14da08(0x207)](exports,a127_0x14da08(0x214),{'value':!![]}),exports[a127_0x14da08(0x217)]=void 0x0;const constants_1=require(a127_0x14da08(0x23f)),core_1=require(a127_0x14da08(0x218)),zip_1=require(a127_0x14da08(0x20c)),typedi_1=__importDefault(require(a127_0x14da08(0x224))),salesforce_error_1=require(a127_0x14da08(0x212)),composite_utils_1=require(a127_0x14da08(0x21f)),flosum_naming_utils_1=require(a127_0x14da08(0x1f1)),salesforce_git_sync_service_1=require(a127_0x14da08(0x1f3));class SalesforceComponentsManager{constructor(_0x39c06c,_0x205074,_0x406291,_0x41fbea,_0x356260){const _0x571762=a127_0x14da08;this['repositoryId']=_0x39c06c,this[_0x571762(0x209)]=_0x205074,this[_0x571762(0x225)]=_0x406291,this[_0x571762(0x24b)]=_0x41fbea,this[_0x571762(0x244)]=_0x356260,this[_0x571762(0x1ff)]=new core_1[(_0x571762(0x246))](SalesforceComponentsManager[_0x571762(0x202)]),this[_0x571762(0x200)]=typedi_1[_0x571762(0x21b)]['get'](salesforce_git_sync_service_1['SalesforceGitSyncService']);}['proceedComponentMeta'](_0x2eec7c,_0xe30fc6){const _0x32206a=a127_0x14da08,_0xd184a7=flosum_naming_utils_1[_0x32206a(0x1f6)](_0x2eec7c,[_0x32206a(0x247),_0x32206a(0x215),_0x32206a(0x208)]);this[_0x32206a(0x244)][_0x32206a(0x20f)]({'componentId':'','reference':_0xe30fc6,'version':_0xd184a7[_0x32206a(0x208)],'componentName':_0xd184a7[_0x32206a(0x215)],'componentType':_0xd184a7[_0x32206a(0x247)]});}['prepareCommitManifest'](_0x2bf1aa,_0x5ad5ca){const _0x38066e=a127_0x14da08,{request:_0x2b2fb4}=composite_utils_1[_0x38066e(0x1f0)](constants_1['FLOSUM_COMMIT_MANIFEST'],{[constants_1[_0x38066e(0x236)]+_0x38066e(0x1f7)]:_0x2bf1aa,[constants_1[_0x38066e(0x236)]+_0x38066e(0x1f8)]:_0x5ad5ca});return _0x2b2fb4;}async[a127_0x14da08(0x20d)](_0xaf3657,_0xa7cf1c){const _0x187f5c=a127_0x14da08,_0x4fca44={},_0x49479c=zip_1[_0x187f5c(0x23d)][_0x187f5c(0x22e)]();for(const _0x248b84 of Object[_0x187f5c(0x238)](_0xaf3657[_0x187f5c(0x22d)])){_0x49479c['file'](_0x248b84,_0xaf3657[_0x187f5c(0x22d)][_0x248b84],{'createFolders':!![]});}return _0x4fca44[_0x187f5c(0x24e)]=_0x187f5c(0x211),_0x4fca44['Name']=_0xaf3657['type'],_0x4fca44[_0x187f5c(0x242)]=_0xaf3657['type'],_0x4fca44['ParentId']=_0xa7cf1c,_0x4fca44['Body']=await _0x49479c[_0x187f5c(0x1fc)]({'type':_0x187f5c(0x239),'compression':_0x187f5c(0x23b),'compressionOptions':{'level':0x6}}),_0x4fca44;}['prepareComponentHistoryRecord'](_0x780ad4,_0x23fdc4,_0x341f66){const _0x5e642a=a127_0x14da08,_0x4c4273=new Date()[_0x5e642a(0x22b)](),_0x344a22={};return _0x344a22[constants_1['FLOSUM_NAMESPACE']+_0x5e642a(0x1fa)]=_0x23fdc4,_0x344a22[constants_1['FLOSUM_NAMESPACE']+_0x5e642a(0x241)]=_0x780ad4[_0x5e642a(0x21a)],_0x344a22[constants_1['FLOSUM_NAMESPACE']+_0x5e642a(0x210)]=_0x4c4273,_0x344a22[constants_1[_0x5e642a(0x236)]+'Changed_By__c']=this[_0x5e642a(0x225)],_0x344a22[constants_1[_0x5e642a(0x236)]+_0x5e642a(0x208)]=_0x341f66?_0x341f66+0x1:0x1,_0x344a22[constants_1[_0x5e642a(0x21c)]+_0x5e642a(0x220)]=!![],_0x344a22;}[a127_0x14da08(0x1f5)](_0x276b3d,_0x5f31aa){const _0x4a659d=a127_0x14da08;var _0x45fafa,_0x12ec55;const _0x553ad8=new Date()[_0x4a659d(0x22b)](),_0x282131={};return!_0x5f31aa?(this['branchId']?(_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x1fe)]=this[_0x4a659d(0x209)],_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x255)]='Branch',_0x282131['RecordTypeId']=(_0x45fafa=this[_0x4a659d(0x24b)]['find'](_0xede091=>_0xede091['name']===_0x4a659d(0x222)))===null||_0x45fafa===void 0x0?void 0x0:_0x45fafa['id']):(_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x254)]=this[_0x4a659d(0x23c)],_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x255)]=_0x4a659d(0x245),_0x282131[_0x4a659d(0x213)]=(_0x12ec55=this[_0x4a659d(0x24b)][_0x4a659d(0x24c)](_0x5e84b1=>_0x5e84b1[_0x4a659d(0x202)]===_0x4a659d(0x245)))===null||_0x12ec55===void 0x0?void 0x0:_0x12ec55['id']),_0x282131[constants_1['FLOSUM_NAMESPACE']+'Version__c']=0x1):_0x282131[constants_1['FLOSUM_NAMESPACE']+_0x4a659d(0x208)]=_0x5f31aa[_0x4a659d(0x226)]+0x1,_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x247)]=_0x276b3d[_0x4a659d(0x219)],_0x282131[constants_1['FLOSUM_NAMESPACE']+_0x4a659d(0x215)]=_0x276b3d['name'],_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x231)]=_0x276b3d[_0x4a659d(0x221)],_0x282131[constants_1[_0x4a659d(0x236)]+_0x4a659d(0x20b)]=this['username'],_0x282131[constants_1[_0x4a659d(0x236)]+'Last_Modified_By__c']=this[_0x4a659d(0x225)],_0x282131[constants_1[_0x4a659d(0x236)]+'Last_Modified_Date__c']=_0x553ad8,_0x282131[constants_1['FLOSUM_NAMESPACE']+'Committed_On__c']=_0x553ad8,_0x282131[constants_1['FLOSUM_NAMESPACE']+'CRC32__c']=_0x276b3d['crc'],_0x282131;}[a127_0x14da08(0x22a)](){const _0x3e993e=a127_0x14da08;return this[_0x3e993e(0x244)];}async[a127_0x14da08(0x234)](_0x17828a,_0x1dea97=''){const _0x49e9b4=a127_0x14da08,_0x22a41f=[];for(const _0x3126f3 of _0x17828a){const _0x528116=composite_utils_1['createPostRequest'](constants_1[_0x49e9b4(0x21d)],this[_0x49e9b4(0x1f5)](_0x3126f3)),_0x35bf41=composite_utils_1[_0x49e9b4(0x1f0)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x49e9b4(0x24d)](_0x3126f3,'@{'+_0x528116[_0x49e9b4(0x250)]+_0x49e9b4(0x248))),_0x3f9598=composite_utils_1[_0x49e9b4(0x1f0)](constants_1[_0x49e9b4(0x1f2)],await this['prepareComponentAttachmentRecord'](_0x3126f3,'@{'+_0x35bf41[_0x49e9b4(0x250)]+'.id}'));this[_0x49e9b4(0x206)](_0x528116[_0x49e9b4(0x233)][_0x49e9b4(0x227)],_0x528116['reference']),_0x22a41f[_0x49e9b4(0x20f)](_0x528116[_0x49e9b4(0x233)],_0x35bf41['request'],_0x3f9598[_0x49e9b4(0x233)]),_0x1dea97&&_0x22a41f[_0x49e9b4(0x20f)](this['prepareCommitManifest'](_0x1dea97,'@{'+_0x35bf41['reference']+_0x49e9b4(0x248)));}return _0x22a41f;}async['update'](_0x45e6d1,_0xb68984=''){const _0x5f5abe=a127_0x14da08,_0x42b142=[];for(const {component:_0x1fa6f1,meta:_0x198057}of _0x45e6d1){if(!_0x198057['id']){const _0x34b635=this[_0x5f5abe(0x244)][_0x5f5abe(0x24c)](_0x678482=>_0x678482[_0x5f5abe(0x201)]===_0x1fa6f1[_0x5f5abe(0x202)]&&_0x678482[_0x5f5abe(0x251)]===_0x1fa6f1[_0x5f5abe(0x219)]);if(!_0x34b635)throw new salesforce_error_1[(_0x5f5abe(0x1fb))](new Error(_0x5f5abe(0x252)+_0x1fa6f1[_0x5f5abe(0x202)]+'\x20['+_0x1fa6f1['type']+_0x5f5abe(0x22f)));_0x198057['id']=_0x34b635[_0x5f5abe(0x1f4)];}const _0x15423d=composite_utils_1[_0x5f5abe(0x1f9)](constants_1[_0x5f5abe(0x21d)],_0x198057['id'],this[_0x5f5abe(0x1f5)](_0x1fa6f1,_0x198057)),_0x3282d0=composite_utils_1['createPostRequest'](constants_1[_0x5f5abe(0x216)],this[_0x5f5abe(0x24d)](_0x1fa6f1,_0x198057['id'],_0x198057[_0x5f5abe(0x226)])),_0x56cb5c=composite_utils_1[_0x5f5abe(0x1f0)](constants_1[_0x5f5abe(0x1f2)],await this['prepareComponentAttachmentRecord'](_0x1fa6f1,'@{'+_0x3282d0[_0x5f5abe(0x250)]+_0x5f5abe(0x248)));this['proceedComponentMeta'](_0x15423d[_0x5f5abe(0x233)]['body'],_0x15423d[_0x5f5abe(0x250)]),_0x42b142[_0x5f5abe(0x20f)](_0x15423d[_0x5f5abe(0x233)],_0x3282d0['request'],_0x56cb5c[_0x5f5abe(0x233)]),_0xb68984&&_0x42b142[_0x5f5abe(0x20f)](this[_0x5f5abe(0x249)](_0xb68984,'@{'+_0x3282d0[_0x5f5abe(0x250)]+'.id}'));}return _0x42b142;}async['delete'](_0x1b545d,_0x4033d8=![]){const _0x239d36=a127_0x14da08,_0x56c06a={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x8f28e1=[];for(const _0x4e8070 of _0x1b545d){if(_0x4e8070[_0x239d36(0x1f4)])_0x8f28e1[_0x239d36(0x20f)](_0x4e8070[_0x239d36(0x1f4)]);else{const _0x428de5=this['proceededComponentsMeta'][_0x239d36(0x24c)](_0x2c87a2=>_0x2c87a2['componentName']===_0x4e8070['componentName']&&_0x2c87a2[_0x239d36(0x251)]===_0x4e8070[_0x239d36(0x251)]);if(!_0x428de5||!_0x428de5[_0x239d36(0x1f4)]){this['logger']['error']('Could\x20not\x20find\x20meta\x20data\x20for\x20'+_0x4e8070[_0x239d36(0x201)]+'\x20['+_0x4e8070[_0x239d36(0x251)]+']');continue;}_0x8f28e1[_0x239d36(0x20f)](_0x428de5[_0x239d36(0x1f4)]);}}if(_0x4033d8){const _0x3c6602=await this[_0x239d36(0x200)][_0x239d36(0x235)](_0x8f28e1);_0x56c06a['manifests']=_0x3c6602[_0x239d36(0x228)](_0x1da783=>composite_utils_1['createDeleteRequest'](constants_1[_0x239d36(0x240)],_0x1da783)[_0x239d36(0x233)]);}return _0x56c06a[_0x239d36(0x223)]=_0x8f28e1['map'](_0x278bcf=>composite_utils_1[_0x239d36(0x1f9)](constants_1[_0x239d36(0x21d)],_0x278bcf,{[constants_1['FLOSUM_GIT_NAMESPACE']+_0x239d36(0x229)]:!![]})[_0x239d36(0x233)]),_0x56c06a['componentsToDelete']=_0x8f28e1[_0x239d36(0x228)](_0x3b98ac=>composite_utils_1[_0x239d36(0x237)](constants_1['FLOSUM_COMPONENT'],_0x3b98ac)[_0x239d36(0x233)]),_0x56c06a;}}function a127_0x1058(){const _0x4743cb=['prepareComponentRecord','extractFieldsFromRecord','Commit__c','Component_History__c','createPatchRequest','Component__c','SalesforceError','generateAsync','toString','Branch__c','logger','gitSync','componentName','name','__importDefault','9PtibPn','102368eDzmiY','proceedComponentMeta','defineProperty','Version__c','branchId','3166100hIDWzD','Last_Updated_By__c','../../parsers/utils/zip','prepareComponentAttachmentRecord','217176nZnPIl','push','Changed_On__c','application/zip','../errors/salesforce.error','RecordTypeId','__esModule','Component_Name__c','FLOSUM_COMPONENT_HISTORY','SalesforceComponentsManager','../../../core','type','crc','default','FLOSUM_GIT_NAMESPACE','FLOSUM_COMPONENT','search','../utils/composite.utils','Is_From_Agent__c','filePath','Branch','componentsToUpdate','typedi','username','version','body','map','Deletion_By_Agent__c','getProceededComponentsMeta','toISOString','3xOuiVq','files','createZip',']\x20-\x20meta\x20not\x20found','1600454CGNAss','File_Name__c','74810usGRLu','request','insert','fetchCommitManifestsByComponentIds','FLOSUM_NAMESPACE','createDeleteRequest','keys','base64','54osOArk','DEFLATE','repositoryId','Zip','constructor','../../../constants','FLOSUM_COMMIT_MANIFEST','CRC32__c','Description','(((.+)+)+)+$','proceededComponentsMeta','Repository','Logger','Component_Type__c','.id}','prepareCommitManifest','3125388iYNJXg','recordTypes','find','prepareComponentHistoryRecord','ContentType','apply','reference','componentType','Could\x20not\x20proceed\x20component\x20','872774dvMGOb','Repository__c','Source__c','createPostRequest','../utils/flosum-naming.utils','FLOSUM_ATTACHMENT','./salesforce-git-sync.service','componentId'];a127_0x1058=function(){return _0x4743cb;};return a127_0x1058();}function a127_0x211e(_0x5562f6,_0x160cad){const _0x5d56cd=a127_0x1058();return a127_0x211e=function(_0x464a48,_0x1f9adf){_0x464a48=_0x464a48-0x1f0;let _0x10583d=_0x5d56cd[_0x464a48];return _0x10583d;},a127_0x211e(_0x5562f6,_0x160cad);}exports[a127_0x14da08(0x217)]=SalesforceComponentsManager;