const a127_0x28ad11=a127_0x8d6f;(function(_0x2111da,_0x3c2def){const _0x140c3b=a127_0x8d6f,_0x4056f3=_0x2111da();while(!![]){try{const _0x707e73=parseInt(_0x140c3b(0x135))/0x1+-parseInt(_0x140c3b(0x10c))/0x2*(-parseInt(_0x140c3b(0x12d))/0x3)+-parseInt(_0x140c3b(0x103))/0x4+-parseInt(_0x140c3b(0x125))/0x5+-parseInt(_0x140c3b(0x136))/0x6+-parseInt(_0x140c3b(0x111))/0x7*(parseInt(_0x140c3b(0x138))/0x8)+parseInt(_0x140c3b(0xe7))/0x9;if(_0x707e73===_0x3c2def)break;else _0x4056f3['push'](_0x4056f3['shift']());}catch(_0x307e74){_0x4056f3['push'](_0x4056f3['shift']());}}}(a127_0x59c3,0xec135));const a127_0x5666a=function(){let _0x3071f3=!![];return function(_0x52a95b,_0x587e42){const _0x4f3623=_0x3071f3?function(){const _0x5e6752=a127_0x8d6f;if(_0x587e42){const _0x2293bc=_0x587e42[_0x5e6752(0xf9)](_0x52a95b,arguments);return _0x587e42=null,_0x2293bc;}}:function(){};return _0x3071f3=![],_0x4f3623;};}(),a127_0x13b4f9=a127_0x5666a(this,function(){const _0x2968e8=a127_0x8d6f;return a127_0x13b4f9[_0x2968e8(0x113)]()['search'](_0x2968e8(0x104))[_0x2968e8(0x113)]()[_0x2968e8(0x10a)](a127_0x13b4f9)['search'](_0x2968e8(0x104));});a127_0x13b4f9();'use strict';var __importDefault=this&&this[a127_0x28ad11(0x132)]||function(_0x3bf933){const _0x175c2e=a127_0x28ad11;return _0x3bf933&&_0x3bf933[_0x175c2e(0x10e)]?_0x3bf933:{'default':_0x3bf933};};function a127_0x59c3(){const _0x49b8eb=['type','update','createPostRequest','generateAsync','../../parsers/utils/zip','defineProperty','Last_Modified_By__c','6048920TlLMUd','componentsToUpdate','Branch__c','extractFieldsFromRecord','prepareComponentAttachmentRecord','version','Last_Updated_By__c','Component__c','39UMxqLv','gitSync','SalesforceComponentsManager','Is_From_Agent__c','Changed_By__c','__importDefault','CRC32__c','proceedComponentMeta','960452XvECXE','10275372BZjbqj','FLOSUM_ATTACHMENT','392JMPWto','request','FLOSUM_COMPONENT_HISTORY','FLOSUM_COMMIT_MANIFEST','RecordTypeId','Committed_On__c','logger','fetchCommitManifestsByComponentIds','branchId','Body','createZip','componentId','prepareCommitManifest','error','../utils/flosum-naming.utils','FLOSUM_NAMESPACE','43436601aQskRU','Version__c','File_Name__c','Commit__c','Component_Type__c','DEFLATE','name','Name','recordTypes','typedi','keys','application/zip','file','username','../../../constants','./salesforce-git-sync.service','.id}','../errors/salesforce.error','apply','manifests','body','proceededComponentsMeta','Could\x20not\x20find\x20meta\x20data\x20for\x20','Component_Name__c','../utils/composite.utils',']\x20-\x20meta\x20not\x20found','base64','componentName','5341580KrNcsv','(((.+)+)+)+$','ContentType','Logger','createDeleteRequest','prepareComponentHistoryRecord','repositoryId','constructor','files','187232sBtPJB','map','__esModule','reference','prepareComponentRecord','254149RabdiQ','find','toString','get','Component_History__c','FLOSUM_COMPONENT','crc','push','componentType','Description','toISOString','FLOSUM_GIT_NAMESPACE','Could\x20not\x20proceed\x20component\x20'];a127_0x59c3=function(){return _0x49b8eb;};return a127_0x59c3();}Object[a127_0x28ad11(0x123)](exports,a127_0x28ad11(0x10e),{'value':!![]}),exports[a127_0x28ad11(0x12f)]=void 0x0;const constants_1=require(a127_0x28ad11(0xf5)),core_1=require('../../../core'),zip_1=require(a127_0x28ad11(0x122)),typedi_1=__importDefault(require(a127_0x28ad11(0xf0))),salesforce_error_1=require(a127_0x28ad11(0xf8)),composite_utils_1=require(a127_0x28ad11(0xff)),flosum_naming_utils_1=require(a127_0x28ad11(0xe5)),salesforce_git_sync_service_1=require(a127_0x28ad11(0xf6));class SalesforceComponentsManager{constructor(_0x3c9c0a,_0x944153,_0x133d17,_0x36c279,_0x4581bd){const _0x25d1d7=a127_0x28ad11;this[_0x25d1d7(0x109)]=_0x3c9c0a,this[_0x25d1d7(0xdf)]=_0x944153,this[_0x25d1d7(0xf4)]=_0x133d17,this[_0x25d1d7(0xef)]=_0x36c279,this[_0x25d1d7(0xfc)]=_0x4581bd,this[_0x25d1d7(0xdd)]=new core_1[(_0x25d1d7(0x106))](SalesforceComponentsManager['name']),this['gitSync']=typedi_1['default'][_0x25d1d7(0x114)](salesforce_git_sync_service_1['SalesforceGitSyncService']);}['proceedComponentMeta'](_0x547a4c,_0x147118){const _0x555fbf=a127_0x28ad11,_0x2743b1=flosum_naming_utils_1[_0x555fbf(0x128)](_0x547a4c,[_0x555fbf(0xeb),_0x555fbf(0xfe),_0x555fbf(0xe8)]);this[_0x555fbf(0xfc)][_0x555fbf(0x118)]({'componentId':'','reference':_0x147118,'version':_0x2743b1[_0x555fbf(0xe8)],'componentName':_0x2743b1['Component_Name__c'],'componentType':_0x2743b1[_0x555fbf(0xeb)]});}[a127_0x28ad11(0xe3)](_0x3b90f2,_0x1b5ea2){const _0xf1b8dd=a127_0x28ad11,{request:_0x41bbe5}=composite_utils_1[_0xf1b8dd(0x120)](constants_1[_0xf1b8dd(0x13b)],{[constants_1['FLOSUM_NAMESPACE']+_0xf1b8dd(0xea)]:_0x3b90f2,[constants_1[_0xf1b8dd(0xe6)]+_0xf1b8dd(0x115)]:_0x1b5ea2});return _0x41bbe5;}async[a127_0x28ad11(0x129)](_0x51702b,_0x32b276){const _0x28d138=a127_0x28ad11,_0x5a2338={},_0x4a577c=zip_1['Zip'][_0x28d138(0xe1)]();for(const _0x35bfc7 of Object[_0x28d138(0xf1)](_0x51702b[_0x28d138(0x10b)])){_0x4a577c[_0x28d138(0xf3)](_0x35bfc7,_0x51702b[_0x28d138(0x10b)][_0x35bfc7],{'createFolders':!![]});}return _0x5a2338[_0x28d138(0x105)]=_0x28d138(0xf2),_0x5a2338[_0x28d138(0xee)]=_0x51702b[_0x28d138(0x11e)],_0x5a2338[_0x28d138(0x11a)]=_0x51702b['type'],_0x5a2338['ParentId']=_0x32b276,_0x5a2338[_0x28d138(0xe0)]=await _0x4a577c[_0x28d138(0x121)]({'type':_0x28d138(0x101),'compression':_0x28d138(0xec),'compressionOptions':{'level':0x6}}),_0x5a2338;}[a127_0x28ad11(0x108)](_0xeff7cc,_0x138ae1,_0x4209af){const _0x177f2c=a127_0x28ad11,_0x3e0209=new Date()[_0x177f2c(0x11b)](),_0x52c4fd={};return _0x52c4fd[constants_1[_0x177f2c(0xe6)]+_0x177f2c(0x12c)]=_0x138ae1,_0x52c4fd[constants_1[_0x177f2c(0xe6)]+_0x177f2c(0x133)]=_0xeff7cc[_0x177f2c(0x117)],_0x52c4fd[constants_1[_0x177f2c(0xe6)]+'Changed_On__c']=_0x3e0209,_0x52c4fd[constants_1[_0x177f2c(0xe6)]+_0x177f2c(0x131)]=this[_0x177f2c(0xf4)],_0x52c4fd[constants_1[_0x177f2c(0xe6)]+'Version__c']=_0x4209af?_0x4209af+0x1:0x1,_0x52c4fd[constants_1[_0x177f2c(0x11c)]+_0x177f2c(0x130)]=!![],_0x52c4fd;}[a127_0x28ad11(0x110)](_0x2e9c0d,_0x3bfd96){const _0x47f270=a127_0x28ad11;var _0xdd40ef,_0x45541a;const _0xb59c54=new Date()[_0x47f270(0x11b)](),_0x4fb122={};return!_0x3bfd96?(this[_0x47f270(0xdf)]?(_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0x127)]=this['branchId'],_0x4fb122[constants_1[_0x47f270(0xe6)]+'Source__c']='Branch',_0x4fb122['RecordTypeId']=(_0xdd40ef=this[_0x47f270(0xef)][_0x47f270(0x112)](_0x469800=>_0x469800[_0x47f270(0xed)]==='Branch'))===null||_0xdd40ef===void 0x0?void 0x0:_0xdd40ef['id']):(_0x4fb122[constants_1[_0x47f270(0xe6)]+'Repository__c']=this[_0x47f270(0x109)],_0x4fb122[constants_1[_0x47f270(0xe6)]+'Source__c']='Repository',_0x4fb122[_0x47f270(0x13c)]=(_0x45541a=this[_0x47f270(0xef)][_0x47f270(0x112)](_0xe94df2=>_0xe94df2[_0x47f270(0xed)]==='Repository'))===null||_0x45541a===void 0x0?void 0x0:_0x45541a['id']),_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xe8)]=0x1):_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xe8)]=_0x3bfd96['version']+0x1,_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xeb)]=_0x2e9c0d['type'],_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xfe)]=_0x2e9c0d[_0x47f270(0xed)],_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xe9)]=_0x2e9c0d['filePath'],_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0x12b)]=this['username'],_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0x124)]=this[_0x47f270(0xf4)],_0x4fb122[constants_1[_0x47f270(0xe6)]+'Last_Modified_Date__c']=_0xb59c54,_0x4fb122[constants_1[_0x47f270(0xe6)]+_0x47f270(0xdc)]=_0xb59c54,_0x4fb122[constants_1['FLOSUM_NAMESPACE']+_0x47f270(0x133)]=_0x2e9c0d['crc'],_0x4fb122;}['getProceededComponentsMeta'](){return this['proceededComponentsMeta'];}async['insert'](_0x52b4d6,_0x3c3904=''){const _0x5782d4=a127_0x28ad11,_0x126ff1=[];for(const _0x1007d5 of _0x52b4d6){const _0x58dd10=composite_utils_1['createPostRequest'](constants_1['FLOSUM_COMPONENT'],this[_0x5782d4(0x110)](_0x1007d5)),_0x284848=composite_utils_1[_0x5782d4(0x120)](constants_1[_0x5782d4(0x13a)],this['prepareComponentHistoryRecord'](_0x1007d5,'@{'+_0x58dd10[_0x5782d4(0x10f)]+'.id}')),_0x2452fb=composite_utils_1[_0x5782d4(0x120)](constants_1[_0x5782d4(0x137)],await this['prepareComponentAttachmentRecord'](_0x1007d5,'@{'+_0x284848[_0x5782d4(0x10f)]+_0x5782d4(0xf7)));this[_0x5782d4(0x134)](_0x58dd10[_0x5782d4(0x139)][_0x5782d4(0xfb)],_0x58dd10[_0x5782d4(0x10f)]),_0x126ff1['push'](_0x58dd10[_0x5782d4(0x139)],_0x284848['request'],_0x2452fb[_0x5782d4(0x139)]),_0x3c3904&&_0x126ff1[_0x5782d4(0x118)](this['prepareCommitManifest'](_0x3c3904,'@{'+_0x284848[_0x5782d4(0x10f)]+_0x5782d4(0xf7)));}return _0x126ff1;}async[a127_0x28ad11(0x11f)](_0x4c92d5,_0x447a44=''){const _0x4887fc=a127_0x28ad11,_0x7d98ad=[];for(const {component:_0x37c9ad,meta:_0x5b1e5c}of _0x4c92d5){if(!_0x5b1e5c['id']){const _0x224a24=this['proceededComponentsMeta']['find'](_0x15cfa1=>_0x15cfa1[_0x4887fc(0x102)]===_0x37c9ad[_0x4887fc(0xed)]&&_0x15cfa1['componentType']===_0x37c9ad[_0x4887fc(0x11e)]);if(!_0x224a24)throw new salesforce_error_1['SalesforceError'](new Error(_0x4887fc(0x11d)+_0x37c9ad[_0x4887fc(0xed)]+'\x20['+_0x37c9ad[_0x4887fc(0x11e)]+_0x4887fc(0x100)));_0x5b1e5c['id']=_0x224a24[_0x4887fc(0xe2)];}const _0x3d029a=composite_utils_1['createPatchRequest'](constants_1[_0x4887fc(0x116)],_0x5b1e5c['id'],this[_0x4887fc(0x110)](_0x37c9ad,_0x5b1e5c)),_0x4ca86f=composite_utils_1[_0x4887fc(0x120)](constants_1['FLOSUM_COMPONENT_HISTORY'],this[_0x4887fc(0x108)](_0x37c9ad,_0x5b1e5c['id'],_0x5b1e5c[_0x4887fc(0x12a)])),_0x40ffd0=composite_utils_1[_0x4887fc(0x120)](constants_1[_0x4887fc(0x137)],await this[_0x4887fc(0x129)](_0x37c9ad,'@{'+_0x4ca86f[_0x4887fc(0x10f)]+_0x4887fc(0xf7)));this[_0x4887fc(0x134)](_0x3d029a[_0x4887fc(0x139)][_0x4887fc(0xfb)],_0x3d029a['reference']),_0x7d98ad[_0x4887fc(0x118)](_0x3d029a[_0x4887fc(0x139)],_0x4ca86f[_0x4887fc(0x139)],_0x40ffd0[_0x4887fc(0x139)]),_0x447a44&&_0x7d98ad[_0x4887fc(0x118)](this[_0x4887fc(0xe3)](_0x447a44,'@{'+_0x4ca86f[_0x4887fc(0x10f)]+'.id}'));}return _0x7d98ad;}async['delete'](_0x116c8f,_0x931e09=![]){const _0x4f1158=a127_0x28ad11,_0x3b6c7d={'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]},_0x4927ab=[];for(const _0x5dd5cf of _0x116c8f){if(_0x5dd5cf['componentId'])_0x4927ab[_0x4f1158(0x118)](_0x5dd5cf[_0x4f1158(0xe2)]);else{const _0x4cefa0=this[_0x4f1158(0xfc)][_0x4f1158(0x112)](_0x4e5faf=>_0x4e5faf[_0x4f1158(0x102)]===_0x5dd5cf[_0x4f1158(0x102)]&&_0x4e5faf['componentType']===_0x5dd5cf[_0x4f1158(0x119)]);if(!_0x4cefa0||!_0x4cefa0[_0x4f1158(0xe2)]){this[_0x4f1158(0xdd)][_0x4f1158(0xe4)](_0x4f1158(0xfd)+_0x5dd5cf[_0x4f1158(0x102)]+'\x20['+_0x5dd5cf['componentType']+']');continue;}_0x4927ab[_0x4f1158(0x118)](_0x4cefa0['componentId']);}}if(_0x931e09){const _0x54d8ce=await this[_0x4f1158(0x12e)][_0x4f1158(0xde)](_0x4927ab);_0x3b6c7d[_0x4f1158(0xfa)]=_0x54d8ce[_0x4f1158(0x10d)](_0x273bf8=>composite_utils_1[_0x4f1158(0x107)](constants_1['FLOSUM_COMMIT_MANIFEST'],_0x273bf8)[_0x4f1158(0x139)]);}return _0x3b6c7d[_0x4f1158(0x126)]=_0x4927ab[_0x4f1158(0x10d)](_0x40a630=>composite_utils_1['createPatchRequest'](constants_1['FLOSUM_COMPONENT'],_0x40a630,{[constants_1[_0x4f1158(0x11c)]+'Deletion_By_Agent__c']:!![]})[_0x4f1158(0x139)]),_0x3b6c7d['componentsToDelete']=_0x4927ab['map'](_0x1208ec=>composite_utils_1[_0x4f1158(0x107)](constants_1['FLOSUM_COMPONENT'],_0x1208ec)['request']),_0x3b6c7d;}}function a127_0x8d6f(_0x3aae72,_0x3d8f1a){const _0x4d5196=a127_0x59c3();return a127_0x8d6f=function(_0x13b4f9,_0x5666a){_0x13b4f9=_0x13b4f9-0xdc;let _0x59c355=_0x4d5196[_0x13b4f9];return _0x59c355;},a127_0x8d6f(_0x3aae72,_0x3d8f1a);}exports[a127_0x28ad11(0x12f)]=SalesforceComponentsManager;