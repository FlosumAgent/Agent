const a125_0x43fc6a=a125_0x416e;function a125_0x416e(_0x5d9de8,_0x17d6f7){const _0x34382d=a125_0x44df();return a125_0x416e=function(_0x1cbec7,_0x1d5402){_0x1cbec7=_0x1cbec7-0x122;let _0x44df3b=_0x34382d[_0x1cbec7];return _0x44df3b;},a125_0x416e(_0x5d9de8,_0x17d6f7);}(function(_0x2a3835,_0x48732a){const _0x434fa4=a125_0x416e,_0x25b9a9=_0x2a3835();while(!![]){try{const _0x2279fb=parseInt(_0x434fa4(0x130))/0x1*(parseInt(_0x434fa4(0x122))/0x2)+parseInt(_0x434fa4(0x163))/0x3+parseInt(_0x434fa4(0x12e))/0x4+parseInt(_0x434fa4(0x14f))/0x5+parseInt(_0x434fa4(0x162))/0x6*(-parseInt(_0x434fa4(0x168))/0x7)+parseInt(_0x434fa4(0x16d))/0x8+-parseInt(_0x434fa4(0x13e))/0x9;if(_0x2279fb===_0x48732a)break;else _0x25b9a9['push'](_0x25b9a9['shift']());}catch(_0x120cca){_0x25b9a9['push'](_0x25b9a9['shift']());}}}(a125_0x44df,0xe401b));function a125_0x44df(){const _0x1cbf08=['Updating','error','force\x20update\x20token','InvalidRefreshTokenError','length','default','search','ERR_INVALID_SALESFORCE_TOKEN','create\x20authorized\x20request\x20failed:\x20authorization\x20error','AuthState','data','../../shared/utils','__importDefault','Logger','forceUpdateToken','../../../constants/errors','1423835dqMYIM','object','decorate','/services/oauth2/token','setAuthDetails','getOwnPropertyDescriptor','instanceUrl','refresh_token','salesforseSettings','loginUrl','settings','joinURL','../enums/auth-state.enum','waitAuth','instance_url','updateAccessToken','../errors/unauthorized-salesforce.error','log','AUTH_WAIT_TIME','6UzYskn','5444619PbNWHr','then','__metadata','metadata','../errors/invalid-refresh-token.error','5927474vHSSQs','Active','UnauthorizedSalesforceError','Error','authState','10513104GmwaNv','message','sleep','name','10WHGVJt','../../../constants','tokenType','axios','application/json','function','constructor','Idle','toString','orgId','logger','SALESFORCE_API_VERSION','6492908AtfnFp','get','132109qNInMJ','(((.+)+)+)+$','update\x20access\x20token\x20failed:\x20%s','Service','services/data/','post','update\x20access\x20token','accessToken','__esModule','SalesforceAuthService','response','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','SalesforceSettingsService','token_type','35251677PtpDFj'];a125_0x44df=function(){return _0x1cbf08;};return a125_0x44df();}const a125_0x1d5402=function(){let _0x1f86c1=!![];return function(_0x1e9e8e,_0x185719){const _0xcaa0d4=_0x1f86c1?function(){if(_0x185719){const _0x2d9831=_0x185719['apply'](_0x1e9e8e,arguments);return _0x185719=null,_0x2d9831;}}:function(){};return _0x1f86c1=![],_0xcaa0d4;};}(),a125_0x1cbec7=a125_0x1d5402(this,function(){const _0x5357dc=a125_0x416e;return a125_0x1cbec7['toString']()[_0x5357dc(0x145)](_0x5357dc(0x131))[_0x5357dc(0x12a)]()[_0x5357dc(0x128)](a125_0x1cbec7)[_0x5357dc(0x145)](_0x5357dc(0x131));});a125_0x1cbec7();'use strict';var __decorate=this&&this['__decorate']||function(_0x5c5514,_0x10e9c9,_0x478034,_0x274719){const _0x595727=a125_0x416e;var _0x410980=arguments[_0x595727(0x143)],_0x49d7cd=_0x410980<0x3?_0x10e9c9:_0x274719===null?_0x274719=Object[_0x595727(0x154)](_0x10e9c9,_0x478034):_0x274719,_0x5e849c;if(typeof Reflect===_0x595727(0x150)&&typeof Reflect[_0x595727(0x151)]===_0x595727(0x127))_0x49d7cd=Reflect[_0x595727(0x151)](_0x5c5514,_0x10e9c9,_0x478034,_0x274719);else{for(var _0x58b320=_0x5c5514[_0x595727(0x143)]-0x1;_0x58b320>=0x0;_0x58b320--)if(_0x5e849c=_0x5c5514[_0x58b320])_0x49d7cd=(_0x410980<0x3?_0x5e849c(_0x49d7cd):_0x410980>0x3?_0x5e849c(_0x10e9c9,_0x478034,_0x49d7cd):_0x5e849c(_0x10e9c9,_0x478034))||_0x49d7cd;}return _0x410980>0x3&&_0x49d7cd&&Object['defineProperty'](_0x10e9c9,_0x478034,_0x49d7cd),_0x49d7cd;},__metadata=this&&this[a125_0x43fc6a(0x165)]||function(_0x267a2e,_0x3a4418){const _0x2fa621=a125_0x43fc6a;if(typeof Reflect===_0x2fa621(0x150)&&typeof Reflect[_0x2fa621(0x166)]===_0x2fa621(0x127))return Reflect['metadata'](_0x267a2e,_0x3a4418);},__importDefault=this&&this[a125_0x43fc6a(0x14b)]||function(_0xb0d824){const _0x32545e=a125_0x43fc6a;return _0xb0d824&&_0xb0d824[_0x32545e(0x138)]?_0xb0d824:{'default':_0xb0d824};},SalesforceAuthService_1;Object['defineProperty'](exports,a125_0x43fc6a(0x138),{'value':!![]}),exports[a125_0x43fc6a(0x139)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a125_0x43fc6a(0x14e)),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a125_0x43fc6a(0x125))),utils_1=require(a125_0x43fc6a(0x14a)),invalid_refresh_token_error_1=require(a125_0x43fc6a(0x167)),auth_state_enum_1=require(a125_0x43fc6a(0x15b)),unauthorized_salesforce_error_1=require(a125_0x43fc6a(0x15f)),constants_1=require(a125_0x43fc6a(0x123));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x5f32ea){const _0x2cd4a1=a125_0x43fc6a;this[_0x2cd4a1(0x157)]=_0x5f32ea,this['AUTH_WAIT_TIME']=0x1388,this[_0x2cd4a1(0x16c)]=auth_state_enum_1[_0x2cd4a1(0x148)][_0x2cd4a1(0x129)],this[_0x2cd4a1(0x12c)]=new core_1[(_0x2cd4a1(0x14c))](SalesforceAuthService_1[_0x2cd4a1(0x170)]),this[_0x2cd4a1(0x153)]();}get['settings'](){const _0x4e1426=a125_0x43fc6a;return this['salesforseSettings'][_0x4e1426(0x159)];}async['setAuthDetails'](){const _0x226767=a125_0x43fc6a;this[_0x226767(0x12c)][_0x226767(0x160)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x226767(0x148)][this[_0x226767(0x16c)]]);try{if(this[_0x226767(0x16c)]===auth_state_enum_1[_0x226767(0x148)][_0x226767(0x16b)])return;if(this['authState']===auth_state_enum_1[_0x226767(0x148)][_0x226767(0x129)])await this[_0x226767(0x15e)]();else{const _0x24428f=await this['requestConfig'](),_0x41d095=await axios_1[_0x226767(0x144)][_0x226767(0x12f)](_0x226767(0x134)+constants_1[_0x226767(0x12d)],_0x24428f)[_0x226767(0x164)](()=>!![])['catch'](()=>![]);!_0x41d095&&await this[_0x226767(0x15e)]();}}catch(_0xa19039){}}async[a125_0x43fc6a(0x15e)](){const _0x4038d2=a125_0x43fc6a;var _0x4721fc,_0xce24ea,_0x31deae;this[_0x4038d2(0x12c)][_0x4038d2(0x160)](_0x4038d2(0x136));try{this['authState']=auth_state_enum_1[_0x4038d2(0x148)][_0x4038d2(0x13f)];const {refreshToken:_0x5edff4,clientId:_0x5d647a,clientSecret:_0x59fd98}=this[_0x4038d2(0x159)],{data:_0x33ec40}=await axios_1[_0x4038d2(0x144)][_0x4038d2(0x135)](utils_1[_0x4038d2(0x15a)](this['salesforseSettings'][_0x4038d2(0x158)],_0x4038d2(0x152)),null,{'params':{'grant_type':_0x4038d2(0x156),'refresh_token':_0x5edff4,'client_id':_0x5d647a,'client_secret':_0x59fd98}});this['instanceUrl']=_0x33ec40[_0x4038d2(0x15d)],this[_0x4038d2(0x137)]=_0x33ec40['access_token'],this[_0x4038d2(0x124)]=_0x33ec40[_0x4038d2(0x13d)],this[_0x4038d2(0x16c)]=auth_state_enum_1[_0x4038d2(0x148)][_0x4038d2(0x169)],this['logger'][_0x4038d2(0x160)]('access\x20token\x20updated\x20for\x20%s',this[_0x4038d2(0x155)]);}catch(_0x42d258){const _0x110875=((_0xce24ea=(_0x4721fc=_0x42d258===null||_0x42d258===void 0x0?void 0x0:_0x42d258[_0x4038d2(0x13a)])===null||_0x4721fc===void 0x0?void 0x0:_0x4721fc[_0x4038d2(0x149)])===null||_0xce24ea===void 0x0?void 0x0:_0xce24ea[_0x4038d2(0x140)])||((_0x31deae=_0x42d258===null||_0x42d258===void 0x0?void 0x0:_0x42d258['response'])===null||_0x31deae===void 0x0?void 0x0:_0x31deae[_0x4038d2(0x149)])||_0x42d258[_0x4038d2(0x16e)];this[_0x4038d2(0x12c)][_0x4038d2(0x140)](_0x4038d2(0x132),_0x110875),this[_0x4038d2(0x16c)]=auth_state_enum_1[_0x4038d2(0x148)][_0x4038d2(0x16b)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x4038d2(0x146)]);}}async[a125_0x43fc6a(0x14d)](){const _0x44334f=a125_0x43fc6a;this['logger'][_0x44334f(0x160)](_0x44334f(0x141));if(this[_0x44334f(0x16c)]===auth_state_enum_1['AuthState'][_0x44334f(0x13f)]||this[_0x44334f(0x16c)]===auth_state_enum_1[_0x44334f(0x148)][_0x44334f(0x129)])return await utils_1[_0x44334f(0x16f)](this[_0x44334f(0x161)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x44334f(0x148)][_0x44334f(0x16b)])throw new invalid_refresh_token_error_1[(_0x44334f(0x142))](errors_1[_0x44334f(0x146)]);await this[_0x44334f(0x15e)]();}async[a125_0x43fc6a(0x15c)](){const _0x3a992d=a125_0x43fc6a;if(this['authState']===auth_state_enum_1[_0x3a992d(0x148)]['Error']){this['logger'][_0x3a992d(0x160)](_0x3a992d(0x147));throw new unauthorized_salesforce_error_1[(_0x3a992d(0x16a))]();}if(this[_0x3a992d(0x16c)]!==auth_state_enum_1[_0x3a992d(0x148)][_0x3a992d(0x169)])return this[_0x3a992d(0x12c)][_0x3a992d(0x160)](_0x3a992d(0x13b)),await utils_1[_0x3a992d(0x16f)](this[_0x3a992d(0x161)]),this['waitAuth']();}['getAuthData'](){const _0x245a24=a125_0x43fc6a;return{'orgId':this[_0x245a24(0x12b)],'accessToken':this[_0x245a24(0x137)],'instanceUrl':this[_0x245a24(0x155)]};}async['requestConfig'](){const _0x3f9c10=a125_0x43fc6a;return await this[_0x3f9c10(0x15c)](),{'baseURL':this['instanceUrl'],'headers':{'accept':_0x3f9c10(0x126),'authorization':this[_0x3f9c10(0x124)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a125_0x43fc6a(0x133)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a125_0x43fc6a(0x13c)]])],SalesforceAuthService),exports[a125_0x43fc6a(0x139)]=SalesforceAuthService;