const a106_0x5068=['design:paramtypes','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','authState','41xBQhri','constructor','__esModule','updateAccessToken','58621svTXQq','accessToken','requestConfig','test','9157XAycYr','5iwoMeW','/services/oauth2/token','post','access_token','AuthState','Idle','object','instance_url','message','default','109SyIGSy','response','Error','AUTH_WAIT_TIME','UnauthorizedSalesforceError','getOwnPropertyDescriptor','settings','apply','../../../constants','SalesforceAuthService','forceUpdateToken','__decorate','420890tjxvqk','6701ucUqTx','14797QMPgPf','catch','../../shared/services/salesforce-settings.service','get','metadata','Active','__importDefault','services/data/','axios','SalesforceSettingsService','101teZIRU','ERR_INVALID_SALESFORCE_TOKEN','15273jCDOwC','../enums/auth-state.enum','decorate','then','data','check\x20auth:\x20current\x20state\x20-\x20%s','1iZKlet','../../shared/utils','sleep','joinURL','create\x20authorized\x20request\x20failed:\x20authorization\x20error','loginUrl','defineProperty','function','instanceUrl','29CpNehi','salesforseSettings','name','226960ZYquGh','length','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','logger','../errors/invalid-refresh-token.error','Updating','InvalidRefreshTokenError','../../../core','__metadata','application/json','error','setAuthDetails','tokenType','log'];const a106_0x5d3b43=a106_0x8fcb;(function(_0xc4c8e7,_0x1d1ab4){const _0x4320c3=a106_0x8fcb;while(!![]){try{const _0x324892=-parseInt(_0x4320c3(0x6d))*-parseInt(_0x4320c3(0xb1))+parseInt(_0x4320c3(0x7e))*parseInt(_0x4320c3(0x9f))+parseInt(_0x4320c3(0x9d))+-parseInt(_0x4320c3(0x9e))*-parseInt(_0x4320c3(0x91))+parseInt(_0x4320c3(0x87))*-parseInt(_0x4320c3(0x82))+parseInt(_0x4320c3(0x86))*parseInt(_0x4320c3(0x6a))+-parseInt(_0x4320c3(0xab))*parseInt(_0x4320c3(0xa9));if(_0x324892===_0x1d1ab4)break;else _0xc4c8e7['push'](_0xc4c8e7['shift']());}catch(_0x284b92){_0xc4c8e7['push'](_0xc4c8e7['shift']());}}}(a106_0x5068,0x6545b));const a106_0x2ceb67=function(){let _0x2fd835=!![];return function(_0xd9be75,_0x59410b){const _0x147f87=_0x2fd835?function(){const _0x320bed=a106_0x8fcb;if(_0x59410b){const _0x31a989=_0x59410b[_0x320bed(0x98)](_0xd9be75,arguments);return _0x59410b=null,_0x31a989;}}:function(){};return _0x2fd835=![],_0x147f87;};}(),a106_0x2f9323=a106_0x2ceb67(this,function(){const _0x2de0a9=function(){const _0x5b0bbc=a106_0x8fcb,_0x118a6d=_0x2de0a9[_0x5b0bbc(0x7f)]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x5b0bbc(0x7f)](_0x5b0bbc(0x7c));return!_0x118a6d[_0x5b0bbc(0x85)](a106_0x2f9323);};return _0x2de0a9();});a106_0x2f9323();'use strict';var __decorate=this&&this[a106_0x5d3b43(0x9c)]||function(_0x1e115b,_0xf1a9f7,_0x262315,_0x4f9d53){const _0x4a5263=a106_0x5d3b43;var _0x29104c=arguments[_0x4a5263(0x6e)],_0x305e61=_0x29104c<0x3?_0xf1a9f7:_0x4f9d53===null?_0x4f9d53=Object[_0x4a5263(0x96)](_0xf1a9f7,_0x262315):_0x4f9d53,_0x203788;if(typeof Reflect===_0x4a5263(0x8d)&&typeof Reflect[_0x4a5263(0xad)]===_0x4a5263(0x68))_0x305e61=Reflect['decorate'](_0x1e115b,_0xf1a9f7,_0x262315,_0x4f9d53);else{for(var _0x45d130=_0x1e115b[_0x4a5263(0x6e)]-0x1;_0x45d130>=0x0;_0x45d130--)if(_0x203788=_0x1e115b[_0x45d130])_0x305e61=(_0x29104c<0x3?_0x203788(_0x305e61):_0x29104c>0x3?_0x203788(_0xf1a9f7,_0x262315,_0x305e61):_0x203788(_0xf1a9f7,_0x262315))||_0x305e61;}return _0x29104c>0x3&&_0x305e61&&Object[_0x4a5263(0x67)](_0xf1a9f7,_0x262315,_0x305e61),_0x305e61;},__metadata=this&&this[a106_0x5d3b43(0x75)]||function(_0x5d06bb,_0x176255){const _0x26849a=a106_0x5d3b43;if(typeof Reflect===_0x26849a(0x8d)&&typeof Reflect[_0x26849a(0xa3)]===_0x26849a(0x68))return Reflect[_0x26849a(0xa3)](_0x5d06bb,_0x176255);},__importDefault=this&&this[a106_0x5d3b43(0xa5)]||function(_0x50dd21){return _0x50dd21&&_0x50dd21['__esModule']?_0x50dd21:{'default':_0x50dd21};},SalesforceAuthService_1;Object[a106_0x5d3b43(0x67)](exports,a106_0x5d3b43(0x80),{'value':!![]}),exports[a106_0x5d3b43(0x9a)]=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require(a106_0x5d3b43(0x74)),salesforce_settings_service_1=require(a106_0x5d3b43(0xa1)),axios_1=__importDefault(require(a106_0x5d3b43(0xa7))),utils_1=require(a106_0x5d3b43(0xb2)),invalid_refresh_token_error_1=require(a106_0x5d3b43(0x71)),auth_state_enum_1=require(a106_0x5d3b43(0xac)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a106_0x5d3b43(0x99));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x22733a){const _0x1834ed=a106_0x5d3b43;this[_0x1834ed(0x6b)]=_0x22733a,this[_0x1834ed(0x94)]=0x1388,this[_0x1834ed(0x7d)]=auth_state_enum_1[_0x1834ed(0x8b)]['Idle'],this[_0x1834ed(0x70)]=new core_1['Logger'](SalesforceAuthService_1[_0x1834ed(0x6c)]),this['setAuthDetails']();}get[a106_0x5d3b43(0x97)](){const _0x13b890=a106_0x5d3b43;return this[_0x13b890(0x6b)]['settings'];}async[a106_0x5d3b43(0x78)](){const _0x927c18=a106_0x5d3b43;this[_0x927c18(0x70)][_0x927c18(0x7a)](_0x927c18(0xb0),auth_state_enum_1[_0x927c18(0x8b)][this[_0x927c18(0x7d)]]);try{if(this[_0x927c18(0x7d)]===auth_state_enum_1[_0x927c18(0x8b)][_0x927c18(0x93)])return;if(this[_0x927c18(0x7d)]===auth_state_enum_1[_0x927c18(0x8b)][_0x927c18(0x8c)])await this[_0x927c18(0x81)]();else{const _0x21fbd7=await this['requestConfig'](),_0x42c266=await axios_1[_0x927c18(0x90)][_0x927c18(0xa2)](_0x927c18(0xa6)+constants_1['SALESFORCE_API_VERSION'],_0x21fbd7)[_0x927c18(0xae)](()=>!![])[_0x927c18(0xa0)](()=>![]);!_0x42c266&&await this[_0x927c18(0x81)]();}}catch(_0x49f725){}}async[a106_0x5d3b43(0x81)](){const _0x1cd1a2=a106_0x5d3b43;var _0x4b0d63,_0x1a4292,_0x4acb92;this[_0x1cd1a2(0x70)][_0x1cd1a2(0x7a)]('update\x20access\x20token');try{this[_0x1cd1a2(0x7d)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x4369e0,clientId:_0x1627ec,clientSecret:_0x45c584}=this[_0x1cd1a2(0x97)],{data:_0x29cfde}=await axios_1[_0x1cd1a2(0x90)][_0x1cd1a2(0x89)](utils_1[_0x1cd1a2(0x64)](this[_0x1cd1a2(0x6b)][_0x1cd1a2(0x66)],_0x1cd1a2(0x88)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x4369e0,'client_id':_0x1627ec,'client_secret':_0x45c584}});this[_0x1cd1a2(0x69)]=_0x29cfde[_0x1cd1a2(0x8e)],this[_0x1cd1a2(0x83)]=_0x29cfde[_0x1cd1a2(0x8a)],this[_0x1cd1a2(0x79)]=_0x29cfde['token_type'],this['authState']=auth_state_enum_1[_0x1cd1a2(0x8b)][_0x1cd1a2(0xa4)],this['logger'][_0x1cd1a2(0x7a)]('access\x20token\x20updated\x20for\x20%s',this[_0x1cd1a2(0x69)]);}catch(_0x5a17b0){const _0x23497b=((_0x1a4292=(_0x4b0d63=_0x5a17b0===null||_0x5a17b0===void 0x0?void 0x0:_0x5a17b0[_0x1cd1a2(0x92)])===null||_0x4b0d63===void 0x0?void 0x0:_0x4b0d63[_0x1cd1a2(0xaf)])===null||_0x1a4292===void 0x0?void 0x0:_0x1a4292[_0x1cd1a2(0x77)])||((_0x4acb92=_0x5a17b0===null||_0x5a17b0===void 0x0?void 0x0:_0x5a17b0[_0x1cd1a2(0x92)])===null||_0x4acb92===void 0x0?void 0x0:_0x4acb92[_0x1cd1a2(0xaf)])||_0x5a17b0[_0x1cd1a2(0x8f)];this[_0x1cd1a2(0x70)][_0x1cd1a2(0x77)]('update\x20access\x20token\x20failed:\x20%s',_0x23497b),this['authState']=auth_state_enum_1[_0x1cd1a2(0x8b)]['Error'];throw new invalid_refresh_token_error_1[(_0x1cd1a2(0x73))](errors_1[_0x1cd1a2(0xaa)]);}}async[a106_0x5d3b43(0x9b)](){const _0x9475c8=a106_0x5d3b43;this[_0x9475c8(0x70)][_0x9475c8(0x7a)]('force\x20update\x20token');if(this[_0x9475c8(0x7d)]===auth_state_enum_1[_0x9475c8(0x8b)][_0x9475c8(0x72)]||this[_0x9475c8(0x7d)]===auth_state_enum_1['AuthState'][_0x9475c8(0x8c)])return await utils_1['sleep'](this[_0x9475c8(0x94)]),this[_0x9475c8(0x9b)]();if(this['authState']===auth_state_enum_1[_0x9475c8(0x8b)][_0x9475c8(0x93)])throw new invalid_refresh_token_error_1[(_0x9475c8(0x73))](errors_1[_0x9475c8(0xaa)]);await this['updateAccessToken']();}async[a106_0x5d3b43(0x84)](){const _0x47f819=a106_0x5d3b43;if(this[_0x47f819(0x7d)]===auth_state_enum_1['AuthState'][_0x47f819(0x93)]){this[_0x47f819(0x70)][_0x47f819(0x7a)](_0x47f819(0x65));throw new unauthorized_salesforce_error_1[(_0x47f819(0x95))]();}if(this['authState']!==auth_state_enum_1[_0x47f819(0x8b)]['Active'])return this[_0x47f819(0x70)]['log'](_0x47f819(0x6f)),await utils_1[_0x47f819(0xb3)](this['AUTH_WAIT_TIME']),this[_0x47f819(0x84)]();return{'baseURL':this['instanceUrl'],'headers':{'accept':_0x47f819(0x76),'content-type':_0x47f819(0x76),'authorization':this['tokenType']+'\x20'+this[_0x47f819(0x83)]}};}};function a106_0x8fcb(_0x336060,_0x10f0a5){return a106_0x8fcb=function(_0x2aa7cc,_0x2f9323){_0x2aa7cc=_0x2aa7cc-0x64;let _0x2ceb67=a106_0x5068[_0x2aa7cc];return _0x2ceb67;},a106_0x8fcb(_0x336060,_0x10f0a5);}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a106_0x5d3b43(0x7b),[salesforce_settings_service_1[a106_0x5d3b43(0xa8)]])],SalesforceAuthService),exports[a106_0x5d3b43(0x9a)]=SalesforceAuthService;