const a103_0x1722=['../../../core','14686RjNWEj','371074RSwtNl','loginUrl','apply','length','__metadata','../../shared/utils','log','../enums/auth-state.enum','../errors/unauthorized-salesforce.error','function','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','accessToken','../../shared/services/salesforce-settings.service','instanceUrl','Updating','get','requestConfig','axios','salesforce-auth-service','settings','1Wmsybw','post','return\x20/\x22\x20+\x20this\x20+\x20\x22/','forceUpdateToken','95398gqrfOq','../errors/invalid-refresh-token.error','error','then','ERR_INVALID_SALESFORCE_TOKEN','../../../constants/errors','update\x20access\x20token\x20failed:\x20%s','instance_url','decorate','application/json','__importDefault','update\x20access\x20token','../../../constants','data','/services/oauth2/token','Error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','UnauthorizedSalesforceError','tokenType','response','6pBQJTz','access\x20token\x20updated\x20for\x20%s','InvalidRefreshTokenError','3Rbmdnz','updateAccessToken','default','Service','290209oeKnLo','access_token','defineProperty','getOwnPropertyDescriptor','SalesforceAuthService','refresh_token','AUTH_WAIT_TIME','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','metadata','SalesforceSettingsService','3802DWjklA','typedi','message','136yUtbjz','constructor','sleep','salesforseSettings','object','296WsjpJa','Idle','260409TBIscl','catch','Active','__esModule','authState','AuthState'];const a103_0x4b7aa4=a103_0x7cd6;(function(_0x77df3d,_0x193b83){const _0x2bcf93=a103_0x7cd6;while(!![]){try{const _0x2a37a6=parseInt(_0x2bcf93(0x94))+-parseInt(_0x2bcf93(0x8c))+-parseInt(_0x2bcf93(0xc7))*-parseInt(_0x2bcf93(0xa8))+parseInt(_0x2bcf93(0xc3))*-parseInt(_0x2bcf93(0xac))+parseInt(_0x2bcf93(0x93))+-parseInt(_0x2bcf93(0xc0))*-parseInt(_0x2bcf93(0xd1))+-parseInt(_0x2bcf93(0x8a))*-parseInt(_0x2bcf93(0xd4));if(_0x2a37a6===_0x193b83)break;else _0x77df3d['push'](_0x77df3d['shift']());}catch(_0x2a2fd0){_0x77df3d['push'](_0x77df3d['shift']());}}}(a103_0x1722,0x2efb2));const a103_0x3e2daa=function(){let _0x328e6a=!![];return function(_0xb91389,_0x9f1eb3){const _0x10bf4e=_0x328e6a?function(){const _0x3bdc12=a103_0x7cd6;if(_0x9f1eb3){const _0x498846=_0x9f1eb3[_0x3bdc12(0x96)](_0xb91389,arguments);return _0x9f1eb3=null,_0x498846;}}:function(){};return _0x328e6a=![],_0x10bf4e;};}(),a103_0x2d5a86=a103_0x3e2daa(this,function(){const _0x1ce1a1=function(){const _0x4a0ec9=a103_0x7cd6,_0x2738c8=_0x1ce1a1['constructor'](_0x4a0ec9(0xaa))()[_0x4a0ec9(0x86)](_0x4a0ec9(0xce));return!_0x2738c8['test'](a103_0x2d5a86);};return _0x1ce1a1();});a103_0x2d5a86();'use strict';function a103_0x7cd6(_0x1dfc70,_0xaef04b){return a103_0x7cd6=function(_0x49f9ea,_0x2d5a86){_0x49f9ea=_0x49f9ea-0x86;let _0x3e2daa=a103_0x1722[_0x49f9ea];return _0x3e2daa;},a103_0x7cd6(_0x1dfc70,_0xaef04b);}var __decorate=this&&this['__decorate']||function(_0x353a84,_0x22b1dd,_0x3943b6,_0x1548c5){const _0x3f2cf3=a103_0x7cd6;var _0x49d4e1=arguments[_0x3f2cf3(0x97)],_0x28e0f8=_0x49d4e1<0x3?_0x22b1dd:_0x1548c5===null?_0x1548c5=Object[_0x3f2cf3(0xca)](_0x22b1dd,_0x3943b6):_0x1548c5,_0x32f7ea;if(typeof Reflect===_0x3f2cf3(0x89)&&typeof Reflect[_0x3f2cf3(0xb4)]===_0x3f2cf3(0x9d))_0x28e0f8=Reflect['decorate'](_0x353a84,_0x22b1dd,_0x3943b6,_0x1548c5);else{for(var _0x373d1e=_0x353a84[_0x3f2cf3(0x97)]-0x1;_0x373d1e>=0x0;_0x373d1e--)if(_0x32f7ea=_0x353a84[_0x373d1e])_0x28e0f8=(_0x49d4e1<0x3?_0x32f7ea(_0x28e0f8):_0x49d4e1>0x3?_0x32f7ea(_0x22b1dd,_0x3943b6,_0x28e0f8):_0x32f7ea(_0x22b1dd,_0x3943b6))||_0x28e0f8;}return _0x49d4e1>0x3&&_0x28e0f8&&Object[_0x3f2cf3(0xc9)](_0x22b1dd,_0x3943b6,_0x28e0f8),_0x28e0f8;},__metadata=this&&this[a103_0x4b7aa4(0x98)]||function(_0x207c0e,_0x35bc20){const _0x51ed20=a103_0x4b7aa4;if(typeof Reflect===_0x51ed20(0x89)&&typeof Reflect[_0x51ed20(0xcf)]===_0x51ed20(0x9d))return Reflect[_0x51ed20(0xcf)](_0x207c0e,_0x35bc20);},__importDefault=this&&this[a103_0x4b7aa4(0xb6)]||function(_0x352279){const _0x10397d=a103_0x4b7aa4;return _0x352279&&_0x352279[_0x10397d(0x8f)]?_0x352279:{'default':_0x352279};};Object[a103_0x4b7aa4(0xc9)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a103_0x4b7aa4(0xd2)),errors_1=require(a103_0x4b7aa4(0xb1)),core_1=require(a103_0x4b7aa4(0x92)),salesforce_settings_service_1=require(a103_0x4b7aa4(0xa0)),axios_1=__importDefault(require(a103_0x4b7aa4(0xa5))),utils_1=require(a103_0x4b7aa4(0x99)),invalid_refresh_token_error_1=require(a103_0x4b7aa4(0xad)),auth_state_enum_1=require(a103_0x4b7aa4(0x9b)),unauthorized_salesforce_error_1=require(a103_0x4b7aa4(0x9c)),constants_1=require(a103_0x4b7aa4(0xb8)),logger=new core_1['Logger'](a103_0x4b7aa4(0xa6));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x27e538){const _0x31d694=a103_0x4b7aa4;this['salesforseSettings']=_0x27e538,this['AUTH_WAIT_TIME']=0x1388,this[_0x31d694(0x90)]=auth_state_enum_1[_0x31d694(0x91)]['Idle'],this['setAuthDetails']();}get[a103_0x4b7aa4(0xa7)](){const _0x205ff4=a103_0x4b7aa4;return this[_0x205ff4(0x88)][_0x205ff4(0xa7)];}async['setAuthDetails'](){const _0x4c7d6b=a103_0x4b7aa4;logger[_0x4c7d6b(0x9a)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4c7d6b(0x91)][this[_0x4c7d6b(0x90)]]);try{if(this['authState']===auth_state_enum_1[_0x4c7d6b(0x91)][_0x4c7d6b(0xbb)])return;if(this[_0x4c7d6b(0x90)]===auth_state_enum_1[_0x4c7d6b(0x91)][_0x4c7d6b(0x8b)])await this[_0x4c7d6b(0xc4)]();else{const _0x59cee5=await this[_0x4c7d6b(0xa4)](),_0x28e177=await axios_1[_0x4c7d6b(0xc5)][_0x4c7d6b(0xa3)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x59cee5)[_0x4c7d6b(0xaf)](()=>!![])[_0x4c7d6b(0x8d)](()=>![]);!_0x28e177&&await this[_0x4c7d6b(0xc4)]();}}catch(_0x1c54b2){}}async['updateAccessToken'](){const _0x377cc5=a103_0x4b7aa4;var _0x2955dd,_0x2bebc9,_0x218899;logger['log'](_0x377cc5(0xb7));try{this['authState']=auth_state_enum_1['AuthState'][_0x377cc5(0xa2)];const {refreshToken:_0x4b7f09,clientId:_0xf27efa,clientSecret:_0x2758ae}=this[_0x377cc5(0xa7)],{data:_0x36b3f4}=await axios_1[_0x377cc5(0xc5)][_0x377cc5(0xa9)](utils_1['joinURL'](this[_0x377cc5(0x88)][_0x377cc5(0x95)],_0x377cc5(0xba)),null,{'params':{'grant_type':_0x377cc5(0xcc),'refresh_token':_0x4b7f09,'client_id':_0xf27efa,'client_secret':_0x2758ae}});this[_0x377cc5(0xa1)]=_0x36b3f4[_0x377cc5(0xb3)],this[_0x377cc5(0x9f)]=_0x36b3f4[_0x377cc5(0xc8)],this[_0x377cc5(0xbe)]=_0x36b3f4['token_type'],this['authState']=auth_state_enum_1[_0x377cc5(0x91)][_0x377cc5(0x8e)],logger['log'](_0x377cc5(0xc1),this[_0x377cc5(0xa1)]);}catch(_0x41b127){const _0x854b8c=((_0x2bebc9=(_0x2955dd=_0x41b127===null||_0x41b127===void 0x0?void 0x0:_0x41b127[_0x377cc5(0xbf)])===null||_0x2955dd===void 0x0?void 0x0:_0x2955dd['data'])===null||_0x2bebc9===void 0x0?void 0x0:_0x2bebc9[_0x377cc5(0xae)])||((_0x218899=_0x41b127===null||_0x41b127===void 0x0?void 0x0:_0x41b127[_0x377cc5(0xbf)])===null||_0x218899===void 0x0?void 0x0:_0x218899[_0x377cc5(0xb9)])||_0x41b127[_0x377cc5(0xd3)];logger['error'](_0x377cc5(0xb2),_0x854b8c),this['authState']=auth_state_enum_1[_0x377cc5(0x91)]['Error'];throw new invalid_refresh_token_error_1[(_0x377cc5(0xc2))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a103_0x4b7aa4(0xab)](){const _0x3b3669=a103_0x4b7aa4;logger[_0x3b3669(0x9a)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x3b3669(0x91)][_0x3b3669(0xa2)]||this[_0x3b3669(0x90)]===auth_state_enum_1[_0x3b3669(0x91)][_0x3b3669(0x8b)])return await utils_1[_0x3b3669(0x87)](this[_0x3b3669(0xcd)]),this[_0x3b3669(0xab)]();if(this[_0x3b3669(0x90)]===auth_state_enum_1[_0x3b3669(0x91)]['Error'])throw new invalid_refresh_token_error_1[(_0x3b3669(0xc2))](errors_1[_0x3b3669(0xb0)]);await this['updateAccessToken']();}async['requestConfig'](){const _0x167961=a103_0x4b7aa4;if(this[_0x167961(0x90)]===auth_state_enum_1['AuthState'][_0x167961(0xbb)]){logger[_0x167961(0x9a)](_0x167961(0xbc));throw new unauthorized_salesforce_error_1[(_0x167961(0xbd))]();}if(this[_0x167961(0x90)]!==auth_state_enum_1['AuthState'][_0x167961(0x8e)])return logger[_0x167961(0x9a)](_0x167961(0x9e)),await utils_1[_0x167961(0x87)](this[_0x167961(0xcd)]),this[_0x167961(0xa4)]();return{'baseURL':this[_0x167961(0xa1)],'headers':{'accept':_0x167961(0xb5),'content-type':_0x167961(0xb5),'authorization':this[_0x167961(0xbe)]+'\x20'+this[_0x167961(0x9f)]}};}};SalesforceAuthService=__decorate([typedi_1[a103_0x4b7aa4(0xc6)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a103_0x4b7aa4(0xd0)]])],SalesforceAuthService),exports[a103_0x4b7aa4(0xcb)]=SalesforceAuthService;