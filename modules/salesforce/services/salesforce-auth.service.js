const a125_0x14486a=a125_0x2c83;function a125_0x2c83(_0x46d55b,_0x3bdb43){const _0x3a2b61=a125_0x16a3();return a125_0x2c83=function(_0xe069bd,_0x4741dd){_0xe069bd=_0xe069bd-0x65;let _0x16a312=_0x3a2b61[_0xe069bd];return _0x16a312;},a125_0x2c83(_0x46d55b,_0x3bdb43);}(function(_0x61f3ef,_0x5bce76){const _0x59360d=a125_0x2c83,_0x441563=_0x61f3ef();while(!![]){try{const _0x5747db=-parseInt(_0x59360d(0xa6))/0x1+-parseInt(_0x59360d(0x7d))/0x2*(parseInt(_0x59360d(0x9b))/0x3)+-parseInt(_0x59360d(0x69))/0x4*(parseInt(_0x59360d(0xac))/0x5)+-parseInt(_0x59360d(0x98))/0x6+-parseInt(_0x59360d(0x90))/0x7+parseInt(_0x59360d(0x8c))/0x8*(-parseInt(_0x59360d(0x8f))/0x9)+parseInt(_0x59360d(0x7b))/0xa;if(_0x5747db===_0x5bce76)break;else _0x441563['push'](_0x441563['shift']());}catch(_0x210e4f){_0x441563['push'](_0x441563['shift']());}}}(a125_0x16a3,0x4cfb0));const a125_0x4741dd=function(){let _0x473fea=!![];return function(_0x3391c0,_0x21c830){const _0xb968a=_0x473fea?function(){if(_0x21c830){const _0x15487a=_0x21c830['apply'](_0x3391c0,arguments);return _0x21c830=null,_0x15487a;}}:function(){};return _0x473fea=![],_0xb968a;};}(),a125_0xe069bd=a125_0x4741dd(this,function(){const _0x15f5de=a125_0x2c83;return a125_0xe069bd[_0x15f5de(0x96)]()['search'](_0x15f5de(0xad))[_0x15f5de(0x96)]()[_0x15f5de(0x80)](a125_0xe069bd)[_0x15f5de(0x6a)](_0x15f5de(0xad));});a125_0xe069bd();'use strict';var __decorate=this&&this[a125_0x14486a(0x81)]||function(_0x443293,_0xbfa415,_0x36a2a7,_0x47e4d7){const _0x18145b=a125_0x14486a;var _0x583915=arguments[_0x18145b(0xb7)],_0x3930c6=_0x583915<0x3?_0xbfa415:_0x47e4d7===null?_0x47e4d7=Object['getOwnPropertyDescriptor'](_0xbfa415,_0x36a2a7):_0x47e4d7,_0x485913;if(typeof Reflect===_0x18145b(0x86)&&typeof Reflect['decorate']===_0x18145b(0x91))_0x3930c6=Reflect[_0x18145b(0xb2)](_0x443293,_0xbfa415,_0x36a2a7,_0x47e4d7);else{for(var _0x310b36=_0x443293['length']-0x1;_0x310b36>=0x0;_0x310b36--)if(_0x485913=_0x443293[_0x310b36])_0x3930c6=(_0x583915<0x3?_0x485913(_0x3930c6):_0x583915>0x3?_0x485913(_0xbfa415,_0x36a2a7,_0x3930c6):_0x485913(_0xbfa415,_0x36a2a7))||_0x3930c6;}return _0x583915>0x3&&_0x3930c6&&Object[_0x18145b(0xa5)](_0xbfa415,_0x36a2a7,_0x3930c6),_0x3930c6;},__metadata=this&&this[a125_0x14486a(0x8a)]||function(_0x5df67a,_0x4d42e1){const _0x477a63=a125_0x14486a;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x477a63(0x91))return Reflect[_0x477a63(0xb6)](_0x5df67a,_0x4d42e1);},__importDefault=this&&this[a125_0x14486a(0xa7)]||function(_0x1a9a05){const _0x52b22e=a125_0x14486a;return _0x1a9a05&&_0x1a9a05[_0x52b22e(0xa1)]?_0x1a9a05:{'default':_0x1a9a05};},SalesforceAuthService_1;Object[a125_0x14486a(0xa5)](exports,'__esModule',{'value':!![]}),exports[a125_0x14486a(0x76)]=void 0x0;const typedi_1=require(a125_0x14486a(0x89)),errors_1=require(a125_0x14486a(0x97)),core_1=require(a125_0x14486a(0xaa)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a125_0x14486a(0x7a))),utils_1=require(a125_0x14486a(0xa3)),invalid_refresh_token_error_1=require(a125_0x14486a(0x70)),auth_state_enum_1=require(a125_0x14486a(0x88)),unauthorized_salesforce_error_1=require(a125_0x14486a(0x8e)),constants_1=require(a125_0x14486a(0x83));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4b7d98){const _0x5242d7=a125_0x14486a;this['salesforseSettings']=_0x4b7d98,this[_0x5242d7(0x6e)]=0x1388,this['authState']=auth_state_enum_1[_0x5242d7(0x75)]['Idle'],this[_0x5242d7(0x6d)]=new core_1[(_0x5242d7(0x95))](SalesforceAuthService_1[_0x5242d7(0x8d)]),this[_0x5242d7(0x79)]();}get[a125_0x14486a(0x9f)](){const _0x4bf4f=a125_0x14486a;return this[_0x4bf4f(0x68)][_0x4bf4f(0x9f)];}async[a125_0x14486a(0x79)](){const _0x4852cc=a125_0x14486a;this[_0x4852cc(0x6d)]['log'](_0x4852cc(0x93),auth_state_enum_1[_0x4852cc(0x75)][this[_0x4852cc(0xb3)]]);try{if(this['authState']===auth_state_enum_1[_0x4852cc(0x75)][_0x4852cc(0xa2)])return;if(this[_0x4852cc(0xb3)]===auth_state_enum_1[_0x4852cc(0x75)][_0x4852cc(0x6b)])await this['updateAccessToken']();else{const _0x3ba0cf=await this[_0x4852cc(0x8b)](),_0x3e56a8=await axios_1['default'][_0x4852cc(0xb1)](_0x4852cc(0x94)+constants_1[_0x4852cc(0x77)],_0x3ba0cf)[_0x4852cc(0x66)](()=>!![])[_0x4852cc(0xb9)](()=>![]);!_0x3e56a8&&await this[_0x4852cc(0xb8)]();}}catch(_0x563eff){}}async[a125_0x14486a(0xb8)](){const _0x31a666=a125_0x14486a;var _0x75505,_0x5fc204,_0x3ba3fe;this[_0x31a666(0x6d)][_0x31a666(0x9c)](_0x31a666(0x72));try{this[_0x31a666(0xb3)]=auth_state_enum_1[_0x31a666(0x75)][_0x31a666(0xa8)];const {refreshToken:_0x48c492,clientId:_0x37f354,clientSecret:_0x413b30}=this[_0x31a666(0x9f)],{data:_0xcdd274}=await axios_1[_0x31a666(0xa9)][_0x31a666(0xaf)](utils_1[_0x31a666(0x65)](this[_0x31a666(0x68)]['loginUrl'],_0x31a666(0x6c)),null,{'params':{'grant_type':_0x31a666(0x82),'refresh_token':_0x48c492,'client_id':_0x37f354,'client_secret':_0x413b30}});this[_0x31a666(0xa0)]=_0xcdd274[_0x31a666(0x92)],this[_0x31a666(0x9d)]=_0xcdd274[_0x31a666(0xb4)],this[_0x31a666(0x87)]=_0xcdd274[_0x31a666(0xae)],this['authState']=auth_state_enum_1[_0x31a666(0x75)][_0x31a666(0x85)],this[_0x31a666(0x6d)][_0x31a666(0x9c)](_0x31a666(0x9e),this[_0x31a666(0xa0)]);}catch(_0x5e0040){const _0x3d75fc=((_0x5fc204=(_0x75505=_0x5e0040===null||_0x5e0040===void 0x0?void 0x0:_0x5e0040[_0x31a666(0x9a)])===null||_0x75505===void 0x0?void 0x0:_0x75505[_0x31a666(0xa4)])===null||_0x5fc204===void 0x0?void 0x0:_0x5fc204[_0x31a666(0xab)])||((_0x3ba3fe=_0x5e0040===null||_0x5e0040===void 0x0?void 0x0:_0x5e0040[_0x31a666(0x9a)])===null||_0x3ba3fe===void 0x0?void 0x0:_0x3ba3fe['data'])||_0x5e0040[_0x31a666(0x71)];this[_0x31a666(0x6d)][_0x31a666(0xab)](_0x31a666(0x7e),_0x3d75fc),this[_0x31a666(0xb3)]=auth_state_enum_1[_0x31a666(0x75)]['Error'];throw new invalid_refresh_token_error_1[(_0x31a666(0xb5))](errors_1[_0x31a666(0xb0)]);}}async[a125_0x14486a(0x78)](){const _0x176822=a125_0x14486a;this[_0x176822(0x6d)][_0x176822(0x9c)](_0x176822(0x7f));if(this['authState']===auth_state_enum_1['AuthState'][_0x176822(0xa8)]||this[_0x176822(0xb3)]===auth_state_enum_1[_0x176822(0x75)]['Idle'])return await utils_1[_0x176822(0x74)](this[_0x176822(0x6e)]),this[_0x176822(0x78)]();if(this[_0x176822(0xb3)]===auth_state_enum_1[_0x176822(0x75)][_0x176822(0xa2)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x176822(0xb0)]);await this[_0x176822(0xb8)]();}async[a125_0x14486a(0x7c)](){const _0x2a098c=a125_0x14486a;if(this[_0x2a098c(0xb3)]===auth_state_enum_1[_0x2a098c(0x75)][_0x2a098c(0xa2)]){this[_0x2a098c(0x6d)][_0x2a098c(0x9c)](_0x2a098c(0x67));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x2a098c(0xb3)]!==auth_state_enum_1[_0x2a098c(0x75)]['Active'])return this['logger'][_0x2a098c(0x9c)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x2a098c(0x74)](this['AUTH_WAIT_TIME']),this['waitAuth']();}['getAuthData'](){const _0x52ebc6=a125_0x14486a;return{'orgId':this[_0x52ebc6(0x99)],'accessToken':this['accessToken'],'instanceUrl':this['instanceUrl']};}async[a125_0x14486a(0x8b)](){const _0xe999fa=a125_0x14486a;return await this[_0xe999fa(0x7c)](),{'baseURL':this[_0xe999fa(0xa0)],'headers':{'accept':_0xe999fa(0x84),'authorization':this[_0xe999fa(0x87)]+'\x20'+this[_0xe999fa(0x9d)]}};}};function a125_0x16a3(){const _0x5d6c3a=['Updating','default','../../../core','error','2860035tsBeAz','(((.+)+)+)+$','token_type','post','ERR_INVALID_SALESFORCE_TOKEN','get','decorate','authState','access_token','InvalidRefreshTokenError','metadata','length','updateAccessToken','catch','joinURL','then','create\x20authorized\x20request\x20failed:\x20authorization\x20error','salesforseSettings','4MItpvN','search','Idle','/services/oauth2/token','logger','AUTH_WAIT_TIME','design:paramtypes','../errors/invalid-refresh-token.error','message','update\x20access\x20token','SalesforceSettingsService','sleep','AuthState','SalesforceAuthService','SALESFORCE_API_VERSION','forceUpdateToken','setAuthDetails','axios','19672260FafKoB','waitAuth','2lVRbNx','update\x20access\x20token\x20failed:\x20%s','force\x20update\x20token','constructor','__decorate','refresh_token','../../../constants','application/json','Active','object','tokenType','../enums/auth-state.enum','typedi','__metadata','requestConfig','278808IvvJse','name','../errors/unauthorized-salesforce.error','9loswgF','1603784GApCRX','function','instance_url','check\x20auth:\x20current\x20state\x20-\x20%s','services/data/','Logger','toString','../../../constants/errors','1071138duTPAE','orgId','response','1420458ucdWUc','log','accessToken','access\x20token\x20updated\x20for\x20%s','settings','instanceUrl','__esModule','Error','../../shared/utils','data','defineProperty','163935AaVlcM','__importDefault'];a125_0x16a3=function(){return _0x5d6c3a;};return a125_0x16a3();}SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a125_0x14486a(0x6f),[salesforce_settings_service_1[a125_0x14486a(0x73)]])],SalesforceAuthService),exports[a125_0x14486a(0x76)]=SalesforceAuthService;