const a119_0x19078b=a119_0x1ea2;(function(_0x50dbf7,_0x258840){const _0x592f67=a119_0x1ea2,_0x3a41cb=_0x50dbf7();while(!![]){try{const _0x16ee57=-parseInt(_0x592f67(0x214))/0x1*(-parseInt(_0x592f67(0x23d))/0x2)+-parseInt(_0x592f67(0x224))/0x3*(-parseInt(_0x592f67(0x212))/0x4)+parseInt(_0x592f67(0x1fe))/0x5+parseInt(_0x592f67(0x230))/0x6*(-parseInt(_0x592f67(0x21a))/0x7)+parseInt(_0x592f67(0x20a))/0x8*(parseInt(_0x592f67(0x218))/0x9)+parseInt(_0x592f67(0x213))/0xa*(parseInt(_0x592f67(0x1ff))/0xb)+-parseInt(_0x592f67(0x1f4))/0xc;if(_0x16ee57===_0x258840)break;else _0x3a41cb['push'](_0x3a41cb['shift']());}catch(_0x5c49c9){_0x3a41cb['push'](_0x3a41cb['shift']());}}}(a119_0x37cc,0x6efd9));const a119_0x48e09d=function(){let _0x3b2ef1=!![];return function(_0x2b0f4c,_0xb1f52){const _0x59582e=_0x3b2ef1?function(){if(_0xb1f52){const _0x1d2b68=_0xb1f52['apply'](_0x2b0f4c,arguments);return _0xb1f52=null,_0x1d2b68;}}:function(){};return _0x3b2ef1=![],_0x59582e;};}(),a119_0x2a3774=a119_0x48e09d(this,function(){const _0x35ed64=a119_0x1ea2;return a119_0x2a3774[_0x35ed64(0x235)]()[_0x35ed64(0x1ed)](_0x35ed64(0x209))[_0x35ed64(0x235)]()[_0x35ed64(0x20d)](a119_0x2a3774)[_0x35ed64(0x1ed)]('(((.+)+)+)+$');});function a119_0x37cc(){const _0x3ac53b=['9HISLoE','instance_url','427Gcobpf','design:paramtypes','tokenType','UnauthorizedSalesforceError','instanceUrl','Error','Service','SalesforceSettingsService','joinURL','../errors/unauthorized-salesforce.error','3xqGevs','orgId','application/json','SALESFORCE_API_VERSION','forceUpdateToken','getAuthData','access\x20token\x20updated\x20for\x20%s','defineProperty','../errors/invalid-refresh-token.error','axios','AuthState','update\x20access\x20token','51966qZaZyM','force\x20update\x20token','AUTH_WAIT_TIME','catch','salesforseSettings','toString','settings','Active','getOwnPropertyDescriptor','__esModule','metadata','default','error','938074GSEUuj','services/data/','data','length','__importDefault','search','then','../enums/auth-state.enum','create\x20authorized\x20request\x20failed:\x20authorization\x20error','updateAccessToken','update\x20access\x20token\x20failed:\x20%s','decorate','7446516ooWIqV','access_token','message','../../shared/utils','object','sleep','Updating','requestConfig','accessToken','log','4422555NzFTiB','152427JbdvtH','setAuthDetails','Idle','get','waitAuth','../../../constants','InvalidRefreshTokenError','refresh_token','logger','__metadata','(((.+)+)+)+$','1502632EBXWZr','/services/oauth2/token','function','constructor','authState','check\x20auth:\x20current\x20state\x20-\x20%s','ERR_INVALID_SALESFORCE_TOKEN','loginUrl','192988wPlEOg','10OdKHFm','1TRKKxA','name','Logger','../../../constants/errors'];a119_0x37cc=function(){return _0x3ac53b;};return a119_0x37cc();}a119_0x2a3774();'use strict';var __decorate=this&&this['__decorate']||function(_0x1b49ac,_0xd21819,_0x28fe54,_0x2bda7c){const _0xa4efee=a119_0x1ea2;var _0x4d2aeb=arguments[_0xa4efee(0x1eb)],_0x29d092=_0x4d2aeb<0x3?_0xd21819:_0x2bda7c===null?_0x2bda7c=Object[_0xa4efee(0x238)](_0xd21819,_0x28fe54):_0x2bda7c,_0x3f2688;if(typeof Reflect===_0xa4efee(0x1f8)&&typeof Reflect[_0xa4efee(0x1f3)]===_0xa4efee(0x20c))_0x29d092=Reflect['decorate'](_0x1b49ac,_0xd21819,_0x28fe54,_0x2bda7c);else{for(var _0x35175b=_0x1b49ac[_0xa4efee(0x1eb)]-0x1;_0x35175b>=0x0;_0x35175b--)if(_0x3f2688=_0x1b49ac[_0x35175b])_0x29d092=(_0x4d2aeb<0x3?_0x3f2688(_0x29d092):_0x4d2aeb>0x3?_0x3f2688(_0xd21819,_0x28fe54,_0x29d092):_0x3f2688(_0xd21819,_0x28fe54))||_0x29d092;}return _0x4d2aeb>0x3&&_0x29d092&&Object[_0xa4efee(0x22b)](_0xd21819,_0x28fe54,_0x29d092),_0x29d092;},__metadata=this&&this[a119_0x19078b(0x208)]||function(_0x4fd540,_0x7586e6){const _0xe56420=a119_0x19078b;if(typeof Reflect===_0xe56420(0x1f8)&&typeof Reflect[_0xe56420(0x23a)]==='function')return Reflect[_0xe56420(0x23a)](_0x4fd540,_0x7586e6);},__importDefault=this&&this[a119_0x19078b(0x1ec)]||function(_0x416a1e){const _0x21bda7=a119_0x19078b;return _0x416a1e&&_0x416a1e[_0x21bda7(0x239)]?_0x416a1e:{'default':_0x416a1e};},SalesforceAuthService_1;Object[a119_0x19078b(0x22b)](exports,a119_0x19078b(0x239),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require(a119_0x19078b(0x217)),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a119_0x19078b(0x22d))),utils_1=require(a119_0x19078b(0x1f7)),invalid_refresh_token_error_1=require(a119_0x19078b(0x22c)),auth_state_enum_1=require(a119_0x19078b(0x1ef)),unauthorized_salesforce_error_1=require(a119_0x19078b(0x223)),constants_1=require(a119_0x19078b(0x204));function a119_0x1ea2(_0x4ad223,_0x114c02){const _0x242349=a119_0x37cc();return a119_0x1ea2=function(_0x2a3774,_0x48e09d){_0x2a3774=_0x2a3774-0x1e9;let _0x37cc1b=_0x242349[_0x2a3774];return _0x37cc1b;},a119_0x1ea2(_0x4ad223,_0x114c02);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x12b68f){const _0x318d14=a119_0x19078b;this[_0x318d14(0x234)]=_0x12b68f,this[_0x318d14(0x232)]=0x1388,this[_0x318d14(0x20e)]=auth_state_enum_1[_0x318d14(0x22e)]['Idle'],this[_0x318d14(0x207)]=new core_1[(_0x318d14(0x216))](SalesforceAuthService_1[_0x318d14(0x215)]),this[_0x318d14(0x200)]();}get['settings'](){return this['salesforseSettings']['settings'];}async[a119_0x19078b(0x200)](){const _0x22155e=a119_0x19078b;this['logger'][_0x22155e(0x1fd)](_0x22155e(0x20f),auth_state_enum_1[_0x22155e(0x22e)][this['authState']]);try{if(this[_0x22155e(0x20e)]===auth_state_enum_1['AuthState'][_0x22155e(0x21f)])return;if(this[_0x22155e(0x20e)]===auth_state_enum_1[_0x22155e(0x22e)][_0x22155e(0x201)])await this[_0x22155e(0x1f1)]();else{const _0x75e154=await this[_0x22155e(0x1fb)](),_0x340cb7=await axios_1[_0x22155e(0x23b)][_0x22155e(0x202)](_0x22155e(0x1e9)+constants_1[_0x22155e(0x227)],_0x75e154)[_0x22155e(0x1ee)](()=>!![])[_0x22155e(0x233)](()=>![]);!_0x340cb7&&await this[_0x22155e(0x1f1)]();}}catch(_0x285649){}}async['updateAccessToken'](){const _0x13e722=a119_0x19078b;var _0x3c328b,_0x47c295,_0x53e360;this[_0x13e722(0x207)]['log'](_0x13e722(0x22f));try{this['authState']=auth_state_enum_1[_0x13e722(0x22e)][_0x13e722(0x1fa)];const {refreshToken:_0x131685,clientId:_0xe63a0,clientSecret:_0x5805a8}=this[_0x13e722(0x236)],{data:_0x169ff2}=await axios_1[_0x13e722(0x23b)]['post'](utils_1[_0x13e722(0x222)](this[_0x13e722(0x234)][_0x13e722(0x211)],_0x13e722(0x20b)),null,{'params':{'grant_type':_0x13e722(0x206),'refresh_token':_0x131685,'client_id':_0xe63a0,'client_secret':_0x5805a8}});this[_0x13e722(0x21e)]=_0x169ff2[_0x13e722(0x219)],this['accessToken']=_0x169ff2[_0x13e722(0x1f5)],this[_0x13e722(0x21c)]=_0x169ff2['token_type'],this[_0x13e722(0x20e)]=auth_state_enum_1[_0x13e722(0x22e)][_0x13e722(0x237)],this[_0x13e722(0x207)]['log'](_0x13e722(0x22a),this[_0x13e722(0x21e)]);}catch(_0x4b9bac){const _0x27fadb=((_0x47c295=(_0x3c328b=_0x4b9bac===null||_0x4b9bac===void 0x0?void 0x0:_0x4b9bac['response'])===null||_0x3c328b===void 0x0?void 0x0:_0x3c328b[_0x13e722(0x1ea)])===null||_0x47c295===void 0x0?void 0x0:_0x47c295[_0x13e722(0x23c)])||((_0x53e360=_0x4b9bac===null||_0x4b9bac===void 0x0?void 0x0:_0x4b9bac['response'])===null||_0x53e360===void 0x0?void 0x0:_0x53e360[_0x13e722(0x1ea)])||_0x4b9bac[_0x13e722(0x1f6)];this[_0x13e722(0x207)]['error'](_0x13e722(0x1f2),_0x27fadb),this[_0x13e722(0x20e)]=auth_state_enum_1[_0x13e722(0x22e)]['Error'];throw new invalid_refresh_token_error_1[(_0x13e722(0x205))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a119_0x19078b(0x228)](){const _0x52749a=a119_0x19078b;this['logger'][_0x52749a(0x1fd)](_0x52749a(0x231));if(this[_0x52749a(0x20e)]===auth_state_enum_1[_0x52749a(0x22e)]['Updating']||this[_0x52749a(0x20e)]===auth_state_enum_1[_0x52749a(0x22e)][_0x52749a(0x201)])return await utils_1[_0x52749a(0x1f9)](this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x52749a(0x22e)][_0x52749a(0x21f)])throw new invalid_refresh_token_error_1[(_0x52749a(0x205))](errors_1[_0x52749a(0x210)]);await this[_0x52749a(0x1f1)]();}async[a119_0x19078b(0x203)](){const _0x23dd5f=a119_0x19078b;if(this[_0x23dd5f(0x20e)]===auth_state_enum_1['AuthState'][_0x23dd5f(0x21f)]){this['logger'][_0x23dd5f(0x1fd)](_0x23dd5f(0x1f0));throw new unauthorized_salesforce_error_1[(_0x23dd5f(0x21d))]();}if(this['authState']!==auth_state_enum_1[_0x23dd5f(0x22e)][_0x23dd5f(0x237)])return this['logger']['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x23dd5f(0x1f9)](this[_0x23dd5f(0x232)]),this[_0x23dd5f(0x203)]();}[a119_0x19078b(0x229)](){const _0x3402db=a119_0x19078b;return{'orgId':this[_0x3402db(0x225)],'accessToken':this['accessToken'],'instanceUrl':this[_0x3402db(0x21e)]};}async[a119_0x19078b(0x1fb)](){const _0x1fbb8a=a119_0x19078b;return await this[_0x1fbb8a(0x203)](),{'baseURL':this[_0x1fbb8a(0x21e)],'headers':{'accept':_0x1fbb8a(0x226),'authorization':this[_0x1fbb8a(0x21c)]+'\x20'+this[_0x1fbb8a(0x1fc)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a119_0x19078b(0x220)](),__metadata(a119_0x19078b(0x21b),[salesforce_settings_service_1[a119_0x19078b(0x221)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;