const a108_0x512d40=a108_0x571a;function a108_0x571a(_0x54b140,_0x31cea5){const _0x17a384=a108_0xafe8();return a108_0x571a=function(_0x3f38aa,_0x48cf8f){_0x3f38aa=_0x3f38aa-0x8e;let _0xafe893=_0x17a384[_0x3f38aa];return _0xafe893;},a108_0x571a(_0x54b140,_0x31cea5);}(function(_0x1b0e48,_0x3edfa6){const _0x2f4c85=a108_0x571a,_0x4cc1c4=_0x1b0e48();while(!![]){try{const _0x40f8ed=-parseInt(_0x2f4c85(0xd0))/0x1+-parseInt(_0x2f4c85(0xbf))/0x2*(-parseInt(_0x2f4c85(0x92))/0x3)+-parseInt(_0x2f4c85(0xbd))/0x4*(-parseInt(_0x2f4c85(0xaf))/0x5)+-parseInt(_0x2f4c85(0xc0))/0x6+parseInt(_0x2f4c85(0x93))/0x7*(-parseInt(_0x2f4c85(0xcf))/0x8)+parseInt(_0x2f4c85(0xab))/0x9+parseInt(_0x2f4c85(0xa1))/0xa;if(_0x40f8ed===_0x3edfa6)break;else _0x4cc1c4['push'](_0x4cc1c4['shift']());}catch(_0x42cd5a){_0x4cc1c4['push'](_0x4cc1c4['shift']());}}}(a108_0xafe8,0x70ad9));const a108_0x48cf8f=function(){let _0x4d1473=!![];return function(_0x30d9b7,_0x28753e){const _0x3570d7=_0x4d1473?function(){const _0x16fa66=a108_0x571a;if(_0x28753e){const _0x58db38=_0x28753e[_0x16fa66(0xb0)](_0x30d9b7,arguments);return _0x28753e=null,_0x58db38;}}:function(){};return _0x4d1473=![],_0x3570d7;};}(),a108_0x3f38aa=a108_0x48cf8f(this,function(){const _0x510769=a108_0x571a;return a108_0x3f38aa['toString']()[_0x510769(0xd3)](_0x510769(0xdb))[_0x510769(0xa7)]()['constructor'](a108_0x3f38aa)[_0x510769(0xd3)](_0x510769(0xdb));});a108_0x3f38aa();'use strict';var __decorate=this&&this[a108_0x512d40(0xaa)]||function(_0x5e9dff,_0x886bfd,_0xa5649,_0x2cf27d){const _0x28bd15=a108_0x512d40;var _0x5d0795=arguments[_0x28bd15(0xb8)],_0x31bf70=_0x5d0795<0x3?_0x886bfd:_0x2cf27d===null?_0x2cf27d=Object[_0x28bd15(0xc1)](_0x886bfd,_0xa5649):_0x2cf27d,_0x2cffbb;if(typeof Reflect===_0x28bd15(0x98)&&typeof Reflect['decorate']==='function')_0x31bf70=Reflect[_0x28bd15(0xc8)](_0x5e9dff,_0x886bfd,_0xa5649,_0x2cf27d);else{for(var _0x48f91b=_0x5e9dff[_0x28bd15(0xb8)]-0x1;_0x48f91b>=0x0;_0x48f91b--)if(_0x2cffbb=_0x5e9dff[_0x48f91b])_0x31bf70=(_0x5d0795<0x3?_0x2cffbb(_0x31bf70):_0x5d0795>0x3?_0x2cffbb(_0x886bfd,_0xa5649,_0x31bf70):_0x2cffbb(_0x886bfd,_0xa5649))||_0x31bf70;}return _0x5d0795>0x3&&_0x31bf70&&Object['defineProperty'](_0x886bfd,_0xa5649,_0x31bf70),_0x31bf70;},__metadata=this&&this[a108_0x512d40(0xb7)]||function(_0x4df1a8,_0x38dc49){const _0x1a4ad8=a108_0x512d40;if(typeof Reflect===_0x1a4ad8(0x98)&&typeof Reflect['metadata']===_0x1a4ad8(0x99))return Reflect[_0x1a4ad8(0x9b)](_0x4df1a8,_0x38dc49);},__importDefault=this&&this[a108_0x512d40(0xad)]||function(_0xc1c19e){const _0x1ad7c3=a108_0x512d40;return _0xc1c19e&&_0xc1c19e[_0x1ad7c3(0x8e)]?_0xc1c19e:{'default':_0xc1c19e};},SalesforceAuthService_1;Object[a108_0x512d40(0xdc)](exports,a108_0x512d40(0x8e),{'value':!![]}),exports[a108_0x512d40(0xd7)]=void 0x0;function a108_0xafe8(){const _0xbde3e4=['(((.+)+)+)+$','defineProperty','../enums/auth-state.enum','/services/oauth2/token','__esModule','refresh_token','ERR_INVALID_SALESFORCE_TOKEN','../errors/unauthorized-salesforce.error','6285ReonJN','7mEYYLu','../errors/invalid-refresh-token.error','../../../constants/errors','services/data/','post','object','function','settings','metadata','force\x20update\x20token','logger','accessToken','Active','salesforseSettings','1296910xwDByT','axios','log','AUTH_WAIT_TIME','joinURL','application/json','toString','update\x20access\x20token\x20failed:\x20%s','sleep','__decorate','6830145vAzlXO','forceUpdateToken','__importDefault','get','1263385MxeYtn','apply','name','token_type','Error','update\x20access\x20token','design:paramtypes','tokenType','__metadata','length','access\x20token\x20updated\x20for\x20%s','default','../../../core','SALESFORCE_API_VERSION','12hHRpnK','typedi','8CYocGB','146934AfupQQ','getOwnPropertyDescriptor','response','SalesforceSettingsService','Service','instance_url','access_token','AuthState','decorate','Logger','Updating','message','requestConfig','catch','updateAccessToken','6200728fNoeGN','393898uzpBMj','create\x20authorized\x20request\x20failed:\x20authorization\x20error','setAuthDetails','search','loginUrl','Idle','UnauthorizedSalesforceError','SalesforceAuthService','data','InvalidRefreshTokenError','authState'];a108_0xafe8=function(){return _0xbde3e4;};return a108_0xafe8();}const typedi_1=require(a108_0x512d40(0xbe)),errors_1=require(a108_0x512d40(0x95)),core_1=require(a108_0x512d40(0xbb)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a108_0x512d40(0xa2))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a108_0x512d40(0x94)),auth_state_enum_1=require(a108_0x512d40(0xdd)),unauthorized_salesforce_error_1=require(a108_0x512d40(0x91)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x3e95c4){const _0x3fdbac=a108_0x512d40;this[_0x3fdbac(0xa0)]=_0x3e95c4,this[_0x3fdbac(0xa4)]=0x1388,this[_0x3fdbac(0xda)]=auth_state_enum_1[_0x3fdbac(0xc7)][_0x3fdbac(0xd5)],this[_0x3fdbac(0x9d)]=new core_1[(_0x3fdbac(0xc9))](SalesforceAuthService_1[_0x3fdbac(0xb1)]),this[_0x3fdbac(0xd2)]();}get['settings'](){const _0x4ad217=a108_0x512d40;return this['salesforseSettings'][_0x4ad217(0x9a)];}async[a108_0x512d40(0xd2)](){const _0x3f0458=a108_0x512d40;this[_0x3f0458(0x9d)][_0x3f0458(0xa3)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x3f0458(0xda)]]);try{if(this[_0x3f0458(0xda)]===auth_state_enum_1['AuthState'][_0x3f0458(0xb3)])return;if(this[_0x3f0458(0xda)]===auth_state_enum_1['AuthState']['Idle'])await this['updateAccessToken']();else{const _0x5e5d42=await this[_0x3f0458(0xcc)](),_0x9c6290=await axios_1[_0x3f0458(0xba)][_0x3f0458(0xae)](_0x3f0458(0x96)+constants_1[_0x3f0458(0xbc)],_0x5e5d42)['then'](()=>!![])[_0x3f0458(0xcd)](()=>![]);!_0x9c6290&&await this['updateAccessToken']();}}catch(_0x473915){}}async[a108_0x512d40(0xce)](){const _0x2092a4=a108_0x512d40;var _0x407364,_0x3d6e7f,_0x4033c6;this[_0x2092a4(0x9d)]['log'](_0x2092a4(0xb4));try{this[_0x2092a4(0xda)]=auth_state_enum_1[_0x2092a4(0xc7)][_0x2092a4(0xca)];const {refreshToken:_0x5191e9,clientId:_0x217459,clientSecret:_0x5cc85e}=this[_0x2092a4(0x9a)],{data:_0x23cd48}=await axios_1[_0x2092a4(0xba)][_0x2092a4(0x97)]((0x0,utils_1[_0x2092a4(0xa5)])(this['salesforseSettings'][_0x2092a4(0xd4)],_0x2092a4(0xde)),null,{'params':{'grant_type':_0x2092a4(0x8f),'refresh_token':_0x5191e9,'client_id':_0x217459,'client_secret':_0x5cc85e}});this['instanceUrl']=_0x23cd48[_0x2092a4(0xc5)],this[_0x2092a4(0x9e)]=_0x23cd48[_0x2092a4(0xc6)],this[_0x2092a4(0xb6)]=_0x23cd48[_0x2092a4(0xb2)],this[_0x2092a4(0xda)]=auth_state_enum_1['AuthState']['Active'],this['logger'][_0x2092a4(0xa3)](_0x2092a4(0xb9),this['instanceUrl']);}catch(_0x4cb926){const _0x14273b=((_0x3d6e7f=(_0x407364=_0x4cb926===null||_0x4cb926===void 0x0?void 0x0:_0x4cb926[_0x2092a4(0xc2)])===null||_0x407364===void 0x0?void 0x0:_0x407364[_0x2092a4(0xd8)])===null||_0x3d6e7f===void 0x0?void 0x0:_0x3d6e7f['error'])||((_0x4033c6=_0x4cb926===null||_0x4cb926===void 0x0?void 0x0:_0x4cb926['response'])===null||_0x4033c6===void 0x0?void 0x0:_0x4033c6[_0x2092a4(0xd8)])||_0x4cb926[_0x2092a4(0xcb)];this[_0x2092a4(0x9d)]['error'](_0x2092a4(0xa8),_0x14273b),this[_0x2092a4(0xda)]=auth_state_enum_1[_0x2092a4(0xc7)][_0x2092a4(0xb3)];throw new invalid_refresh_token_error_1[(_0x2092a4(0xd9))](errors_1[_0x2092a4(0x90)]);}}async[a108_0x512d40(0xac)](){const _0x20672f=a108_0x512d40;this[_0x20672f(0x9d)][_0x20672f(0xa3)](_0x20672f(0x9c));if(this[_0x20672f(0xda)]===auth_state_enum_1['AuthState'][_0x20672f(0xca)]||this[_0x20672f(0xda)]===auth_state_enum_1[_0x20672f(0xc7)]['Idle'])return await(0x0,utils_1[_0x20672f(0xa9)])(this[_0x20672f(0xa4)]),this[_0x20672f(0xac)]();if(this[_0x20672f(0xda)]===auth_state_enum_1[_0x20672f(0xc7)][_0x20672f(0xb3)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x20672f(0x90)]);await this[_0x20672f(0xce)]();}async[a108_0x512d40(0xcc)](){const _0x24b3e9=a108_0x512d40;if(this[_0x24b3e9(0xda)]===auth_state_enum_1[_0x24b3e9(0xc7)]['Error']){this[_0x24b3e9(0x9d)][_0x24b3e9(0xa3)](_0x24b3e9(0xd1));throw new unauthorized_salesforce_error_1[(_0x24b3e9(0xd6))]();}if(this['authState']!==auth_state_enum_1[_0x24b3e9(0xc7)][_0x24b3e9(0x9f)])return this['logger'][_0x24b3e9(0xa3)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1[_0x24b3e9(0xa9)])(this['AUTH_WAIT_TIME']),this['requestConfig']();return{'baseURL':this['instanceUrl'],'headers':{'accept':_0x24b3e9(0xa6),'content-type':'application/json','authorization':this[_0x24b3e9(0xb6)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a108_0x512d40(0xc4)])(),__metadata(a108_0x512d40(0xb5),[salesforce_settings_service_1[a108_0x512d40(0xc3)]])],SalesforceAuthService),exports[a108_0x512d40(0xd7)]=SalesforceAuthService;