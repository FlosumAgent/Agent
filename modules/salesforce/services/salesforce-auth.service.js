const a108_0x12e3f4=a108_0x427d;function a108_0x427d(_0x41b284,_0x5b2c53){const _0x41a424=a108_0x2498();return a108_0x427d=function(_0xde6980,_0x5aaaaf){_0xde6980=_0xde6980-0x1b2;let _0x24982d=_0x41a424[_0xde6980];return _0x24982d;},a108_0x427d(_0x41b284,_0x5b2c53);}(function(_0x9fc216,_0x3ad5eb){const _0x54f0e6=a108_0x427d,_0x2e1070=_0x9fc216();while(!![]){try{const _0x5e4f5f=-parseInt(_0x54f0e6(0x1d1))/0x1+parseInt(_0x54f0e6(0x1e5))/0x2+parseInt(_0x54f0e6(0x1dc))/0x3+-parseInt(_0x54f0e6(0x1ba))/0x4+parseInt(_0x54f0e6(0x1d3))/0x5*(-parseInt(_0x54f0e6(0x1b9))/0x6)+-parseInt(_0x54f0e6(0x1bf))/0x7*(parseInt(_0x54f0e6(0x1e4))/0x8)+parseInt(_0x54f0e6(0x1d8))/0x9*(parseInt(_0x54f0e6(0x1ea))/0xa);if(_0x5e4f5f===_0x3ad5eb)break;else _0x2e1070['push'](_0x2e1070['shift']());}catch(_0x57ac09){_0x2e1070['push'](_0x2e1070['shift']());}}}(a108_0x2498,0xe230e));const a108_0x5aaaaf=function(){let _0x40795a=!![];return function(_0x248bd4,_0x26ae43){const _0x96bdcd=_0x40795a?function(){if(_0x26ae43){const _0x519bb5=_0x26ae43['apply'](_0x248bd4,arguments);return _0x26ae43=null,_0x519bb5;}}:function(){};return _0x40795a=![],_0x96bdcd;};}(),a108_0xde6980=a108_0x5aaaaf(this,function(){const _0x35b992=a108_0x427d;return a108_0xde6980[_0x35b992(0x1b2)]()[_0x35b992(0x1d4)](_0x35b992(0x1e7))['toString']()[_0x35b992(0x1f8)](a108_0xde6980)[_0x35b992(0x1d4)]('(((.+)+)+)+$');});a108_0xde6980();'use strict';var __decorate=this&&this[a108_0x12e3f4(0x1b6)]||function(_0x9dd0c,_0x8dd3a0,_0x3d5fd0,_0x3de220){const _0x32326e=a108_0x12e3f4;var _0x19edbd=arguments[_0x32326e(0x1ca)],_0x5df296=_0x19edbd<0x3?_0x8dd3a0:_0x3de220===null?_0x3de220=Object['getOwnPropertyDescriptor'](_0x8dd3a0,_0x3d5fd0):_0x3de220,_0xb30864;if(typeof Reflect===_0x32326e(0x1bb)&&typeof Reflect[_0x32326e(0x1de)]===_0x32326e(0x1cd))_0x5df296=Reflect[_0x32326e(0x1de)](_0x9dd0c,_0x8dd3a0,_0x3d5fd0,_0x3de220);else{for(var _0x5838aa=_0x9dd0c[_0x32326e(0x1ca)]-0x1;_0x5838aa>=0x0;_0x5838aa--)if(_0xb30864=_0x9dd0c[_0x5838aa])_0x5df296=(_0x19edbd<0x3?_0xb30864(_0x5df296):_0x19edbd>0x3?_0xb30864(_0x8dd3a0,_0x3d5fd0,_0x5df296):_0xb30864(_0x8dd3a0,_0x3d5fd0))||_0x5df296;}return _0x19edbd>0x3&&_0x5df296&&Object[_0x32326e(0x1b5)](_0x8dd3a0,_0x3d5fd0,_0x5df296),_0x5df296;},__metadata=this&&this[a108_0x12e3f4(0x1b3)]||function(_0x2bba1e,_0x1aff2e){const _0x598359=a108_0x12e3f4;if(typeof Reflect===_0x598359(0x1bb)&&typeof Reflect['metadata']==='function')return Reflect[_0x598359(0x1f7)](_0x2bba1e,_0x1aff2e);},__importDefault=this&&this[a108_0x12e3f4(0x1d9)]||function(_0x5c223e){const _0x4ce794=a108_0x12e3f4;return _0x5c223e&&_0x5c223e[_0x4ce794(0x1d5)]?_0x5c223e:{'default':_0x5c223e};},SalesforceAuthService_1;Object[a108_0x12e3f4(0x1b5)](exports,a108_0x12e3f4(0x1d5),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require(a108_0x12e3f4(0x1e6)),core_1=require('../../../core'),salesforce_settings_service_1=require(a108_0x12e3f4(0x1db)),axios_1=__importDefault(require(a108_0x12e3f4(0x1fa))),utils_1=require(a108_0x12e3f4(0x1df)),invalid_refresh_token_error_1=require(a108_0x12e3f4(0x1e1)),auth_state_enum_1=require(a108_0x12e3f4(0x1d6)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a108_0x12e3f4(0x1be));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x2123d4){const _0x3fddaa=a108_0x12e3f4;this[_0x3fddaa(0x1ff)]=_0x2123d4,this[_0x3fddaa(0x1c1)]=0x1388,this[_0x3fddaa(0x1f4)]=auth_state_enum_1[_0x3fddaa(0x1eb)]['Idle'],this[_0x3fddaa(0x1cc)]=new core_1['Logger'](SalesforceAuthService_1[_0x3fddaa(0x1fc)]),this[_0x3fddaa(0x1e0)]();}get[a108_0x12e3f4(0x1e8)](){const _0x3511c4=a108_0x12e3f4;return this['salesforseSettings'][_0x3511c4(0x1e8)];}async['setAuthDetails'](){const _0x43bd8d=a108_0x12e3f4;this[_0x43bd8d(0x1cc)]['log'](_0x43bd8d(0x1bc),auth_state_enum_1['AuthState'][this[_0x43bd8d(0x1f4)]]);try{if(this[_0x43bd8d(0x1f4)]===auth_state_enum_1['AuthState'][_0x43bd8d(0x1f3)])return;if(this[_0x43bd8d(0x1f4)]===auth_state_enum_1[_0x43bd8d(0x1eb)][_0x43bd8d(0x1ce)])await this['updateAccessToken']();else{const _0x2cfeba=await this[_0x43bd8d(0x1e9)](),_0x1b35c6=await axios_1[_0x43bd8d(0x1b7)][_0x43bd8d(0x1f0)]('services/data/'+constants_1[_0x43bd8d(0x1bd)],_0x2cfeba)[_0x43bd8d(0x1b4)](()=>!![])[_0x43bd8d(0x1b8)](()=>![]);!_0x1b35c6&&await this[_0x43bd8d(0x1dd)]();}}catch(_0xf7b260){}}async[a108_0x12e3f4(0x1dd)](){const _0xf72351=a108_0x12e3f4;var _0x1d4400,_0x52b3e3,_0x51b194;this['logger'][_0xf72351(0x1fd)](_0xf72351(0x1ef));try{this[_0xf72351(0x1f4)]=auth_state_enum_1[_0xf72351(0x1eb)][_0xf72351(0x1ec)];const {refreshToken:_0x25872e,clientId:_0x336a84,clientSecret:_0x2be870}=this[_0xf72351(0x1e8)],{data:_0x275ab9}=await axios_1[_0xf72351(0x1b7)][_0xf72351(0x1f5)]((0x0,utils_1[_0xf72351(0x1c2)])(this['salesforseSettings'][_0xf72351(0x1cf)],_0xf72351(0x1f2)),null,{'params':{'grant_type':_0xf72351(0x1f9),'refresh_token':_0x25872e,'client_id':_0x336a84,'client_secret':_0x2be870}});this[_0xf72351(0x1da)]=_0x275ab9[_0xf72351(0x1c5)],this[_0xf72351(0x1d7)]=_0x275ab9[_0xf72351(0x1d0)],this[_0xf72351(0x200)]=_0x275ab9['token_type'],this[_0xf72351(0x1f4)]=auth_state_enum_1[_0xf72351(0x1eb)]['Active'],this['logger'][_0xf72351(0x1fd)](_0xf72351(0x1e3),this[_0xf72351(0x1da)]);}catch(_0x447d90){const _0x5d83bc=((_0x52b3e3=(_0x1d4400=_0x447d90===null||_0x447d90===void 0x0?void 0x0:_0x447d90[_0xf72351(0x1f6)])===null||_0x1d4400===void 0x0?void 0x0:_0x1d4400[_0xf72351(0x1fb)])===null||_0x52b3e3===void 0x0?void 0x0:_0x52b3e3[_0xf72351(0x1cb)])||((_0x51b194=_0x447d90===null||_0x447d90===void 0x0?void 0x0:_0x447d90[_0xf72351(0x1f6)])===null||_0x51b194===void 0x0?void 0x0:_0x51b194[_0xf72351(0x1fb)])||_0x447d90[_0xf72351(0x1c9)];this[_0xf72351(0x1cc)][_0xf72351(0x1cb)](_0xf72351(0x1d2),_0x5d83bc),this[_0xf72351(0x1f4)]=auth_state_enum_1['AuthState'][_0xf72351(0x1f3)];throw new invalid_refresh_token_error_1[(_0xf72351(0x1fe))](errors_1[_0xf72351(0x1c8)]);}}async[a108_0x12e3f4(0x1ee)](){const _0x2643a9=a108_0x12e3f4;this['logger']['log'](_0x2643a9(0x1c0));if(this['authState']===auth_state_enum_1[_0x2643a9(0x1eb)][_0x2643a9(0x1ec)]||this[_0x2643a9(0x1f4)]===auth_state_enum_1['AuthState'][_0x2643a9(0x1ce)])return await(0x0,utils_1['sleep'])(this[_0x2643a9(0x1c1)]),this[_0x2643a9(0x1ee)]();if(this[_0x2643a9(0x1f4)]===auth_state_enum_1['AuthState'][_0x2643a9(0x1f3)])throw new invalid_refresh_token_error_1[(_0x2643a9(0x1fe))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this['updateAccessToken']();}async[a108_0x12e3f4(0x1e9)](){const _0x2b31c9=a108_0x12e3f4;if(this[_0x2b31c9(0x1f4)]===auth_state_enum_1[_0x2b31c9(0x1eb)][_0x2b31c9(0x1f3)]){this[_0x2b31c9(0x1cc)][_0x2b31c9(0x1fd)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x2b31c9(0x1ed))]();}if(this[_0x2b31c9(0x1f4)]!==auth_state_enum_1[_0x2b31c9(0x1eb)]['Active'])return this[_0x2b31c9(0x1cc)][_0x2b31c9(0x1fd)](_0x2b31c9(0x1c4)),await(0x0,utils_1[_0x2b31c9(0x1f1)])(this[_0x2b31c9(0x1c1)]),this[_0x2b31c9(0x1e9)]();return{'baseURL':this[_0x2b31c9(0x1da)],'headers':{'accept':_0x2b31c9(0x1c7),'content-type':'application/json','authorization':this['tokenType']+'\x20'+this[_0x2b31c9(0x1d7)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a108_0x12e3f4(0x1e2)])(),__metadata(a108_0x12e3f4(0x1c6),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a108_0x12e3f4(0x1c3)]=SalesforceAuthService;function a108_0x2498(){const _0x41bb30=['design:paramtypes','application/json','ERR_INVALID_SALESFORCE_TOKEN','message','length','error','logger','function','Idle','loginUrl','access_token','1478178hAgkUO','update\x20access\x20token\x20failed:\x20%s','155otszvY','search','__esModule','../enums/auth-state.enum','accessToken','1953IKxTpX','__importDefault','instanceUrl','../../shared/services/salesforce-settings.service','2090193XMydvv','updateAccessToken','decorate','../../shared/utils','setAuthDetails','../errors/invalid-refresh-token.error','Service','access\x20token\x20updated\x20for\x20%s','32sSHLMW','1330800YQNXmt','../../../constants/errors','(((.+)+)+)+$','settings','requestConfig','172570eGTHUr','AuthState','Updating','UnauthorizedSalesforceError','forceUpdateToken','update\x20access\x20token','get','sleep','/services/oauth2/token','Error','authState','post','response','metadata','constructor','refresh_token','axios','data','name','log','InvalidRefreshTokenError','salesforseSettings','tokenType','toString','__metadata','then','defineProperty','__decorate','default','catch','128406hZbtOU','2294724GDOZjR','object','check\x20auth:\x20current\x20state\x20-\x20%s','SALESFORCE_API_VERSION','../../../constants','2563981nODecl','force\x20update\x20token','AUTH_WAIT_TIME','joinURL','SalesforceAuthService','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','instance_url'];a108_0x2498=function(){return _0x41bb30;};return a108_0x2498();}