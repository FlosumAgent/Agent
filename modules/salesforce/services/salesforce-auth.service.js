const a105_0xa3ea=['instanceUrl','SalesforceAuthService','force\x20update\x20token','accessToken','length','AuthState','instance_url','defineProperty','logger','SALESFORCE_API_VERSION','__esModule','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','581371fmcBVL','update\x20access\x20token\x20failed:\x20%s','../enums/auth-state.enum','default','updateAccessToken','return\x20/\x22\x20+\x20this\x20+\x20\x22/','object','../../../constants','access\x20token\x20updated\x20for\x20%s','requestConfig','decorate','getOwnPropertyDescriptor','catch','__metadata','response','forceUpdateToken','application/json','118464fDcOmb','apply','data','check\x20auth:\x20current\x20state\x20-\x20%s','Service','refresh_token','log','access_token','Active','InvalidRefreshTokenError','7IIuXzI','function','101796fpifAk','salesforseSettings','authState','481439UQiJtB','4aVLUqE','Error','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','create\x20authorized\x20request\x20failed:\x20authorization\x20error','ERR_INVALID_SALESFORCE_TOKEN','Idle','1gnhWdU','../../../core','settings','975677kvDOHT','axios','error','UnauthorizedSalesforceError','setAuthDetails','post','../errors/invalid-refresh-token.error','update\x20access\x20token','/services/oauth2/token','sleep','constructor','Updating','SalesforceSettingsService','14671jIqBZQ','59679cLHtbA','AUTH_WAIT_TIME','loginUrl','then','metadata','tokenType'];const a105_0x38636a=a105_0x118c;(function(_0x44a6c8,_0x12ae73){const _0x112cf1=a105_0x118c;while(!![]){try{const _0x30ba18=parseInt(_0x112cf1(0x1a9))+-parseInt(_0x112cf1(0x1b0))*parseInt(_0x112cf1(0x1a6))+-parseInt(_0x112cf1(0x1b3))+parseInt(_0x112cf1(0x189))+-parseInt(_0x112cf1(0x1c1))+parseInt(_0x112cf1(0x1aa))*parseInt(_0x112cf1(0x19a))+parseInt(_0x112cf1(0x1a4))*parseInt(_0x112cf1(0x1c0));if(_0x30ba18===_0x12ae73)break;else _0x44a6c8['push'](_0x44a6c8['shift']());}catch(_0x4d0bf9){_0x44a6c8['push'](_0x44a6c8['shift']());}}}(a105_0xa3ea,0x7a9c3));const a105_0x185dfc=function(){let _0x38b007=!![];return function(_0x47fb35,_0x170255){const _0x12a019=_0x38b007?function(){const _0x1b9d75=a105_0x118c;if(_0x170255){const _0x141b78=_0x170255[_0x1b9d75(0x19b)](_0x47fb35,arguments);return _0x170255=null,_0x141b78;}}:function(){};return _0x38b007=![],_0x12a019;};}(),a105_0x8c2fda=a105_0x185dfc(this,function(){const _0x560b12=function(){const _0xa9b526=a105_0x118c,_0x489faf=_0x560b12[_0xa9b526(0x1bd)](_0xa9b526(0x18e))()[_0xa9b526(0x1bd)](_0xa9b526(0x1ac));return!_0x489faf['test'](a105_0x8c2fda);};return _0x560b12();});a105_0x8c2fda();'use strict';function a105_0x118c(_0x4bdf50,_0x206877){return a105_0x118c=function(_0x378980,_0x8c2fda){_0x378980=_0x378980-0x184;let _0x185dfc=a105_0xa3ea[_0x378980];return _0x185dfc;},a105_0x118c(_0x4bdf50,_0x206877);}var __decorate=this&&this['__decorate']||function(_0x5f3820,_0x14ffef,_0x2858b3,_0x2f784a){const _0x416ea4=a105_0x118c;var _0x366b49=arguments[_0x416ea4(0x1cb)],_0x48fce5=_0x366b49<0x3?_0x14ffef:_0x2f784a===null?_0x2f784a=Object[_0x416ea4(0x194)](_0x14ffef,_0x2858b3):_0x2f784a,_0x214c01;if(typeof Reflect===_0x416ea4(0x18f)&&typeof Reflect['decorate']===_0x416ea4(0x1a5))_0x48fce5=Reflect[_0x416ea4(0x193)](_0x5f3820,_0x14ffef,_0x2858b3,_0x2f784a);else{for(var _0x595d64=_0x5f3820[_0x416ea4(0x1cb)]-0x1;_0x595d64>=0x0;_0x595d64--)if(_0x214c01=_0x5f3820[_0x595d64])_0x48fce5=(_0x366b49<0x3?_0x214c01(_0x48fce5):_0x366b49>0x3?_0x214c01(_0x14ffef,_0x2858b3,_0x48fce5):_0x214c01(_0x14ffef,_0x2858b3))||_0x48fce5;}return _0x366b49>0x3&&_0x48fce5&&Object[_0x416ea4(0x184)](_0x14ffef,_0x2858b3,_0x48fce5),_0x48fce5;},__metadata=this&&this[a105_0x38636a(0x196)]||function(_0x2b2620,_0x239b95){const _0x46a9cc=a105_0x38636a;if(typeof Reflect===_0x46a9cc(0x18f)&&typeof Reflect[_0x46a9cc(0x1c5)]===_0x46a9cc(0x1a5))return Reflect[_0x46a9cc(0x1c5)](_0x2b2620,_0x239b95);},__importDefault=this&&this['__importDefault']||function(_0x53f30d){return _0x53f30d&&_0x53f30d['__esModule']?_0x53f30d:{'default':_0x53f30d};},SalesforceAuthService_1;Object['defineProperty'](exports,a105_0x38636a(0x187),{'value':!![]}),exports[a105_0x38636a(0x1c8)]=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require(a105_0x38636a(0x1b1)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a105_0x38636a(0x1b4))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a105_0x38636a(0x1b9)),auth_state_enum_1=require(a105_0x38636a(0x18b)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a105_0x38636a(0x190));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x176342){const _0x4af3d0=a105_0x38636a;this['salesforseSettings']=_0x176342,this['AUTH_WAIT_TIME']=0x1388,this[_0x4af3d0(0x1a8)]=auth_state_enum_1['AuthState']['Idle'],this[_0x4af3d0(0x185)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x4af3d0(0x1b7)]();}get[a105_0x38636a(0x1b2)](){const _0x3fcb53=a105_0x38636a;return this[_0x3fcb53(0x1a7)][_0x3fcb53(0x1b2)];}async['setAuthDetails'](){const _0x4c6163=a105_0x38636a;this[_0x4c6163(0x185)][_0x4c6163(0x1a0)](_0x4c6163(0x19d),auth_state_enum_1['AuthState'][this[_0x4c6163(0x1a8)]]);try{if(this[_0x4c6163(0x1a8)]===auth_state_enum_1[_0x4c6163(0x1cc)][_0x4c6163(0x1ab)])return;if(this[_0x4c6163(0x1a8)]===auth_state_enum_1['AuthState'][_0x4c6163(0x1af)])await this[_0x4c6163(0x18d)]();else{const _0x28054f=await this[_0x4c6163(0x192)](),_0x1174b5=await axios_1[_0x4c6163(0x18c)]['get']('services/data/'+constants_1[_0x4c6163(0x186)],_0x28054f)[_0x4c6163(0x1c4)](()=>!![])[_0x4c6163(0x195)](()=>![]);!_0x1174b5&&await this[_0x4c6163(0x18d)]();}}catch(_0x519b56){}}async[a105_0x38636a(0x18d)](){const _0x13c2c1=a105_0x38636a;var _0x3d1cc8,_0x663bf6,_0x38e4ee;this['logger']['log'](_0x13c2c1(0x1ba));try{this[_0x13c2c1(0x1a8)]=auth_state_enum_1[_0x13c2c1(0x1cc)]['Updating'];const {refreshToken:_0x395535,clientId:_0x41c3a3,clientSecret:_0x28ebc0}=this[_0x13c2c1(0x1b2)],{data:_0x4ae0a0}=await axios_1[_0x13c2c1(0x18c)][_0x13c2c1(0x1b8)](utils_1['joinURL'](this[_0x13c2c1(0x1a7)][_0x13c2c1(0x1c3)],_0x13c2c1(0x1bb)),null,{'params':{'grant_type':_0x13c2c1(0x19f),'refresh_token':_0x395535,'client_id':_0x41c3a3,'client_secret':_0x28ebc0}});this[_0x13c2c1(0x1c7)]=_0x4ae0a0[_0x13c2c1(0x1cd)],this[_0x13c2c1(0x1ca)]=_0x4ae0a0[_0x13c2c1(0x1a1)],this[_0x13c2c1(0x1c6)]=_0x4ae0a0['token_type'],this[_0x13c2c1(0x1a8)]=auth_state_enum_1[_0x13c2c1(0x1cc)][_0x13c2c1(0x1a2)],this[_0x13c2c1(0x185)][_0x13c2c1(0x1a0)](_0x13c2c1(0x191),this['instanceUrl']);}catch(_0x9d72f6){const _0x28f36d=((_0x663bf6=(_0x3d1cc8=_0x9d72f6===null||_0x9d72f6===void 0x0?void 0x0:_0x9d72f6[_0x13c2c1(0x197)])===null||_0x3d1cc8===void 0x0?void 0x0:_0x3d1cc8[_0x13c2c1(0x19c)])===null||_0x663bf6===void 0x0?void 0x0:_0x663bf6['error'])||((_0x38e4ee=_0x9d72f6===null||_0x9d72f6===void 0x0?void 0x0:_0x9d72f6[_0x13c2c1(0x197)])===null||_0x38e4ee===void 0x0?void 0x0:_0x38e4ee[_0x13c2c1(0x19c)])||_0x9d72f6['message'];this[_0x13c2c1(0x185)][_0x13c2c1(0x1b5)](_0x13c2c1(0x18a),_0x28f36d),this[_0x13c2c1(0x1a8)]=auth_state_enum_1['AuthState'][_0x13c2c1(0x1ab)];throw new invalid_refresh_token_error_1[(_0x13c2c1(0x1a3))](errors_1[_0x13c2c1(0x1ae)]);}}async[a105_0x38636a(0x198)](){const _0x4df9de=a105_0x38636a;this[_0x4df9de(0x185)]['log'](_0x4df9de(0x1c9));if(this[_0x4df9de(0x1a8)]===auth_state_enum_1[_0x4df9de(0x1cc)][_0x4df9de(0x1be)]||this['authState']===auth_state_enum_1[_0x4df9de(0x1cc)][_0x4df9de(0x1af)])return await utils_1[_0x4df9de(0x1bc)](this['AUTH_WAIT_TIME']),this[_0x4df9de(0x198)]();if(this[_0x4df9de(0x1a8)]===auth_state_enum_1['AuthState'][_0x4df9de(0x1ab)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x4df9de(0x1ae)]);await this[_0x4df9de(0x18d)]();}async[a105_0x38636a(0x192)](){const _0x3d435e=a105_0x38636a;if(this['authState']===auth_state_enum_1[_0x3d435e(0x1cc)][_0x3d435e(0x1ab)]){this[_0x3d435e(0x185)][_0x3d435e(0x1a0)](_0x3d435e(0x1ad));throw new unauthorized_salesforce_error_1[(_0x3d435e(0x1b6))]();}if(this[_0x3d435e(0x1a8)]!==auth_state_enum_1['AuthState']['Active'])return this['logger'][_0x3d435e(0x1a0)](_0x3d435e(0x188)),await utils_1[_0x3d435e(0x1bc)](this[_0x3d435e(0x1c2)]),this[_0x3d435e(0x192)]();return{'baseURL':this[_0x3d435e(0x1c7)],'headers':{'accept':_0x3d435e(0x199),'content-type':_0x3d435e(0x199),'authorization':this['tokenType']+'\x20'+this[_0x3d435e(0x1ca)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a105_0x38636a(0x19e)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a105_0x38636a(0x1bf)]])],SalesforceAuthService),exports[a105_0x38636a(0x1c8)]=SalesforceAuthService;