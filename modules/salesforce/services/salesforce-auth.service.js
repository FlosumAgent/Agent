const a106_0x30bf=['__decorate','create\x20authorized\x20request\x20failed:\x20authorization\x20error','services/data/','access_token','10979wPGifM','updateAccessToken','object','default','2403YPzLjO','response','SALESFORCE_API_VERSION','Service','../../shared/utils','joinURL','forceUpdateToken','test','loginUrl','52045gTWeab','design:paramtypes','decorate','defineProperty','access\x20token\x20updated\x20for\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','name','getOwnPropertyDescriptor','check\x20auth:\x20current\x20state\x20-\x20%s','InvalidRefreshTokenError','constructor','2031xjKkBN','refresh_token','apply','10nyojYL','27Hnxzmb','/services/oauth2/token','Error','ERR_INVALID_SALESFORCE_TOKEN','update\x20access\x20token','141jGnEEa','AUTH_WAIT_TIME','__importDefault','../../../core','post','Logger','setAuthDetails','SalesforceAuthService','sleep','catch','__metadata','metadata','365KorAnP','length','Active','log','SalesforceSettingsService','116779OnbeXs','Idle','../errors/invalid-refresh-token.error','data','instanceUrl','error','requestConfig','salesforseSettings','../../../constants','authState','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','__esModule','AuthState','instance_url','tokenType','../enums/auth-state.enum','UnauthorizedSalesforceError','axios','settings','174334QqzVIg','logger','typedi','return\x20/\x22\x20+\x20this\x20+\x20\x22/','token_type','get','47GBxzch','../errors/unauthorized-salesforce.error'];const a106_0x41f32c=a106_0x5707;(function(_0x5a9f4e,_0x42ef37){const _0x4526bd=a106_0x5707;while(!![]){try{const _0x2d3416=parseInt(_0x4526bd(0x175))*parseInt(_0x4526bd(0x1ba))+-parseInt(_0x4526bd(0x18d))+parseInt(_0x4526bd(0x1a6))+parseInt(_0x4526bd(0x1b5))*parseInt(_0x4526bd(0x1b1))+parseInt(_0x4526bd(0x17a))+parseInt(_0x4526bd(0x19d))*parseInt(_0x4526bd(0x193))+parseInt(_0x4526bd(0x199))*-parseInt(_0x4526bd(0x1b4));if(_0x2d3416===_0x42ef37)break;else _0x5a9f4e['push'](_0x5a9f4e['shift']());}catch(_0x16e692){_0x5a9f4e['push'](_0x5a9f4e['shift']());}}}(a106_0x30bf,0x19607));const a106_0x2fde21=function(){let _0x1e69fe=!![];return function(_0x157d3e,_0x28a5e4){const _0x2efd76=_0x1e69fe?function(){const _0x401697=a106_0x5707;if(_0x28a5e4){const _0xb53ee9=_0x28a5e4[_0x401697(0x1b3)](_0x157d3e,arguments);return _0x28a5e4=null,_0xb53ee9;}}:function(){};return _0x1e69fe=![],_0x2efd76;};}(),a106_0x110f21=a106_0x2fde21(this,function(){const _0x4c7cb0=function(){const _0x35fb9f=a106_0x5707,_0x3b4055=_0x4c7cb0[_0x35fb9f(0x1b0)](_0x35fb9f(0x190))()[_0x35fb9f(0x1b0)](_0x35fb9f(0x184));return!_0x3b4055[_0x35fb9f(0x1a4)](a106_0x110f21);};return _0x4c7cb0();});a106_0x110f21();'use strict';function a106_0x5707(_0x436e7a,_0x414465){return a106_0x5707=function(_0x48a7e6,_0x110f21){_0x48a7e6=_0x48a7e6-0x16b;let _0x2fde21=a106_0x30bf[_0x48a7e6];return _0x2fde21;},a106_0x5707(_0x436e7a,_0x414465);}var __decorate=this&&this[a106_0x41f32c(0x195)]||function(_0x26d814,_0x2899ca,_0x5d377b,_0x4d78da){const _0x321bd4=a106_0x41f32c;var _0x458eb=arguments[_0x321bd4(0x176)],_0x576e27=_0x458eb<0x3?_0x2899ca:_0x4d78da===null?_0x4d78da=Object[_0x321bd4(0x1ad)](_0x2899ca,_0x5d377b):_0x4d78da,_0x435a5a;if(typeof Reflect===_0x321bd4(0x19b)&&typeof Reflect[_0x321bd4(0x1a8)]==='function')_0x576e27=Reflect[_0x321bd4(0x1a8)](_0x26d814,_0x2899ca,_0x5d377b,_0x4d78da);else{for(var _0xc3b75d=_0x26d814[_0x321bd4(0x176)]-0x1;_0xc3b75d>=0x0;_0xc3b75d--)if(_0x435a5a=_0x26d814[_0xc3b75d])_0x576e27=(_0x458eb<0x3?_0x435a5a(_0x576e27):_0x458eb>0x3?_0x435a5a(_0x2899ca,_0x5d377b,_0x576e27):_0x435a5a(_0x2899ca,_0x5d377b))||_0x576e27;}return _0x458eb>0x3&&_0x576e27&&Object[_0x321bd4(0x1a9)](_0x2899ca,_0x5d377b,_0x576e27),_0x576e27;},__metadata=this&&this[a106_0x41f32c(0x173)]||function(_0x45ec59,_0x468b79){const _0x2ea6b0=a106_0x41f32c;if(typeof Reflect==='object'&&typeof Reflect[_0x2ea6b0(0x174)]==='function')return Reflect[_0x2ea6b0(0x174)](_0x45ec59,_0x468b79);},__importDefault=this&&this[a106_0x41f32c(0x16b)]||function(_0x25bf2b){return _0x25bf2b&&_0x25bf2b['__esModule']?_0x25bf2b:{'default':_0x25bf2b};},SalesforceAuthService_1;Object[a106_0x41f32c(0x1a9)](exports,a106_0x41f32c(0x185),{'value':!![]}),exports[a106_0x41f32c(0x170)]=void 0x0;const typedi_1=require(a106_0x41f32c(0x18f)),errors_1=require('../../../constants/errors'),core_1=require(a106_0x41f32c(0x16c)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a106_0x41f32c(0x18b))),utils_1=require(a106_0x41f32c(0x1a1)),invalid_refresh_token_error_1=require(a106_0x41f32c(0x17c)),auth_state_enum_1=require(a106_0x41f32c(0x189)),unauthorized_salesforce_error_1=require(a106_0x41f32c(0x194)),constants_1=require(a106_0x41f32c(0x182));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x50e18c){const _0x281681=a106_0x41f32c;this[_0x281681(0x181)]=_0x50e18c,this[_0x281681(0x1bb)]=0x1388,this[_0x281681(0x183)]=auth_state_enum_1[_0x281681(0x186)][_0x281681(0x17b)],this[_0x281681(0x18e)]=new core_1[(_0x281681(0x16e))](SalesforceAuthService_1[_0x281681(0x1ac)]),this[_0x281681(0x16f)]();}get['settings'](){const _0x1ed25c=a106_0x41f32c;return this[_0x1ed25c(0x181)][_0x1ed25c(0x18c)];}async[a106_0x41f32c(0x16f)](){const _0x1e6765=a106_0x41f32c;this[_0x1e6765(0x18e)][_0x1e6765(0x178)](_0x1e6765(0x1ae),auth_state_enum_1[_0x1e6765(0x186)][this[_0x1e6765(0x183)]]);try{if(this['authState']===auth_state_enum_1[_0x1e6765(0x186)][_0x1e6765(0x1b7)])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x1e6765(0x17b)])await this[_0x1e6765(0x19a)]();else{const _0x38fa2e=await this[_0x1e6765(0x180)](),_0x18f2e2=await axios_1[_0x1e6765(0x19c)][_0x1e6765(0x192)](_0x1e6765(0x197)+constants_1[_0x1e6765(0x19f)],_0x38fa2e)['then'](()=>!![])[_0x1e6765(0x172)](()=>![]);!_0x18f2e2&&await this[_0x1e6765(0x19a)]();}}catch(_0xc192a7){}}async[a106_0x41f32c(0x19a)](){const _0x17c764=a106_0x41f32c;var _0x5ac5fe,_0x2e527c,_0x252863;this['logger'][_0x17c764(0x178)](_0x17c764(0x1b9));try{this[_0x17c764(0x183)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x5c17e3,clientId:_0x4df80e,clientSecret:_0x267045}=this['settings'],{data:_0x5525d6}=await axios_1[_0x17c764(0x19c)][_0x17c764(0x16d)](utils_1[_0x17c764(0x1a2)](this[_0x17c764(0x181)][_0x17c764(0x1a5)],_0x17c764(0x1b6)),null,{'params':{'grant_type':_0x17c764(0x1b2),'refresh_token':_0x5c17e3,'client_id':_0x4df80e,'client_secret':_0x267045}});this[_0x17c764(0x17e)]=_0x5525d6[_0x17c764(0x187)],this['accessToken']=_0x5525d6[_0x17c764(0x198)],this[_0x17c764(0x188)]=_0x5525d6[_0x17c764(0x191)],this[_0x17c764(0x183)]=auth_state_enum_1[_0x17c764(0x186)][_0x17c764(0x177)],this[_0x17c764(0x18e)]['log'](_0x17c764(0x1aa),this[_0x17c764(0x17e)]);}catch(_0x58343d){const _0x227803=((_0x2e527c=(_0x5ac5fe=_0x58343d===null||_0x58343d===void 0x0?void 0x0:_0x58343d[_0x17c764(0x19e)])===null||_0x5ac5fe===void 0x0?void 0x0:_0x5ac5fe[_0x17c764(0x17d)])===null||_0x2e527c===void 0x0?void 0x0:_0x2e527c['error'])||((_0x252863=_0x58343d===null||_0x58343d===void 0x0?void 0x0:_0x58343d[_0x17c764(0x19e)])===null||_0x252863===void 0x0?void 0x0:_0x252863['data'])||_0x58343d['message'];this[_0x17c764(0x18e)][_0x17c764(0x17f)]('update\x20access\x20token\x20failed:\x20%s',_0x227803),this[_0x17c764(0x183)]=auth_state_enum_1[_0x17c764(0x186)]['Error'];throw new invalid_refresh_token_error_1[(_0x17c764(0x1af))](errors_1[_0x17c764(0x1b8)]);}}async[a106_0x41f32c(0x1a3)](){const _0x486621=a106_0x41f32c;this[_0x486621(0x18e)][_0x486621(0x178)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x486621(0x186)]['Updating']||this[_0x486621(0x183)]===auth_state_enum_1[_0x486621(0x186)]['Idle'])return await utils_1[_0x486621(0x171)](this[_0x486621(0x1bb)]),this['forceUpdateToken']();if(this[_0x486621(0x183)]===auth_state_enum_1[_0x486621(0x186)][_0x486621(0x1b7)])throw new invalid_refresh_token_error_1[(_0x486621(0x1af))](errors_1[_0x486621(0x1b8)]);await this[_0x486621(0x19a)]();}async[a106_0x41f32c(0x180)](){const _0x5a003c=a106_0x41f32c;if(this[_0x5a003c(0x183)]===auth_state_enum_1['AuthState'][_0x5a003c(0x1b7)]){this[_0x5a003c(0x18e)][_0x5a003c(0x178)](_0x5a003c(0x196));throw new unauthorized_salesforce_error_1[(_0x5a003c(0x18a))]();}if(this[_0x5a003c(0x183)]!==auth_state_enum_1['AuthState'][_0x5a003c(0x177)])return this['logger']['log'](_0x5a003c(0x1ab)),await utils_1[_0x5a003c(0x171)](this['AUTH_WAIT_TIME']),this[_0x5a003c(0x180)]();return{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','content-type':'application/json','authorization':this[_0x5a003c(0x188)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a106_0x41f32c(0x1a0)](),__metadata(a106_0x41f32c(0x1a7),[salesforce_settings_service_1[a106_0x41f32c(0x179)]])],SalesforceAuthService),exports[a106_0x41f32c(0x170)]=SalesforceAuthService;