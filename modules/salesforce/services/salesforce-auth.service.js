function a107_0x8685(){const _0x19e849=['access_token','salesforseSettings','updateAccessToken','search','application/json','getOwnPropertyDescriptor','../errors/invalid-refresh-token.error','InvalidRefreshTokenError','create\x20authorized\x20request\x20failed:\x20authorization\x20error','296862RBXcwj','then','error','277753iGxXOB','__decorate','get','__esModule','instanceUrl','joinURL','log','forceUpdateToken','SalesforceSettingsService','object','defineProperty','metadata','Error','length','9893295MZnyMZ','services/data/','../errors/unauthorized-salesforce.error','accessToken','access\x20token\x20updated\x20for\x20%s','toString','authState','1157574mKPAmj','sleep','2116188mPELRX','Service','Updating','axios','token_type','SALESFORCE_API_VERSION','settings','../../../constants','requestConfig','../enums/auth-state.enum','AuthState','5dPSXoV','__metadata','3299340PtYxex','force\x20update\x20token','AUTH_WAIT_TIME','instance_url','Idle','logger','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','SalesforceAuthService','__importDefault','decorate','apply','loginUrl','16twiffK','setAuthDetails','function','default','response','Active','refresh_token','/services/oauth2/token','data','64TPKHnY','tokenType','(((.+)+)+)+$','design:paramtypes','Logger','15755970hJxVtc','post','constructor','../../shared/utils'];a107_0x8685=function(){return _0x19e849;};return a107_0x8685();}const a107_0x8d7d38=a107_0x4828;(function(_0x180089,_0x24ee38){const _0x3afdb6=a107_0x4828,_0x2486bb=_0x180089();while(!![]){try{const _0x1962f9=-parseInt(_0x3afdb6(0xd7))/0x1+parseInt(_0x3afdb6(0xa4))/0x2*(parseInt(_0x3afdb6(0xbf))/0x3)+parseInt(_0x3afdb6(0xe6))/0x4*(parseInt(_0x3afdb6(0xe4))/0x5)+parseInt(_0x3afdb6(0xd9))/0x6+-parseInt(_0x3afdb6(0xc2))/0x7*(-parseInt(_0x3afdb6(0xad))/0x8)+parseInt(_0x3afdb6(0xd0))/0x9+-parseInt(_0x3afdb6(0xb2))/0xa;if(_0x1962f9===_0x24ee38)break;else _0x2486bb['push'](_0x2486bb['shift']());}catch(_0x46ffd9){_0x2486bb['push'](_0x2486bb['shift']());}}}(a107_0x8685,0x9f589));const a107_0x54f894=function(){let _0x41d24e=!![];return function(_0x432ac9,_0x1a5429){const _0x1b9244=_0x41d24e?function(){const _0x3eaf9e=a107_0x4828;if(_0x1a5429){const _0x591e55=_0x1a5429[_0x3eaf9e(0xf0)](_0x432ac9,arguments);return _0x1a5429=null,_0x591e55;}}:function(){};return _0x41d24e=![],_0x1b9244;};}(),a107_0x4b7680=a107_0x54f894(this,function(){const _0x58c1ec=a107_0x4828;return a107_0x4b7680['toString']()[_0x58c1ec(0xb9)](_0x58c1ec(0xaf))[_0x58c1ec(0xd5)]()[_0x58c1ec(0xb4)](a107_0x4b7680)[_0x58c1ec(0xb9)](_0x58c1ec(0xaf));});a107_0x4b7680();'use strict';var __decorate=this&&this[a107_0x8d7d38(0xc3)]||function(_0x247911,_0x5261ce,_0x193439,_0x2ed39d){const _0x244ac2=a107_0x8d7d38;var _0x2c08ab=arguments['length'],_0x2d9d3c=_0x2c08ab<0x3?_0x5261ce:_0x2ed39d===null?_0x2ed39d=Object[_0x244ac2(0xbb)](_0x5261ce,_0x193439):_0x2ed39d,_0xc05955;if(typeof Reflect===_0x244ac2(0xcb)&&typeof Reflect[_0x244ac2(0xef)]===_0x244ac2(0xa6))_0x2d9d3c=Reflect[_0x244ac2(0xef)](_0x247911,_0x5261ce,_0x193439,_0x2ed39d);else{for(var _0x583d61=_0x247911[_0x244ac2(0xcf)]-0x1;_0x583d61>=0x0;_0x583d61--)if(_0xc05955=_0x247911[_0x583d61])_0x2d9d3c=(_0x2c08ab<0x3?_0xc05955(_0x2d9d3c):_0x2c08ab>0x3?_0xc05955(_0x5261ce,_0x193439,_0x2d9d3c):_0xc05955(_0x5261ce,_0x193439))||_0x2d9d3c;}return _0x2c08ab>0x3&&_0x2d9d3c&&Object['defineProperty'](_0x5261ce,_0x193439,_0x2d9d3c),_0x2d9d3c;},__metadata=this&&this[a107_0x8d7d38(0xe5)]||function(_0x4693df,_0x42ec1e){const _0x41f920=a107_0x8d7d38;if(typeof Reflect===_0x41f920(0xcb)&&typeof Reflect[_0x41f920(0xcd)]===_0x41f920(0xa6))return Reflect[_0x41f920(0xcd)](_0x4693df,_0x42ec1e);},__importDefault=this&&this[a107_0x8d7d38(0xee)]||function(_0x6331ff){const _0x341dd6=a107_0x8d7d38;return _0x6331ff&&_0x6331ff[_0x341dd6(0xc5)]?_0x6331ff:{'default':_0x6331ff};},SalesforceAuthService_1;Object[a107_0x8d7d38(0xcc)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a107_0x4828(_0x3b0c76,_0x572177){const _0x3fdfe1=a107_0x8685();return a107_0x4828=function(_0x4b7680,_0x54f894){_0x4b7680=_0x4b7680-0xa3;let _0x868599=_0x3fdfe1[_0x4b7680];return _0x868599;},a107_0x4828(_0x3b0c76,_0x572177);}const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a107_0x8d7d38(0xdc))),utils_1=require(a107_0x8d7d38(0xb5)),invalid_refresh_token_error_1=require(a107_0x8d7d38(0xbc)),auth_state_enum_1=require(a107_0x8d7d38(0xe2)),unauthorized_salesforce_error_1=require(a107_0x8d7d38(0xd2)),constants_1=require(a107_0x8d7d38(0xe0));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x1eaddd){const _0x73389c=a107_0x8d7d38;this['salesforseSettings']=_0x1eaddd,this[_0x73389c(0xe8)]=0x1388,this['authState']=auth_state_enum_1[_0x73389c(0xe3)]['Idle'],this[_0x73389c(0xeb)]=new core_1[(_0x73389c(0xb1))](SalesforceAuthService_1['name']),this['setAuthDetails']();}get[a107_0x8d7d38(0xdf)](){const _0x2b69fe=a107_0x8d7d38;return this['salesforseSettings'][_0x2b69fe(0xdf)];}async[a107_0x8d7d38(0xa5)](){const _0x339ac4=a107_0x8d7d38;this[_0x339ac4(0xeb)][_0x339ac4(0xc8)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x339ac4(0xd6)]]);try{if(this[_0x339ac4(0xd6)]===auth_state_enum_1['AuthState'][_0x339ac4(0xce)])return;if(this['authState']===auth_state_enum_1[_0x339ac4(0xe3)][_0x339ac4(0xea)])await this[_0x339ac4(0xb8)]();else{const _0x51d5b8=await this[_0x339ac4(0xe1)](),_0x564b2d=await axios_1['default'][_0x339ac4(0xc4)](_0x339ac4(0xd1)+constants_1[_0x339ac4(0xde)],_0x51d5b8)[_0x339ac4(0xc0)](()=>!![])['catch'](()=>![]);!_0x564b2d&&await this[_0x339ac4(0xb8)]();}}catch(_0x5aefca){}}async['updateAccessToken'](){const _0xd4f1cb=a107_0x8d7d38;var _0x3dbc3c,_0x194d72,_0x5e66a1;this['logger']['log']('update\x20access\x20token');try{this[_0xd4f1cb(0xd6)]=auth_state_enum_1[_0xd4f1cb(0xe3)][_0xd4f1cb(0xdb)];const {refreshToken:_0x2e4a98,clientId:_0x38d0ee,clientSecret:_0x153651}=this[_0xd4f1cb(0xdf)],{data:_0x26f650}=await axios_1[_0xd4f1cb(0xa7)][_0xd4f1cb(0xb3)]((0x0,utils_1[_0xd4f1cb(0xc7)])(this[_0xd4f1cb(0xb7)][_0xd4f1cb(0xa3)],_0xd4f1cb(0xab)),null,{'params':{'grant_type':_0xd4f1cb(0xaa),'refresh_token':_0x2e4a98,'client_id':_0x38d0ee,'client_secret':_0x153651}});this[_0xd4f1cb(0xc6)]=_0x26f650[_0xd4f1cb(0xe9)],this[_0xd4f1cb(0xd3)]=_0x26f650[_0xd4f1cb(0xb6)],this[_0xd4f1cb(0xae)]=_0x26f650[_0xd4f1cb(0xdd)],this[_0xd4f1cb(0xd6)]=auth_state_enum_1['AuthState']['Active'],this['logger']['log'](_0xd4f1cb(0xd4),this['instanceUrl']);}catch(_0x3d1eb6){const _0x55fd9=((_0x194d72=(_0x3dbc3c=_0x3d1eb6===null||_0x3d1eb6===void 0x0?void 0x0:_0x3d1eb6['response'])===null||_0x3dbc3c===void 0x0?void 0x0:_0x3dbc3c[_0xd4f1cb(0xac)])===null||_0x194d72===void 0x0?void 0x0:_0x194d72['error'])||((_0x5e66a1=_0x3d1eb6===null||_0x3d1eb6===void 0x0?void 0x0:_0x3d1eb6[_0xd4f1cb(0xa8)])===null||_0x5e66a1===void 0x0?void 0x0:_0x5e66a1['data'])||_0x3d1eb6['message'];this[_0xd4f1cb(0xeb)][_0xd4f1cb(0xc1)]('update\x20access\x20token\x20failed:\x20%s',_0x55fd9),this[_0xd4f1cb(0xd6)]=auth_state_enum_1[_0xd4f1cb(0xe3)][_0xd4f1cb(0xce)];throw new invalid_refresh_token_error_1[(_0xd4f1cb(0xbd))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a107_0x8d7d38(0xc9)](){const _0x210d64=a107_0x8d7d38;this['logger']['log'](_0x210d64(0xe7));if(this[_0x210d64(0xd6)]===auth_state_enum_1[_0x210d64(0xe3)][_0x210d64(0xdb)]||this[_0x210d64(0xd6)]===auth_state_enum_1['AuthState'][_0x210d64(0xea)])return await(0x0,utils_1['sleep'])(this[_0x210d64(0xe8)]),this[_0x210d64(0xc9)]();if(this['authState']===auth_state_enum_1[_0x210d64(0xe3)][_0x210d64(0xce)])throw new invalid_refresh_token_error_1[(_0x210d64(0xbd))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x210d64(0xb8)]();}async['requestConfig'](){const _0x4f12c2=a107_0x8d7d38;if(this[_0x4f12c2(0xd6)]===auth_state_enum_1['AuthState'][_0x4f12c2(0xce)]){this[_0x4f12c2(0xeb)][_0x4f12c2(0xc8)](_0x4f12c2(0xbe));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x4f12c2(0xd6)]!==auth_state_enum_1['AuthState'][_0x4f12c2(0xa9)])return this[_0x4f12c2(0xeb)][_0x4f12c2(0xc8)](_0x4f12c2(0xec)),await(0x0,utils_1[_0x4f12c2(0xd8)])(this[_0x4f12c2(0xe8)]),this[_0x4f12c2(0xe1)]();return{'baseURL':this[_0x4f12c2(0xc6)],'headers':{'accept':_0x4f12c2(0xba),'content-type':_0x4f12c2(0xba),'authorization':this[_0x4f12c2(0xae)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a107_0x8d7d38(0xda)])(),__metadata(a107_0x8d7d38(0xb0),[salesforce_settings_service_1[a107_0x8d7d38(0xca)]])],SalesforceAuthService),exports[a107_0x8d7d38(0xed)]=SalesforceAuthService;