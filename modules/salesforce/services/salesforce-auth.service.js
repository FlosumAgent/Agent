const a107_0x238f78=a107_0x5393;function a107_0x5393(_0x2ff36f,_0x313977){const _0x356b8c=a107_0x383d();return a107_0x5393=function(_0x5dd45e,_0x9252b3){_0x5dd45e=_0x5dd45e-0x1c1;let _0x383dd6=_0x356b8c[_0x5dd45e];return _0x383dd6;},a107_0x5393(_0x2ff36f,_0x313977);}(function(_0x8394c9,_0x4d0236){const _0x26bb21=a107_0x5393,_0x64dad8=_0x8394c9();while(!![]){try{const _0x391531=parseInt(_0x26bb21(0x1f7))/0x1+-parseInt(_0x26bb21(0x1fc))/0x2+parseInt(_0x26bb21(0x1ea))/0x3+-parseInt(_0x26bb21(0x1c4))/0x4+-parseInt(_0x26bb21(0x1cc))/0x5*(-parseInt(_0x26bb21(0x1de))/0x6)+parseInt(_0x26bb21(0x20b))/0x7*(parseInt(_0x26bb21(0x1d7))/0x8)+-parseInt(_0x26bb21(0x208))/0x9;if(_0x391531===_0x4d0236)break;else _0x64dad8['push'](_0x64dad8['shift']());}catch(_0x21ef88){_0x64dad8['push'](_0x64dad8['shift']());}}}(a107_0x383d,0x87788));const a107_0x9252b3=function(){let _0x1d8ae2=!![];return function(_0x418e5d,_0x2ee85d){const _0x1615bb=_0x1d8ae2?function(){if(_0x2ee85d){const _0x50414c=_0x2ee85d['apply'](_0x418e5d,arguments);return _0x2ee85d=null,_0x50414c;}}:function(){};return _0x1d8ae2=![],_0x1615bb;};}(),a107_0x5dd45e=a107_0x9252b3(this,function(){const _0x67c780=a107_0x5393;return a107_0x5dd45e['toString']()['search'](_0x67c780(0x1ce))[_0x67c780(0x1cb)]()[_0x67c780(0x202)](a107_0x5dd45e)['search']('(((.+)+)+)+$');});a107_0x5dd45e();'use strict';var __decorate=this&&this[a107_0x238f78(0x1f6)]||function(_0x4a1954,_0x52ca48,_0x57f3dd,_0x13d063){const _0x300d81=a107_0x238f78;var _0x4a226a=arguments[_0x300d81(0x1e8)],_0x3d6e43=_0x4a226a<0x3?_0x52ca48:_0x13d063===null?_0x13d063=Object[_0x300d81(0x1e1)](_0x52ca48,_0x57f3dd):_0x13d063,_0x1fb268;if(typeof Reflect==='object'&&typeof Reflect[_0x300d81(0x1fb)]===_0x300d81(0x1f2))_0x3d6e43=Reflect['decorate'](_0x4a1954,_0x52ca48,_0x57f3dd,_0x13d063);else{for(var _0x5aea69=_0x4a1954[_0x300d81(0x1e8)]-0x1;_0x5aea69>=0x0;_0x5aea69--)if(_0x1fb268=_0x4a1954[_0x5aea69])_0x3d6e43=(_0x4a226a<0x3?_0x1fb268(_0x3d6e43):_0x4a226a>0x3?_0x1fb268(_0x52ca48,_0x57f3dd,_0x3d6e43):_0x1fb268(_0x52ca48,_0x57f3dd))||_0x3d6e43;}return _0x4a226a>0x3&&_0x3d6e43&&Object['defineProperty'](_0x52ca48,_0x57f3dd,_0x3d6e43),_0x3d6e43;},__metadata=this&&this[a107_0x238f78(0x1ec)]||function(_0x2667ce,_0x47d136){const _0x49ba2b=a107_0x238f78;if(typeof Reflect===_0x49ba2b(0x1c8)&&typeof Reflect[_0x49ba2b(0x1e9)]===_0x49ba2b(0x1f2))return Reflect[_0x49ba2b(0x1e9)](_0x2667ce,_0x47d136);},__importDefault=this&&this[a107_0x238f78(0x1e7)]||function(_0x53739d){const _0x10a8d5=a107_0x238f78;return _0x53739d&&_0x53739d[_0x10a8d5(0x1df)]?_0x53739d:{'default':_0x53739d};},SalesforceAuthService_1;Object[a107_0x238f78(0x1f1)](exports,'__esModule',{'value':!![]}),exports[a107_0x238f78(0x1c6)]=void 0x0;const typedi_1=require(a107_0x238f78(0x1ee)),errors_1=require('../../../constants/errors'),core_1=require(a107_0x238f78(0x1cd)),salesforce_settings_service_1=require(a107_0x238f78(0x1e6)),axios_1=__importDefault(require(a107_0x238f78(0x1e3))),utils_1=require(a107_0x238f78(0x1cf)),invalid_refresh_token_error_1=require(a107_0x238f78(0x1f4)),auth_state_enum_1=require(a107_0x238f78(0x204)),unauthorized_salesforce_error_1=require(a107_0x238f78(0x1c1)),constants_1=require(a107_0x238f78(0x1db));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4995a2){const _0x3323f0=a107_0x238f78;this[_0x3323f0(0x20e)]=_0x4995a2,this['AUTH_WAIT_TIME']=0x1388,this[_0x3323f0(0x1d2)]=auth_state_enum_1[_0x3323f0(0x1eb)]['Idle'],this[_0x3323f0(0x201)]=new core_1[(_0x3323f0(0x20d))](SalesforceAuthService_1[_0x3323f0(0x20a)]),this['setAuthDetails']();}get[a107_0x238f78(0x1d8)](){const _0x2223c0=a107_0x238f78;return this[_0x2223c0(0x20e)][_0x2223c0(0x1d8)];}async[a107_0x238f78(0x1c9)](){const _0xd9f36d=a107_0x238f78;this[_0xd9f36d(0x201)][_0xd9f36d(0x1e0)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0xd9f36d(0x1eb)][this[_0xd9f36d(0x1d2)]]);try{if(this[_0xd9f36d(0x1d2)]===auth_state_enum_1[_0xd9f36d(0x1eb)]['Error'])return;if(this[_0xd9f36d(0x1d2)]===auth_state_enum_1[_0xd9f36d(0x1eb)][_0xd9f36d(0x1ff)])await this['updateAccessToken']();else{const _0x43e719=await this[_0xd9f36d(0x1d6)](),_0x3e8cdf=await axios_1[_0xd9f36d(0x1c3)]['get'](_0xd9f36d(0x1d4)+constants_1[_0xd9f36d(0x1da)],_0x43e719)[_0xd9f36d(0x1ca)](()=>!![])[_0xd9f36d(0x1dd)](()=>![]);!_0x3e8cdf&&await this['updateAccessToken']();}}catch(_0x354f7b){}}async[a107_0x238f78(0x1c5)](){const _0x5e8ced=a107_0x238f78;var _0x1338b7,_0x483bcb,_0x5f1964;this[_0x5e8ced(0x201)]['log'](_0x5e8ced(0x1f3));try{this[_0x5e8ced(0x1d2)]=auth_state_enum_1['AuthState'][_0x5e8ced(0x1fa)];const {refreshToken:_0x3c79d7,clientId:_0x257282,clientSecret:_0x51ac2b}=this[_0x5e8ced(0x1d8)],{data:_0x5c39f9}=await axios_1[_0x5e8ced(0x1c3)][_0x5e8ced(0x209)]((0x0,utils_1[_0x5e8ced(0x1fe)])(this[_0x5e8ced(0x20e)][_0x5e8ced(0x1dc)],_0x5e8ced(0x1e4)),null,{'params':{'grant_type':_0x5e8ced(0x1ed),'refresh_token':_0x3c79d7,'client_id':_0x257282,'client_secret':_0x51ac2b}});this[_0x5e8ced(0x1f9)]=_0x5c39f9['instance_url'],this[_0x5e8ced(0x203)]=_0x5c39f9[_0x5e8ced(0x1d0)],this['tokenType']=_0x5c39f9[_0x5e8ced(0x1c2)],this[_0x5e8ced(0x1d2)]=auth_state_enum_1[_0x5e8ced(0x1eb)]['Active'],this['logger']['log']('access\x20token\x20updated\x20for\x20%s',this[_0x5e8ced(0x1f9)]);}catch(_0x2cf0c8){const _0x3ddd0c=((_0x483bcb=(_0x1338b7=_0x2cf0c8===null||_0x2cf0c8===void 0x0?void 0x0:_0x2cf0c8[_0x5e8ced(0x1c7)])===null||_0x1338b7===void 0x0?void 0x0:_0x1338b7[_0x5e8ced(0x1d9)])===null||_0x483bcb===void 0x0?void 0x0:_0x483bcb[_0x5e8ced(0x1d5)])||((_0x5f1964=_0x2cf0c8===null||_0x2cf0c8===void 0x0?void 0x0:_0x2cf0c8[_0x5e8ced(0x1c7)])===null||_0x5f1964===void 0x0?void 0x0:_0x5f1964[_0x5e8ced(0x1d9)])||_0x2cf0c8[_0x5e8ced(0x1d1)];this[_0x5e8ced(0x201)]['error'](_0x5e8ced(0x1ef),_0x3ddd0c),this[_0x5e8ced(0x1d2)]=auth_state_enum_1[_0x5e8ced(0x1eb)][_0x5e8ced(0x20c)];throw new invalid_refresh_token_error_1[(_0x5e8ced(0x1fd))](errors_1[_0x5e8ced(0x1f8)]);}}async[a107_0x238f78(0x1f0)](){const _0x17692e=a107_0x238f78;this[_0x17692e(0x201)]['log'](_0x17692e(0x1d3));if(this[_0x17692e(0x1d2)]===auth_state_enum_1[_0x17692e(0x1eb)][_0x17692e(0x1fa)]||this['authState']===auth_state_enum_1[_0x17692e(0x1eb)][_0x17692e(0x1ff)])return await(0x0,utils_1[_0x17692e(0x207)])(this[_0x17692e(0x206)]),this[_0x17692e(0x1f0)]();if(this[_0x17692e(0x1d2)]===auth_state_enum_1['AuthState'][_0x17692e(0x20c)])throw new invalid_refresh_token_error_1[(_0x17692e(0x1fd))](errors_1[_0x17692e(0x1f8)]);await this[_0x17692e(0x1c5)]();}async[a107_0x238f78(0x1d6)](){const _0x3b2d89=a107_0x238f78;if(this[_0x3b2d89(0x1d2)]===auth_state_enum_1[_0x3b2d89(0x1eb)][_0x3b2d89(0x20c)]){this[_0x3b2d89(0x201)][_0x3b2d89(0x1e0)](_0x3b2d89(0x1e2));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x3b2d89(0x1d2)]!==auth_state_enum_1['AuthState'][_0x3b2d89(0x205)])return this[_0x3b2d89(0x201)][_0x3b2d89(0x1e0)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await(0x0,utils_1['sleep'])(this[_0x3b2d89(0x206)]),this[_0x3b2d89(0x1d6)]();return{'baseURL':this[_0x3b2d89(0x1f9)],'headers':{'accept':_0x3b2d89(0x20f),'content-type':'application/json','authorization':this[_0x3b2d89(0x1f5)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a107_0x238f78(0x1e5)])(),__metadata('design:paramtypes',[salesforce_settings_service_1[a107_0x238f78(0x200)]])],SalesforceAuthService),exports[a107_0x238f78(0x1c6)]=SalesforceAuthService;function a107_0x383d(){const _0x246a38=['655650JztILW','../../../core','(((.+)+)+)+$','../../shared/utils','access_token','message','authState','force\x20update\x20token','services/data/','error','requestConfig','32uFZMMW','settings','data','SALESFORCE_API_VERSION','../../../constants','loginUrl','catch','6ExZMqT','__esModule','log','getOwnPropertyDescriptor','create\x20authorized\x20request\x20failed:\x20authorization\x20error','axios','/services/oauth2/token','Service','../../shared/services/salesforce-settings.service','__importDefault','length','metadata','1957092MgHzCb','AuthState','__metadata','refresh_token','typedi','update\x20access\x20token\x20failed:\x20%s','forceUpdateToken','defineProperty','function','update\x20access\x20token','../errors/invalid-refresh-token.error','tokenType','__decorate','911565Plpozt','ERR_INVALID_SALESFORCE_TOKEN','instanceUrl','Updating','decorate','1616456tVrFxe','InvalidRefreshTokenError','joinURL','Idle','SalesforceSettingsService','logger','constructor','accessToken','../enums/auth-state.enum','Active','AUTH_WAIT_TIME','sleep','4850172WaEDKf','post','name','1437121PUGuPT','Error','Logger','salesforseSettings','application/json','../errors/unauthorized-salesforce.error','token_type','default','2456988MZPJVa','updateAccessToken','SalesforceAuthService','response','object','setAuthDetails','then','toString'];a107_0x383d=function(){return _0x246a38;};return a107_0x383d();}