const a103_0x1c75=['return\x20/\x22\x20+\x20this\x20+\x20\x22/','requestConfig','../../../constants','49454lAgoVc','log','accessToken','ERR_INVALID_SALESFORCE_TOKEN','__metadata','axios','70318zUYGwf','3yOoMyb','decorate','default','Updating','SalesforceAuthService','settings','__esModule','AUTH_WAIT_TIME','then','__importDefault','Error','297214YweGTT','salesforseSettings','338ADjuHd','sleep','SALESFORCE_API_VERSION','typedi','InvalidRefreshTokenError','setAuthDetails','object','forceUpdateToken','tokenType','instance_url','apply','access_token','instanceUrl','Service','access\x20token\x20updated\x20for\x20%s','refresh_token','../../../core','message','../enums/auth-state.enum','1VAVjWM','token_type','salesforce-auth-service','AuthState','error','post','defineProperty','design:paramtypes','updateAccessToken','../../../constants/errors','Idle','metadata','test','/services/oauth2/token','../../shared/services/salesforce-settings.service','getOwnPropertyDescriptor','function','SalesforceSettingsService','force\x20update\x20token','120271pbwdcW','../errors/unauthorized-salesforce.error','constructor','__decorate','../errors/invalid-refresh-token.error','response','../../shared/utils','get','1PdIIuL','409DiTVxz','Active','application/json','206433oQLZme','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','data','authState','147699HMpRFh'];const a103_0x5420a9=a103_0x2155;(function(_0x404e9c,_0x3ca285){const _0x5bb9eb=a103_0x2155;while(!![]){try{const _0x336bb2=-parseInt(_0x5bb9eb(0x15f))*-parseInt(_0x5bb9eb(0x130))+-parseInt(_0x5bb9eb(0x16a))*-parseInt(_0x5bb9eb(0x143))+-parseInt(_0x5bb9eb(0x162))*parseInt(_0x5bb9eb(0x15e))+-parseInt(_0x5bb9eb(0x171))*-parseInt(_0x5bb9eb(0x170))+parseInt(_0x5bb9eb(0x166))+-parseInt(_0x5bb9eb(0x12e))+parseInt(_0x5bb9eb(0x156));if(_0x336bb2===_0x3ca285)break;else _0x404e9c['push'](_0x404e9c['shift']());}catch(_0x3122ea){_0x404e9c['push'](_0x404e9c['shift']());}}}(a103_0x1c75,0x27c9d));function a103_0x2155(_0x64e2af,_0x3f0d25){return a103_0x2155=function(_0x33525c,_0x20b0ef){_0x33525c=_0x33525c-0x12a;let _0xeb6bd8=a103_0x1c75[_0x33525c];return _0xeb6bd8;},a103_0x2155(_0x64e2af,_0x3f0d25);}const a103_0xeb6bd8=function(){let _0x3096b7=!![];return function(_0x49ffa2,_0x42a36e){const _0x1fc78c=_0x3096b7?function(){const _0x5ac032=a103_0x2155;if(_0x42a36e){const _0x1127f2=_0x42a36e[_0x5ac032(0x13a)](_0x49ffa2,arguments);return _0x42a36e=null,_0x1127f2;}}:function(){};return _0x3096b7=![],_0x1fc78c;};}(),a103_0x20b0ef=a103_0xeb6bd8(this,function(){const _0x258ebf=function(){const _0x3a8e03=a103_0x2155,_0x43c15c=_0x258ebf[_0x3a8e03(0x158)](_0x3a8e03(0x167))()[_0x3a8e03(0x158)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x43c15c[_0x3a8e03(0x14f)](a103_0x20b0ef);};return _0x258ebf();});a103_0x20b0ef();'use strict';var __decorate=this&&this[a103_0x5420a9(0x159)]||function(_0x323735,_0x2347ba,_0x4f4c45,_0x43eb9){const _0x24610d=a103_0x5420a9;var _0x506938=arguments['length'],_0x306cc5=_0x506938<0x3?_0x2347ba:_0x43eb9===null?_0x43eb9=Object[_0x24610d(0x152)](_0x2347ba,_0x4f4c45):_0x43eb9,_0x15624b;if(typeof Reflect===_0x24610d(0x136)&&typeof Reflect[_0x24610d(0x172)]==='function')_0x306cc5=Reflect['decorate'](_0x323735,_0x2347ba,_0x4f4c45,_0x43eb9);else{for(var _0x5d8044=_0x323735['length']-0x1;_0x5d8044>=0x0;_0x5d8044--)if(_0x15624b=_0x323735[_0x5d8044])_0x306cc5=(_0x506938<0x3?_0x15624b(_0x306cc5):_0x506938>0x3?_0x15624b(_0x2347ba,_0x4f4c45,_0x306cc5):_0x15624b(_0x2347ba,_0x4f4c45))||_0x306cc5;}return _0x506938>0x3&&_0x306cc5&&Object[_0x24610d(0x149)](_0x2347ba,_0x4f4c45,_0x306cc5),_0x306cc5;},__metadata=this&&this[a103_0x5420a9(0x16e)]||function(_0x131f58,_0x14d4e9){const _0x1bfce8=a103_0x5420a9;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1bfce8(0x153))return Reflect[_0x1bfce8(0x14e)](_0x131f58,_0x14d4e9);},__importDefault=this&&this[a103_0x5420a9(0x12c)]||function(_0x1e6f1e){const _0x5919c1=a103_0x5420a9;return _0x1e6f1e&&_0x1e6f1e[_0x5919c1(0x177)]?_0x1e6f1e:{'default':_0x1e6f1e};};Object[a103_0x5420a9(0x149)](exports,a103_0x5420a9(0x177),{'value':!![]}),exports[a103_0x5420a9(0x175)]=void 0x0;const typedi_1=require(a103_0x5420a9(0x133)),errors_1=require(a103_0x5420a9(0x14c)),core_1=require(a103_0x5420a9(0x140)),salesforce_settings_service_1=require(a103_0x5420a9(0x151)),axios_1=__importDefault(require(a103_0x5420a9(0x16f))),utils_1=require(a103_0x5420a9(0x15c)),invalid_refresh_token_error_1=require(a103_0x5420a9(0x15a)),auth_state_enum_1=require(a103_0x5420a9(0x142)),unauthorized_salesforce_error_1=require(a103_0x5420a9(0x157)),constants_1=require(a103_0x5420a9(0x169)),logger=new core_1['Logger'](a103_0x5420a9(0x145));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x351368){const _0x35f36f=a103_0x5420a9;this[_0x35f36f(0x12f)]=_0x351368,this[_0x35f36f(0x12a)]=0x1388,this[_0x35f36f(0x165)]=auth_state_enum_1['AuthState'][_0x35f36f(0x14d)],this[_0x35f36f(0x135)]();}get['settings'](){const _0x22ccf8=a103_0x5420a9;return this[_0x22ccf8(0x12f)][_0x22ccf8(0x176)];}async['setAuthDetails'](){const _0x1bb736=a103_0x5420a9;logger[_0x1bb736(0x16b)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x1bb736(0x146)][this[_0x1bb736(0x165)]]);try{if(this[_0x1bb736(0x165)]===auth_state_enum_1[_0x1bb736(0x146)][_0x1bb736(0x12d)])return;if(this[_0x1bb736(0x165)]===auth_state_enum_1[_0x1bb736(0x146)]['Idle'])await this[_0x1bb736(0x14b)]();else{const _0x218d7d=await this['requestConfig'](),_0x5d8b50=await axios_1[_0x1bb736(0x173)][_0x1bb736(0x15d)]('services/data/'+constants_1[_0x1bb736(0x132)],_0x218d7d)[_0x1bb736(0x12b)](()=>!![])['catch'](()=>![]);!_0x5d8b50&&await this[_0x1bb736(0x14b)]();}}catch(_0x1d40e5){}}async[a103_0x5420a9(0x14b)](){const _0x4eb1d2=a103_0x5420a9;var _0x3910f1,_0x21f6ac,_0xdfc2a9;logger[_0x4eb1d2(0x16b)]('update\x20access\x20token');try{this[_0x4eb1d2(0x165)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x2b5a60,clientId:_0x4df14a,clientSecret:_0x4a8da0}=this[_0x4eb1d2(0x176)],{data:_0x25d9e5}=await axios_1['default'][_0x4eb1d2(0x148)](utils_1['joinURL'](this[_0x4eb1d2(0x12f)]['loginUrl'],_0x4eb1d2(0x150)),null,{'params':{'grant_type':_0x4eb1d2(0x13f),'refresh_token':_0x2b5a60,'client_id':_0x4df14a,'client_secret':_0x4a8da0}});this['instanceUrl']=_0x25d9e5[_0x4eb1d2(0x139)],this['accessToken']=_0x25d9e5[_0x4eb1d2(0x13b)],this[_0x4eb1d2(0x138)]=_0x25d9e5[_0x4eb1d2(0x144)],this[_0x4eb1d2(0x165)]=auth_state_enum_1[_0x4eb1d2(0x146)][_0x4eb1d2(0x160)],logger['log'](_0x4eb1d2(0x13e),this[_0x4eb1d2(0x13c)]);}catch(_0xf532b2){const _0x36b476=((_0x21f6ac=(_0x3910f1=_0xf532b2===null||_0xf532b2===void 0x0?void 0x0:_0xf532b2[_0x4eb1d2(0x15b)])===null||_0x3910f1===void 0x0?void 0x0:_0x3910f1[_0x4eb1d2(0x164)])===null||_0x21f6ac===void 0x0?void 0x0:_0x21f6ac[_0x4eb1d2(0x147)])||((_0xdfc2a9=_0xf532b2===null||_0xf532b2===void 0x0?void 0x0:_0xf532b2[_0x4eb1d2(0x15b)])===null||_0xdfc2a9===void 0x0?void 0x0:_0xdfc2a9[_0x4eb1d2(0x164)])||_0xf532b2[_0x4eb1d2(0x141)];logger[_0x4eb1d2(0x147)]('update\x20access\x20token\x20failed:\x20%s',_0x36b476),this[_0x4eb1d2(0x165)]=auth_state_enum_1['AuthState'][_0x4eb1d2(0x12d)];throw new invalid_refresh_token_error_1[(_0x4eb1d2(0x134))](errors_1[_0x4eb1d2(0x16d)]);}}async[a103_0x5420a9(0x137)](){const _0x493bcd=a103_0x5420a9;logger[_0x493bcd(0x16b)](_0x493bcd(0x155));if(this[_0x493bcd(0x165)]===auth_state_enum_1[_0x493bcd(0x146)][_0x493bcd(0x174)]||this[_0x493bcd(0x165)]===auth_state_enum_1[_0x493bcd(0x146)][_0x493bcd(0x14d)])return await utils_1[_0x493bcd(0x131)](this[_0x493bcd(0x12a)]),this[_0x493bcd(0x137)]();if(this[_0x493bcd(0x165)]===auth_state_enum_1[_0x493bcd(0x146)][_0x493bcd(0x12d)])throw new invalid_refresh_token_error_1[(_0x493bcd(0x134))](errors_1[_0x493bcd(0x16d)]);await this[_0x493bcd(0x14b)]();}async[a103_0x5420a9(0x168)](){const _0x397fe9=a103_0x5420a9;if(this[_0x397fe9(0x165)]===auth_state_enum_1[_0x397fe9(0x146)][_0x397fe9(0x12d)]){logger[_0x397fe9(0x16b)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this['authState']!==auth_state_enum_1[_0x397fe9(0x146)][_0x397fe9(0x160)])return logger[_0x397fe9(0x16b)](_0x397fe9(0x163)),await utils_1[_0x397fe9(0x131)](this['AUTH_WAIT_TIME']),this[_0x397fe9(0x168)]();return{'baseURL':this[_0x397fe9(0x13c)],'headers':{'accept':_0x397fe9(0x161),'content-type':'application/json','authorization':this[_0x397fe9(0x138)]+'\x20'+this[_0x397fe9(0x16c)]}};}};SalesforceAuthService=__decorate([typedi_1[a103_0x5420a9(0x13d)](),__metadata(a103_0x5420a9(0x14a),[salesforce_settings_service_1[a103_0x5420a9(0x154)]])],SalesforceAuthService),exports[a103_0x5420a9(0x175)]=SalesforceAuthService;