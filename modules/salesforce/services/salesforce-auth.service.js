const a106_0x583b=['return\x20/\x22\x20+\x20this\x20+\x20\x22/','application/json','sleep','230FVpuZI','instance_url','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','length','metadata','381473CvgwGh','updateAccessToken','../../../constants/errors','../../../core','../../../constants','instanceUrl','4173pOgEtB','Idle','Updating','386400sMCdBH','response','Service','451938NJsuNL','AUTH_WAIT_TIME','SALESFORCE_API_VERSION','post','__esModule','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','accessToken','198088xxJjjj','access\x20token\x20updated\x20for\x20%s','tokenType','default','2963jnDojH','object','forceUpdateToken','AuthState','defineProperty','setAuthDetails','token_type','access_token','Error','constructor','function','decorate','1JQsLhW','authState','settings','InvalidRefreshTokenError','/services/oauth2/token','../enums/auth-state.enum','then','error','ERR_INVALID_SALESFORCE_TOKEN','design:paramtypes','log','UnauthorizedSalesforceError','loginUrl','SalesforceSettingsService','check\x20auth:\x20current\x20state\x20-\x20%s','451086VTZwVV','logger','../errors/unauthorized-salesforce.error','../../shared/utils','requestConfig','data','get','__importDefault','salesforseSettings'];const a106_0x4bc09b=a106_0x5998;(function(_0x281d75,_0x88a05){const _0x3226ac=a106_0x5998;while(!![]){try{const _0x4ee021=-parseInt(_0x3226ac(0x1a8))+parseInt(_0x3226ac(0x1b5))+-parseInt(_0x3226ac(0x1ab))+parseInt(_0x3226ac(0x1ae))*parseInt(_0x3226ac(0x1c5))+parseInt(_0x3226ac(0x1d4))+parseInt(_0x3226ac(0x1a2))+parseInt(_0x3226ac(0x1b9))*-parseInt(_0x3226ac(0x19d));if(_0x4ee021===_0x88a05)break;else _0x281d75['push'](_0x281d75['shift']());}catch(_0x7619e4){_0x281d75['push'](_0x281d75['shift']());}}}(a106_0x583b,0x6439a));const a106_0x5c4ac2=function(){let _0x5e215d=!![];return function(_0x58eadd,_0x1dc6d2){const _0x1fd68d=_0x5e215d?function(){if(_0x1dc6d2){const _0x50aaa2=_0x1dc6d2['apply'](_0x58eadd,arguments);return _0x1dc6d2=null,_0x50aaa2;}}:function(){};return _0x5e215d=![],_0x1fd68d;};}(),a106_0x27f484=a106_0x5c4ac2(this,function(){const _0x39c9bb=function(){const _0x3ecd17=a106_0x5998,_0x71bde9=_0x39c9bb[_0x3ecd17(0x1c2)](_0x3ecd17(0x19a))()[_0x3ecd17(0x1c2)](_0x3ecd17(0x19f));return!_0x71bde9['test'](a106_0x27f484);};return _0x39c9bb();});a106_0x27f484();'use strict';var __decorate=this&&this['__decorate']||function(_0x43fc4d,_0x2bb336,_0x195214,_0x46eb41){const _0x375063=a106_0x5998;var _0x380105=arguments['length'],_0x3d80a1=_0x380105<0x3?_0x2bb336:_0x46eb41===null?_0x46eb41=Object['getOwnPropertyDescriptor'](_0x2bb336,_0x195214):_0x46eb41,_0x10c50d;if(typeof Reflect==='object'&&typeof Reflect[_0x375063(0x1c4)]===_0x375063(0x1c3))_0x3d80a1=Reflect['decorate'](_0x43fc4d,_0x2bb336,_0x195214,_0x46eb41);else{for(var _0x5e6e10=_0x43fc4d[_0x375063(0x1a0)]-0x1;_0x5e6e10>=0x0;_0x5e6e10--)if(_0x10c50d=_0x43fc4d[_0x5e6e10])_0x3d80a1=(_0x380105<0x3?_0x10c50d(_0x3d80a1):_0x380105>0x3?_0x10c50d(_0x2bb336,_0x195214,_0x3d80a1):_0x10c50d(_0x2bb336,_0x195214))||_0x3d80a1;}return _0x380105>0x3&&_0x3d80a1&&Object[_0x375063(0x1bd)](_0x2bb336,_0x195214,_0x3d80a1),_0x3d80a1;},__metadata=this&&this['__metadata']||function(_0x35ed3b,_0x1f13b9){const _0x173514=a106_0x5998;if(typeof Reflect===_0x173514(0x1ba)&&typeof Reflect['metadata']==='function')return Reflect[_0x173514(0x1a1)](_0x35ed3b,_0x1f13b9);},__importDefault=this&&this[a106_0x4bc09b(0x198)]||function(_0x1a85fe){return _0x1a85fe&&_0x1a85fe['__esModule']?_0x1a85fe:{'default':_0x1a85fe};},SalesforceAuthService_1;Object['defineProperty'](exports,a106_0x4bc09b(0x1b2),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require(a106_0x4bc09b(0x1a4)),core_1=require(a106_0x4bc09b(0x1a5)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a106_0x4bc09b(0x194)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a106_0x4bc09b(0x1ca)),unauthorized_salesforce_error_1=require(a106_0x4bc09b(0x193)),constants_1=require(a106_0x4bc09b(0x1a6));function a106_0x5998(_0x828ff8,_0xc644d5){return a106_0x5998=function(_0x5b4512,_0x27f484){_0x5b4512=_0x5b4512-0x192;let _0x5c4ac2=a106_0x583b[_0x5b4512];return _0x5c4ac2;},a106_0x5998(_0x828ff8,_0xc644d5);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x167de3){const _0x129322=a106_0x4bc09b;this['salesforseSettings']=_0x167de3,this[_0x129322(0x1af)]=0x1388,this[_0x129322(0x1c6)]=auth_state_enum_1['AuthState']['Idle'],this[_0x129322(0x192)]=new core_1['Logger'](SalesforceAuthService_1['name']),this[_0x129322(0x1be)]();}get[a106_0x4bc09b(0x1c7)](){const _0x1ac50f=a106_0x4bc09b;return this[_0x1ac50f(0x199)][_0x1ac50f(0x1c7)];}async[a106_0x4bc09b(0x1be)](){const _0x5d1456=a106_0x4bc09b;this[_0x5d1456(0x192)][_0x5d1456(0x1cf)](_0x5d1456(0x1d3),auth_state_enum_1[_0x5d1456(0x1bc)][this[_0x5d1456(0x1c6)]]);try{if(this[_0x5d1456(0x1c6)]===auth_state_enum_1[_0x5d1456(0x1bc)][_0x5d1456(0x1c1)])return;if(this[_0x5d1456(0x1c6)]===auth_state_enum_1[_0x5d1456(0x1bc)][_0x5d1456(0x1a9)])await this['updateAccessToken']();else{const _0xb0d4d=await this[_0x5d1456(0x195)](),_0x406698=await axios_1[_0x5d1456(0x1b8)][_0x5d1456(0x197)]('services/data/'+constants_1[_0x5d1456(0x1b0)],_0xb0d4d)[_0x5d1456(0x1cb)](()=>!![])['catch'](()=>![]);!_0x406698&&await this[_0x5d1456(0x1a3)]();}}catch(_0x49d706){}}async[a106_0x4bc09b(0x1a3)](){const _0x4b066e=a106_0x4bc09b;var _0x455da7,_0x58f20c,_0x3854da;this[_0x4b066e(0x192)][_0x4b066e(0x1cf)]('update\x20access\x20token');try{this[_0x4b066e(0x1c6)]=auth_state_enum_1['AuthState'][_0x4b066e(0x1aa)];const {refreshToken:_0x3a3757,clientId:_0x3cbccf,clientSecret:_0x518029}=this[_0x4b066e(0x1c7)],{data:_0x5a9a28}=await axios_1[_0x4b066e(0x1b8)][_0x4b066e(0x1b1)](utils_1['joinURL'](this[_0x4b066e(0x199)][_0x4b066e(0x1d1)],_0x4b066e(0x1c9)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x3a3757,'client_id':_0x3cbccf,'client_secret':_0x518029}});this[_0x4b066e(0x1a7)]=_0x5a9a28[_0x4b066e(0x19e)],this[_0x4b066e(0x1b4)]=_0x5a9a28[_0x4b066e(0x1c0)],this[_0x4b066e(0x1b7)]=_0x5a9a28[_0x4b066e(0x1bf)],this[_0x4b066e(0x1c6)]=auth_state_enum_1[_0x4b066e(0x1bc)]['Active'],this['logger']['log'](_0x4b066e(0x1b6),this[_0x4b066e(0x1a7)]);}catch(_0x9ebef7){const _0x100b7f=((_0x58f20c=(_0x455da7=_0x9ebef7===null||_0x9ebef7===void 0x0?void 0x0:_0x9ebef7[_0x4b066e(0x1ac)])===null||_0x455da7===void 0x0?void 0x0:_0x455da7[_0x4b066e(0x196)])===null||_0x58f20c===void 0x0?void 0x0:_0x58f20c[_0x4b066e(0x1cc)])||((_0x3854da=_0x9ebef7===null||_0x9ebef7===void 0x0?void 0x0:_0x9ebef7[_0x4b066e(0x1ac)])===null||_0x3854da===void 0x0?void 0x0:_0x3854da['data'])||_0x9ebef7['message'];this[_0x4b066e(0x192)]['error']('update\x20access\x20token\x20failed:\x20%s',_0x100b7f),this[_0x4b066e(0x1c6)]=auth_state_enum_1[_0x4b066e(0x1bc)][_0x4b066e(0x1c1)];throw new invalid_refresh_token_error_1[(_0x4b066e(0x1c8))](errors_1[_0x4b066e(0x1cd)]);}}async[a106_0x4bc09b(0x1bb)](){const _0x31667a=a106_0x4bc09b;this['logger'][_0x31667a(0x1cf)]('force\x20update\x20token');if(this[_0x31667a(0x1c6)]===auth_state_enum_1[_0x31667a(0x1bc)][_0x31667a(0x1aa)]||this['authState']===auth_state_enum_1[_0x31667a(0x1bc)][_0x31667a(0x1a9)])return await utils_1['sleep'](this['AUTH_WAIT_TIME']),this[_0x31667a(0x1bb)]();if(this[_0x31667a(0x1c6)]===auth_state_enum_1[_0x31667a(0x1bc)][_0x31667a(0x1c1)])throw new invalid_refresh_token_error_1[(_0x31667a(0x1c8))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x31667a(0x1a3)]();}async[a106_0x4bc09b(0x195)](){const _0x24c00a=a106_0x4bc09b;if(this[_0x24c00a(0x1c6)]===auth_state_enum_1[_0x24c00a(0x1bc)][_0x24c00a(0x1c1)]){this[_0x24c00a(0x192)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x24c00a(0x1d0))]();}if(this['authState']!==auth_state_enum_1[_0x24c00a(0x1bc)]['Active'])return this[_0x24c00a(0x192)][_0x24c00a(0x1cf)](_0x24c00a(0x1b3)),await utils_1[_0x24c00a(0x19c)](this[_0x24c00a(0x1af)]),this['requestConfig']();return{'baseURL':this[_0x24c00a(0x1a7)],'headers':{'accept':_0x24c00a(0x19b),'content-type':'application/json','authorization':this[_0x24c00a(0x1b7)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a106_0x4bc09b(0x1ad)](),__metadata(a106_0x4bc09b(0x1ce),[salesforce_settings_service_1[a106_0x4bc09b(0x1d2)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;