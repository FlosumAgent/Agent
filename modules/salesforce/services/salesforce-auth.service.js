const a106_0x44bb=['instanceUrl','then','apply','check\x20auth:\x20current\x20state\x20-\x20%s','677nMVqCh','object','tokenType','decorate','update\x20access\x20token','../errors/unauthorized-salesforce.error','test','AuthState','sleep','/services/oauth2/token','setAuthDetails','../errors/invalid-refresh-token.error','forceUpdateToken','SalesforceSettingsService','metadata','salesforseSettings','updateAccessToken','../../shared/utils','Error','catch','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','application/json','post','error','403787JdrDwc','constructor','../../../constants/errors','joinURL','1yIIsOy','token_type','get','defineProperty','../enums/auth-state.enum','__esModule','loginUrl','services/data/','create\x20authorized\x20request\x20failed:\x20authorization\x20error','AUTH_WAIT_TIME','Updating','__decorate','message','UnauthorizedSalesforceError','typedi','2293ZyEZkt','design:paramtypes','refresh_token','authState','23SyFkWY','37154rYbPPC','response','1297797iMJlxK','Idle','InvalidRefreshTokenError','default','accessToken','Service','logger','../../../constants','access_token','134002tAIRFZ','settings','519289vfvpML','1699JBpRph','function','SalesforceAuthService','__importDefault','requestConfig','data','return\x20/\x22\x20+\x20this\x20+\x20\x22/','Logger','getOwnPropertyDescriptor','1JwFPfs','Active','../../../core','log'];const a106_0x5c0fe0=a106_0x1d0e;(function(_0x6f2eac,_0x1df7f6){const _0xa4380=a106_0x1d0e;while(!![]){try{const _0x1b5fa5=parseInt(_0xa4380(0xec))+-parseInt(_0xa4380(0xcb))*-parseInt(_0xa4380(0xc7))+-parseInt(_0xa4380(0xdf))+-parseInt(_0xa4380(0xed))*-parseInt(_0xa4380(0xfe))+-parseInt(_0xa4380(0xe1))+-parseInt(_0xa4380(0xde))*parseInt(_0xa4380(0xda))+-parseInt(_0xa4380(0xf6))*-parseInt(_0xa4380(0xea));if(_0x1b5fa5===_0x1df7f6)break;else _0x6f2eac['push'](_0x6f2eac['shift']());}catch(_0x396e60){_0x6f2eac['push'](_0x6f2eac['shift']());}}}(a106_0x44bb,0xc819b));const a106_0x24407e=function(){let _0x2702a5=!![];return function(_0x2ea82b,_0x25f1fa){const _0x754243=_0x2702a5?function(){const _0x6f61b9=a106_0x1d0e;if(_0x25f1fa){const _0x44cff6=_0x25f1fa[_0x6f61b9(0xfc)](_0x2ea82b,arguments);return _0x25f1fa=null,_0x44cff6;}}:function(){};return _0x2702a5=![],_0x754243;};}(),a106_0x3a46c4=a106_0x24407e(this,function(){const _0x53336e=function(){const _0x3b177d=a106_0x1d0e,_0x26996d=_0x53336e[_0x3b177d(0xc8)](_0x3b177d(0xf3))()[_0x3b177d(0xc8)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x26996d[_0x3b177d(0xb5)](a106_0x3a46c4);};return _0x53336e();});a106_0x3a46c4();'use strict';var __decorate=this&&this[a106_0x5c0fe0(0xd6)]||function(_0x5267c3,_0x542398,_0x14a951,_0x5243a2){const _0x20573f=a106_0x5c0fe0;var _0x4e8831=arguments['length'],_0x590bf1=_0x4e8831<0x3?_0x542398:_0x5243a2===null?_0x5243a2=Object[_0x20573f(0xf5)](_0x542398,_0x14a951):_0x5243a2,_0x2d8e5e;if(typeof Reflect==='object'&&typeof Reflect[_0x20573f(0xb2)]===_0x20573f(0xee))_0x590bf1=Reflect[_0x20573f(0xb2)](_0x5267c3,_0x542398,_0x14a951,_0x5243a2);else{for(var _0x3e391f=_0x5267c3['length']-0x1;_0x3e391f>=0x0;_0x3e391f--)if(_0x2d8e5e=_0x5267c3[_0x3e391f])_0x590bf1=(_0x4e8831<0x3?_0x2d8e5e(_0x590bf1):_0x4e8831>0x3?_0x2d8e5e(_0x542398,_0x14a951,_0x590bf1):_0x2d8e5e(_0x542398,_0x14a951))||_0x590bf1;}return _0x4e8831>0x3&&_0x590bf1&&Object[_0x20573f(0xce)](_0x542398,_0x14a951,_0x590bf1),_0x590bf1;},__metadata=this&&this['__metadata']||function(_0x946b81,_0x3e648b){const _0x55ac1d=a106_0x5c0fe0;if(typeof Reflect===_0x55ac1d(0xff)&&typeof Reflect[_0x55ac1d(0xbd)]==='function')return Reflect[_0x55ac1d(0xbd)](_0x946b81,_0x3e648b);},__importDefault=this&&this[a106_0x5c0fe0(0xf0)]||function(_0x4bb60a){return _0x4bb60a&&_0x4bb60a['__esModule']?_0x4bb60a:{'default':_0x4bb60a};},SalesforceAuthService_1;Object[a106_0x5c0fe0(0xce)](exports,a106_0x5c0fe0(0xd0),{'value':!![]}),exports[a106_0x5c0fe0(0xef)]=void 0x0;function a106_0x1d0e(_0x56650a,_0x501e2c){return a106_0x1d0e=function(_0x5449c8,_0x3a46c4){_0x5449c8=_0x5449c8-0xb1;let _0x24407e=a106_0x44bb[_0x5449c8];return _0x24407e;},a106_0x1d0e(_0x56650a,_0x501e2c);}const typedi_1=require(a106_0x5c0fe0(0xd9)),errors_1=require(a106_0x5c0fe0(0xc9)),core_1=require(a106_0x5c0fe0(0xf8)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a106_0x5c0fe0(0xc0)),invalid_refresh_token_error_1=require(a106_0x5c0fe0(0xba)),auth_state_enum_1=require(a106_0x5c0fe0(0xcf)),unauthorized_salesforce_error_1=require(a106_0x5c0fe0(0xb4)),constants_1=require(a106_0x5c0fe0(0xe8));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x45ab5b){const _0x2331b3=a106_0x5c0fe0;this['salesforseSettings']=_0x45ab5b,this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1[_0x2331b3(0xb6)][_0x2331b3(0xe2)],this[_0x2331b3(0xe7)]=new core_1[(_0x2331b3(0xf4))](SalesforceAuthService_1['name']),this[_0x2331b3(0xb9)]();}get[a106_0x5c0fe0(0xeb)](){const _0x3ecafd=a106_0x5c0fe0;return this[_0x3ecafd(0xbe)][_0x3ecafd(0xeb)];}async[a106_0x5c0fe0(0xb9)](){const _0x34e1e8=a106_0x5c0fe0;this['logger']['log'](_0x34e1e8(0xfd),auth_state_enum_1['AuthState'][this[_0x34e1e8(0xdd)]]);try{if(this['authState']===auth_state_enum_1['AuthState'][_0x34e1e8(0xc1)])return;if(this[_0x34e1e8(0xdd)]===auth_state_enum_1['AuthState'][_0x34e1e8(0xe2)])await this['updateAccessToken']();else{const _0x45fc0e=await this[_0x34e1e8(0xf1)](),_0x1c24ac=await axios_1[_0x34e1e8(0xe4)][_0x34e1e8(0xcd)](_0x34e1e8(0xd2)+constants_1['SALESFORCE_API_VERSION'],_0x45fc0e)[_0x34e1e8(0xfb)](()=>!![])[_0x34e1e8(0xc2)](()=>![]);!_0x1c24ac&&await this[_0x34e1e8(0xbf)]();}}catch(_0x242b32){}}async[a106_0x5c0fe0(0xbf)](){const _0x5222ef=a106_0x5c0fe0;var _0x4b96a2,_0x383920,_0x317261;this[_0x5222ef(0xe7)][_0x5222ef(0xf9)](_0x5222ef(0xb3));try{this[_0x5222ef(0xdd)]=auth_state_enum_1[_0x5222ef(0xb6)][_0x5222ef(0xd5)];const {refreshToken:_0x5c4665,clientId:_0x27ace9,clientSecret:_0x1a5482}=this[_0x5222ef(0xeb)],{data:_0xd48ffa}=await axios_1[_0x5222ef(0xe4)][_0x5222ef(0xc5)](utils_1[_0x5222ef(0xca)](this[_0x5222ef(0xbe)][_0x5222ef(0xd1)],_0x5222ef(0xb8)),null,{'params':{'grant_type':_0x5222ef(0xdc),'refresh_token':_0x5c4665,'client_id':_0x27ace9,'client_secret':_0x1a5482}});this[_0x5222ef(0xfa)]=_0xd48ffa['instance_url'],this[_0x5222ef(0xe5)]=_0xd48ffa[_0x5222ef(0xe9)],this['tokenType']=_0xd48ffa[_0x5222ef(0xcc)],this[_0x5222ef(0xdd)]=auth_state_enum_1[_0x5222ef(0xb6)][_0x5222ef(0xf7)],this['logger'][_0x5222ef(0xf9)]('access\x20token\x20updated\x20for\x20%s',this[_0x5222ef(0xfa)]);}catch(_0x15f98b){const _0x51bada=((_0x383920=(_0x4b96a2=_0x15f98b===null||_0x15f98b===void 0x0?void 0x0:_0x15f98b['response'])===null||_0x4b96a2===void 0x0?void 0x0:_0x4b96a2[_0x5222ef(0xf2)])===null||_0x383920===void 0x0?void 0x0:_0x383920['error'])||((_0x317261=_0x15f98b===null||_0x15f98b===void 0x0?void 0x0:_0x15f98b[_0x5222ef(0xe0)])===null||_0x317261===void 0x0?void 0x0:_0x317261[_0x5222ef(0xf2)])||_0x15f98b[_0x5222ef(0xd7)];this[_0x5222ef(0xe7)][_0x5222ef(0xc6)]('update\x20access\x20token\x20failed:\x20%s',_0x51bada),this[_0x5222ef(0xdd)]=auth_state_enum_1[_0x5222ef(0xb6)][_0x5222ef(0xc1)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x10d7bb=a106_0x5c0fe0;this['logger'][_0x10d7bb(0xf9)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x10d7bb(0xb6)][_0x10d7bb(0xd5)]||this[_0x10d7bb(0xdd)]===auth_state_enum_1[_0x10d7bb(0xb6)][_0x10d7bb(0xe2)])return await utils_1[_0x10d7bb(0xb7)](this[_0x10d7bb(0xd4)]),this[_0x10d7bb(0xbb)]();if(this['authState']===auth_state_enum_1[_0x10d7bb(0xb6)][_0x10d7bb(0xc1)])throw new invalid_refresh_token_error_1[(_0x10d7bb(0xe3))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x10d7bb(0xbf)]();}async[a106_0x5c0fe0(0xf1)](){const _0x46fb75=a106_0x5c0fe0;if(this[_0x46fb75(0xdd)]===auth_state_enum_1[_0x46fb75(0xb6)][_0x46fb75(0xc1)]){this[_0x46fb75(0xe7)][_0x46fb75(0xf9)](_0x46fb75(0xd3));throw new unauthorized_salesforce_error_1[(_0x46fb75(0xd8))]();}if(this[_0x46fb75(0xdd)]!==auth_state_enum_1['AuthState'][_0x46fb75(0xf7)])return this['logger'][_0x46fb75(0xf9)](_0x46fb75(0xc3)),await utils_1['sleep'](this['AUTH_WAIT_TIME']),this['requestConfig']();return{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','content-type':_0x46fb75(0xc4),'authorization':this[_0x46fb75(0xb1)]+'\x20'+this[_0x46fb75(0xe5)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a106_0x5c0fe0(0xe6)](),__metadata(a106_0x5c0fe0(0xdb),[salesforce_settings_service_1[a106_0x5c0fe0(0xbc)]])],SalesforceAuthService),exports[a106_0x5c0fe0(0xef)]=SalesforceAuthService;