const a119_0x2b86d7=a119_0x4c04;(function(_0x4735a6,_0x1a1f6b){const _0x5065bc=a119_0x4c04,_0x2bb82f=_0x4735a6();while(!![]){try{const _0x685837=parseInt(_0x5065bc(0x12d))/0x1+-parseInt(_0x5065bc(0x133))/0x2+-parseInt(_0x5065bc(0x122))/0x3+-parseInt(_0x5065bc(0x125))/0x4*(parseInt(_0x5065bc(0x12b))/0x5)+parseInt(_0x5065bc(0x10b))/0x6*(-parseInt(_0x5065bc(0x12f))/0x7)+parseInt(_0x5065bc(0x113))/0x8*(parseInt(_0x5065bc(0x11f))/0x9)+parseInt(_0x5065bc(0x13b))/0xa*(parseInt(_0x5065bc(0x136))/0xb);if(_0x685837===_0x1a1f6b)break;else _0x2bb82f['push'](_0x2bb82f['shift']());}catch(_0x5a02bb){_0x2bb82f['push'](_0x2bb82f['shift']());}}}(a119_0x2ab0,0xa41ea));function a119_0x2ab0(){const _0x1b907f=['AUTH_WAIT_TIME','response','error','AuthState','229990AmYvss','../../../constants/errors','/services/oauth2/token','create\x20authorized\x20request\x20failed:\x20authorization\x20error','instance_url','SALESFORCE_API_VERSION','InvalidRefreshTokenError','../errors/invalid-refresh-token.error','Idle','loginUrl','toString','accessToken','authState','log','Active','ERR_INVALID_SALESFORCE_TOKEN','default','sleep','refresh_token','setAuthDetails','waitAuth','getOwnPropertyDescriptor','metadata','length','Service','__importDefault','post','constructor','catch','defineProperty','services/data/','../../../core','function','SalesforceAuthService','36RhjpEM','token_type','settings','requestConfig','../../shared/utils','tokenType','force\x20update\x20token','update\x20access\x20token\x20failed:\x20%s','134936pSVrrP','Error','joinURL','check\x20auth:\x20current\x20state\x20-\x20%s','apply','update\x20access\x20token','__metadata','(((.+)+)+)+$','access_token','__esModule','message','data','36SNkYCx','search','instanceUrl','1525017lzzPBY','logger','__decorate','1168044IUpozG','axios','forceUpdateToken','decorate','salesforseSettings','Logger','5oNSnJQ','object','631162CMWKsy','../../shared/services/salesforce-settings.service','301791ACnXgg','updateAccessToken','orgId','design:paramtypes','648618XcMghx','Updating','UnauthorizedSalesforceError','649vsWLhw'];a119_0x2ab0=function(){return _0x1b907f;};return a119_0x2ab0();}const a119_0x125947=function(){let _0x128164=!![];return function(_0x46f45b,_0x5d5971){const _0x5767f7=_0x128164?function(){const _0x1f4aa0=a119_0x4c04;if(_0x5d5971){const _0x59c9ed=_0x5d5971[_0x1f4aa0(0x117)](_0x46f45b,arguments);return _0x5d5971=null,_0x59c9ed;}}:function(){};return _0x128164=![],_0x5767f7;};}(),a119_0x670f8b=a119_0x125947(this,function(){const _0x201ec0=a119_0x4c04;return a119_0x670f8b[_0x201ec0(0x145)]()[_0x201ec0(0x120)]('(((.+)+)+)+$')[_0x201ec0(0x145)]()[_0x201ec0(0x104)](a119_0x670f8b)[_0x201ec0(0x120)](_0x201ec0(0x11a));});a119_0x670f8b();'use strict';var __decorate=this&&this[a119_0x2b86d7(0x124)]||function(_0x472188,_0x3bd4d6,_0x42c989,_0x2d6765){const _0x4c64d5=a119_0x2b86d7;var _0xeb61fa=arguments[_0x4c64d5(0x100)],_0x3b9b08=_0xeb61fa<0x3?_0x3bd4d6:_0x2d6765===null?_0x2d6765=Object[_0x4c64d5(0xfe)](_0x3bd4d6,_0x42c989):_0x2d6765,_0x92231e;if(typeof Reflect===_0x4c64d5(0x12c)&&typeof Reflect[_0x4c64d5(0x128)]===_0x4c64d5(0x109))_0x3b9b08=Reflect['decorate'](_0x472188,_0x3bd4d6,_0x42c989,_0x2d6765);else{for(var _0x2c1593=_0x472188[_0x4c64d5(0x100)]-0x1;_0x2c1593>=0x0;_0x2c1593--)if(_0x92231e=_0x472188[_0x2c1593])_0x3b9b08=(_0xeb61fa<0x3?_0x92231e(_0x3b9b08):_0xeb61fa>0x3?_0x92231e(_0x3bd4d6,_0x42c989,_0x3b9b08):_0x92231e(_0x3bd4d6,_0x42c989))||_0x3b9b08;}return _0xeb61fa>0x3&&_0x3b9b08&&Object['defineProperty'](_0x3bd4d6,_0x42c989,_0x3b9b08),_0x3b9b08;},__metadata=this&&this[a119_0x2b86d7(0x119)]||function(_0x19f183,_0x3dbdf2){const _0x1d8c6d=a119_0x2b86d7;if(typeof Reflect===_0x1d8c6d(0x12c)&&typeof Reflect[_0x1d8c6d(0xff)]==='function')return Reflect[_0x1d8c6d(0xff)](_0x19f183,_0x3dbdf2);},__importDefault=this&&this[a119_0x2b86d7(0x102)]||function(_0x27868b){return _0x27868b&&_0x27868b['__esModule']?_0x27868b:{'default':_0x27868b};},SalesforceAuthService_1;Object[a119_0x2b86d7(0x106)](exports,a119_0x2b86d7(0x11c),{'value':!![]}),exports[a119_0x2b86d7(0x10a)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a119_0x2b86d7(0x13c)),core_1=require(a119_0x2b86d7(0x108)),salesforce_settings_service_1=require(a119_0x2b86d7(0x12e)),axios_1=__importDefault(require(a119_0x2b86d7(0x126))),utils_1=require(a119_0x2b86d7(0x10f)),invalid_refresh_token_error_1=require(a119_0x2b86d7(0x142)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require('../../../constants');function a119_0x4c04(_0x34654e,_0x11a4f5){const _0x4c8d9f=a119_0x2ab0();return a119_0x4c04=function(_0x670f8b,_0x125947){_0x670f8b=_0x670f8b-0xf8;let _0x2ab01b=_0x4c8d9f[_0x670f8b];return _0x2ab01b;},a119_0x4c04(_0x34654e,_0x11a4f5);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x57c282){const _0x1583e5=a119_0x2b86d7;this[_0x1583e5(0x129)]=_0x57c282,this['AUTH_WAIT_TIME']=0x1388,this['authState']=auth_state_enum_1['AuthState'][_0x1583e5(0x143)],this[_0x1583e5(0x123)]=new core_1[(_0x1583e5(0x12a))](SalesforceAuthService_1['name']),this[_0x1583e5(0xfc)]();}get[a119_0x2b86d7(0x10d)](){const _0x411b65=a119_0x2b86d7;return this[_0x411b65(0x129)][_0x411b65(0x10d)];}async[a119_0x2b86d7(0xfc)](){const _0x354119=a119_0x2b86d7;this[_0x354119(0x123)]['log'](_0x354119(0x116),auth_state_enum_1[_0x354119(0x13a)][this[_0x354119(0x147)]]);try{if(this[_0x354119(0x147)]===auth_state_enum_1[_0x354119(0x13a)][_0x354119(0x114)])return;if(this[_0x354119(0x147)]===auth_state_enum_1[_0x354119(0x13a)][_0x354119(0x143)])await this[_0x354119(0x130)]();else{const _0x14e24f=await this[_0x354119(0x10e)](),_0x57370e=await axios_1[_0x354119(0xf9)]['get'](_0x354119(0x107)+constants_1[_0x354119(0x140)],_0x14e24f)['then'](()=>!![])[_0x354119(0x105)](()=>![]);!_0x57370e&&await this[_0x354119(0x130)]();}}catch(_0x2dbfe3){}}async[a119_0x2b86d7(0x130)](){const _0x535995=a119_0x2b86d7;var _0x4959c7,_0x284b38,_0x4dbaa1;this[_0x535995(0x123)]['log'](_0x535995(0x118));try{this['authState']=auth_state_enum_1['AuthState'][_0x535995(0x134)];const {refreshToken:_0x584cc6,clientId:_0x34ab54,clientSecret:_0xd91e5b}=this[_0x535995(0x10d)],{data:_0x199f02}=await axios_1[_0x535995(0xf9)][_0x535995(0x103)](utils_1[_0x535995(0x115)](this['salesforseSettings'][_0x535995(0x144)],_0x535995(0x13d)),null,{'params':{'grant_type':_0x535995(0xfb),'refresh_token':_0x584cc6,'client_id':_0x34ab54,'client_secret':_0xd91e5b}});this['instanceUrl']=_0x199f02[_0x535995(0x13f)],this['accessToken']=_0x199f02[_0x535995(0x11b)],this[_0x535995(0x110)]=_0x199f02[_0x535995(0x10c)],this[_0x535995(0x147)]=auth_state_enum_1['AuthState'][_0x535995(0x149)],this['logger'][_0x535995(0x148)]('access\x20token\x20updated\x20for\x20%s',this[_0x535995(0x121)]);}catch(_0x27b51d){const _0x3b4753=((_0x284b38=(_0x4959c7=_0x27b51d===null||_0x27b51d===void 0x0?void 0x0:_0x27b51d[_0x535995(0x138)])===null||_0x4959c7===void 0x0?void 0x0:_0x4959c7[_0x535995(0x11e)])===null||_0x284b38===void 0x0?void 0x0:_0x284b38[_0x535995(0x139)])||((_0x4dbaa1=_0x27b51d===null||_0x27b51d===void 0x0?void 0x0:_0x27b51d[_0x535995(0x138)])===null||_0x4dbaa1===void 0x0?void 0x0:_0x4dbaa1[_0x535995(0x11e)])||_0x27b51d[_0x535995(0x11d)];this['logger'][_0x535995(0x139)](_0x535995(0x112),_0x3b4753),this[_0x535995(0x147)]=auth_state_enum_1['AuthState'][_0x535995(0x114)];throw new invalid_refresh_token_error_1[(_0x535995(0x141))](errors_1[_0x535995(0xf8)]);}}async[a119_0x2b86d7(0x127)](){const _0x3daa61=a119_0x2b86d7;this[_0x3daa61(0x123)]['log'](_0x3daa61(0x111));if(this['authState']===auth_state_enum_1[_0x3daa61(0x13a)][_0x3daa61(0x134)]||this['authState']===auth_state_enum_1[_0x3daa61(0x13a)][_0x3daa61(0x143)])return await utils_1['sleep'](this[_0x3daa61(0x137)]),this[_0x3daa61(0x127)]();if(this[_0x3daa61(0x147)]===auth_state_enum_1[_0x3daa61(0x13a)]['Error'])throw new invalid_refresh_token_error_1[(_0x3daa61(0x141))](errors_1[_0x3daa61(0xf8)]);await this[_0x3daa61(0x130)]();}async[a119_0x2b86d7(0xfd)](){const _0x1ea8d5=a119_0x2b86d7;if(this[_0x1ea8d5(0x147)]===auth_state_enum_1[_0x1ea8d5(0x13a)][_0x1ea8d5(0x114)]){this[_0x1ea8d5(0x123)][_0x1ea8d5(0x148)](_0x1ea8d5(0x13e));throw new unauthorized_salesforce_error_1[(_0x1ea8d5(0x135))]();}if(this[_0x1ea8d5(0x147)]!==auth_state_enum_1['AuthState'][_0x1ea8d5(0x149)])return this[_0x1ea8d5(0x123)][_0x1ea8d5(0x148)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x1ea8d5(0xfa)](this[_0x1ea8d5(0x137)]),this[_0x1ea8d5(0xfd)]();}['getAuthData'](){const _0x35765a=a119_0x2b86d7;return{'orgId':this[_0x35765a(0x131)],'accessToken':this[_0x35765a(0x146)],'instanceUrl':this[_0x35765a(0x121)]};}async[a119_0x2b86d7(0x10e)](){const _0x3dc89c=a119_0x2b86d7;return await this['waitAuth'](),{'baseURL':this[_0x3dc89c(0x121)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x3dc89c(0x146)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a119_0x2b86d7(0x101)](),__metadata(a119_0x2b86d7(0x132),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;