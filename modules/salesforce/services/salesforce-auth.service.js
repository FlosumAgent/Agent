const a108_0x10cefe=a108_0x3262;(function(_0x4239a4,_0x42348f){const _0x521937=a108_0x3262,_0x13c0f3=_0x4239a4();while(!![]){try{const _0xe73d1c=parseInt(_0x521937(0x22f))/0x1+parseInt(_0x521937(0x207))/0x2*(parseInt(_0x521937(0x21c))/0x3)+-parseInt(_0x521937(0x1ff))/0x4+-parseInt(_0x521937(0x217))/0x5*(-parseInt(_0x521937(0x234))/0x6)+-parseInt(_0x521937(0x21e))/0x7+-parseInt(_0x521937(0x205))/0x8*(-parseInt(_0x521937(0x20f))/0x9)+-parseInt(_0x521937(0x1f4))/0xa*(parseInt(_0x521937(0x21f))/0xb);if(_0xe73d1c===_0x42348f)break;else _0x13c0f3['push'](_0x13c0f3['shift']());}catch(_0x2edf05){_0x13c0f3['push'](_0x13c0f3['shift']());}}}(a108_0x5843,0xaf292));const a108_0x43889b=function(){let _0x480173=!![];return function(_0x236dd3,_0xa32b09){const _0x368b96=_0x480173?function(){const _0x51d953=a108_0x3262;if(_0xa32b09){const _0x4eaa4=_0xa32b09[_0x51d953(0x212)](_0x236dd3,arguments);return _0xa32b09=null,_0x4eaa4;}}:function(){};return _0x480173=![],_0x368b96;};}(),a108_0x2f325d=a108_0x43889b(this,function(){const _0x1c3818=a108_0x3262;return a108_0x2f325d[_0x1c3818(0x1f8)]()[_0x1c3818(0x22b)]('(((.+)+)+)+$')[_0x1c3818(0x1f8)]()[_0x1c3818(0x23e)](a108_0x2f325d)[_0x1c3818(0x22b)]('(((.+)+)+)+$');});function a108_0x5843(){const _0x1afd42=['function','updateAccessToken','design:paramtypes','3225969UGCPxR','catch','../enums/auth-state.enum','apply','UnauthorizedSalesforceError','response','SalesforceAuthService','post','15045GDVdsM','../errors/unauthorized-salesforce.error','check\x20auth:\x20current\x20state\x20-\x20%s','../../shared/services/salesforce-settings.service','message','682599CbDgTa','../../shared/utils','3903312QKhmmI','15191209gdFWnb','__metadata','InvalidRefreshTokenError','sleep','access_token','joinURL','then','get','Idle','Active','salesforseSettings','Error','search','Updating','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','data','676769GGLMay','object','loginUrl','logger','../../../constants/errors','2094IsdbTG','create\x20authorized\x20request\x20failed:\x20authorization\x20error','name','SalesforceSettingsService','AuthState','update\x20access\x20token','typedi','force\x20update\x20token','decorate','Service','constructor','defineProperty','tokenType','ERR_INVALID_SALESFORCE_TOKEN','__importDefault','authState','error','services/data/','forceUpdateToken','10SqmydY','../../../core','log','getOwnPropertyDescriptor','toString','application/json','default','__esModule','__decorate','SALESFORCE_API_VERSION','setAuthDetails','60928XGivlN','requestConfig','../../../constants','/services/oauth2/token','instance_url','metadata','16kZywee','accessToken','2TCJjPK','instanceUrl','settings','refresh_token','AUTH_WAIT_TIME'];a108_0x5843=function(){return _0x1afd42;};return a108_0x5843();}function a108_0x3262(_0x2a3aba,_0x2da0d1){const _0x2e6869=a108_0x5843();return a108_0x3262=function(_0x2f325d,_0x43889b){_0x2f325d=_0x2f325d-0x1f1;let _0x584329=_0x2e6869[_0x2f325d];return _0x584329;},a108_0x3262(_0x2a3aba,_0x2da0d1);}a108_0x2f325d();'use strict';var __decorate=this&&this[a108_0x10cefe(0x1fc)]||function(_0x5897c5,_0x63b212,_0x353122,_0x458a57){const _0x27eb7b=a108_0x10cefe;var _0x52141b=arguments['length'],_0x224aa9=_0x52141b<0x3?_0x63b212:_0x458a57===null?_0x458a57=Object[_0x27eb7b(0x1f7)](_0x63b212,_0x353122):_0x458a57,_0x4d2a5f;if(typeof Reflect==='object'&&typeof Reflect[_0x27eb7b(0x23c)]===_0x27eb7b(0x20c))_0x224aa9=Reflect[_0x27eb7b(0x23c)](_0x5897c5,_0x63b212,_0x353122,_0x458a57);else{for(var _0x4c9ea3=_0x5897c5['length']-0x1;_0x4c9ea3>=0x0;_0x4c9ea3--)if(_0x4d2a5f=_0x5897c5[_0x4c9ea3])_0x224aa9=(_0x52141b<0x3?_0x4d2a5f(_0x224aa9):_0x52141b>0x3?_0x4d2a5f(_0x63b212,_0x353122,_0x224aa9):_0x4d2a5f(_0x63b212,_0x353122))||_0x224aa9;}return _0x52141b>0x3&&_0x224aa9&&Object[_0x27eb7b(0x23f)](_0x63b212,_0x353122,_0x224aa9),_0x224aa9;},__metadata=this&&this[a108_0x10cefe(0x220)]||function(_0x5aa5bc,_0xcd7f15){const _0xa0d1fe=a108_0x10cefe;if(typeof Reflect===_0xa0d1fe(0x230)&&typeof Reflect[_0xa0d1fe(0x204)]===_0xa0d1fe(0x20c))return Reflect[_0xa0d1fe(0x204)](_0x5aa5bc,_0xcd7f15);},__importDefault=this&&this[a108_0x10cefe(0x242)]||function(_0x314c26){const _0x177e54=a108_0x10cefe;return _0x314c26&&_0x314c26[_0x177e54(0x1fb)]?_0x314c26:{'default':_0x314c26};},SalesforceAuthService_1;Object[a108_0x10cefe(0x23f)](exports,a108_0x10cefe(0x1fb),{'value':!![]}),exports[a108_0x10cefe(0x215)]=void 0x0;const typedi_1=require(a108_0x10cefe(0x23a)),errors_1=require(a108_0x10cefe(0x233)),core_1=require(a108_0x10cefe(0x1f5)),salesforce_settings_service_1=require(a108_0x10cefe(0x21a)),axios_1=__importDefault(require('axios')),utils_1=require(a108_0x10cefe(0x21d)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a108_0x10cefe(0x211)),unauthorized_salesforce_error_1=require(a108_0x10cefe(0x218)),constants_1=require(a108_0x10cefe(0x201));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x34ce78){const _0x3547c1=a108_0x10cefe;this[_0x3547c1(0x229)]=_0x34ce78,this[_0x3547c1(0x20b)]=0x1388,this[_0x3547c1(0x243)]=auth_state_enum_1[_0x3547c1(0x238)][_0x3547c1(0x227)],this[_0x3547c1(0x232)]=new core_1['Logger'](SalesforceAuthService_1[_0x3547c1(0x236)]),this[_0x3547c1(0x1fe)]();}get[a108_0x10cefe(0x209)](){return this['salesforseSettings']['settings'];}async[a108_0x10cefe(0x1fe)](){const _0x5dcbf5=a108_0x10cefe;this[_0x5dcbf5(0x232)]['log'](_0x5dcbf5(0x219),auth_state_enum_1[_0x5dcbf5(0x238)][this[_0x5dcbf5(0x243)]]);try{if(this[_0x5dcbf5(0x243)]===auth_state_enum_1['AuthState'][_0x5dcbf5(0x22a)])return;if(this[_0x5dcbf5(0x243)]===auth_state_enum_1[_0x5dcbf5(0x238)][_0x5dcbf5(0x227)])await this[_0x5dcbf5(0x20d)]();else{const _0x1589df=await this[_0x5dcbf5(0x200)](),_0x25c53e=await axios_1[_0x5dcbf5(0x1fa)][_0x5dcbf5(0x226)](_0x5dcbf5(0x1f2)+constants_1[_0x5dcbf5(0x1fd)],_0x1589df)[_0x5dcbf5(0x225)](()=>!![])[_0x5dcbf5(0x210)](()=>![]);!_0x25c53e&&await this[_0x5dcbf5(0x20d)]();}}catch(_0x5de25c){}}async['updateAccessToken'](){const _0x1b8aa5=a108_0x10cefe;var _0x2250ca,_0x420f4d,_0x436e29;this[_0x1b8aa5(0x232)][_0x1b8aa5(0x1f6)](_0x1b8aa5(0x239));try{this[_0x1b8aa5(0x243)]=auth_state_enum_1[_0x1b8aa5(0x238)][_0x1b8aa5(0x22c)];const {refreshToken:_0x2acb87,clientId:_0x11f0c4,clientSecret:_0x942a14}=this['settings'],{data:_0x2209d6}=await axios_1[_0x1b8aa5(0x1fa)][_0x1b8aa5(0x216)]((0x0,utils_1[_0x1b8aa5(0x224)])(this[_0x1b8aa5(0x229)][_0x1b8aa5(0x231)],_0x1b8aa5(0x202)),null,{'params':{'grant_type':_0x1b8aa5(0x20a),'refresh_token':_0x2acb87,'client_id':_0x11f0c4,'client_secret':_0x942a14}});this[_0x1b8aa5(0x208)]=_0x2209d6[_0x1b8aa5(0x203)],this[_0x1b8aa5(0x206)]=_0x2209d6[_0x1b8aa5(0x223)],this[_0x1b8aa5(0x240)]=_0x2209d6['token_type'],this[_0x1b8aa5(0x243)]=auth_state_enum_1[_0x1b8aa5(0x238)][_0x1b8aa5(0x228)],this[_0x1b8aa5(0x232)][_0x1b8aa5(0x1f6)]('access\x20token\x20updated\x20for\x20%s',this[_0x1b8aa5(0x208)]);}catch(_0x106c28){const _0x5eb5f7=((_0x420f4d=(_0x2250ca=_0x106c28===null||_0x106c28===void 0x0?void 0x0:_0x106c28['response'])===null||_0x2250ca===void 0x0?void 0x0:_0x2250ca[_0x1b8aa5(0x22e)])===null||_0x420f4d===void 0x0?void 0x0:_0x420f4d[_0x1b8aa5(0x1f1)])||((_0x436e29=_0x106c28===null||_0x106c28===void 0x0?void 0x0:_0x106c28[_0x1b8aa5(0x214)])===null||_0x436e29===void 0x0?void 0x0:_0x436e29['data'])||_0x106c28[_0x1b8aa5(0x21b)];this[_0x1b8aa5(0x232)][_0x1b8aa5(0x1f1)]('update\x20access\x20token\x20failed:\x20%s',_0x5eb5f7),this[_0x1b8aa5(0x243)]=auth_state_enum_1[_0x1b8aa5(0x238)][_0x1b8aa5(0x22a)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1b8aa5(0x241)]);}}async[a108_0x10cefe(0x1f3)](){const _0xe12364=a108_0x10cefe;this[_0xe12364(0x232)][_0xe12364(0x1f6)](_0xe12364(0x23b));if(this[_0xe12364(0x243)]===auth_state_enum_1[_0xe12364(0x238)][_0xe12364(0x22c)]||this[_0xe12364(0x243)]===auth_state_enum_1[_0xe12364(0x238)][_0xe12364(0x227)])return await(0x0,utils_1[_0xe12364(0x222)])(this[_0xe12364(0x20b)]),this[_0xe12364(0x1f3)]();if(this['authState']===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0xe12364(0x221))](errors_1[_0xe12364(0x241)]);await this[_0xe12364(0x20d)]();}async['requestConfig'](){const _0x56b184=a108_0x10cefe;if(this[_0x56b184(0x243)]===auth_state_enum_1[_0x56b184(0x238)][_0x56b184(0x22a)]){this[_0x56b184(0x232)][_0x56b184(0x1f6)](_0x56b184(0x235));throw new unauthorized_salesforce_error_1[(_0x56b184(0x213))]();}if(this['authState']!==auth_state_enum_1[_0x56b184(0x238)]['Active'])return this[_0x56b184(0x232)][_0x56b184(0x1f6)](_0x56b184(0x22d)),await(0x0,utils_1[_0x56b184(0x222)])(this[_0x56b184(0x20b)]),this[_0x56b184(0x200)]();return{'baseURL':this[_0x56b184(0x208)],'headers':{'accept':_0x56b184(0x1f9),'content-type':_0x56b184(0x1f9),'authorization':this[_0x56b184(0x240)]+'\x20'+this[_0x56b184(0x206)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a108_0x10cefe(0x23d)])(),__metadata(a108_0x10cefe(0x20e),[salesforce_settings_service_1[a108_0x10cefe(0x237)]])],SalesforceAuthService),exports[a108_0x10cefe(0x215)]=SalesforceAuthService;