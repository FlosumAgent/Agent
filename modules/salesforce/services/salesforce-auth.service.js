const a103_0x35b7=['Error','Service','sleep','SALESFORCE_API_VERSION','access\x20token\x20updated\x20for\x20%s','data','12326THvsyr','get','/services/oauth2/token','authState','SalesforceAuthService','then','../errors/invalid-refresh-token.error','metadata','SalesforceSettingsService','updateAccessToken','check\x20auth:\x20current\x20state\x20-\x20%s','services/data/','../../../constants','3754ePiQvp','refresh_token','setAuthDetails','519439gYTRKJ','length','../../../constants/errors','salesforseSettings','response','log','application/json','tokenType','settings','instance_url','AUTH_WAIT_TIME','create\x20authorized\x20request\x20failed:\x20authorization\x20error','__esModule','accessToken','forceUpdateToken','120009NtVMfy','test','force\x20update\x20token','defineProperty','access_token','update\x20access\x20token\x20failed:\x20%s','455927IUNFGF','getOwnPropertyDescriptor','../../shared/utils','Active','axios','Updating','InvalidRefreshTokenError','Idle','__importDefault','default','../../shared/services/salesforce-settings.service','ERR_INVALID_SALESFORCE_TOKEN','decorate','128sLyrfV','design:paramtypes','AuthState','42XQXQLU','instanceUrl','update\x20access\x20token','constructor','loginUrl','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','requestConfig','object','token_type','488655hAWUfE','UnauthorizedSalesforceError','../../../core','return\x20/\x22\x20+\x20this\x20+\x20\x22/','1nnHRIR','message','666076EfWjSZ','../enums/auth-state.enum'];const a103_0x27ef22=a103_0x2fd8;(function(_0x510344,_0x8fbcff){const _0x238647=a103_0x2fd8;while(!![]){try{const _0x3540d9=-parseInt(_0x238647(0x172))+parseInt(_0x238647(0x190))+-parseInt(_0x238647(0x166))*parseInt(_0x238647(0x18d))+parseInt(_0x238647(0x153))+parseInt(_0x238647(0x178))+parseInt(_0x238647(0x159))*-parseInt(_0x238647(0x176))+-parseInt(_0x238647(0x180))*-parseInt(_0x238647(0x169));if(_0x3540d9===_0x8fbcff)break;else _0x510344['push'](_0x510344['shift']());}catch(_0x5d8683){_0x510344['push'](_0x510344['shift']());}}}(a103_0x35b7,0x6132a));const a103_0x3675d1=function(){let _0xd6b856=!![];return function(_0x1cfe4f,_0x5c0416){const _0x36944e=_0xd6b856?function(){if(_0x5c0416){const _0x42cbd4=_0x5c0416['apply'](_0x1cfe4f,arguments);return _0x5c0416=null,_0x42cbd4;}}:function(){};return _0xd6b856=![],_0x36944e;};}(),a103_0x85b01f=a103_0x3675d1(this,function(){const _0x58f163=function(){const _0x4d15c9=a103_0x2fd8,_0x594ba2=_0x58f163[_0x4d15c9(0x16c)](_0x4d15c9(0x175))()[_0x4d15c9(0x16c)](_0x4d15c9(0x16e));return!_0x594ba2[_0x4d15c9(0x154)](a103_0x85b01f);};return _0x58f163();});function a103_0x2fd8(_0xd2cef4,_0x3c5883){return a103_0x2fd8=function(_0x2635d9,_0x85b01f){_0x2635d9=_0x2635d9-0x151;let _0x3675d1=a103_0x35b7[_0x2635d9];return _0x3675d1;},a103_0x2fd8(_0xd2cef4,_0x3c5883);}a103_0x85b01f();'use strict';var __decorate=this&&this['__decorate']||function(_0x3ebe72,_0x53fe2a,_0x5d9005,_0x52e5cd){const _0x25014a=a103_0x2fd8;var _0x302c33=arguments[_0x25014a(0x191)],_0x356d75=_0x302c33<0x3?_0x53fe2a:_0x52e5cd===null?_0x52e5cd=Object[_0x25014a(0x15a)](_0x53fe2a,_0x5d9005):_0x52e5cd,_0x7fed6;if(typeof Reflect===_0x25014a(0x170)&&typeof Reflect[_0x25014a(0x165)]==='function')_0x356d75=Reflect[_0x25014a(0x165)](_0x3ebe72,_0x53fe2a,_0x5d9005,_0x52e5cd);else{for(var _0xce7be5=_0x3ebe72[_0x25014a(0x191)]-0x1;_0xce7be5>=0x0;_0xce7be5--)if(_0x7fed6=_0x3ebe72[_0xce7be5])_0x356d75=(_0x302c33<0x3?_0x7fed6(_0x356d75):_0x302c33>0x3?_0x7fed6(_0x53fe2a,_0x5d9005,_0x356d75):_0x7fed6(_0x53fe2a,_0x5d9005))||_0x356d75;}return _0x302c33>0x3&&_0x356d75&&Object['defineProperty'](_0x53fe2a,_0x5d9005,_0x356d75),_0x356d75;},__metadata=this&&this['__metadata']||function(_0xecfd40,_0x3ac530){const _0x219bef=a103_0x2fd8;if(typeof Reflect===_0x219bef(0x170)&&typeof Reflect[_0x219bef(0x187)]==='function')return Reflect[_0x219bef(0x187)](_0xecfd40,_0x3ac530);},__importDefault=this&&this[a103_0x27ef22(0x161)]||function(_0xc7a31d){return _0xc7a31d&&_0xc7a31d['__esModule']?_0xc7a31d:{'default':_0xc7a31d};};Object[a103_0x27ef22(0x156)](exports,a103_0x27ef22(0x19c),{'value':!![]}),exports[a103_0x27ef22(0x184)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a103_0x27ef22(0x192)),core_1=require(a103_0x27ef22(0x174)),salesforce_settings_service_1=require(a103_0x27ef22(0x163)),axios_1=__importDefault(require(a103_0x27ef22(0x15d))),utils_1=require(a103_0x27ef22(0x15b)),invalid_refresh_token_error_1=require(a103_0x27ef22(0x186)),auth_state_enum_1=require(a103_0x27ef22(0x179)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a103_0x27ef22(0x18c)),logger=new core_1['Logger']('salesforce-auth-service');let SalesforceAuthService=class SalesforceAuthService{constructor(_0x1ecd09){const _0x4dfdd8=a103_0x27ef22;this['salesforseSettings']=_0x1ecd09,this[_0x4dfdd8(0x19a)]=0x1388,this[_0x4dfdd8(0x183)]=auth_state_enum_1['AuthState']['Idle'],this['setAuthDetails']();}get[a103_0x27ef22(0x198)](){const _0x3ed1c8=a103_0x27ef22;return this['salesforseSettings'][_0x3ed1c8(0x198)];}async[a103_0x27ef22(0x18f)](){const _0x3bc7b2=a103_0x27ef22;logger[_0x3bc7b2(0x195)](_0x3bc7b2(0x18a),auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x3bc7b2(0x183)]===auth_state_enum_1[_0x3bc7b2(0x168)][_0x3bc7b2(0x17a)])return;if(this[_0x3bc7b2(0x183)]===auth_state_enum_1[_0x3bc7b2(0x168)]['Idle'])await this['updateAccessToken']();else{const _0x791d20=await this[_0x3bc7b2(0x16f)](),_0x903acd=await axios_1[_0x3bc7b2(0x162)][_0x3bc7b2(0x181)](_0x3bc7b2(0x18b)+constants_1[_0x3bc7b2(0x17d)],_0x791d20)[_0x3bc7b2(0x185)](()=>!![])['catch'](()=>![]);!_0x903acd&&await this[_0x3bc7b2(0x189)]();}}catch(_0x113975){}}async['updateAccessToken'](){const _0x21bf15=a103_0x27ef22;var _0x31879f,_0x1b5ae5,_0x3840e0;logger[_0x21bf15(0x195)](_0x21bf15(0x16b));try{this['authState']=auth_state_enum_1[_0x21bf15(0x168)][_0x21bf15(0x15e)];const {refreshToken:_0x4b5b6a,clientId:_0x4a9051,clientSecret:_0x5c3cc1}=this['settings'],{data:_0x2a6d77}=await axios_1[_0x21bf15(0x162)]['post'](utils_1['joinURL'](this[_0x21bf15(0x193)][_0x21bf15(0x16d)],_0x21bf15(0x182)),null,{'params':{'grant_type':_0x21bf15(0x18e),'refresh_token':_0x4b5b6a,'client_id':_0x4a9051,'client_secret':_0x5c3cc1}});this['instanceUrl']=_0x2a6d77[_0x21bf15(0x199)],this[_0x21bf15(0x151)]=_0x2a6d77[_0x21bf15(0x157)],this[_0x21bf15(0x197)]=_0x2a6d77[_0x21bf15(0x171)],this['authState']=auth_state_enum_1[_0x21bf15(0x168)]['Active'],logger[_0x21bf15(0x195)](_0x21bf15(0x17e),this[_0x21bf15(0x16a)]);}catch(_0xa842d3){const _0x30e39c=((_0x1b5ae5=(_0x31879f=_0xa842d3===null||_0xa842d3===void 0x0?void 0x0:_0xa842d3[_0x21bf15(0x194)])===null||_0x31879f===void 0x0?void 0x0:_0x31879f[_0x21bf15(0x17f)])===null||_0x1b5ae5===void 0x0?void 0x0:_0x1b5ae5['error'])||((_0x3840e0=_0xa842d3===null||_0xa842d3===void 0x0?void 0x0:_0xa842d3[_0x21bf15(0x194)])===null||_0x3840e0===void 0x0?void 0x0:_0x3840e0[_0x21bf15(0x17f)])||_0xa842d3[_0x21bf15(0x177)];logger['error'](_0x21bf15(0x158),_0x30e39c),this[_0x21bf15(0x183)]=auth_state_enum_1[_0x21bf15(0x168)][_0x21bf15(0x17a)];throw new invalid_refresh_token_error_1[(_0x21bf15(0x15f))](errors_1[_0x21bf15(0x164)]);}}async[a103_0x27ef22(0x152)](){const _0x1a1961=a103_0x27ef22;logger['log'](_0x1a1961(0x155));if(this[_0x1a1961(0x183)]===auth_state_enum_1[_0x1a1961(0x168)][_0x1a1961(0x15e)]||this['authState']===auth_state_enum_1[_0x1a1961(0x168)][_0x1a1961(0x160)])return await utils_1[_0x1a1961(0x17c)](this[_0x1a1961(0x19a)]),this['forceUpdateToken']();if(this[_0x1a1961(0x183)]===auth_state_enum_1[_0x1a1961(0x168)][_0x1a1961(0x17a)])throw new invalid_refresh_token_error_1[(_0x1a1961(0x15f))](errors_1[_0x1a1961(0x164)]);await this[_0x1a1961(0x189)]();}async[a103_0x27ef22(0x16f)](){const _0x3b81fe=a103_0x27ef22;if(this[_0x3b81fe(0x183)]===auth_state_enum_1[_0x3b81fe(0x168)][_0x3b81fe(0x17a)]){logger[_0x3b81fe(0x195)](_0x3b81fe(0x19b));throw new unauthorized_salesforce_error_1[(_0x3b81fe(0x173))]();}if(this['authState']!==auth_state_enum_1[_0x3b81fe(0x168)][_0x3b81fe(0x15c)])return logger[_0x3b81fe(0x195)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1['sleep'](this[_0x3b81fe(0x19a)]),this[_0x3b81fe(0x16f)]();return{'baseURL':this[_0x3b81fe(0x16a)],'headers':{'accept':'application/json','content-type':_0x3b81fe(0x196),'authorization':this[_0x3b81fe(0x197)]+'\x20'+this[_0x3b81fe(0x151)]}};}};SalesforceAuthService=__decorate([typedi_1[a103_0x27ef22(0x17b)](),__metadata(a103_0x27ef22(0x167),[salesforce_settings_service_1[a103_0x27ef22(0x188)]])],SalesforceAuthService),exports[a103_0x27ef22(0x184)]=SalesforceAuthService;