const a105_0x4510=['loginUrl','defineProperty','decorate','instance_url','salesforseSettings','default','test','1ScOPlV','access_token','2037042pcJFMd','InvalidRefreshTokenError','SALESFORCE_API_VERSION','Idle','constructor','authState','instanceUrl','data','typedi','2itzJHt','318252MIUbKi','object','__importDefault','axios','/services/oauth2/token','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','joinURL','update\x20access\x20token\x20failed:\x20%s','995175PNvhAS','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','UnauthorizedSalesforceError','post','response','../errors/unauthorized-salesforce.error','5901KnxTBI','check\x20auth:\x20current\x20state\x20-\x20%s','Error','__esModule','getOwnPropertyDescriptor','catch','apply','message','design:paramtypes','setAuthDetails','../errors/invalid-refresh-token.error','AuthState','1180POJIwp','logger','sleep','settings','Updating','requestConfig','../../../constants/errors','token_type','tokenType','20705fMZRTQ','services/data/','metadata','application/json','length','../enums/auth-state.enum','return\x20/\x22\x20+\x20this\x20+\x20\x22/','../../shared/utils','create\x20authorized\x20request\x20failed:\x20authorization\x20error','updateAccessToken','SalesforceAuthService','Service','Active','accessToken','Logger','access\x20token\x20updated\x20for\x20%s','AUTH_WAIT_TIME','error','1963WJYxCE','log','577ulIPBR','update\x20access\x20token','refresh_token','948emYjQP','get','../../shared/services/salesforce-settings.service'];const a105_0x4d7351=a105_0x2655;(function(_0x1350b6,_0x4414da){const _0xdbd02c=a105_0x2655;while(!![]){try{const _0x25c839=parseInt(_0xdbd02c(0xe6))*-parseInt(_0xdbd02c(0xda))+parseInt(_0xdbd02c(0xf4))+-parseInt(_0xdbd02c(0xcb))*-parseInt(_0xdbd02c(0xcd))+parseInt(_0xdbd02c(0xee))+parseInt(_0xdbd02c(0x109))*-parseInt(_0xdbd02c(0xe5))+-parseInt(_0xdbd02c(0xd0))*-parseInt(_0xdbd02c(0x100))+-parseInt(_0xdbd02c(0xdc));if(_0x25c839===_0x4414da)break;else _0x1350b6['push'](_0x1350b6['shift']());}catch(_0x330e37){_0x1350b6['push'](_0x1350b6['shift']());}}}(a105_0x4510,0xd0e6f));function a105_0x2655(_0xa9f17d,_0x35d2c2){return a105_0x2655=function(_0x592381,_0x24ba5f){_0x592381=_0x592381-0xca;let _0x413f24=a105_0x4510[_0x592381];return _0x413f24;},a105_0x2655(_0xa9f17d,_0x35d2c2);}const a105_0x413f24=function(){let _0x19aa4a=!![];return function(_0x565bb2,_0x514a10){const _0x55068a=_0x19aa4a?function(){const _0x575b27=a105_0x2655;if(_0x514a10){const _0x23622e=_0x514a10[_0x575b27(0xfa)](_0x565bb2,arguments);return _0x514a10=null,_0x23622e;}}:function(){};return _0x19aa4a=![],_0x55068a;};}(),a105_0x24ba5f=a105_0x413f24(this,function(){const _0x2ce9dd=function(){const _0x369c37=a105_0x2655,_0x18e365=_0x2ce9dd[_0x369c37(0xe0)](_0x369c37(0x10f))()[_0x369c37(0xe0)](_0x369c37(0xef));return!_0x18e365[_0x369c37(0xd9)](a105_0x24ba5f);};return _0x2ce9dd();});a105_0x24ba5f();'use strict';var __decorate=this&&this['__decorate']||function(_0x44ae6d,_0x477d1b,_0x126049,_0x48ae3f){const _0xdad671=a105_0x2655;var _0x89e3da=arguments[_0xdad671(0x10d)],_0x4f6189=_0x89e3da<0x3?_0x477d1b:_0x48ae3f===null?_0x48ae3f=Object[_0xdad671(0xf8)](_0x477d1b,_0x126049):_0x48ae3f,_0x576365;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x4f6189=Reflect[_0xdad671(0xd5)](_0x44ae6d,_0x477d1b,_0x126049,_0x48ae3f);else{for(var _0x5c132e=_0x44ae6d[_0xdad671(0x10d)]-0x1;_0x5c132e>=0x0;_0x5c132e--)if(_0x576365=_0x44ae6d[_0x5c132e])_0x4f6189=(_0x89e3da<0x3?_0x576365(_0x4f6189):_0x89e3da>0x3?_0x576365(_0x477d1b,_0x126049,_0x4f6189):_0x576365(_0x477d1b,_0x126049))||_0x4f6189;}return _0x89e3da>0x3&&_0x4f6189&&Object[_0xdad671(0xd4)](_0x477d1b,_0x126049,_0x4f6189),_0x4f6189;},__metadata=this&&this['__metadata']||function(_0x3bd391,_0x3a20b2){const _0x2d23be=a105_0x2655;if(typeof Reflect===_0x2d23be(0xe7)&&typeof Reflect[_0x2d23be(0x10b)]==='function')return Reflect[_0x2d23be(0x10b)](_0x3bd391,_0x3a20b2);},__importDefault=this&&this[a105_0x4d7351(0xe8)]||function(_0x27181c){const _0x25aa47=a105_0x4d7351;return _0x27181c&&_0x27181c[_0x25aa47(0xf7)]?_0x27181c:{'default':_0x27181c};},SalesforceAuthService_1;Object[a105_0x4d7351(0xd4)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a105_0x4d7351(0xe4)),errors_1=require(a105_0x4d7351(0x106)),core_1=require('../../../core'),salesforce_settings_service_1=require(a105_0x4d7351(0xd2)),axios_1=__importDefault(require(a105_0x4d7351(0xe9))),utils_1=require(a105_0x4d7351(0x110)),invalid_refresh_token_error_1=require(a105_0x4d7351(0xfe)),auth_state_enum_1=require(a105_0x4d7351(0x10e)),unauthorized_salesforce_error_1=require(a105_0x4d7351(0xf3)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x48f803){const _0x50593d=a105_0x4d7351;this[_0x50593d(0xd7)]=_0x48f803,this['AUTH_WAIT_TIME']=0x1388,this[_0x50593d(0xe1)]=auth_state_enum_1['AuthState'][_0x50593d(0xdf)],this[_0x50593d(0x101)]=new core_1[(_0x50593d(0x117))](SalesforceAuthService_1['name']),this['setAuthDetails']();}get[a105_0x4d7351(0x103)](){const _0x2b1a27=a105_0x4d7351;return this[_0x2b1a27(0xd7)][_0x2b1a27(0x103)];}async[a105_0x4d7351(0xfd)](){const _0x4c481f=a105_0x4d7351;this['logger']['log'](_0x4c481f(0xf5),auth_state_enum_1[_0x4c481f(0xff)][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x4c481f(0xff)][_0x4c481f(0xf6)])return;if(this[_0x4c481f(0xe1)]===auth_state_enum_1[_0x4c481f(0xff)][_0x4c481f(0xdf)])await this[_0x4c481f(0x112)]();else{const _0x438545=await this[_0x4c481f(0x105)](),_0x337946=await axios_1[_0x4c481f(0xd8)][_0x4c481f(0xd1)](_0x4c481f(0x10a)+constants_1[_0x4c481f(0xde)],_0x438545)['then'](()=>!![])[_0x4c481f(0xf9)](()=>![]);!_0x337946&&await this['updateAccessToken']();}}catch(_0x5c896d){}}async[a105_0x4d7351(0x112)](){const _0x2387a2=a105_0x4d7351;var _0x3b00fc,_0x469b4a,_0x879b38;this[_0x2387a2(0x101)][_0x2387a2(0xcc)](_0x2387a2(0xce));try{this[_0x2387a2(0xe1)]=auth_state_enum_1[_0x2387a2(0xff)]['Updating'];const {refreshToken:_0x59f2b7,clientId:_0xe3699e,clientSecret:_0x1fcef6}=this[_0x2387a2(0x103)],{data:_0x4543e6}=await axios_1[_0x2387a2(0xd8)][_0x2387a2(0xf1)](utils_1[_0x2387a2(0xec)](this[_0x2387a2(0xd7)][_0x2387a2(0xd3)],_0x2387a2(0xea)),null,{'params':{'grant_type':_0x2387a2(0xcf),'refresh_token':_0x59f2b7,'client_id':_0xe3699e,'client_secret':_0x1fcef6}});this['instanceUrl']=_0x4543e6[_0x2387a2(0xd6)],this['accessToken']=_0x4543e6[_0x2387a2(0xdb)],this[_0x2387a2(0x108)]=_0x4543e6[_0x2387a2(0x107)],this['authState']=auth_state_enum_1[_0x2387a2(0xff)]['Active'],this['logger']['log'](_0x2387a2(0x118),this[_0x2387a2(0xe2)]);}catch(_0xaecdbf){const _0x33fbfb=((_0x469b4a=(_0x3b00fc=_0xaecdbf===null||_0xaecdbf===void 0x0?void 0x0:_0xaecdbf[_0x2387a2(0xf2)])===null||_0x3b00fc===void 0x0?void 0x0:_0x3b00fc[_0x2387a2(0xe3)])===null||_0x469b4a===void 0x0?void 0x0:_0x469b4a[_0x2387a2(0xca)])||((_0x879b38=_0xaecdbf===null||_0xaecdbf===void 0x0?void 0x0:_0xaecdbf[_0x2387a2(0xf2)])===null||_0x879b38===void 0x0?void 0x0:_0x879b38[_0x2387a2(0xe3)])||_0xaecdbf[_0x2387a2(0xfb)];this[_0x2387a2(0x101)]['error'](_0x2387a2(0xed),_0x33fbfb),this[_0x2387a2(0xe1)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x2387a2(0xdd))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x3767ae=a105_0x4d7351;this['logger'][_0x3767ae(0xcc)]('force\x20update\x20token');if(this[_0x3767ae(0xe1)]===auth_state_enum_1['AuthState'][_0x3767ae(0x104)]||this[_0x3767ae(0xe1)]===auth_state_enum_1[_0x3767ae(0xff)][_0x3767ae(0xdf)])return await utils_1[_0x3767ae(0x102)](this[_0x3767ae(0x119)]),this['forceUpdateToken']();if(this[_0x3767ae(0xe1)]===auth_state_enum_1[_0x3767ae(0xff)][_0x3767ae(0xf6)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this['updateAccessToken']();}async[a105_0x4d7351(0x105)](){const _0x45030e=a105_0x4d7351;if(this[_0x45030e(0xe1)]===auth_state_enum_1[_0x45030e(0xff)]['Error']){this[_0x45030e(0x101)][_0x45030e(0xcc)](_0x45030e(0x111));throw new unauthorized_salesforce_error_1[(_0x45030e(0xf0))]();}if(this['authState']!==auth_state_enum_1[_0x45030e(0xff)][_0x45030e(0x115)])return this[_0x45030e(0x101)][_0x45030e(0xcc)](_0x45030e(0xeb)),await utils_1[_0x45030e(0x102)](this['AUTH_WAIT_TIME']),this[_0x45030e(0x105)]();return{'baseURL':this['instanceUrl'],'headers':{'accept':_0x45030e(0x10c),'content-type':_0x45030e(0x10c),'authorization':this[_0x45030e(0x108)]+'\x20'+this[_0x45030e(0x116)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a105_0x4d7351(0x114)](),__metadata(a105_0x4d7351(0xfc),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a105_0x4d7351(0x113)]=SalesforceAuthService;