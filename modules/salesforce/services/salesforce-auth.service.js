const a125_0x57d37a=a125_0x581d;(function(_0x58e6f2,_0x358157){const _0x3c64f5=a125_0x581d,_0x3aee66=_0x58e6f2();while(!![]){try{const _0x4b208c=parseInt(_0x3c64f5(0x205))/0x1+parseInt(_0x3c64f5(0x1ba))/0x2+parseInt(_0x3c64f5(0x1cf))/0x3+-parseInt(_0x3c64f5(0x1f1))/0x4+parseInt(_0x3c64f5(0x1ce))/0x5*(-parseInt(_0x3c64f5(0x1f4))/0x6)+parseInt(_0x3c64f5(0x1eb))/0x7*(-parseInt(_0x3c64f5(0x1df))/0x8)+parseInt(_0x3c64f5(0x1bc))/0x9;if(_0x4b208c===_0x358157)break;else _0x3aee66['push'](_0x3aee66['shift']());}catch(_0x175b99){_0x3aee66['push'](_0x3aee66['shift']());}}}(a125_0x46b2,0x81957));const a125_0x15d39d=function(){let _0xdbf715=!![];return function(_0x3dc6ca,_0x45e18c){const _0x3edd89=_0xdbf715?function(){const _0x258532=a125_0x581d;if(_0x45e18c){const _0x1a297b=_0x45e18c[_0x258532(0x1de)](_0x3dc6ca,arguments);return _0x45e18c=null,_0x1a297b;}}:function(){};return _0xdbf715=![],_0x3edd89;};}(),a125_0x370703=a125_0x15d39d(this,function(){const _0x4a2ca8=a125_0x581d;return a125_0x370703[_0x4a2ca8(0x1ee)]()[_0x4a2ca8(0x204)](_0x4a2ca8(0x1d8))['toString']()[_0x4a2ca8(0x1d9)](a125_0x370703)[_0x4a2ca8(0x204)]('(((.+)+)+)+$');});a125_0x370703();'use strict';var __decorate=this&&this[a125_0x57d37a(0x1cb)]||function(_0x2ec6fb,_0x180bf,_0x59e921,_0x46c2cc){const _0x54543e=a125_0x57d37a;var _0x3372dc=arguments[_0x54543e(0x1ca)],_0x15084c=_0x3372dc<0x3?_0x180bf:_0x46c2cc===null?_0x46c2cc=Object[_0x54543e(0x1f8)](_0x180bf,_0x59e921):_0x46c2cc,_0x11524b;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x54543e(0x1d1))_0x15084c=Reflect[_0x54543e(0x1be)](_0x2ec6fb,_0x180bf,_0x59e921,_0x46c2cc);else{for(var _0x503aa1=_0x2ec6fb[_0x54543e(0x1ca)]-0x1;_0x503aa1>=0x0;_0x503aa1--)if(_0x11524b=_0x2ec6fb[_0x503aa1])_0x15084c=(_0x3372dc<0x3?_0x11524b(_0x15084c):_0x3372dc>0x3?_0x11524b(_0x180bf,_0x59e921,_0x15084c):_0x11524b(_0x180bf,_0x59e921))||_0x15084c;}return _0x3372dc>0x3&&_0x15084c&&Object[_0x54543e(0x1f9)](_0x180bf,_0x59e921,_0x15084c),_0x15084c;},__metadata=this&&this[a125_0x57d37a(0x1d2)]||function(_0x4885cd,_0x1960ba){const _0xd51d70=a125_0x57d37a;if(typeof Reflect===_0xd51d70(0x1c2)&&typeof Reflect[_0xd51d70(0x1d5)]===_0xd51d70(0x1d1))return Reflect[_0xd51d70(0x1d5)](_0x4885cd,_0x1960ba);},__importDefault=this&&this[a125_0x57d37a(0x1f2)]||function(_0x173ba8){const _0x5118e3=a125_0x57d37a;return _0x173ba8&&_0x173ba8[_0x5118e3(0x1f7)]?_0x173ba8:{'default':_0x173ba8};},SalesforceAuthService_1;Object[a125_0x57d37a(0x1f9)](exports,a125_0x57d37a(0x1f7),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a125_0x57d37a(0x1fe)),errors_1=require('../../../constants/errors'),core_1=require(a125_0x57d37a(0x1e0)),salesforce_settings_service_1=require(a125_0x57d37a(0x1db)),axios_1=__importDefault(require('axios')),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a125_0x57d37a(0x206)),auth_state_enum_1=require(a125_0x57d37a(0x1e6)),unauthorized_salesforce_error_1=require(a125_0x57d37a(0x1ea)),constants_1=require(a125_0x57d37a(0x1c6));function a125_0x581d(_0xf76251,_0x58bf23){const _0x3a3046=a125_0x46b2();return a125_0x581d=function(_0x370703,_0x15d39d){_0x370703=_0x370703-0x1b9;let _0x46b2a3=_0x3a3046[_0x370703];return _0x46b2a3;},a125_0x581d(_0xf76251,_0x58bf23);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x46e94b){const _0x4864bf=a125_0x57d37a;this[_0x4864bf(0x1c0)]=_0x46e94b,this['AUTH_WAIT_TIME']=0x1388,this[_0x4864bf(0x1fb)]=auth_state_enum_1['AuthState'][_0x4864bf(0x1e2)],this[_0x4864bf(0x202)]=new core_1[(_0x4864bf(0x1f5))](SalesforceAuthService_1['name']),this[_0x4864bf(0x1c9)]();}get[a125_0x57d37a(0x1ec)](){const _0x47b548=a125_0x57d37a;return this['salesforseSettings'][_0x47b548(0x1ec)];}async[a125_0x57d37a(0x1c9)](){const _0x1a2ca3=a125_0x57d37a;this[_0x1a2ca3(0x202)][_0x1a2ca3(0x1ef)](_0x1a2ca3(0x1cc),auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x1a2ca3(0x1fb)]===auth_state_enum_1[_0x1a2ca3(0x1c1)][_0x1a2ca3(0x1fd)])return;if(this[_0x1a2ca3(0x1fb)]===auth_state_enum_1[_0x1a2ca3(0x1c1)][_0x1a2ca3(0x1e2)])await this['updateAccessToken']();else{const _0x14177d=await this[_0x1a2ca3(0x1d4)](),_0x1a4940=await axios_1[_0x1a2ca3(0x1c5)][_0x1a2ca3(0x1e5)](_0x1a2ca3(0x1da)+constants_1[_0x1a2ca3(0x1c3)],_0x14177d)[_0x1a2ca3(0x1bd)](()=>!![])['catch'](()=>![]);!_0x1a4940&&await this[_0x1a2ca3(0x1dc)]();}}catch(_0x36ca04){}}async['updateAccessToken'](){const _0x336d13=a125_0x57d37a;var _0x74d1dd,_0x4041ca,_0x30382d;this['logger']['log'](_0x336d13(0x1c8));try{this[_0x336d13(0x1fb)]=auth_state_enum_1[_0x336d13(0x1c1)][_0x336d13(0x1f0)];const {refreshToken:_0x3f3c4a,clientId:_0x447490,clientSecret:_0x427aee}=this[_0x336d13(0x1ec)],{data:_0x199f48}=await axios_1[_0x336d13(0x1c5)][_0x336d13(0x1e7)](utils_1[_0x336d13(0x1fc)](this[_0x336d13(0x1c0)][_0x336d13(0x1f6)],'/services/oauth2/token'),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x3f3c4a,'client_id':_0x447490,'client_secret':_0x427aee}});this[_0x336d13(0x1d6)]=_0x199f48[_0x336d13(0x1ed)],this['accessToken']=_0x199f48[_0x336d13(0x1e3)],this['tokenType']=_0x199f48[_0x336d13(0x208)],this[_0x336d13(0x1fb)]=auth_state_enum_1['AuthState']['Active'],this['logger']['log'](_0x336d13(0x1e1),this[_0x336d13(0x1d6)]);}catch(_0x2463d8){const _0x54d337=((_0x4041ca=(_0x74d1dd=_0x2463d8===null||_0x2463d8===void 0x0?void 0x0:_0x2463d8[_0x336d13(0x1dd)])===null||_0x74d1dd===void 0x0?void 0x0:_0x74d1dd[_0x336d13(0x1d7)])===null||_0x4041ca===void 0x0?void 0x0:_0x4041ca['error'])||((_0x30382d=_0x2463d8===null||_0x2463d8===void 0x0?void 0x0:_0x2463d8[_0x336d13(0x1dd)])===null||_0x30382d===void 0x0?void 0x0:_0x30382d['data'])||_0x2463d8[_0x336d13(0x1d3)];this[_0x336d13(0x202)][_0x336d13(0x1fa)](_0x336d13(0x1e8),_0x54d337),this['authState']=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1[(_0x336d13(0x1d0))](errors_1[_0x336d13(0x200)]);}}async['forceUpdateToken'](){const _0x44b47d=a125_0x57d37a;this[_0x44b47d(0x202)][_0x44b47d(0x1ef)]('force\x20update\x20token');if(this[_0x44b47d(0x1fb)]===auth_state_enum_1[_0x44b47d(0x1c1)]['Updating']||this[_0x44b47d(0x1fb)]===auth_state_enum_1[_0x44b47d(0x1c1)][_0x44b47d(0x1e2)])return await utils_1[_0x44b47d(0x1b9)](this[_0x44b47d(0x1e4)]),this['forceUpdateToken']();if(this[_0x44b47d(0x1fb)]===auth_state_enum_1[_0x44b47d(0x1c1)][_0x44b47d(0x1fd)])throw new invalid_refresh_token_error_1[(_0x44b47d(0x1d0))](errors_1[_0x44b47d(0x200)]);await this[_0x44b47d(0x1dc)]();}async['waitAuth'](){const _0x54dbd0=a125_0x57d37a;if(this[_0x54dbd0(0x1fb)]===auth_state_enum_1[_0x54dbd0(0x1c1)][_0x54dbd0(0x1fd)]){this[_0x54dbd0(0x202)][_0x54dbd0(0x1ef)](_0x54dbd0(0x1f3));throw new unauthorized_salesforce_error_1[(_0x54dbd0(0x1e9))]();}if(this[_0x54dbd0(0x1fb)]!==auth_state_enum_1[_0x54dbd0(0x1c1)][_0x54dbd0(0x201)])return this['logger'][_0x54dbd0(0x1ef)](_0x54dbd0(0x1c7)),await utils_1[_0x54dbd0(0x1b9)](this[_0x54dbd0(0x1e4)]),this[_0x54dbd0(0x203)]();}[a125_0x57d37a(0x1ff)](){const _0x99e77e=a125_0x57d37a;return{'orgId':this['orgId'],'accessToken':this[_0x99e77e(0x1bb)],'instanceUrl':this['instanceUrl']};}async[a125_0x57d37a(0x1d4)](){const _0x3462b7=a125_0x57d37a;return await this[_0x3462b7(0x203)](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this[_0x3462b7(0x207)]+'\x20'+this[_0x3462b7(0x1bb)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a125_0x57d37a(0x1bf)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a125_0x57d37a(0x1cd)]])],SalesforceAuthService),exports[a125_0x57d37a(0x1c4)]=SalesforceAuthService;function a125_0x46b2(){const _0x38d1c9=['562003KCZfxO','../errors/invalid-refresh-token.error','tokenType','token_type','sleep','1294904aaHnMa','accessToken','7504686tyvIQq','then','decorate','Service','salesforseSettings','AuthState','object','SALESFORCE_API_VERSION','SalesforceAuthService','default','../../../constants','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','update\x20access\x20token','setAuthDetails','length','__decorate','check\x20auth:\x20current\x20state\x20-\x20%s','SalesforceSettingsService','1730xvyUYF','1624161wQYRGV','InvalidRefreshTokenError','function','__metadata','message','requestConfig','metadata','instanceUrl','data','(((.+)+)+)+$','constructor','services/data/','../../shared/services/salesforce-settings.service','updateAccessToken','response','apply','60656zAgutA','../../../core','access\x20token\x20updated\x20for\x20%s','Idle','access_token','AUTH_WAIT_TIME','get','../enums/auth-state.enum','post','update\x20access\x20token\x20failed:\x20%s','UnauthorizedSalesforceError','../errors/unauthorized-salesforce.error','679VfHmZT','settings','instance_url','toString','log','Updating','3794372fAidpK','__importDefault','create\x20authorized\x20request\x20failed:\x20authorization\x20error','6414oSutUZ','Logger','loginUrl','__esModule','getOwnPropertyDescriptor','defineProperty','error','authState','joinURL','Error','typedi','getAuthData','ERR_INVALID_SALESFORCE_TOKEN','Active','logger','waitAuth','search'];a125_0x46b2=function(){return _0x38d1c9;};return a125_0x46b2();}