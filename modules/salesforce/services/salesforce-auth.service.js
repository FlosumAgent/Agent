const a106_0x2c37=['check\x20auth:\x20current\x20state\x20-\x20%s','instanceUrl','__decorate','accessToken','__importDefault','../../shared/services/salesforce-settings.service','requestConfig','create\x20authorized\x20request\x20failed:\x20authorization\x20error','access_token','log','update\x20access\x20token\x20failed:\x20%s','41933xcloyS','instance_url','ERR_INVALID_SALESFORCE_TOKEN','163752vJlWor','SalesforceSettingsService','3QMhQaG','token_type','force\x20update\x20token','100ZzBELV','length','../errors/unauthorized-salesforce.error','1qdOAuC','../../../constants/errors','loginUrl','design:paramtypes','application/json','apply','forceUpdateToken','logger','__esModule','data','sleep','test','../errors/invalid-refresh-token.error','Idle','AuthState','../../shared/utils','../../../constants','name','authState','635685qPNtei','__metadata','salesforseSettings','joinURL','15uqjqcx','settings','axios','constructor','380299lIzgfg','SalesforceAuthService','UnauthorizedSalesforceError','error','../../../core','catch','Error','55288FWbwxy','/services/oauth2/token','post','metadata','function','access\x20token\x20updated\x20for\x20%s','decorate','658303DDhElm','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','tokenType','update\x20access\x20token','1OBAQQh','InvalidRefreshTokenError','AUTH_WAIT_TIME','get','setAuthDetails','Active','response','7478XqAOUw','../enums/auth-state.enum','refresh_token','return\x20/\x22\x20+\x20this\x20+\x20\x22/','updateAccessToken','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','Updating','getOwnPropertyDescriptor'];const a106_0x380fd7=a106_0x426a;(function(_0x172781,_0x29c780){const _0x4b6d7f=a106_0x426a;while(!![]){try{const _0x43765a=-parseInt(_0x4b6d7f(0xb3))*-parseInt(_0x4b6d7f(0xae))+-parseInt(_0x4b6d7f(0xd4))*-parseInt(_0x4b6d7f(0xe6))+parseInt(_0x4b6d7f(0xcc))+-parseInt(_0x4b6d7f(0xed))*parseInt(_0x4b6d7f(0xb6))+parseInt(_0x4b6d7f(0xe2))*-parseInt(_0x4b6d7f(0xb9))+-parseInt(_0x4b6d7f(0xb1))+-parseInt(_0x4b6d7f(0xd0))*-parseInt(_0x4b6d7f(0xdb));if(_0x43765a===_0x29c780)break;else _0x172781['push'](_0x172781['shift']());}catch(_0x418caa){_0x172781['push'](_0x172781['shift']());}}}(a106_0x2c37,0x61f60));const a106_0x55735d=function(){let _0x36b57c=!![];return function(_0x513d54,_0x147182){const _0x4e4078=_0x36b57c?function(){const _0x1a663b=a106_0x426a;if(_0x147182){const _0x2b8293=_0x147182[_0x1a663b(0xbe)](_0x513d54,arguments);return _0x147182=null,_0x2b8293;}}:function(){};return _0x36b57c=![],_0x4e4078;};}(),a106_0x10fb66=a106_0x55735d(this,function(){const _0x537077=function(){const _0x4df8d6=a106_0x426a,_0x3232bd=_0x537077[_0x4df8d6(0xd3)](_0x4df8d6(0xf0))()[_0x4df8d6(0xd3)](_0x4df8d6(0xf2));return!_0x3232bd[_0x4df8d6(0xc4)](a106_0x10fb66);};return _0x537077();});a106_0x10fb66();'use strict';var __decorate=this&&this[a106_0x380fd7(0xf7)]||function(_0x49613a,_0x4c0c2d,_0x22da62,_0x544045){const _0x5c2292=a106_0x380fd7;var _0x50304c=arguments[_0x5c2292(0xb7)],_0x7db789=_0x50304c<0x3?_0x4c0c2d:_0x544045===null?_0x544045=Object[_0x5c2292(0xf4)](_0x4c0c2d,_0x22da62):_0x544045,_0x4074b0;if(typeof Reflect==='object'&&typeof Reflect[_0x5c2292(0xe1)]===_0x5c2292(0xdf))_0x7db789=Reflect['decorate'](_0x49613a,_0x4c0c2d,_0x22da62,_0x544045);else{for(var _0x2b88ba=_0x49613a[_0x5c2292(0xb7)]-0x1;_0x2b88ba>=0x0;_0x2b88ba--)if(_0x4074b0=_0x49613a[_0x2b88ba])_0x7db789=(_0x50304c<0x3?_0x4074b0(_0x7db789):_0x50304c>0x3?_0x4074b0(_0x4c0c2d,_0x22da62,_0x7db789):_0x4074b0(_0x4c0c2d,_0x22da62))||_0x7db789;}return _0x50304c>0x3&&_0x7db789&&Object['defineProperty'](_0x4c0c2d,_0x22da62,_0x7db789),_0x7db789;},__metadata=this&&this[a106_0x380fd7(0xcd)]||function(_0x836ceb,_0x48d265){const _0x11a4f5=a106_0x380fd7;if(typeof Reflect==='object'&&typeof Reflect[_0x11a4f5(0xde)]===_0x11a4f5(0xdf))return Reflect[_0x11a4f5(0xde)](_0x836ceb,_0x48d265);},__importDefault=this&&this[a106_0x380fd7(0xa7)]||function(_0x5bfc3a){const _0x2ea38b=a106_0x380fd7;return _0x5bfc3a&&_0x5bfc3a[_0x2ea38b(0xc1)]?_0x5bfc3a:{'default':_0x5bfc3a};},SalesforceAuthService_1;function a106_0x426a(_0x2b6f3c,_0x550042){return a106_0x426a=function(_0x5a0397,_0x10fb66){_0x5a0397=_0x5a0397-0xa7;let _0x55735d=a106_0x2c37[_0x5a0397];return _0x55735d;},a106_0x426a(_0x2b6f3c,_0x550042);}Object['defineProperty'](exports,a106_0x380fd7(0xc1),{'value':!![]}),exports[a106_0x380fd7(0xd5)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a106_0x380fd7(0xba)),core_1=require(a106_0x380fd7(0xd8)),salesforce_settings_service_1=require(a106_0x380fd7(0xa8)),axios_1=__importDefault(require(a106_0x380fd7(0xd2))),utils_1=require(a106_0x380fd7(0xc8)),invalid_refresh_token_error_1=require(a106_0x380fd7(0xc5)),auth_state_enum_1=require(a106_0x380fd7(0xee)),unauthorized_salesforce_error_1=require(a106_0x380fd7(0xb8)),constants_1=require(a106_0x380fd7(0xc9));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4e9d1e){const _0x1f58c9=a106_0x380fd7;this[_0x1f58c9(0xce)]=_0x4e9d1e,this['AUTH_WAIT_TIME']=0x1388,this[_0x1f58c9(0xcb)]=auth_state_enum_1[_0x1f58c9(0xc7)][_0x1f58c9(0xc6)],this[_0x1f58c9(0xc0)]=new core_1['Logger'](SalesforceAuthService_1[_0x1f58c9(0xca)]),this[_0x1f58c9(0xea)]();}get[a106_0x380fd7(0xd1)](){const _0x5e5953=a106_0x380fd7;return this[_0x5e5953(0xce)]['settings'];}async[a106_0x380fd7(0xea)](){const _0xaa99eb=a106_0x380fd7;this[_0xaa99eb(0xc0)][_0xaa99eb(0xac)](_0xaa99eb(0xf5),auth_state_enum_1['AuthState'][this[_0xaa99eb(0xcb)]]);try{if(this[_0xaa99eb(0xcb)]===auth_state_enum_1[_0xaa99eb(0xc7)][_0xaa99eb(0xda)])return;if(this[_0xaa99eb(0xcb)]===auth_state_enum_1[_0xaa99eb(0xc7)][_0xaa99eb(0xc6)])await this['updateAccessToken']();else{const _0x5bab49=await this[_0xaa99eb(0xa9)](),_0x3dfca9=await axios_1['default'][_0xaa99eb(0xe9)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x5bab49)['then'](()=>!![])[_0xaa99eb(0xd9)](()=>![]);!_0x3dfca9&&await this[_0xaa99eb(0xf1)]();}}catch(_0x1c5833){}}async[a106_0x380fd7(0xf1)](){const _0x2319e7=a106_0x380fd7;var _0x4134b0,_0x229eb1,_0x1aa05d;this[_0x2319e7(0xc0)]['log'](_0x2319e7(0xe5));try{this[_0x2319e7(0xcb)]=auth_state_enum_1[_0x2319e7(0xc7)][_0x2319e7(0xf3)];const {refreshToken:_0x12918,clientId:_0x451fbd,clientSecret:_0x49d386}=this['settings'],{data:_0x50e9b2}=await axios_1['default'][_0x2319e7(0xdd)](utils_1[_0x2319e7(0xcf)](this['salesforseSettings'][_0x2319e7(0xbb)],_0x2319e7(0xdc)),null,{'params':{'grant_type':_0x2319e7(0xef),'refresh_token':_0x12918,'client_id':_0x451fbd,'client_secret':_0x49d386}});this[_0x2319e7(0xf6)]=_0x50e9b2[_0x2319e7(0xaf)],this[_0x2319e7(0xf8)]=_0x50e9b2[_0x2319e7(0xab)],this['tokenType']=_0x50e9b2[_0x2319e7(0xb4)],this[_0x2319e7(0xcb)]=auth_state_enum_1[_0x2319e7(0xc7)][_0x2319e7(0xeb)],this['logger'][_0x2319e7(0xac)](_0x2319e7(0xe0),this[_0x2319e7(0xf6)]);}catch(_0x499430){const _0x5f1b25=((_0x229eb1=(_0x4134b0=_0x499430===null||_0x499430===void 0x0?void 0x0:_0x499430[_0x2319e7(0xec)])===null||_0x4134b0===void 0x0?void 0x0:_0x4134b0[_0x2319e7(0xc2)])===null||_0x229eb1===void 0x0?void 0x0:_0x229eb1['error'])||((_0x1aa05d=_0x499430===null||_0x499430===void 0x0?void 0x0:_0x499430[_0x2319e7(0xec)])===null||_0x1aa05d===void 0x0?void 0x0:_0x1aa05d['data'])||_0x499430['message'];this[_0x2319e7(0xc0)][_0x2319e7(0xd7)](_0x2319e7(0xad),_0x5f1b25),this[_0x2319e7(0xcb)]=auth_state_enum_1[_0x2319e7(0xc7)]['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x2319e7(0xb0)]);}}async['forceUpdateToken'](){const _0x2b5326=a106_0x380fd7;this[_0x2b5326(0xc0)][_0x2b5326(0xac)](_0x2b5326(0xb5));if(this[_0x2b5326(0xcb)]===auth_state_enum_1['AuthState'][_0x2b5326(0xf3)]||this[_0x2b5326(0xcb)]===auth_state_enum_1[_0x2b5326(0xc7)][_0x2b5326(0xc6)])return await utils_1[_0x2b5326(0xc3)](this[_0x2b5326(0xe8)]),this[_0x2b5326(0xbf)]();if(this[_0x2b5326(0xcb)]===auth_state_enum_1[_0x2b5326(0xc7)][_0x2b5326(0xda)])throw new invalid_refresh_token_error_1[(_0x2b5326(0xe7))](errors_1[_0x2b5326(0xb0)]);await this[_0x2b5326(0xf1)]();}async[a106_0x380fd7(0xa9)](){const _0x4cdf1f=a106_0x380fd7;if(this[_0x4cdf1f(0xcb)]===auth_state_enum_1['AuthState']['Error']){this[_0x4cdf1f(0xc0)][_0x4cdf1f(0xac)](_0x4cdf1f(0xaa));throw new unauthorized_salesforce_error_1[(_0x4cdf1f(0xd6))]();}if(this[_0x4cdf1f(0xcb)]!==auth_state_enum_1[_0x4cdf1f(0xc7)]['Active'])return this['logger']['log'](_0x4cdf1f(0xe3)),await utils_1[_0x4cdf1f(0xc3)](this[_0x4cdf1f(0xe8)]),this[_0x4cdf1f(0xa9)]();return{'baseURL':this[_0x4cdf1f(0xf6)],'headers':{'accept':_0x4cdf1f(0xbd),'content-type':_0x4cdf1f(0xbd),'authorization':this[_0x4cdf1f(0xe4)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a106_0x380fd7(0xbc),[salesforce_settings_service_1[a106_0x380fd7(0xb2)]])],SalesforceAuthService),exports[a106_0x380fd7(0xd5)]=SalesforceAuthService;