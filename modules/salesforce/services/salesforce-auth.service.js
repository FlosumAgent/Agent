const a108_0x532905=a108_0x1e67;(function(_0x38e47f,_0xf46dea){const _0x45d1b2=a108_0x1e67,_0x4c96df=_0x38e47f();while(!![]){try{const _0x58d0d0=-parseInt(_0x45d1b2(0x202))/0x1+parseInt(_0x45d1b2(0x1fc))/0x2*(-parseInt(_0x45d1b2(0x1d9))/0x3)+-parseInt(_0x45d1b2(0x1d6))/0x4+-parseInt(_0x45d1b2(0x1f9))/0x5+parseInt(_0x45d1b2(0x1c7))/0x6*(-parseInt(_0x45d1b2(0x1c5))/0x7)+parseInt(_0x45d1b2(0x1f4))/0x8+-parseInt(_0x45d1b2(0x1de))/0x9*(-parseInt(_0x45d1b2(0x1d8))/0xa);if(_0x58d0d0===_0xf46dea)break;else _0x4c96df['push'](_0x4c96df['shift']());}catch(_0x3f7410){_0x4c96df['push'](_0x4c96df['shift']());}}}(a108_0x439d,0xd699a));const a108_0x4322f8=function(){let _0x3ae530=!![];return function(_0x2e58b9,_0x397c21){const _0x2cf2fe=_0x3ae530?function(){const _0x5f5894=a108_0x1e67;if(_0x397c21){const _0x1de5d5=_0x397c21[_0x5f5894(0x1e9)](_0x2e58b9,arguments);return _0x397c21=null,_0x1de5d5;}}:function(){};return _0x3ae530=![],_0x2cf2fe;};}(),a108_0x3b6eb4=a108_0x4322f8(this,function(){const _0x10b48f=a108_0x1e67;return a108_0x3b6eb4[_0x10b48f(0x1cd)]()['search'](_0x10b48f(0x204))['toString']()[_0x10b48f(0x1b9)](a108_0x3b6eb4)[_0x10b48f(0x1c8)]('(((.+)+)+)+$');});a108_0x3b6eb4();function a108_0x439d(){const _0x2e13d8=['1651425JREVNq','then','accessToken','4322gAaXhq','joinURL','defineProperty','settings','../errors/unauthorized-salesforce.error','setAuthDetails','915591gDQRja','Service','(((.+)+)+)+$','../../../core','instance_url','authState','../../shared/utils','loginUrl','constructor','log','data','default','name','sleep','design:paramtypes','logger','metadata','catch','../../../constants/errors','updateAccessToken','168ifTawE','__esModule','353874OqYSHs','search','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','application/json','refresh_token','Active','toString','axios','decorate','__importDefault','function','__decorate','error','/services/oauth2/token','salesforseSettings','6594816JLDhTx','message','20bmzmVu','921VpYgyi','SalesforceAuthService','ERR_INVALID_SALESFORCE_TOKEN','AuthState','../../../constants','19798092XLZuOM','tokenType','services/data/','../enums/auth-state.enum','InvalidRefreshTokenError','AUTH_WAIT_TIME','post','check\x20auth:\x20current\x20state\x20-\x20%s','update\x20access\x20token\x20failed:\x20%s','SalesforceSettingsService','Logger','apply','get','instanceUrl','response','Error','length','Idle','forceUpdateToken','SALESFORCE_API_VERSION','__metadata','typedi','11623432ONPIHK','UnauthorizedSalesforceError','token_type','force\x20update\x20token','requestConfig'];a108_0x439d=function(){return _0x2e13d8;};return a108_0x439d();}'use strict';var __decorate=this&&this[a108_0x532905(0x1d2)]||function(_0x26c03e,_0x2071e6,_0x20535a,_0xfa81de){const _0x2f1db0=a108_0x532905;var _0x3f4b5c=arguments['length'],_0x477266=_0x3f4b5c<0x3?_0x2071e6:_0xfa81de===null?_0xfa81de=Object['getOwnPropertyDescriptor'](_0x2071e6,_0x20535a):_0xfa81de,_0x21d166;if(typeof Reflect==='object'&&typeof Reflect[_0x2f1db0(0x1cf)]===_0x2f1db0(0x1d1))_0x477266=Reflect[_0x2f1db0(0x1cf)](_0x26c03e,_0x2071e6,_0x20535a,_0xfa81de);else{for(var _0xf19795=_0x26c03e[_0x2f1db0(0x1ee)]-0x1;_0xf19795>=0x0;_0xf19795--)if(_0x21d166=_0x26c03e[_0xf19795])_0x477266=(_0x3f4b5c<0x3?_0x21d166(_0x477266):_0x3f4b5c>0x3?_0x21d166(_0x2071e6,_0x20535a,_0x477266):_0x21d166(_0x2071e6,_0x20535a))||_0x477266;}return _0x3f4b5c>0x3&&_0x477266&&Object[_0x2f1db0(0x1fe)](_0x2071e6,_0x20535a,_0x477266),_0x477266;},__metadata=this&&this[a108_0x532905(0x1f2)]||function(_0xd08c12,_0x418811){const _0x5c39bf=a108_0x532905;if(typeof Reflect==='object'&&typeof Reflect[_0x5c39bf(0x1c1)]===_0x5c39bf(0x1d1))return Reflect['metadata'](_0xd08c12,_0x418811);},__importDefault=this&&this[a108_0x532905(0x1d0)]||function(_0x43bf4b){return _0x43bf4b&&_0x43bf4b['__esModule']?_0x43bf4b:{'default':_0x43bf4b};},SalesforceAuthService_1;Object['defineProperty'](exports,a108_0x532905(0x1c6),{'value':!![]}),exports[a108_0x532905(0x1da)]=void 0x0;const typedi_1=require(a108_0x532905(0x1f3)),errors_1=require(a108_0x532905(0x1c3)),core_1=require(a108_0x532905(0x1b4)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a108_0x532905(0x1ce))),utils_1=require(a108_0x532905(0x1b7)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a108_0x532905(0x1e1)),unauthorized_salesforce_error_1=require(a108_0x532905(0x200)),constants_1=require(a108_0x532905(0x1dd));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x5eaca2){const _0x1e6d41=a108_0x532905;this[_0x1e6d41(0x1d5)]=_0x5eaca2,this[_0x1e6d41(0x1e3)]=0x1388,this[_0x1e6d41(0x1b6)]=auth_state_enum_1[_0x1e6d41(0x1dc)]['Idle'],this[_0x1e6d41(0x1c0)]=new core_1[(_0x1e6d41(0x1e8))](SalesforceAuthService_1[_0x1e6d41(0x1bd)]),this[_0x1e6d41(0x201)]();}get['settings'](){const _0x24f013=a108_0x532905;return this['salesforseSettings'][_0x24f013(0x1ff)];}async[a108_0x532905(0x201)](){const _0x17285c=a108_0x532905;this[_0x17285c(0x1c0)][_0x17285c(0x1ba)](_0x17285c(0x1e5),auth_state_enum_1[_0x17285c(0x1dc)][this[_0x17285c(0x1b6)]]);try{if(this[_0x17285c(0x1b6)]===auth_state_enum_1[_0x17285c(0x1dc)][_0x17285c(0x1ed)])return;if(this[_0x17285c(0x1b6)]===auth_state_enum_1[_0x17285c(0x1dc)][_0x17285c(0x1ef)])await this[_0x17285c(0x1c4)]();else{const _0x38ff95=await this[_0x17285c(0x1f8)](),_0x48fce4=await axios_1[_0x17285c(0x1bc)][_0x17285c(0x1ea)](_0x17285c(0x1e0)+constants_1[_0x17285c(0x1f1)],_0x38ff95)[_0x17285c(0x1fa)](()=>!![])[_0x17285c(0x1c2)](()=>![]);!_0x48fce4&&await this['updateAccessToken']();}}catch(_0x4148ee){}}async[a108_0x532905(0x1c4)](){const _0x32c4cf=a108_0x532905;var _0x4b9efe,_0x530e55,_0x493012;this[_0x32c4cf(0x1c0)][_0x32c4cf(0x1ba)]('update\x20access\x20token');try{this[_0x32c4cf(0x1b6)]=auth_state_enum_1[_0x32c4cf(0x1dc)]['Updating'];const {refreshToken:_0x289546,clientId:_0x31069c,clientSecret:_0x1874ee}=this[_0x32c4cf(0x1ff)],{data:_0xa2c30f}=await axios_1[_0x32c4cf(0x1bc)][_0x32c4cf(0x1e4)]((0x0,utils_1[_0x32c4cf(0x1fd)])(this[_0x32c4cf(0x1d5)][_0x32c4cf(0x1b8)],_0x32c4cf(0x1d4)),null,{'params':{'grant_type':_0x32c4cf(0x1cb),'refresh_token':_0x289546,'client_id':_0x31069c,'client_secret':_0x1874ee}});this[_0x32c4cf(0x1eb)]=_0xa2c30f[_0x32c4cf(0x1b5)],this['accessToken']=_0xa2c30f['access_token'],this[_0x32c4cf(0x1df)]=_0xa2c30f[_0x32c4cf(0x1f6)],this[_0x32c4cf(0x1b6)]=auth_state_enum_1['AuthState'][_0x32c4cf(0x1cc)],this[_0x32c4cf(0x1c0)][_0x32c4cf(0x1ba)]('access\x20token\x20updated\x20for\x20%s',this[_0x32c4cf(0x1eb)]);}catch(_0x317561){const _0x107f91=((_0x530e55=(_0x4b9efe=_0x317561===null||_0x317561===void 0x0?void 0x0:_0x317561[_0x32c4cf(0x1ec)])===null||_0x4b9efe===void 0x0?void 0x0:_0x4b9efe[_0x32c4cf(0x1bb)])===null||_0x530e55===void 0x0?void 0x0:_0x530e55[_0x32c4cf(0x1d3)])||((_0x493012=_0x317561===null||_0x317561===void 0x0?void 0x0:_0x317561[_0x32c4cf(0x1ec)])===null||_0x493012===void 0x0?void 0x0:_0x493012['data'])||_0x317561[_0x32c4cf(0x1d7)];this[_0x32c4cf(0x1c0)][_0x32c4cf(0x1d3)](_0x32c4cf(0x1e6),_0x107f91),this[_0x32c4cf(0x1b6)]=auth_state_enum_1[_0x32c4cf(0x1dc)]['Error'];throw new invalid_refresh_token_error_1[(_0x32c4cf(0x1e2))](errors_1[_0x32c4cf(0x1db)]);}}async[a108_0x532905(0x1f0)](){const _0xe21a97=a108_0x532905;this[_0xe21a97(0x1c0)][_0xe21a97(0x1ba)](_0xe21a97(0x1f7));if(this['authState']===auth_state_enum_1['AuthState']['Updating']||this[_0xe21a97(0x1b6)]===auth_state_enum_1[_0xe21a97(0x1dc)]['Idle'])return await(0x0,utils_1[_0xe21a97(0x1be)])(this[_0xe21a97(0x1e3)]),this[_0xe21a97(0x1f0)]();if(this[_0xe21a97(0x1b6)]===auth_state_enum_1[_0xe21a97(0x1dc)][_0xe21a97(0x1ed)])throw new invalid_refresh_token_error_1[(_0xe21a97(0x1e2))](errors_1[_0xe21a97(0x1db)]);await this['updateAccessToken']();}async[a108_0x532905(0x1f8)](){const _0x531883=a108_0x532905;if(this[_0x531883(0x1b6)]===auth_state_enum_1[_0x531883(0x1dc)][_0x531883(0x1ed)]){this['logger'][_0x531883(0x1ba)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x531883(0x1f5))]();}if(this['authState']!==auth_state_enum_1[_0x531883(0x1dc)][_0x531883(0x1cc)])return this[_0x531883(0x1c0)]['log'](_0x531883(0x1c9)),await(0x0,utils_1[_0x531883(0x1be)])(this[_0x531883(0x1e3)]),this['requestConfig']();return{'baseURL':this[_0x531883(0x1eb)],'headers':{'accept':_0x531883(0x1ca),'content-type':_0x531883(0x1ca),'authorization':this['tokenType']+'\x20'+this[_0x531883(0x1fb)]}};}};function a108_0x1e67(_0x4394b8,_0x13c999){const _0x15cb96=a108_0x439d();return a108_0x1e67=function(_0x3b6eb4,_0x4322f8){_0x3b6eb4=_0x3b6eb4-0x1b4;let _0x439dbb=_0x15cb96[_0x3b6eb4];return _0x439dbb;},a108_0x1e67(_0x4394b8,_0x13c999);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a108_0x532905(0x203)])(),__metadata(a108_0x532905(0x1bf),[salesforce_settings_service_1[a108_0x532905(0x1e7)]])],SalesforceAuthService),exports[a108_0x532905(0x1da)]=SalesforceAuthService;