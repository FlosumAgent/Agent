const a119_0x1b69bd=a119_0x3749;(function(_0x21d4ea,_0x301723){const _0x38d430=a119_0x3749,_0x51e557=_0x21d4ea();while(!![]){try{const _0x56f7f4=parseInt(_0x38d430(0x204))/0x1*(-parseInt(_0x38d430(0x222))/0x2)+-parseInt(_0x38d430(0x20c))/0x3*(-parseInt(_0x38d430(0x225))/0x4)+-parseInt(_0x38d430(0x213))/0x5+-parseInt(_0x38d430(0x1eb))/0x6*(-parseInt(_0x38d430(0x20d))/0x7)+parseInt(_0x38d430(0x233))/0x8+-parseInt(_0x38d430(0x1ed))/0x9*(-parseInt(_0x38d430(0x217))/0xa)+-parseInt(_0x38d430(0x22f))/0xb;if(_0x56f7f4===_0x301723)break;else _0x51e557['push'](_0x51e557['shift']());}catch(_0x55483f){_0x51e557['push'](_0x51e557['shift']());}}}(a119_0x5dde,0x2fd4e));const a119_0x16abc5=function(){let _0x1b2130=!![];return function(_0x2c420d,_0x1d1e4c){const _0x208d1a=_0x1b2130?function(){const _0xe998ca=a119_0x3749;if(_0x1d1e4c){const _0x5e37e5=_0x1d1e4c[_0xe998ca(0x234)](_0x2c420d,arguments);return _0x1d1e4c=null,_0x5e37e5;}}:function(){};return _0x1b2130=![],_0x208d1a;};}(),a119_0x29ae6f=a119_0x16abc5(this,function(){const _0x5e55ff=a119_0x3749;return a119_0x29ae6f['toString']()[_0x5e55ff(0x230)](_0x5e55ff(0x1ec))[_0x5e55ff(0x211)]()['constructor'](a119_0x29ae6f)[_0x5e55ff(0x230)](_0x5e55ff(0x1ec));});a119_0x29ae6f();function a119_0x5dde(){const _0x132921=['__importDefault','281572kQOcjK','Updating','UnauthorizedSalesforceError','ERR_INVALID_SALESFORCE_TOKEN','userinfo','forceUpdateToken','../../shared/services/salesforce-settings.service','SALESFORCE_API_VERSION','get','__metadata','6095078fcEVLM','search','accessToken','metadata','1630536QOuhCn','apply','default','__esModule','sleep','/services/oauth2/token','InvalidRefreshTokenError','tokenType','salesforseSettings','authState','SalesforceAuthService','56022XibDyf','(((.+)+)+)+$','1909557xJbBXC','Logger','../errors/invalid-refresh-token.error','axios','then','check\x20auth:\x20current\x20state\x20-\x20%s','orgId','error','getUserInfo','AuthState','waitAuth','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Service','updateAccessToken','settings','typedi','SalesforceSettingsService','update\x20access\x20token\x20failed:\x20%s','response','post','instanceUrl','Error','Active','3CUGRBc','AUTH_WAIT_TIME','fetchUserinfo','defineProperty','length','setAuthDetails','data','object','6oBSPTe','280meRiEM','getAuthData','loginUrl','/services/oauth2/userinfo','toString','function','839295EYKCaw','log','__decorate','Idle','10uNqzYb','../../../constants','name','message','../../../constants/errors','design:paramtypes','../errors/unauthorized-salesforce.error','logger','requestConfig','refresh_token','user_id','8254HvvOHP','decorate'];a119_0x5dde=function(){return _0x132921;};return a119_0x5dde();}'use strict';var __decorate=this&&this[a119_0x1b69bd(0x215)]||function(_0x4558b2,_0x188cba,_0x122978,_0x51c029){const _0x3b4a60=a119_0x1b69bd;var _0x15e373=arguments[_0x3b4a60(0x208)],_0x55e16a=_0x15e373<0x3?_0x188cba:_0x51c029===null?_0x51c029=Object['getOwnPropertyDescriptor'](_0x188cba,_0x122978):_0x51c029,_0x322bb1;if(typeof Reflect===_0x3b4a60(0x20b)&&typeof Reflect[_0x3b4a60(0x223)]==='function')_0x55e16a=Reflect['decorate'](_0x4558b2,_0x188cba,_0x122978,_0x51c029);else{for(var _0x4dfd77=_0x4558b2[_0x3b4a60(0x208)]-0x1;_0x4dfd77>=0x0;_0x4dfd77--)if(_0x322bb1=_0x4558b2[_0x4dfd77])_0x55e16a=(_0x15e373<0x3?_0x322bb1(_0x55e16a):_0x15e373>0x3?_0x322bb1(_0x188cba,_0x122978,_0x55e16a):_0x322bb1(_0x188cba,_0x122978))||_0x55e16a;}return _0x15e373>0x3&&_0x55e16a&&Object['defineProperty'](_0x188cba,_0x122978,_0x55e16a),_0x55e16a;},__metadata=this&&this[a119_0x1b69bd(0x22e)]||function(_0x29fac0,_0x5b2315){const _0x3bf962=a119_0x1b69bd;if(typeof Reflect==='object'&&typeof Reflect[_0x3bf962(0x232)]===_0x3bf962(0x212))return Reflect[_0x3bf962(0x232)](_0x29fac0,_0x5b2315);},__importDefault=this&&this[a119_0x1b69bd(0x224)]||function(_0x3821b9){const _0x34af97=a119_0x1b69bd;return _0x3821b9&&_0x3821b9[_0x34af97(0x236)]?_0x3821b9:{'default':_0x3821b9};},SalesforceAuthService_1;function a119_0x3749(_0x16f981,_0x14f7c4){const _0x549b7d=a119_0x5dde();return a119_0x3749=function(_0x29ae6f,_0x16abc5){_0x29ae6f=_0x29ae6f-0x1ea;let _0x5dde84=_0x549b7d[_0x29ae6f];return _0x5dde84;},a119_0x3749(_0x16f981,_0x14f7c4);}Object[a119_0x1b69bd(0x207)](exports,a119_0x1b69bd(0x236),{'value':!![]}),exports[a119_0x1b69bd(0x1ea)]=void 0x0;const typedi_1=require(a119_0x1b69bd(0x1fc)),errors_1=require(a119_0x1b69bd(0x21b)),core_1=require('../../../core'),salesforce_settings_service_1=require(a119_0x1b69bd(0x22b)),axios_1=__importDefault(require(a119_0x1b69bd(0x1f0))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a119_0x1b69bd(0x1ef)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a119_0x1b69bd(0x21d)),constants_1=require(a119_0x1b69bd(0x218));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x433916){const _0xd01308=a119_0x1b69bd;this[_0xd01308(0x23b)]=_0x433916,this[_0xd01308(0x205)]=0x1388,this['authState']=auth_state_enum_1[_0xd01308(0x1f6)]['Idle'],this['logger']=new core_1[(_0xd01308(0x1ee))](SalesforceAuthService_1[_0xd01308(0x219)]),this[_0xd01308(0x209)]();}get[a119_0x1b69bd(0x1fb)](){const _0x276655=a119_0x1b69bd;return this['salesforseSettings'][_0x276655(0x1fb)];}async[a119_0x1b69bd(0x209)](){const _0x2be140=a119_0x1b69bd;this[_0x2be140(0x21e)][_0x2be140(0x214)](_0x2be140(0x1f2),auth_state_enum_1[_0x2be140(0x1f6)][this['authState']]);try{if(this[_0x2be140(0x23c)]===auth_state_enum_1[_0x2be140(0x1f6)][_0x2be140(0x202)])return;if(this[_0x2be140(0x23c)]===auth_state_enum_1[_0x2be140(0x1f6)][_0x2be140(0x216)])await this[_0x2be140(0x1fa)]();else{const _0x2d4895=await this['requestConfig'](),_0xd80b51=await axios_1['default'][_0x2be140(0x22d)]('services/data/'+constants_1[_0x2be140(0x22c)],_0x2d4895)[_0x2be140(0x1f1)](()=>!![])['catch'](()=>![]);!_0xd80b51&&await this['updateAccessToken']();}}catch(_0x74252f){}}async[a119_0x1b69bd(0x206)](){const _0x261886=a119_0x1b69bd,_0x3166c1=await axios_1[_0x261886(0x235)][_0x261886(0x22d)](this[_0x261886(0x201)]+_0x261886(0x210),{'headers':{'authorization':this['tokenType']+'\x20'+this[_0x261886(0x231)]}})['then'](({data:_0x16d079})=>_0x16d079);this[_0x261886(0x229)]={'id':_0x3166c1[_0x261886(0x221)],'name':_0x3166c1[_0x261886(0x219)]};}async[a119_0x1b69bd(0x1fa)](){const _0x44771a=a119_0x1b69bd;var _0x534b97,_0x30bd42,_0x302697;this[_0x44771a(0x21e)]['log']('update\x20access\x20token');try{this[_0x44771a(0x23c)]=auth_state_enum_1[_0x44771a(0x1f6)][_0x44771a(0x226)];const {refreshToken:_0x3751f3,clientId:_0x45fd26,clientSecret:_0x290b90}=this[_0x44771a(0x1fb)],{data:_0x447e16}=await axios_1[_0x44771a(0x235)][_0x44771a(0x200)](utils_1['joinURL'](this[_0x44771a(0x23b)][_0x44771a(0x20f)],_0x44771a(0x238)),null,{'params':{'grant_type':_0x44771a(0x220),'refresh_token':_0x3751f3,'client_id':_0x45fd26,'client_secret':_0x290b90}});this[_0x44771a(0x201)]=_0x447e16['instance_url'],this[_0x44771a(0x231)]=_0x447e16['access_token'],this['tokenType']=_0x447e16['token_type'],await this['fetchUserinfo'](),this[_0x44771a(0x23c)]=auth_state_enum_1['AuthState'][_0x44771a(0x203)],this[_0x44771a(0x21e)][_0x44771a(0x214)]('access\x20token\x20updated\x20for\x20%s',this[_0x44771a(0x201)]);}catch(_0x3ae3a6){const _0x2e0c9f=((_0x30bd42=(_0x534b97=_0x3ae3a6===null||_0x3ae3a6===void 0x0?void 0x0:_0x3ae3a6[_0x44771a(0x1ff)])===null||_0x534b97===void 0x0?void 0x0:_0x534b97[_0x44771a(0x20a)])===null||_0x30bd42===void 0x0?void 0x0:_0x30bd42[_0x44771a(0x1f4)])||((_0x302697=_0x3ae3a6===null||_0x3ae3a6===void 0x0?void 0x0:_0x3ae3a6[_0x44771a(0x1ff)])===null||_0x302697===void 0x0?void 0x0:_0x302697['data'])||_0x3ae3a6[_0x44771a(0x21a)];this[_0x44771a(0x21e)][_0x44771a(0x1f4)](_0x44771a(0x1fe),_0x2e0c9f),this[_0x44771a(0x23c)]=auth_state_enum_1['AuthState'][_0x44771a(0x202)];throw new invalid_refresh_token_error_1[(_0x44771a(0x239))](errors_1[_0x44771a(0x228)]);}}async[a119_0x1b69bd(0x22a)](){const _0xeee51b=a119_0x1b69bd;this[_0xeee51b(0x21e)][_0xeee51b(0x214)]('force\x20update\x20token');if(this[_0xeee51b(0x23c)]===auth_state_enum_1[_0xeee51b(0x1f6)][_0xeee51b(0x226)]||this['authState']===auth_state_enum_1[_0xeee51b(0x1f6)][_0xeee51b(0x216)])return await utils_1[_0xeee51b(0x237)](this[_0xeee51b(0x205)]),this[_0xeee51b(0x22a)]();if(this[_0xeee51b(0x23c)]===auth_state_enum_1[_0xeee51b(0x1f6)][_0xeee51b(0x202)])throw new invalid_refresh_token_error_1[(_0xeee51b(0x239))](errors_1[_0xeee51b(0x228)]);await this[_0xeee51b(0x1fa)]();}async['waitAuth'](){const _0x3a2fc0=a119_0x1b69bd;if(this['authState']===auth_state_enum_1[_0x3a2fc0(0x1f6)]['Error']){this[_0x3a2fc0(0x21e)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x3a2fc0(0x227))]();}if(this[_0x3a2fc0(0x23c)]!==auth_state_enum_1[_0x3a2fc0(0x1f6)][_0x3a2fc0(0x203)])return this['logger'][_0x3a2fc0(0x214)](_0x3a2fc0(0x1f8)),await utils_1[_0x3a2fc0(0x237)](this['AUTH_WAIT_TIME']),this[_0x3a2fc0(0x1f7)]();}[a119_0x1b69bd(0x1f5)](){const _0x508a8c=a119_0x1b69bd;return this[_0x508a8c(0x229)];}[a119_0x1b69bd(0x20e)](){const _0x1b7d39=a119_0x1b69bd;return{'orgId':this[_0x1b7d39(0x1f3)],'accessToken':this[_0x1b7d39(0x231)],'instanceUrl':this[_0x1b7d39(0x201)]};}async[a119_0x1b69bd(0x21f)](){const _0x3b29d4=a119_0x1b69bd;return await this['waitAuth'](),{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','authorization':this[_0x3b29d4(0x23a)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1[a119_0x1b69bd(0x1f9)](),__metadata(a119_0x1b69bd(0x21c),[salesforce_settings_service_1[a119_0x1b69bd(0x1fd)]])],SalesforceAuthService),exports[a119_0x1b69bd(0x1ea)]=SalesforceAuthService;