const a103_0x494e=['394vQRFcH','/services/oauth2/token','get','Idle','../../shared/utils','axios','access_token','1gndCTs','415708UJktuT','31703LdSZii','object','update\x20access\x20token','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','accessToken','../../../constants/errors','force\x20update\x20token','typedi','forceUpdateToken','__metadata','AUTH_WAIT_TIME','salesforce-auth-service','AuthState','205111YtMJhH','__decorate','instance_url','updateAccessToken','data','catch','SALESFORCE_API_VERSION','decorate','../errors/unauthorized-salesforce.error','../../../constants','log','refresh_token','response','function','settings','instanceUrl','setAuthDetails','length','../enums/auth-state.enum','authState','Active','Logger','update\x20access\x20token\x20failed:\x20%s','salesforseSettings','sleep','error','create\x20authorized\x20request','metadata','return\x20/\x22\x20+\x20this\x20+\x20\x22/','../errors/invalid-refresh-token.error','SalesforceAuthService','tokenType','Updating','ERR_INVALID_SALESFORCE_TOKEN','2GzCLiT','defineProperty','loginUrl','getOwnPropertyDescriptor','2nsckJP','247022uyiarR','constructor','250339tiMvKC','joinURL','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','default','InvalidRefreshTokenError','check\x20auth:\x20current\x20state\x20-\x20%s','requestConfig','447aUqxCT','application/json','231827VrzRDC','Error','SalesforceSettingsService','design:paramtypes','access\x20token\x20updated\x20for\x20%s','apply','../../../core'];const a103_0x40120c=a103_0x3fad;(function(_0x111b46,_0xe2a6ae){const _0x1c1031=a103_0x3fad;while(!![]){try{const _0x5c4ad0=-parseInt(_0x1c1031(0xb3))+parseInt(_0x1c1031(0xc3))*parseInt(_0x1c1031(0xba))+parseInt(_0x1c1031(0x8a))*parseInt(_0x1c1031(0xac))+-parseInt(_0x1c1031(0xb1))+parseInt(_0x1c1031(0xbc))*-parseInt(_0x1c1031(0xca))+parseInt(_0x1c1031(0xcb))+-parseInt(_0x1c1031(0xb0))*parseInt(_0x1c1031(0xcc));if(_0x5c4ad0===_0xe2a6ae)break;else _0x111b46['push'](_0x111b46['shift']());}catch(_0x112356){_0x111b46['push'](_0x111b46['shift']());}}}(a103_0x494e,0x3322e));const a103_0x336ab2=function(){let _0x1742d4=!![];return function(_0x402ed5,_0x17b2dd){const _0x45d232=_0x1742d4?function(){const _0x43b2a8=a103_0x3fad;if(_0x17b2dd){const _0x57104e=_0x17b2dd[_0x43b2a8(0xc1)](_0x402ed5,arguments);return _0x17b2dd=null,_0x57104e;}}:function(){};return _0x1742d4=![],_0x45d232;};}(),a103_0xbac8f2=a103_0x336ab2(this,function(){const _0xb6f828=function(){const _0x569ee0=a103_0x3fad,_0x2da2b6=_0xb6f828[_0x569ee0(0xb2)](_0x569ee0(0xa6))()['constructor'](_0x569ee0(0xb5));return!_0x2da2b6['test'](a103_0xbac8f2);};return _0xb6f828();});a103_0xbac8f2();'use strict';var __decorate=this&&this[a103_0x40120c(0x8b)]||function(_0x374e96,_0x11cb75,_0x258d1b,_0x11808c){const _0x16ce67=a103_0x40120c;var _0x4a775f=arguments['length'],_0x18ffcd=_0x4a775f<0x3?_0x11cb75:_0x11808c===null?_0x11808c=Object[_0x16ce67(0xaf)](_0x11cb75,_0x258d1b):_0x11808c,_0x4e5d36;if(typeof Reflect===_0x16ce67(0xcd)&&typeof Reflect[_0x16ce67(0x91)]===_0x16ce67(0x97))_0x18ffcd=Reflect['decorate'](_0x374e96,_0x11cb75,_0x258d1b,_0x11808c);else{for(var _0x2d39f9=_0x374e96[_0x16ce67(0x9b)]-0x1;_0x2d39f9>=0x0;_0x2d39f9--)if(_0x4e5d36=_0x374e96[_0x2d39f9])_0x18ffcd=(_0x4a775f<0x3?_0x4e5d36(_0x18ffcd):_0x4a775f>0x3?_0x4e5d36(_0x11cb75,_0x258d1b,_0x18ffcd):_0x4e5d36(_0x11cb75,_0x258d1b))||_0x18ffcd;}return _0x4a775f>0x3&&_0x18ffcd&&Object[_0x16ce67(0xad)](_0x11cb75,_0x258d1b,_0x18ffcd),_0x18ffcd;},__metadata=this&&this[a103_0x40120c(0x86)]||function(_0x472db3,_0x1f5f65){const _0x55653d=a103_0x40120c;if(typeof Reflect===_0x55653d(0xcd)&&typeof Reflect['metadata']===_0x55653d(0x97))return Reflect[_0x55653d(0xa5)](_0x472db3,_0x1f5f65);},__importDefault=this&&this['__importDefault']||function(_0xacb2c0){return _0xacb2c0&&_0xacb2c0['__esModule']?_0xacb2c0:{'default':_0xacb2c0};};Object[a103_0x40120c(0xad)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require(a103_0x40120c(0x84)),errors_1=require(a103_0x40120c(0x82)),core_1=require(a103_0x40120c(0xc2)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a103_0x40120c(0xc8))),utils_1=require(a103_0x40120c(0xc7)),invalid_refresh_token_error_1=require(a103_0x40120c(0xa7)),auth_state_enum_1=require(a103_0x40120c(0x9c)),unauthorized_salesforce_error_1=require(a103_0x40120c(0x92)),constants_1=require(a103_0x40120c(0x93)),logger=new core_1[(a103_0x40120c(0x9f))](a103_0x40120c(0x88));let SalesforceAuthService=class SalesforceAuthService{constructor(_0xf53868){const _0x308cdb=a103_0x40120c;this[_0x308cdb(0xa1)]=_0xf53868,this[_0x308cdb(0x87)]=0x1388,this['authState']=auth_state_enum_1[_0x308cdb(0x89)]['Idle'],this[_0x308cdb(0x9a)]();}get['settings'](){const _0x52e1ed=a103_0x40120c;return this[_0x52e1ed(0xa1)][_0x52e1ed(0x98)];}async[a103_0x40120c(0x9a)](){const _0x4e5527=a103_0x40120c;logger[_0x4e5527(0x94)](_0x4e5527(0xb8),auth_state_enum_1[_0x4e5527(0x89)][this[_0x4e5527(0x9d)]]);try{if(this[_0x4e5527(0x9d)]===auth_state_enum_1[_0x4e5527(0x89)][_0x4e5527(0xbd)])return;if(this[_0x4e5527(0x9d)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x4e5527(0x8d)]();else{const _0x1c1b5b=await this[_0x4e5527(0xb9)](),_0x281dd1=await axios_1[_0x4e5527(0xb6)][_0x4e5527(0xc5)]('services/data/'+constants_1[_0x4e5527(0x90)],_0x1c1b5b)['then'](()=>!![])[_0x4e5527(0x8f)](()=>![]);!_0x281dd1&&await this[_0x4e5527(0x8d)]();}}catch(_0x36c050){}}async[a103_0x40120c(0x8d)](){const _0xce67ea=a103_0x40120c;var _0x41e999,_0x57c61c,_0x2323a0;logger['log'](_0xce67ea(0x7f));try{this[_0xce67ea(0x9d)]=auth_state_enum_1[_0xce67ea(0x89)][_0xce67ea(0xaa)];const {refreshToken:_0x5007f3,clientId:_0x291a61,clientSecret:_0x31d899}=this[_0xce67ea(0x98)],{data:_0x2abba8}=await axios_1[_0xce67ea(0xb6)]['post'](utils_1[_0xce67ea(0xb4)](this[_0xce67ea(0xa1)][_0xce67ea(0xae)],_0xce67ea(0xc4)),null,{'params':{'grant_type':_0xce67ea(0x95),'refresh_token':_0x5007f3,'client_id':_0x291a61,'client_secret':_0x31d899}});this['instanceUrl']=_0x2abba8[_0xce67ea(0x8c)],this[_0xce67ea(0x81)]=_0x2abba8[_0xce67ea(0xc9)],this['tokenType']=_0x2abba8['token_type'],this[_0xce67ea(0x9d)]=auth_state_enum_1[_0xce67ea(0x89)][_0xce67ea(0x9e)],logger['log'](_0xce67ea(0xc0),this[_0xce67ea(0x99)]);}catch(_0xc0e91){const _0xcfdb06=((_0x57c61c=(_0x41e999=_0xc0e91===null||_0xc0e91===void 0x0?void 0x0:_0xc0e91[_0xce67ea(0x96)])===null||_0x41e999===void 0x0?void 0x0:_0x41e999[_0xce67ea(0x8e)])===null||_0x57c61c===void 0x0?void 0x0:_0x57c61c[_0xce67ea(0xa3)])||((_0x2323a0=_0xc0e91===null||_0xc0e91===void 0x0?void 0x0:_0xc0e91[_0xce67ea(0x96)])===null||_0x2323a0===void 0x0?void 0x0:_0x2323a0[_0xce67ea(0x8e)])||_0xc0e91['message'];logger[_0xce67ea(0xa3)](_0xce67ea(0xa0),_0xcfdb06),this[_0xce67ea(0x9d)]=auth_state_enum_1['AuthState'][_0xce67ea(0xbd)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xce67ea(0xab)]);}}async['forceUpdateToken'](){const _0x284723=a103_0x40120c;logger[_0x284723(0x94)](_0x284723(0x83));if(this['authState']===auth_state_enum_1[_0x284723(0x89)][_0x284723(0xaa)]||this[_0x284723(0x9d)]===auth_state_enum_1[_0x284723(0x89)][_0x284723(0xc6)])return await utils_1['sleep'](this[_0x284723(0x87)]),this[_0x284723(0x85)]();if(this['authState']===auth_state_enum_1[_0x284723(0x89)][_0x284723(0xbd)])throw new invalid_refresh_token_error_1[(_0x284723(0xb7))](errors_1[_0x284723(0xab)]);await this['updateAccessToken']();}async['requestConfig'](){const _0x44e48d=a103_0x40120c;if(this[_0x44e48d(0x9d)]===auth_state_enum_1[_0x44e48d(0x89)][_0x44e48d(0xbd)]){logger[_0x44e48d(0x94)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x44e48d(0x9d)]!==auth_state_enum_1[_0x44e48d(0x89)][_0x44e48d(0x9e)])return logger['log'](_0x44e48d(0x80)),await utils_1[_0x44e48d(0xa2)](this[_0x44e48d(0x87)]),this[_0x44e48d(0xb9)]();return logger['log'](_0x44e48d(0xa4)),{'baseURL':this[_0x44e48d(0x99)],'headers':{'accept':_0x44e48d(0xbb),'authorization':this[_0x44e48d(0xa9)]+'\x20'+this[_0x44e48d(0x81)]}};}};function a103_0x3fad(_0x5b4b4f,_0x213684){return a103_0x3fad=function(_0x4f32fd,_0xbac8f2){_0x4f32fd=_0x4f32fd-0x7f;let _0x336ab2=a103_0x494e[_0x4f32fd];return _0x336ab2;},a103_0x3fad(_0x5b4b4f,_0x213684);}SalesforceAuthService=__decorate([typedi_1['Service'](),__metadata(a103_0x40120c(0xbf),[salesforce_settings_service_1[a103_0x40120c(0xbe)]])],SalesforceAuthService),exports[a103_0x40120c(0xa8)]=SalesforceAuthService;