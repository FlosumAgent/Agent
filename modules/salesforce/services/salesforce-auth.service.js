const a103_0x3cf4=['57041mfxgeZ','authState','Updating','accessToken','error','514SDUWVN','joinURL','getOwnPropertyDescriptor','223695gRWhho','Active','application/json','290150KYJvUn','access\x20token\x20updated\x20for\x20%s','SalesforceSettingsService','loginUrl','data','force\x20update\x20token','return\x20/\x22\x20+\x20this\x20+\x20\x22/','test','function','settings','update\x20access\x20token\x20failed:\x20%s','sleep','1bXbQlM','305KpWJGP','AuthState','constructor','SALESFORCE_API_VERSION','__esModule','catch','post','Error','length','updateAccessToken','object','91741BJgwDh','1cCLKUy','265593TLVeGq','../../../constants/errors','Idle','tokenType','message','298913lzIBHz','../../shared/utils','UnauthorizedSalesforceError','__importDefault','salesforseSettings','setAuthDetails','ERR_INVALID_SALESFORCE_TOKEN','update\x20access\x20token','../errors/invalid-refresh-token.error','response','token_type','../../../constants','SalesforceAuthService','Service','defineProperty','InvalidRefreshTokenError','requestConfig','__metadata','Logger','forceUpdateToken','apply','refresh_token','log','access_token','../enums/auth-state.enum','AUTH_WAIT_TIME','/services/oauth2/token','then','typedi','instanceUrl','../errors/unauthorized-salesforce.error'];const a103_0x1fbb66=a103_0x5880;(function(_0x57be73,_0x2e2ae0){const _0x38510c=a103_0x5880;while(!![]){try{const _0x18a82a=parseInt(_0x38510c(0x1d6))*parseInt(_0x38510c(0x1dc))+-parseInt(_0x38510c(0x1d7))+parseInt(_0x38510c(0x1c9))*-parseInt(_0x38510c(0x1fb))+-parseInt(_0x38510c(0x1bd))+-parseInt(_0x38510c(0x200))*-parseInt(_0x38510c(0x1ca))+parseInt(_0x38510c(0x1ba))+parseInt(_0x38510c(0x1d5));if(_0x18a82a===_0x2e2ae0)break;else _0x57be73['push'](_0x57be73['shift']());}catch(_0x1eee67){_0x57be73['push'](_0x57be73['shift']());}}}(a103_0x3cf4,0x26a7f));const a103_0x2a8698=function(){let _0x1b5661=!![];return function(_0x450cf0,_0x50a784){const _0x3bf850=_0x1b5661?function(){const _0x17c4aa=a103_0x5880;if(_0x50a784){const _0xf89b29=_0x50a784[_0x17c4aa(0x1f0)](_0x450cf0,arguments);return _0x50a784=null,_0xf89b29;}}:function(){};return _0x1b5661=![],_0x3bf850;};}(),a103_0x5a33a1=a103_0x2a8698(this,function(){const _0x191c7f=function(){const _0x519fde=a103_0x5880,_0x24aa65=_0x191c7f['constructor'](_0x519fde(0x1c3))()[_0x519fde(0x1cc)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x24aa65[_0x519fde(0x1c4)](a103_0x5a33a1);};return _0x191c7f();});function a103_0x5880(_0x86ab28,_0x1f6671){return a103_0x5880=function(_0x1ef182,_0x5a33a1){_0x1ef182=_0x1ef182-0x1b9;let _0x2a8698=a103_0x3cf4[_0x1ef182];return _0x2a8698;},a103_0x5880(_0x86ab28,_0x1f6671);}a103_0x5a33a1();'use strict';var __decorate=this&&this['__decorate']||function(_0x354325,_0x3e581e,_0x7e2fd6,_0x49988f){const _0x27b483=a103_0x5880;var _0x59d043=arguments['length'],_0x37faf6=_0x59d043<0x3?_0x3e581e:_0x49988f===null?_0x49988f=Object[_0x27b483(0x1b9)](_0x3e581e,_0x7e2fd6):_0x49988f,_0x15284a;if(typeof Reflect===_0x27b483(0x1d4)&&typeof Reflect['decorate']===_0x27b483(0x1c5))_0x37faf6=Reflect['decorate'](_0x354325,_0x3e581e,_0x7e2fd6,_0x49988f);else{for(var _0x1b45b6=_0x354325[_0x27b483(0x1d2)]-0x1;_0x1b45b6>=0x0;_0x1b45b6--)if(_0x15284a=_0x354325[_0x1b45b6])_0x37faf6=(_0x59d043<0x3?_0x15284a(_0x37faf6):_0x59d043>0x3?_0x15284a(_0x3e581e,_0x7e2fd6,_0x37faf6):_0x15284a(_0x3e581e,_0x7e2fd6))||_0x37faf6;}return _0x59d043>0x3&&_0x37faf6&&Object[_0x27b483(0x1ea)](_0x3e581e,_0x7e2fd6,_0x37faf6),_0x37faf6;},__metadata=this&&this[a103_0x1fbb66(0x1ed)]||function(_0x4234bc,_0x465272){const _0x3c9530=a103_0x1fbb66;if(typeof Reflect===_0x3c9530(0x1d4)&&typeof Reflect['metadata']===_0x3c9530(0x1c5))return Reflect['metadata'](_0x4234bc,_0x465272);},__importDefault=this&&this[a103_0x1fbb66(0x1df)]||function(_0x1763dd){const _0x20992a=a103_0x1fbb66;return _0x1763dd&&_0x1763dd[_0x20992a(0x1ce)]?_0x1763dd:{'default':_0x1763dd};};Object[a103_0x1fbb66(0x1ea)](exports,a103_0x1fbb66(0x1ce),{'value':!![]}),exports[a103_0x1fbb66(0x1e8)]=void 0x0;const typedi_1=require(a103_0x1fbb66(0x1f8)),errors_1=require(a103_0x1fbb66(0x1d8)),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a103_0x1fbb66(0x1dd)),invalid_refresh_token_error_1=require(a103_0x1fbb66(0x1e4)),auth_state_enum_1=require(a103_0x1fbb66(0x1f4)),unauthorized_salesforce_error_1=require(a103_0x1fbb66(0x1fa)),constants_1=require(a103_0x1fbb66(0x1e7)),logger=new core_1[(a103_0x1fbb66(0x1ee))]('salesforce-auth-service');let SalesforceAuthService=class SalesforceAuthService{constructor(_0x5ee1e3){const _0x58ab50=a103_0x1fbb66;this['salesforseSettings']=_0x5ee1e3,this[_0x58ab50(0x1f5)]=0x1388,this[_0x58ab50(0x1fc)]=auth_state_enum_1[_0x58ab50(0x1cb)]['Idle'],this['setAuthDetails']();}get[a103_0x1fbb66(0x1c6)](){const _0x2f4042=a103_0x1fbb66;return this[_0x2f4042(0x1e0)][_0x2f4042(0x1c6)];}async[a103_0x1fbb66(0x1e1)](){const _0x4ee9e8=a103_0x1fbb66;logger[_0x4ee9e8(0x1f2)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x4ee9e8(0x1cb)][this['authState']]);try{if(this[_0x4ee9e8(0x1fc)]===auth_state_enum_1[_0x4ee9e8(0x1cb)][_0x4ee9e8(0x1d1)])return;if(this[_0x4ee9e8(0x1fc)]===auth_state_enum_1['AuthState']['Idle'])await this[_0x4ee9e8(0x1d3)]();else{const _0x46217f=await this[_0x4ee9e8(0x1ec)](),_0x2c84f2=await axios_1['default']['get']('services/data/'+constants_1[_0x4ee9e8(0x1cd)],_0x46217f)[_0x4ee9e8(0x1f7)](()=>!![])[_0x4ee9e8(0x1cf)](()=>![]);!_0x2c84f2&&await this[_0x4ee9e8(0x1d3)]();}}catch(_0x1e14f4){}}async[a103_0x1fbb66(0x1d3)](){const _0x4b337d=a103_0x1fbb66;var _0x50d22b,_0x170327,_0x51aa22;logger[_0x4b337d(0x1f2)](_0x4b337d(0x1e3));try{this[_0x4b337d(0x1fc)]=auth_state_enum_1[_0x4b337d(0x1cb)][_0x4b337d(0x1fd)];const {refreshToken:_0x5c457d,clientId:_0x468044,clientSecret:_0x5e6ae2}=this[_0x4b337d(0x1c6)],{data:_0x11bbaa}=await axios_1['default'][_0x4b337d(0x1d0)](utils_1[_0x4b337d(0x201)](this['salesforseSettings'][_0x4b337d(0x1c0)],_0x4b337d(0x1f6)),null,{'params':{'grant_type':_0x4b337d(0x1f1),'refresh_token':_0x5c457d,'client_id':_0x468044,'client_secret':_0x5e6ae2}});this['instanceUrl']=_0x11bbaa['instance_url'],this[_0x4b337d(0x1fe)]=_0x11bbaa[_0x4b337d(0x1f3)],this[_0x4b337d(0x1da)]=_0x11bbaa[_0x4b337d(0x1e6)],this[_0x4b337d(0x1fc)]=auth_state_enum_1['AuthState'][_0x4b337d(0x1bb)],logger[_0x4b337d(0x1f2)](_0x4b337d(0x1be),this[_0x4b337d(0x1f9)]);}catch(_0x50ed79){const _0x6a71bc=((_0x170327=(_0x50d22b=_0x50ed79===null||_0x50ed79===void 0x0?void 0x0:_0x50ed79['response'])===null||_0x50d22b===void 0x0?void 0x0:_0x50d22b[_0x4b337d(0x1c1)])===null||_0x170327===void 0x0?void 0x0:_0x170327['error'])||((_0x51aa22=_0x50ed79===null||_0x50ed79===void 0x0?void 0x0:_0x50ed79[_0x4b337d(0x1e5)])===null||_0x51aa22===void 0x0?void 0x0:_0x51aa22[_0x4b337d(0x1c1)])||_0x50ed79[_0x4b337d(0x1db)];logger[_0x4b337d(0x1ff)](_0x4b337d(0x1c7),_0x6a71bc),this[_0x4b337d(0x1fc)]=auth_state_enum_1[_0x4b337d(0x1cb)][_0x4b337d(0x1d1)];throw new invalid_refresh_token_error_1[(_0x4b337d(0x1eb))](errors_1[_0x4b337d(0x1e2)]);}}async['forceUpdateToken'](){const _0x38f4e6=a103_0x1fbb66;logger[_0x38f4e6(0x1f2)](_0x38f4e6(0x1c2));if(this[_0x38f4e6(0x1fc)]===auth_state_enum_1[_0x38f4e6(0x1cb)][_0x38f4e6(0x1fd)]||this[_0x38f4e6(0x1fc)]===auth_state_enum_1['AuthState'][_0x38f4e6(0x1d9)])return await utils_1[_0x38f4e6(0x1c8)](this[_0x38f4e6(0x1f5)]),this[_0x38f4e6(0x1ef)]();if(this[_0x38f4e6(0x1fc)]===auth_state_enum_1[_0x38f4e6(0x1cb)]['Error'])throw new invalid_refresh_token_error_1[(_0x38f4e6(0x1eb))](errors_1[_0x38f4e6(0x1e2)]);await this[_0x38f4e6(0x1d3)]();}async[a103_0x1fbb66(0x1ec)](){const _0x5be29b=a103_0x1fbb66;if(this[_0x5be29b(0x1fc)]===auth_state_enum_1[_0x5be29b(0x1cb)][_0x5be29b(0x1d1)]){logger[_0x5be29b(0x1f2)]('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x5be29b(0x1de))]();}if(this[_0x5be29b(0x1fc)]!==auth_state_enum_1[_0x5be29b(0x1cb)][_0x5be29b(0x1bb)])return logger[_0x5be29b(0x1f2)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x5be29b(0x1c8)](this[_0x5be29b(0x1f5)]),this[_0x5be29b(0x1ec)]();return{'baseURL':this['instanceUrl'],'headers':{'accept':_0x5be29b(0x1bc),'content-type':_0x5be29b(0x1bc),'authorization':this[_0x5be29b(0x1da)]+'\x20'+this[_0x5be29b(0x1fe)]}};}};SalesforceAuthService=__decorate([typedi_1[a103_0x1fbb66(0x1e9)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a103_0x1fbb66(0x1bf)]])],SalesforceAuthService),exports[a103_0x1fbb66(0x1e8)]=SalesforceAuthService;