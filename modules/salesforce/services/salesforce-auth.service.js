const a108_0x1b3de9=a108_0x468f;(function(_0x5d3816,_0x162eee){const _0x46cd48=a108_0x468f,_0x134c9f=_0x5d3816();while(!![]){try{const _0xe9209f=-parseInt(_0x46cd48(0x18e))/0x1*(parseInt(_0x46cd48(0x194))/0x2)+parseInt(_0x46cd48(0x16a))/0x3+-parseInt(_0x46cd48(0x183))/0x4*(-parseInt(_0x46cd48(0x178))/0x5)+-parseInt(_0x46cd48(0x198))/0x6*(parseInt(_0x46cd48(0x15f))/0x7)+parseInt(_0x46cd48(0x175))/0x8*(parseInt(_0x46cd48(0x18c))/0x9)+parseInt(_0x46cd48(0x181))/0xa+parseInt(_0x46cd48(0x172))/0xb*(-parseInt(_0x46cd48(0x195))/0xc);if(_0xe9209f===_0x162eee)break;else _0x134c9f['push'](_0x134c9f['shift']());}catch(_0x4a7c49){_0x134c9f['push'](_0x134c9f['shift']());}}}(a108_0x3e13,0x8bd49));const a108_0x5d63fc=function(){let _0x43aa04=!![];return function(_0x265853,_0x1957f9){const _0x2904a5=_0x43aa04?function(){const _0x501be7=a108_0x468f;if(_0x1957f9){const _0x1919db=_0x1957f9[_0x501be7(0x15d)](_0x265853,arguments);return _0x1957f9=null,_0x1919db;}}:function(){};return _0x43aa04=![],_0x2904a5;};}(),a108_0x5c1472=a108_0x5d63fc(this,function(){const _0x1f3f61=a108_0x468f;return a108_0x5c1472[_0x1f3f61(0x19b)]()[_0x1f3f61(0x190)](_0x1f3f61(0x15c))[_0x1f3f61(0x19b)]()[_0x1f3f61(0x166)](a108_0x5c1472)[_0x1f3f61(0x190)](_0x1f3f61(0x15c));});a108_0x5c1472();'use strict';var __decorate=this&&this[a108_0x1b3de9(0x15e)]||function(_0x2fc59c,_0x46735b,_0xeecd0c,_0x3e8a87){const _0x288843=a108_0x1b3de9;var _0xc37665=arguments[_0x288843(0x176)],_0x359602=_0xc37665<0x3?_0x46735b:_0x3e8a87===null?_0x3e8a87=Object['getOwnPropertyDescriptor'](_0x46735b,_0xeecd0c):_0x3e8a87,_0x3df966;if(typeof Reflect===_0x288843(0x19f)&&typeof Reflect['decorate']===_0x288843(0x16f))_0x359602=Reflect['decorate'](_0x2fc59c,_0x46735b,_0xeecd0c,_0x3e8a87);else{for(var _0x56717e=_0x2fc59c[_0x288843(0x176)]-0x1;_0x56717e>=0x0;_0x56717e--)if(_0x3df966=_0x2fc59c[_0x56717e])_0x359602=(_0xc37665<0x3?_0x3df966(_0x359602):_0xc37665>0x3?_0x3df966(_0x46735b,_0xeecd0c,_0x359602):_0x3df966(_0x46735b,_0xeecd0c))||_0x359602;}return _0xc37665>0x3&&_0x359602&&Object[_0x288843(0x16b)](_0x46735b,_0xeecd0c,_0x359602),_0x359602;},__metadata=this&&this[a108_0x1b3de9(0x192)]||function(_0x1a8a2b,_0xd1fb2c){const _0x2473d3=a108_0x1b3de9;if(typeof Reflect===_0x2473d3(0x19f)&&typeof Reflect['metadata']===_0x2473d3(0x16f))return Reflect[_0x2473d3(0x169)](_0x1a8a2b,_0xd1fb2c);},__importDefault=this&&this[a108_0x1b3de9(0x18f)]||function(_0x206a21){const _0x5bfb87=a108_0x1b3de9;return _0x206a21&&_0x206a21[_0x5bfb87(0x196)]?_0x206a21:{'default':_0x206a21};},SalesforceAuthService_1;Object['defineProperty'](exports,a108_0x1b3de9(0x196),{'value':!![]}),exports[a108_0x1b3de9(0x199)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a108_0x1b3de9(0x1ab)),core_1=require(a108_0x1b3de9(0x17b)),salesforce_settings_service_1=require(a108_0x1b3de9(0x1ac)),axios_1=__importDefault(require('axios')),utils_1=require(a108_0x1b3de9(0x18a)),invalid_refresh_token_error_1=require(a108_0x1b3de9(0x1a4)),auth_state_enum_1=require(a108_0x1b3de9(0x160)),unauthorized_salesforce_error_1=require(a108_0x1b3de9(0x19d)),constants_1=require(a108_0x1b3de9(0x193));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x5bb614){const _0x59a441=a108_0x1b3de9;this[_0x59a441(0x16e)]=_0x5bb614,this[_0x59a441(0x191)]=0x1388,this[_0x59a441(0x18b)]=auth_state_enum_1[_0x59a441(0x165)][_0x59a441(0x19e)],this[_0x59a441(0x184)]=new core_1[(_0x59a441(0x197))](SalesforceAuthService_1[_0x59a441(0x182)]),this['setAuthDetails']();}get[a108_0x1b3de9(0x162)](){const _0x269b81=a108_0x1b3de9;return this[_0x269b81(0x16e)][_0x269b81(0x162)];}async[a108_0x1b3de9(0x1a8)](){const _0x263942=a108_0x1b3de9;this['logger'][_0x263942(0x17d)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this['authState']]);try{if(this['authState']===auth_state_enum_1[_0x263942(0x165)][_0x263942(0x185)])return;if(this[_0x263942(0x18b)]===auth_state_enum_1[_0x263942(0x165)][_0x263942(0x19e)])await this[_0x263942(0x17c)]();else{const _0x4461f7=await this[_0x263942(0x164)](),_0x190877=await axios_1[_0x263942(0x161)][_0x263942(0x1a6)](_0x263942(0x170)+constants_1[_0x263942(0x17e)],_0x4461f7)['then'](()=>!![])[_0x263942(0x188)](()=>![]);!_0x190877&&await this[_0x263942(0x17c)]();}}catch(_0x2e501b){}}async['updateAccessToken'](){const _0x2ad61d=a108_0x1b3de9;var _0x279472,_0x5bc212,_0x4da426;this[_0x2ad61d(0x184)]['log']('update\x20access\x20token');try{this[_0x2ad61d(0x18b)]=auth_state_enum_1['AuthState'][_0x2ad61d(0x174)];const {refreshToken:_0xf19d3e,clientId:_0x1199b6,clientSecret:_0xe79500}=this['settings'],{data:_0x1d6ef8}=await axios_1[_0x2ad61d(0x161)][_0x2ad61d(0x187)]((0x0,utils_1[_0x2ad61d(0x15a)])(this[_0x2ad61d(0x16e)][_0x2ad61d(0x1a2)],_0x2ad61d(0x1a5)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0xf19d3e,'client_id':_0x1199b6,'client_secret':_0xe79500}});this[_0x2ad61d(0x171)]=_0x1d6ef8[_0x2ad61d(0x1a7)],this[_0x2ad61d(0x1a3)]=_0x1d6ef8[_0x2ad61d(0x1a9)],this['tokenType']=_0x1d6ef8[_0x2ad61d(0x17f)],this[_0x2ad61d(0x18b)]=auth_state_enum_1[_0x2ad61d(0x165)][_0x2ad61d(0x168)],this['logger'][_0x2ad61d(0x17d)](_0x2ad61d(0x1a0),this[_0x2ad61d(0x171)]);}catch(_0x4e83e7){const _0x4b2691=((_0x5bc212=(_0x279472=_0x4e83e7===null||_0x4e83e7===void 0x0?void 0x0:_0x4e83e7[_0x2ad61d(0x17a)])===null||_0x279472===void 0x0?void 0x0:_0x279472[_0x2ad61d(0x186)])===null||_0x5bc212===void 0x0?void 0x0:_0x5bc212['error'])||((_0x4da426=_0x4e83e7===null||_0x4e83e7===void 0x0?void 0x0:_0x4e83e7[_0x2ad61d(0x17a)])===null||_0x4da426===void 0x0?void 0x0:_0x4da426[_0x2ad61d(0x186)])||_0x4e83e7[_0x2ad61d(0x1aa)];this[_0x2ad61d(0x184)][_0x2ad61d(0x177)](_0x2ad61d(0x16c),_0x4b2691),this[_0x2ad61d(0x18b)]=auth_state_enum_1['AuthState']['Error'];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a108_0x1b3de9(0x189)](){const _0x598b0d=a108_0x1b3de9;this[_0x598b0d(0x184)][_0x598b0d(0x17d)](_0x598b0d(0x18d));if(this[_0x598b0d(0x18b)]===auth_state_enum_1[_0x598b0d(0x165)][_0x598b0d(0x174)]||this[_0x598b0d(0x18b)]===auth_state_enum_1['AuthState']['Idle'])return await(0x0,utils_1[_0x598b0d(0x19c)])(this[_0x598b0d(0x191)]),this[_0x598b0d(0x189)]();if(this[_0x598b0d(0x18b)]===auth_state_enum_1[_0x598b0d(0x165)][_0x598b0d(0x185)])throw new invalid_refresh_token_error_1[(_0x598b0d(0x167))](errors_1[_0x598b0d(0x180)]);await this[_0x598b0d(0x17c)]();}async[a108_0x1b3de9(0x164)](){const _0x3ff01a=a108_0x1b3de9;if(this[_0x3ff01a(0x18b)]===auth_state_enum_1[_0x3ff01a(0x165)][_0x3ff01a(0x185)]){this[_0x3ff01a(0x184)][_0x3ff01a(0x17d)](_0x3ff01a(0x19a));throw new unauthorized_salesforce_error_1[(_0x3ff01a(0x163))]();}if(this[_0x3ff01a(0x18b)]!==auth_state_enum_1[_0x3ff01a(0x165)][_0x3ff01a(0x168)])return this[_0x3ff01a(0x184)][_0x3ff01a(0x17d)](_0x3ff01a(0x16d)),await(0x0,utils_1[_0x3ff01a(0x19c)])(this[_0x3ff01a(0x191)]),this['requestConfig']();return{'baseURL':this[_0x3ff01a(0x171)],'headers':{'accept':'application/json','content-type':'application/json','authorization':this[_0x3ff01a(0x1a1)]+'\x20'+this['accessToken']}};}};function a108_0x468f(_0x1ca120,_0x4a2abe){const _0xd8f39c=a108_0x3e13();return a108_0x468f=function(_0x5c1472,_0x5d63fc){_0x5c1472=_0x5c1472-0x15a;let _0x3e1350=_0xd8f39c[_0x5c1472];return _0x3e1350;},a108_0x468f(_0x1ca120,_0x4a2abe);}SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a108_0x1b3de9(0x179)])(),__metadata(a108_0x1b3de9(0x173),[salesforce_settings_service_1[a108_0x1b3de9(0x15b)]])],SalesforceAuthService),exports[a108_0x1b3de9(0x199)]=SalesforceAuthService;function a108_0x3e13(){const _0x288bca=['10eXiQJO','2224356DQtQFe','__esModule','Logger','3954pOzqAE','SalesforceAuthService','create\x20authorized\x20request\x20failed:\x20authorization\x20error','toString','sleep','../errors/unauthorized-salesforce.error','Idle','object','access\x20token\x20updated\x20for\x20%s','tokenType','loginUrl','accessToken','../errors/invalid-refresh-token.error','/services/oauth2/token','get','instance_url','setAuthDetails','access_token','message','../../../constants/errors','../../shared/services/salesforce-settings.service','joinURL','SalesforceSettingsService','(((.+)+)+)+$','apply','__decorate','1470eqKAoJ','../enums/auth-state.enum','default','settings','UnauthorizedSalesforceError','requestConfig','AuthState','constructor','InvalidRefreshTokenError','Active','metadata','1953462riRJja','defineProperty','update\x20access\x20token\x20failed:\x20%s','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','salesforseSettings','function','services/data/','instanceUrl','44QSkSPI','design:paramtypes','Updating','16zbLKIs','length','error','25VpqrZC','Service','response','../../../core','updateAccessToken','log','SALESFORCE_API_VERSION','token_type','ERR_INVALID_SALESFORCE_TOKEN','9698480dbofKd','name','293308laPfQJ','logger','Error','data','post','catch','forceUpdateToken','../../shared/utils','authState','105210fkGcCe','force\x20update\x20token','111686rzhSZs','__importDefault','search','AUTH_WAIT_TIME','__metadata','../../../constants'];a108_0x3e13=function(){return _0x288bca;};return a108_0x3e13();}