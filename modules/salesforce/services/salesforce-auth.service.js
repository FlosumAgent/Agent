const a105_0x3f43=['__esModule','../enums/auth-state.enum','axios','log','__metadata','tokenType','data','Active','message','UnauthorizedSalesforceError','access_token','SALESFORCE_API_VERSION','loginUrl','163365lnxhGn','updateAccessToken','force\x20update\x20token','constructor','check\x20auth:\x20current\x20state\x20-\x20%s','response','apply','name','SalesforceSettingsService','defineProperty','../../../constants/errors','catch','199800GdGlVF','Error','settings','getOwnPropertyDescriptor','default','188063voIETw','../errors/unauthorized-salesforce.error','92016ZfMaBe','InvalidRefreshTokenError','../../shared/services/salesforce-settings.service','Updating','logger','__importDefault','update\x20access\x20token\x20failed:\x20%s','function','post','update\x20access\x20token','accessToken','forceUpdateToken','/services/oauth2/token','AUTH_WAIT_TIME','117435CkqIZw','setAuthDetails','access\x20token\x20updated\x20for\x20%s','ERR_INVALID_SALESFORCE_TOKEN','return\x20/\x22\x20+\x20this\x20+\x20\x22/','../../../core','27565ztpEHw','1GqYdXI','requestConfig','test','typedi','joinURL','then','authState','instanceUrl','application/json','refresh_token','get','instance_url','metadata','object','SalesforceAuthService','decorate','../errors/invalid-refresh-token.error','Idle','length','AuthState','salesforseSettings','Logger','error','../../../constants','services/data/','sleep','114560JkzcRd','../../shared/utils'];function a105_0x548c(_0x18a523,_0x32d612){return a105_0x548c=function(_0x5164ea,_0xc6c7af){_0x5164ea=_0x5164ea-0x1ac;let _0x3f8741=a105_0x3f43[_0x5164ea];return _0x3f8741;},a105_0x548c(_0x18a523,_0x32d612);}const a105_0x3db4c2=a105_0x548c;(function(_0x4fb9d6,_0x5ba29b){const _0x2fb537=a105_0x548c;while(!![]){try{const _0x1d4636=-parseInt(_0x2fb537(0x1f8))+parseInt(_0x2fb537(0x1f3))+parseInt(_0x2fb537(0x1e7))+parseInt(_0x2fb537(0x1be))*parseInt(_0x2fb537(0x1bd))+-parseInt(_0x2fb537(0x1d8))+-parseInt(_0x2fb537(0x1fa))+parseInt(_0x2fb537(0x1b7));if(_0x1d4636===_0x5ba29b)break;else _0x4fb9d6['push'](_0x4fb9d6['shift']());}catch(_0x3af54e){_0x4fb9d6['push'](_0x4fb9d6['shift']());}}}(a105_0x3f43,0x1bb76));const a105_0x3f8741=function(){let _0x1e1d89=!![];return function(_0x542134,_0xf4144f){const _0x4ee2ce=_0x1e1d89?function(){const _0x312891=a105_0x548c;if(_0xf4144f){const _0x83ad7a=_0xf4144f[_0x312891(0x1ed)](_0x542134,arguments);return _0xf4144f=null,_0x83ad7a;}}:function(){};return _0x1e1d89=![],_0x4ee2ce;};}(),a105_0xc6c7af=a105_0x3f8741(this,function(){const _0x42b331=function(){const _0x3b4380=a105_0x548c,_0x52f0bf=_0x42b331[_0x3b4380(0x1ea)](_0x3b4380(0x1bb))()[_0x3b4380(0x1ea)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x52f0bf[_0x3b4380(0x1c0)](a105_0xc6c7af);};return _0x42b331();});a105_0xc6c7af();'use strict';var __decorate=this&&this['__decorate']||function(_0x759f8c,_0x21a0f2,_0x1bb721,_0x32c543){const _0x5706ae=a105_0x548c;var _0x3344a2=arguments[_0x5706ae(0x1d0)],_0x41f2e7=_0x3344a2<0x3?_0x21a0f2:_0x32c543===null?_0x32c543=Object[_0x5706ae(0x1f6)](_0x21a0f2,_0x1bb721):_0x32c543,_0x31d28b;if(typeof Reflect===_0x5706ae(0x1cb)&&typeof Reflect[_0x5706ae(0x1cd)]===_0x5706ae(0x1b0))_0x41f2e7=Reflect['decorate'](_0x759f8c,_0x21a0f2,_0x1bb721,_0x32c543);else{for(var _0x1fedf5=_0x759f8c[_0x5706ae(0x1d0)]-0x1;_0x1fedf5>=0x0;_0x1fedf5--)if(_0x31d28b=_0x759f8c[_0x1fedf5])_0x41f2e7=(_0x3344a2<0x3?_0x31d28b(_0x41f2e7):_0x3344a2>0x3?_0x31d28b(_0x21a0f2,_0x1bb721,_0x41f2e7):_0x31d28b(_0x21a0f2,_0x1bb721))||_0x41f2e7;}return _0x3344a2>0x3&&_0x41f2e7&&Object[_0x5706ae(0x1f0)](_0x21a0f2,_0x1bb721,_0x41f2e7),_0x41f2e7;},__metadata=this&&this[a105_0x3db4c2(0x1de)]||function(_0x27f798,_0x42bf1f){const _0x17267d=a105_0x3db4c2;if(typeof Reflect===_0x17267d(0x1cb)&&typeof Reflect[_0x17267d(0x1ca)]===_0x17267d(0x1b0))return Reflect['metadata'](_0x27f798,_0x42bf1f);},__importDefault=this&&this[a105_0x3db4c2(0x1ae)]||function(_0x5d00d4){const _0x3a46ba=a105_0x3db4c2;return _0x5d00d4&&_0x5d00d4[_0x3a46ba(0x1da)]?_0x5d00d4:{'default':_0x5d00d4};},SalesforceAuthService_1;Object[a105_0x3db4c2(0x1f0)](exports,a105_0x3db4c2(0x1da),{'value':!![]}),exports[a105_0x3db4c2(0x1cc)]=void 0x0;const typedi_1=require(a105_0x3db4c2(0x1c1)),errors_1=require(a105_0x3db4c2(0x1f1)),core_1=require(a105_0x3db4c2(0x1bc)),salesforce_settings_service_1=require(a105_0x3db4c2(0x1fc)),axios_1=__importDefault(require(a105_0x3db4c2(0x1dc))),utils_1=require(a105_0x3db4c2(0x1d9)),invalid_refresh_token_error_1=require(a105_0x3db4c2(0x1ce)),auth_state_enum_1=require(a105_0x3db4c2(0x1db)),unauthorized_salesforce_error_1=require(a105_0x3db4c2(0x1f9)),constants_1=require(a105_0x3db4c2(0x1d5));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x26768f){const _0xcff741=a105_0x3db4c2;this[_0xcff741(0x1d2)]=_0x26768f,this[_0xcff741(0x1b6)]=0x1388,this[_0xcff741(0x1c4)]=auth_state_enum_1[_0xcff741(0x1d1)][_0xcff741(0x1cf)],this[_0xcff741(0x1ad)]=new core_1[(_0xcff741(0x1d3))](SalesforceAuthService_1[_0xcff741(0x1ee)]),this[_0xcff741(0x1b8)]();}get['settings'](){const _0x4b85cf=a105_0x3db4c2;return this['salesforseSettings'][_0x4b85cf(0x1f5)];}async[a105_0x3db4c2(0x1b8)](){const _0x276f9f=a105_0x3db4c2;this[_0x276f9f(0x1ad)][_0x276f9f(0x1dd)](_0x276f9f(0x1eb),auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x276f9f(0x1c4)]===auth_state_enum_1[_0x276f9f(0x1d1)][_0x276f9f(0x1f4)])return;if(this['authState']===auth_state_enum_1[_0x276f9f(0x1d1)]['Idle'])await this[_0x276f9f(0x1e8)]();else{const _0x16fe5a=await this[_0x276f9f(0x1bf)](),_0x4b8247=await axios_1[_0x276f9f(0x1f7)][_0x276f9f(0x1c8)](_0x276f9f(0x1d6)+constants_1[_0x276f9f(0x1e5)],_0x16fe5a)[_0x276f9f(0x1c3)](()=>!![])[_0x276f9f(0x1f2)](()=>![]);!_0x4b8247&&await this[_0x276f9f(0x1e8)]();}}catch(_0x2c357){}}async[a105_0x3db4c2(0x1e8)](){const _0x12cb1d=a105_0x3db4c2;var _0x5375a1,_0x56504d,_0x5ef0e6;this[_0x12cb1d(0x1ad)]['log'](_0x12cb1d(0x1b2));try{this[_0x12cb1d(0x1c4)]=auth_state_enum_1[_0x12cb1d(0x1d1)]['Updating'];const {refreshToken:_0x208109,clientId:_0x3080a5,clientSecret:_0x1d5837}=this[_0x12cb1d(0x1f5)],{data:_0x9f40af}=await axios_1[_0x12cb1d(0x1f7)][_0x12cb1d(0x1b1)](utils_1[_0x12cb1d(0x1c2)](this['salesforseSettings'][_0x12cb1d(0x1e6)],_0x12cb1d(0x1b5)),null,{'params':{'grant_type':_0x12cb1d(0x1c7),'refresh_token':_0x208109,'client_id':_0x3080a5,'client_secret':_0x1d5837}});this[_0x12cb1d(0x1c5)]=_0x9f40af[_0x12cb1d(0x1c9)],this[_0x12cb1d(0x1b3)]=_0x9f40af[_0x12cb1d(0x1e4)],this[_0x12cb1d(0x1df)]=_0x9f40af['token_type'],this[_0x12cb1d(0x1c4)]=auth_state_enum_1[_0x12cb1d(0x1d1)][_0x12cb1d(0x1e1)],this[_0x12cb1d(0x1ad)][_0x12cb1d(0x1dd)](_0x12cb1d(0x1b9),this[_0x12cb1d(0x1c5)]);}catch(_0x19325c){const _0x34ff65=((_0x56504d=(_0x5375a1=_0x19325c===null||_0x19325c===void 0x0?void 0x0:_0x19325c['response'])===null||_0x5375a1===void 0x0?void 0x0:_0x5375a1[_0x12cb1d(0x1e0)])===null||_0x56504d===void 0x0?void 0x0:_0x56504d[_0x12cb1d(0x1d4)])||((_0x5ef0e6=_0x19325c===null||_0x19325c===void 0x0?void 0x0:_0x19325c[_0x12cb1d(0x1ec)])===null||_0x5ef0e6===void 0x0?void 0x0:_0x5ef0e6['data'])||_0x19325c[_0x12cb1d(0x1e2)];this[_0x12cb1d(0x1ad)][_0x12cb1d(0x1d4)](_0x12cb1d(0x1af),_0x34ff65),this[_0x12cb1d(0x1c4)]=auth_state_enum_1[_0x12cb1d(0x1d1)][_0x12cb1d(0x1f4)];throw new invalid_refresh_token_error_1[(_0x12cb1d(0x1fb))](errors_1[_0x12cb1d(0x1ba)]);}}async['forceUpdateToken'](){const _0x5a5175=a105_0x3db4c2;this[_0x5a5175(0x1ad)][_0x5a5175(0x1dd)](_0x5a5175(0x1e9));if(this[_0x5a5175(0x1c4)]===auth_state_enum_1[_0x5a5175(0x1d1)][_0x5a5175(0x1ac)]||this[_0x5a5175(0x1c4)]===auth_state_enum_1[_0x5a5175(0x1d1)]['Idle'])return await utils_1['sleep'](this['AUTH_WAIT_TIME']),this[_0x5a5175(0x1b4)]();if(this[_0x5a5175(0x1c4)]===auth_state_enum_1['AuthState'][_0x5a5175(0x1f4)])throw new invalid_refresh_token_error_1[(_0x5a5175(0x1fb))](errors_1[_0x5a5175(0x1ba)]);await this[_0x5a5175(0x1e8)]();}async[a105_0x3db4c2(0x1bf)](){const _0x56b963=a105_0x3db4c2;if(this[_0x56b963(0x1c4)]===auth_state_enum_1[_0x56b963(0x1d1)][_0x56b963(0x1f4)]){this[_0x56b963(0x1ad)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20error');throw new unauthorized_salesforce_error_1[(_0x56b963(0x1e3))]();}if(this[_0x56b963(0x1c4)]!==auth_state_enum_1['AuthState'][_0x56b963(0x1e1)])return this[_0x56b963(0x1ad)][_0x56b963(0x1dd)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x56b963(0x1d7)](this[_0x56b963(0x1b6)]),this[_0x56b963(0x1bf)]();return{'baseURL':this[_0x56b963(0x1c5)],'headers':{'accept':_0x56b963(0x1c6),'content-type':_0x56b963(0x1c6),'authorization':this[_0x56b963(0x1df)]+'\x20'+this[_0x56b963(0x1b3)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata('design:paramtypes',[salesforce_settings_service_1[a105_0x3db4c2(0x1ef)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;