const a106_0x427603=a106_0x6df0;(function(_0x335e1a,_0x152f74){const _0x43c1cc=a106_0x6df0,_0x58a885=_0x335e1a();while(!![]){try{const _0x496a02=parseInt(_0x43c1cc(0xcb))/0x1+parseInt(_0x43c1cc(0xae))/0x2+-parseInt(_0x43c1cc(0xd7))/0x3*(parseInt(_0x43c1cc(0xdd))/0x4)+-parseInt(_0x43c1cc(0xd3))/0x5+-parseInt(_0x43c1cc(0xef))/0x6*(parseInt(_0x43c1cc(0xcf))/0x7)+parseInt(_0x43c1cc(0xe6))/0x8+parseInt(_0x43c1cc(0xc4))/0x9;if(_0x496a02===_0x152f74)break;else _0x58a885['push'](_0x58a885['shift']());}catch(_0x43e3e5){_0x58a885['push'](_0x58a885['shift']());}}}(a106_0x2f1f,0xc18ab));const a106_0x504371=function(){let _0x4d5306=!![];return function(_0x141ca6,_0x11bb57){const _0x3a6dc9=_0x4d5306?function(){const _0x26a883=a106_0x6df0;if(_0x11bb57){const _0x2b8112=_0x11bb57[_0x26a883(0xab)](_0x141ca6,arguments);return _0x11bb57=null,_0x2b8112;}}:function(){};return _0x4d5306=![],_0x3a6dc9;};}(),a106_0x2e9ba4=a106_0x504371(this,function(){const _0x43197f=a106_0x6df0;return a106_0x2e9ba4[_0x43197f(0xec)]()[_0x43197f(0xb6)](_0x43197f(0xf0))[_0x43197f(0xec)]()['constructor'](a106_0x2e9ba4)[_0x43197f(0xb6)]('(((.+)+)+)+$');});a106_0x2e9ba4();'use strict';var __decorate=this&&this[a106_0x427603(0xcc)]||function(_0x43f7d7,_0x1fcf3e,_0x41af6b,_0x5dabeb){const _0x5156ff=a106_0x427603;var _0x1fbd36=arguments[_0x5156ff(0xbb)],_0xa85b30=_0x1fbd36<0x3?_0x1fcf3e:_0x5dabeb===null?_0x5dabeb=Object[_0x5156ff(0xde)](_0x1fcf3e,_0x41af6b):_0x5dabeb,_0x2352d2;if(typeof Reflect===_0x5156ff(0xbc)&&typeof Reflect['decorate']==='function')_0xa85b30=Reflect[_0x5156ff(0xad)](_0x43f7d7,_0x1fcf3e,_0x41af6b,_0x5dabeb);else{for(var _0x197626=_0x43f7d7[_0x5156ff(0xbb)]-0x1;_0x197626>=0x0;_0x197626--)if(_0x2352d2=_0x43f7d7[_0x197626])_0xa85b30=(_0x1fbd36<0x3?_0x2352d2(_0xa85b30):_0x1fbd36>0x3?_0x2352d2(_0x1fcf3e,_0x41af6b,_0xa85b30):_0x2352d2(_0x1fcf3e,_0x41af6b))||_0xa85b30;}return _0x1fbd36>0x3&&_0xa85b30&&Object[_0x5156ff(0xe4)](_0x1fcf3e,_0x41af6b,_0xa85b30),_0xa85b30;},__metadata=this&&this['__metadata']||function(_0x4440f3,_0x54f90d){const _0x198f3b=a106_0x427603;if(typeof Reflect==='object'&&typeof Reflect[_0x198f3b(0xd2)]==='function')return Reflect['metadata'](_0x4440f3,_0x54f90d);},__importDefault=this&&this[a106_0x427603(0xc2)]||function(_0x558cb2){const _0x41af5f=a106_0x427603;return _0x558cb2&&_0x558cb2[_0x41af5f(0xf1)]?_0x558cb2:{'default':_0x558cb2};},SalesforceAuthService_1;Object[a106_0x427603(0xe4)](exports,a106_0x427603(0xf1),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a106_0x6df0(_0x342888,_0x5dcf23){const _0x4a78c1=a106_0x2f1f();return a106_0x6df0=function(_0x2e9ba4,_0x504371){_0x2e9ba4=_0x2e9ba4-0xa6;let _0x2f1f7e=_0x4a78c1[_0x2e9ba4];return _0x2f1f7e;},a106_0x6df0(_0x342888,_0x5dcf23);}const typedi_1=require('typedi'),errors_1=require(a106_0x427603(0xce)),core_1=require(a106_0x427603(0xca)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a106_0x427603(0xc9)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a106_0x427603(0xe5)),unauthorized_salesforce_error_1=require(a106_0x427603(0xaf)),constants_1=require(a106_0x427603(0xb2));function a106_0x2f1f(){const _0x1a4eda=['salesforseSettings','ERR_INVALID_SALESFORCE_TOKEN','InvalidRefreshTokenError','tokenType','instanceUrl','toString','design:paramtypes','forceUpdateToken','36lYjCNQ','(((.+)+)+)+$','__esModule','UnauthorizedSalesforceError','update\x20access\x20token','Error','accessToken','default','apply','error','decorate','258610StSXKG','../errors/unauthorized-salesforce.error','authState','SalesforceSettingsService','../../../constants','application/json','Service','services/data/','search','name','force\x20update\x20token','updateAccessToken','data','length','object','Updating','requestConfig','access_token','joinURL','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','__importDefault','AuthState','18365778sTOPHp','instance_url','settings','logger','update\x20access\x20token\x20failed:\x20%s','../../shared/utils','../../../core','889008kgrjcm','__decorate','/services/oauth2/token','../../../constants/errors','124481FOEBzW','log','SALESFORCE_API_VERSION','metadata','7791870yVRdpc','SalesforceAuthService','loginUrl','Idle','6MGhMpv','create\x20authorized\x20request\x20failed:\x20authorization\x20error','AUTH_WAIT_TIME','check\x20auth:\x20current\x20state\x20-\x20%s','Logger','sleep','2313628FHjXcj','getOwnPropertyDescriptor','message','post','setAuthDetails','then','response','defineProperty','../enums/auth-state.enum','4445424AknMHQ'];a106_0x2f1f=function(){return _0x1a4eda;};return a106_0x2f1f();}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4e73ec){const _0x5bf964=a106_0x427603;this[_0x5bf964(0xe7)]=_0x4e73ec,this['AUTH_WAIT_TIME']=0x1388,this[_0x5bf964(0xb0)]=auth_state_enum_1[_0x5bf964(0xc3)]['Idle'],this[_0x5bf964(0xc7)]=new core_1[(_0x5bf964(0xdb))](SalesforceAuthService_1[_0x5bf964(0xb7)]),this[_0x5bf964(0xe1)]();}get['settings'](){return this['salesforseSettings']['settings'];}async['setAuthDetails'](){const _0xce392=a106_0x427603;this['logger'][_0xce392(0xd0)](_0xce392(0xda),auth_state_enum_1[_0xce392(0xc3)][this[_0xce392(0xb0)]]);try{if(this[_0xce392(0xb0)]===auth_state_enum_1[_0xce392(0xc3)][_0xce392(0xa8)])return;if(this[_0xce392(0xb0)]===auth_state_enum_1[_0xce392(0xc3)][_0xce392(0xd6)])await this[_0xce392(0xb9)]();else{const _0x18b53c=await this[_0xce392(0xbe)](),_0x5ed9d9=await axios_1[_0xce392(0xaa)]['get'](_0xce392(0xb5)+constants_1[_0xce392(0xd1)],_0x18b53c)[_0xce392(0xe2)](()=>!![])['catch'](()=>![]);!_0x5ed9d9&&await this[_0xce392(0xb9)]();}}catch(_0x2501e5){}}async[a106_0x427603(0xb9)](){const _0x526dfa=a106_0x427603;var _0x5089e4,_0x1c9456,_0x2a505e;this[_0x526dfa(0xc7)]['log'](_0x526dfa(0xa7));try{this[_0x526dfa(0xb0)]=auth_state_enum_1['AuthState'][_0x526dfa(0xbd)];const {refreshToken:_0x2ae137,clientId:_0x1bedd0,clientSecret:_0xca3cb9}=this[_0x526dfa(0xc6)],{data:_0x45102e}=await axios_1[_0x526dfa(0xaa)][_0x526dfa(0xe0)]((0x0,utils_1[_0x526dfa(0xc0)])(this[_0x526dfa(0xe7)][_0x526dfa(0xd5)],_0x526dfa(0xcd)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x2ae137,'client_id':_0x1bedd0,'client_secret':_0xca3cb9}});this[_0x526dfa(0xeb)]=_0x45102e[_0x526dfa(0xc5)],this[_0x526dfa(0xa9)]=_0x45102e[_0x526dfa(0xbf)],this[_0x526dfa(0xea)]=_0x45102e['token_type'],this['authState']=auth_state_enum_1[_0x526dfa(0xc3)]['Active'],this[_0x526dfa(0xc7)][_0x526dfa(0xd0)]('access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0x207ea){const _0x49f6d3=((_0x1c9456=(_0x5089e4=_0x207ea===null||_0x207ea===void 0x0?void 0x0:_0x207ea[_0x526dfa(0xe3)])===null||_0x5089e4===void 0x0?void 0x0:_0x5089e4[_0x526dfa(0xba)])===null||_0x1c9456===void 0x0?void 0x0:_0x1c9456['error'])||((_0x2a505e=_0x207ea===null||_0x207ea===void 0x0?void 0x0:_0x207ea[_0x526dfa(0xe3)])===null||_0x2a505e===void 0x0?void 0x0:_0x2a505e[_0x526dfa(0xba)])||_0x207ea[_0x526dfa(0xdf)];this[_0x526dfa(0xc7)][_0x526dfa(0xac)](_0x526dfa(0xc8),_0x49f6d3),this['authState']=auth_state_enum_1[_0x526dfa(0xc3)][_0x526dfa(0xa8)];throw new invalid_refresh_token_error_1[(_0x526dfa(0xe9))](errors_1[_0x526dfa(0xe8)]);}}async[a106_0x427603(0xee)](){const _0x425168=a106_0x427603;this['logger'][_0x425168(0xd0)](_0x425168(0xb8));if(this[_0x425168(0xb0)]===auth_state_enum_1[_0x425168(0xc3)]['Updating']||this['authState']===auth_state_enum_1[_0x425168(0xc3)][_0x425168(0xd6)])return await(0x0,utils_1[_0x425168(0xdc)])(this['AUTH_WAIT_TIME']),this[_0x425168(0xee)]();if(this[_0x425168(0xb0)]===auth_state_enum_1[_0x425168(0xc3)][_0x425168(0xa8)])throw new invalid_refresh_token_error_1[(_0x425168(0xe9))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x425168(0xb9)]();}async[a106_0x427603(0xbe)](){const _0x41b1c1=a106_0x427603;if(this['authState']===auth_state_enum_1[_0x41b1c1(0xc3)]['Error']){this[_0x41b1c1(0xc7)][_0x41b1c1(0xd0)](_0x41b1c1(0xd8));throw new unauthorized_salesforce_error_1[(_0x41b1c1(0xa6))]();}if(this[_0x41b1c1(0xb0)]!==auth_state_enum_1['AuthState']['Active'])return this[_0x41b1c1(0xc7)]['log'](_0x41b1c1(0xc1)),await(0x0,utils_1[_0x41b1c1(0xdc)])(this[_0x41b1c1(0xd9)]),this[_0x41b1c1(0xbe)]();return{'baseURL':this[_0x41b1c1(0xeb)],'headers':{'accept':'application/json','content-type':_0x41b1c1(0xb3),'authorization':this['tokenType']+'\x20'+this[_0x41b1c1(0xa9)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a106_0x427603(0xb4)])(),__metadata(a106_0x427603(0xed),[salesforce_settings_service_1[a106_0x427603(0xb1)]])],SalesforceAuthService),exports[a106_0x427603(0xd4)]=SalesforceAuthService;