const a105_0x267d=['response','default','SALESFORCE_API_VERSION','__importDefault','ERR_INVALID_SALESFORCE_TOKEN','return\x20/\x22\x20+\x20this\x20+\x20\x22/','/services/oauth2/token','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','access_token','force\x20update\x20token','requestConfig','salesforseSettings','UnauthorizedSalesforceError','../errors/invalid-refresh-token.error','data','Error','Service','tokenType','134821goeAGf','__metadata','accessToken','token_type','Updating','229844KBYEfR','sleep','salesforce-auth-service','application/json','refresh_token','../../shared/utils','93691MWfcEw','InvalidRefreshTokenError','test','then','../../../constants/errors','Logger','authState','decorate','53730ZreYPb','constructor','update\x20access\x20token','update\x20access\x20token\x20failed:\x20%s','log','SalesforceSettingsService','message','Idle','post','55485LWwyOq','forceUpdateToken','127ggyIIw','AUTH_WAIT_TIME','length','__esModule','Active','2521NzgWWu','../errors/unauthorized-salesforce.error','updateAccessToken','getOwnPropertyDescriptor','defineProperty','settings','../../shared/services/salesforce-settings.service','instance_url','joinURL','../enums/auth-state.enum','error','SalesforceAuthService','instanceUrl','__decorate','265556FRbEOr','AuthState','apply','function','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','create\x20authorized\x20request\x20failed:\x20authorization\x20error','metadata','axios'];const a105_0xde9227=a105_0x1c77;(function(_0x3d783f,_0x27a7f8){const _0x418002=a105_0x1c77;while(!![]){try{const _0x462967=-parseInt(_0x418002(0xf5))+-parseInt(_0x418002(0xe2))*-parseInt(_0x418002(0xe7))+parseInt(_0x418002(0xcf))+parseInt(_0x418002(0xc9))+-parseInt(_0x418002(0xe0))+parseInt(_0x418002(0xd7))+-parseInt(_0x418002(0xc4));if(_0x462967===_0x27a7f8)break;else _0x3d783f['push'](_0x3d783f['shift']());}catch(_0x208478){_0x3d783f['push'](_0x3d783f['shift']());}}}(a105_0x267d,0x3afa2));const a105_0x5c93b6=function(){let _0x67d078=!![];return function(_0x3cd3d3,_0x510106){const _0x40f6ef=_0x67d078?function(){const _0x3b4d89=a105_0x1c77;if(_0x510106){const _0x5ebc2b=_0x510106[_0x3b4d89(0xf7)](_0x3cd3d3,arguments);return _0x510106=null,_0x5ebc2b;}}:function(){};return _0x67d078=![],_0x40f6ef;};}(),a105_0x46b76d=a105_0x5c93b6(this,function(){const _0x14c371=function(){const _0x3112b0=a105_0x1c77,_0x250fdb=_0x14c371[_0x3112b0(0xd8)](_0x3112b0(0x102))()[_0x3112b0(0xd8)](_0x3112b0(0x104));return!_0x250fdb[_0x3112b0(0xd1)](a105_0x46b76d);};return _0x14c371();});a105_0x46b76d();'use strict';var __decorate=this&&this[a105_0xde9227(0xf4)]||function(_0x3fcb52,_0x30db6a,_0x800dd3,_0x5be7dc){const _0x52cf0e=a105_0xde9227;var _0x1ac658=arguments['length'],_0x422f30=_0x1ac658<0x3?_0x30db6a:_0x5be7dc===null?_0x5be7dc=Object[_0x52cf0e(0xea)](_0x30db6a,_0x800dd3):_0x5be7dc,_0x104b59;if(typeof Reflect==='object'&&typeof Reflect[_0x52cf0e(0xd6)]===_0x52cf0e(0xf8))_0x422f30=Reflect[_0x52cf0e(0xd6)](_0x3fcb52,_0x30db6a,_0x800dd3,_0x5be7dc);else{for(var _0x4e3baa=_0x3fcb52[_0x52cf0e(0xe4)]-0x1;_0x4e3baa>=0x0;_0x4e3baa--)if(_0x104b59=_0x3fcb52[_0x4e3baa])_0x422f30=(_0x1ac658<0x3?_0x104b59(_0x422f30):_0x1ac658>0x3?_0x104b59(_0x30db6a,_0x800dd3,_0x422f30):_0x104b59(_0x30db6a,_0x800dd3))||_0x422f30;}return _0x1ac658>0x3&&_0x422f30&&Object[_0x52cf0e(0xeb)](_0x30db6a,_0x800dd3,_0x422f30),_0x422f30;},__metadata=this&&this[a105_0xde9227(0xc5)]||function(_0x504403,_0x1ca2b3){const _0x37b729=a105_0xde9227;if(typeof Reflect==='object'&&typeof Reflect[_0x37b729(0xfb)]===_0x37b729(0xf8))return Reflect[_0x37b729(0xfb)](_0x504403,_0x1ca2b3);},__importDefault=this&&this[a105_0xde9227(0x100)]||function(_0x207490){return _0x207490&&_0x207490['__esModule']?_0x207490:{'default':_0x207490};};Object[a105_0xde9227(0xeb)](exports,a105_0xde9227(0xe5),{'value':!![]}),exports[a105_0xde9227(0xf2)]=void 0x0;const typedi_1=require('typedi'),errors_1=require(a105_0xde9227(0xd3)),core_1=require('../../../core'),salesforce_settings_service_1=require(a105_0xde9227(0xed)),axios_1=__importDefault(require(a105_0xde9227(0xfc))),utils_1=require(a105_0xde9227(0xce)),invalid_refresh_token_error_1=require(a105_0xde9227(0x10a)),auth_state_enum_1=require(a105_0xde9227(0xf0)),unauthorized_salesforce_error_1=require(a105_0xde9227(0xe8)),constants_1=require('../../../constants'),logger=new core_1[(a105_0xde9227(0xd4))](a105_0xde9227(0xcb));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x1e27be){const _0x3ab5b8=a105_0xde9227;this[_0x3ab5b8(0x108)]=_0x1e27be,this[_0x3ab5b8(0xe3)]=0x1388,this[_0x3ab5b8(0xd5)]=auth_state_enum_1['AuthState']['Idle'],this['setAuthDetails']();}get[a105_0xde9227(0xec)](){const _0x49900f=a105_0xde9227;return this[_0x49900f(0x108)]['settings'];}async['setAuthDetails'](){const _0x1b6806=a105_0xde9227;logger[_0x1b6806(0xdb)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x1b6806(0xd5)]]);try{if(this[_0x1b6806(0xd5)]===auth_state_enum_1[_0x1b6806(0xf6)][_0x1b6806(0x10c)])return;if(this['authState']===auth_state_enum_1[_0x1b6806(0xf6)]['Idle'])await this['updateAccessToken']();else{const _0x5a68d6=await this[_0x1b6806(0x107)](),_0x21a741=await axios_1[_0x1b6806(0xfe)]['get']('services/data/'+constants_1[_0x1b6806(0xff)],_0x5a68d6)[_0x1b6806(0xd2)](()=>!![])['catch'](()=>![]);!_0x21a741&&await this['updateAccessToken']();}}catch(_0x11bacc){}}async[a105_0xde9227(0xe9)](){const _0x174372=a105_0xde9227;var _0x2b73a5,_0xf71916,_0x439031;logger['log'](_0x174372(0xd9));try{this[_0x174372(0xd5)]=auth_state_enum_1[_0x174372(0xf6)][_0x174372(0xc8)];const {refreshToken:_0x1604d3,clientId:_0x31a524,clientSecret:_0x1ff467}=this[_0x174372(0xec)],{data:_0x424f20}=await axios_1[_0x174372(0xfe)][_0x174372(0xdf)](utils_1[_0x174372(0xef)](this['salesforseSettings']['loginUrl'],_0x174372(0x103)),null,{'params':{'grant_type':_0x174372(0xcd),'refresh_token':_0x1604d3,'client_id':_0x31a524,'client_secret':_0x1ff467}});this[_0x174372(0xf3)]=_0x424f20[_0x174372(0xee)],this[_0x174372(0xc6)]=_0x424f20[_0x174372(0x105)],this[_0x174372(0x10e)]=_0x424f20[_0x174372(0xc7)],this['authState']=auth_state_enum_1['AuthState'][_0x174372(0xe6)],logger[_0x174372(0xdb)]('access\x20token\x20updated\x20for\x20%s',this[_0x174372(0xf3)]);}catch(_0x5a1362){const _0xce45aa=((_0xf71916=(_0x2b73a5=_0x5a1362===null||_0x5a1362===void 0x0?void 0x0:_0x5a1362[_0x174372(0xfd)])===null||_0x2b73a5===void 0x0?void 0x0:_0x2b73a5[_0x174372(0x10b)])===null||_0xf71916===void 0x0?void 0x0:_0xf71916[_0x174372(0xf1)])||((_0x439031=_0x5a1362===null||_0x5a1362===void 0x0?void 0x0:_0x5a1362[_0x174372(0xfd)])===null||_0x439031===void 0x0?void 0x0:_0x439031[_0x174372(0x10b)])||_0x5a1362[_0x174372(0xdd)];logger[_0x174372(0xf1)](_0x174372(0xda),_0xce45aa),this[_0x174372(0xd5)]=auth_state_enum_1[_0x174372(0xf6)]['Error'];throw new invalid_refresh_token_error_1[(_0x174372(0xd0))](errors_1[_0x174372(0x101)]);}}async[a105_0xde9227(0xe1)](){const _0x2d62be=a105_0xde9227;logger[_0x2d62be(0xdb)](_0x2d62be(0x106));if(this['authState']===auth_state_enum_1[_0x2d62be(0xf6)]['Updating']||this[_0x2d62be(0xd5)]===auth_state_enum_1['AuthState'][_0x2d62be(0xde)])return await utils_1[_0x2d62be(0xca)](this[_0x2d62be(0xe3)]),this[_0x2d62be(0xe1)]();if(this[_0x2d62be(0xd5)]===auth_state_enum_1['AuthState']['Error'])throw new invalid_refresh_token_error_1[(_0x2d62be(0xd0))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x2d62be(0xe9)]();}async[a105_0xde9227(0x107)](){const _0x468bde=a105_0xde9227;if(this['authState']===auth_state_enum_1[_0x468bde(0xf6)]['Error']){logger['log'](_0x468bde(0xfa));throw new unauthorized_salesforce_error_1[(_0x468bde(0x109))]();}if(this[_0x468bde(0xd5)]!==auth_state_enum_1[_0x468bde(0xf6)][_0x468bde(0xe6)])return logger[_0x468bde(0xdb)](_0x468bde(0xf9)),await utils_1['sleep'](this[_0x468bde(0xe3)]),this[_0x468bde(0x107)]();return{'baseURL':this[_0x468bde(0xf3)],'headers':{'accept':_0x468bde(0xcc),'content-type':_0x468bde(0xcc),'authorization':this[_0x468bde(0x10e)]+'\x20'+this[_0x468bde(0xc6)]}};}};function a105_0x1c77(_0x3c75cf,_0x4d970e){return a105_0x1c77=function(_0x4a7dca,_0x46b76d){_0x4a7dca=_0x4a7dca-0xc4;let _0x5c93b6=a105_0x267d[_0x4a7dca];return _0x5c93b6;},a105_0x1c77(_0x3c75cf,_0x4d970e);}SalesforceAuthService=__decorate([typedi_1[a105_0xde9227(0x10d)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a105_0xde9227(0xdc)]])],SalesforceAuthService),exports[a105_0xde9227(0xf2)]=SalesforceAuthService;