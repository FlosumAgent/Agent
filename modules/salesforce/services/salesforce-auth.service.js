const a107_0x5d641d=a107_0x2992;(function(_0x5410d2,_0x29614b){const _0x23e188=a107_0x2992,_0x29e47d=_0x5410d2();while(!![]){try{const _0xd55428=-parseInt(_0x23e188(0x13c))/0x1+parseInt(_0x23e188(0x136))/0x2+parseInt(_0x23e188(0x147))/0x3*(-parseInt(_0x23e188(0x127))/0x4)+-parseInt(_0x23e188(0x16a))/0x5*(-parseInt(_0x23e188(0x158))/0x6)+-parseInt(_0x23e188(0x14d))/0x7+parseInt(_0x23e188(0x148))/0x8*(-parseInt(_0x23e188(0x169))/0x9)+-parseInt(_0x23e188(0x16f))/0xa*(-parseInt(_0x23e188(0x13a))/0xb);if(_0xd55428===_0x29614b)break;else _0x29e47d['push'](_0x29e47d['shift']());}catch(_0x2076a9){_0x29e47d['push'](_0x29e47d['shift']());}}}(a107_0x3e2f,0x4de52));const a107_0x4ef168=function(){let _0x159bf5=!![];return function(_0x18adc8,_0x300a8a){const _0x4a6ef6=_0x159bf5?function(){const _0x14f6ca=a107_0x2992;if(_0x300a8a){const _0x24d6fc=_0x300a8a[_0x14f6ca(0x12b)](_0x18adc8,arguments);return _0x300a8a=null,_0x24d6fc;}}:function(){};return _0x159bf5=![],_0x4a6ef6;};}(),a107_0x50c211=a107_0x4ef168(this,function(){const _0x323cad=a107_0x2992;return a107_0x50c211['toString']()[_0x323cad(0x150)](_0x323cad(0x135))[_0x323cad(0x13f)]()[_0x323cad(0x154)](a107_0x50c211)[_0x323cad(0x150)](_0x323cad(0x135));});a107_0x50c211();'use strict';var __decorate=this&&this[a107_0x5d641d(0x14f)]||function(_0x46b804,_0x51c0d6,_0xacc2d9,_0x5d140f){const _0x2e2fdf=a107_0x5d641d;var _0x19e378=arguments[_0x2e2fdf(0x16e)],_0x2d6f3c=_0x19e378<0x3?_0x51c0d6:_0x5d140f===null?_0x5d140f=Object[_0x2e2fdf(0x139)](_0x51c0d6,_0xacc2d9):_0x5d140f,_0x10fa0d;if(typeof Reflect===_0x2e2fdf(0x15e)&&typeof Reflect['decorate']===_0x2e2fdf(0x146))_0x2d6f3c=Reflect[_0x2e2fdf(0x160)](_0x46b804,_0x51c0d6,_0xacc2d9,_0x5d140f);else{for(var _0x5b922c=_0x46b804[_0x2e2fdf(0x16e)]-0x1;_0x5b922c>=0x0;_0x5b922c--)if(_0x10fa0d=_0x46b804[_0x5b922c])_0x2d6f3c=(_0x19e378<0x3?_0x10fa0d(_0x2d6f3c):_0x19e378>0x3?_0x10fa0d(_0x51c0d6,_0xacc2d9,_0x2d6f3c):_0x10fa0d(_0x51c0d6,_0xacc2d9))||_0x2d6f3c;}return _0x19e378>0x3&&_0x2d6f3c&&Object[_0x2e2fdf(0x134)](_0x51c0d6,_0xacc2d9,_0x2d6f3c),_0x2d6f3c;},__metadata=this&&this[a107_0x5d641d(0x16c)]||function(_0x22b08b,_0x52e7ff){const _0x4dc0d1=a107_0x5d641d;if(typeof Reflect===_0x4dc0d1(0x15e)&&typeof Reflect[_0x4dc0d1(0x142)]==='function')return Reflect['metadata'](_0x22b08b,_0x52e7ff);},__importDefault=this&&this[a107_0x5d641d(0x15f)]||function(_0x846fe6){const _0x2459c3=a107_0x5d641d;return _0x846fe6&&_0x846fe6[_0x2459c3(0x143)]?_0x846fe6:{'default':_0x846fe6};},SalesforceAuthService_1;function a107_0x2992(_0x326457,_0xb90665){const _0x39f054=a107_0x3e2f();return a107_0x2992=function(_0x50c211,_0x4ef168){_0x50c211=_0x50c211-0x123;let _0x3e2f44=_0x39f054[_0x50c211];return _0x3e2f44;},a107_0x2992(_0x326457,_0xb90665);}function a107_0x3e2f(){const _0x3168fa=['__esModule','catch','default','function','227901IFFGmp','3803432GXJNgW','then','SalesforceSettingsService','../enums/auth-state.enum','accessToken','2614318ctjTST','typedi','__decorate','search','Logger','update\x20access\x20token','logger','constructor','name','services/data/','update\x20access\x20token\x20failed:\x20%s','24QxzEPQ','refresh_token','access\x20token\x20updated\x20for\x20%s','instance_url','forceUpdateToken','settings','object','__importDefault','decorate','Active','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','Updating','design:paramtypes','salesforseSettings','../../shared/services/salesforce-settings.service','AuthState','log','9TMrBNr','59285jQNgwe','updateAccessToken','__metadata','sleep','length','176500dmByCq','tokenType','../../../core','ERR_INVALID_SALESFORCE_TOKEN','response','InvalidRefreshTokenError','get','8RuSiBs','token_type','instanceUrl','/services/oauth2/token','apply','../errors/unauthorized-salesforce.error','SalesforceAuthService','Idle','create\x20authorized\x20request\x20failed:\x20authorization\x20error','application/json','Error','../errors/invalid-refresh-token.error','joinURL','defineProperty','(((.+)+)+)+$','922454LSMXRX','../../shared/utils','setAuthDetails','getOwnPropertyDescriptor','825AaLDly','AUTH_WAIT_TIME','512510npuIpq','post','requestConfig','toString','authState','Service','metadata'];a107_0x3e2f=function(){return _0x3168fa;};return a107_0x3e2f();}Object[a107_0x5d641d(0x134)](exports,a107_0x5d641d(0x143),{'value':!![]}),exports[a107_0x5d641d(0x12d)]=void 0x0;const typedi_1=require(a107_0x5d641d(0x14e)),errors_1=require('../../../constants/errors'),core_1=require(a107_0x5d641d(0x171)),salesforce_settings_service_1=require(a107_0x5d641d(0x166)),axios_1=__importDefault(require('axios')),utils_1=require(a107_0x5d641d(0x137)),invalid_refresh_token_error_1=require(a107_0x5d641d(0x132)),auth_state_enum_1=require(a107_0x5d641d(0x14b)),unauthorized_salesforce_error_1=require(a107_0x5d641d(0x12c)),constants_1=require('../../../constants');let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x22ba91){const _0x3e69ef=a107_0x5d641d;this[_0x3e69ef(0x165)]=_0x22ba91,this[_0x3e69ef(0x13b)]=0x1388,this[_0x3e69ef(0x140)]=auth_state_enum_1[_0x3e69ef(0x167)]['Idle'],this['logger']=new core_1[(_0x3e69ef(0x151))](SalesforceAuthService_1[_0x3e69ef(0x155)]),this[_0x3e69ef(0x138)]();}get[a107_0x5d641d(0x15d)](){const _0x37be6a=a107_0x5d641d;return this[_0x37be6a(0x165)][_0x37be6a(0x15d)];}async['setAuthDetails'](){const _0x56802d=a107_0x5d641d;this[_0x56802d(0x153)]['log']('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this[_0x56802d(0x140)]]);try{if(this[_0x56802d(0x140)]===auth_state_enum_1['AuthState']['Error'])return;if(this['authState']===auth_state_enum_1['AuthState'][_0x56802d(0x12e)])await this[_0x56802d(0x16b)]();else{const _0x1de48a=await this[_0x56802d(0x13e)](),_0x4c47ec=await axios_1[_0x56802d(0x145)][_0x56802d(0x126)](_0x56802d(0x156)+constants_1['SALESFORCE_API_VERSION'],_0x1de48a)[_0x56802d(0x149)](()=>!![])[_0x56802d(0x144)](()=>![]);!_0x4c47ec&&await this['updateAccessToken']();}}catch(_0x3b1171){}}async[a107_0x5d641d(0x16b)](){const _0x2c4d90=a107_0x5d641d;var _0x20603d,_0x152c8d,_0x264ed8;this['logger'][_0x2c4d90(0x168)](_0x2c4d90(0x152));try{this[_0x2c4d90(0x140)]=auth_state_enum_1[_0x2c4d90(0x167)][_0x2c4d90(0x163)];const {refreshToken:_0x37c3d3,clientId:_0x53a0a0,clientSecret:_0x399453}=this[_0x2c4d90(0x15d)],{data:_0x3da6a2}=await axios_1[_0x2c4d90(0x145)][_0x2c4d90(0x13d)]((0x0,utils_1[_0x2c4d90(0x133)])(this['salesforseSettings']['loginUrl'],_0x2c4d90(0x12a)),null,{'params':{'grant_type':_0x2c4d90(0x159),'refresh_token':_0x37c3d3,'client_id':_0x53a0a0,'client_secret':_0x399453}});this['instanceUrl']=_0x3da6a2[_0x2c4d90(0x15b)],this[_0x2c4d90(0x14c)]=_0x3da6a2['access_token'],this[_0x2c4d90(0x170)]=_0x3da6a2[_0x2c4d90(0x128)],this['authState']=auth_state_enum_1[_0x2c4d90(0x167)]['Active'],this[_0x2c4d90(0x153)][_0x2c4d90(0x168)](_0x2c4d90(0x15a),this[_0x2c4d90(0x129)]);}catch(_0x127825){const _0x4d1db6=((_0x152c8d=(_0x20603d=_0x127825===null||_0x127825===void 0x0?void 0x0:_0x127825[_0x2c4d90(0x124)])===null||_0x20603d===void 0x0?void 0x0:_0x20603d['data'])===null||_0x152c8d===void 0x0?void 0x0:_0x152c8d['error'])||((_0x264ed8=_0x127825===null||_0x127825===void 0x0?void 0x0:_0x127825['response'])===null||_0x264ed8===void 0x0?void 0x0:_0x264ed8['data'])||_0x127825['message'];this[_0x2c4d90(0x153)]['error'](_0x2c4d90(0x157),_0x4d1db6),this[_0x2c4d90(0x140)]=auth_state_enum_1[_0x2c4d90(0x167)][_0x2c4d90(0x131)];throw new invalid_refresh_token_error_1[(_0x2c4d90(0x125))](errors_1[_0x2c4d90(0x123)]);}}async[a107_0x5d641d(0x15c)](){const _0x49ba3e=a107_0x5d641d;this[_0x49ba3e(0x153)][_0x49ba3e(0x168)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x49ba3e(0x167)][_0x49ba3e(0x163)]||this['authState']===auth_state_enum_1[_0x49ba3e(0x167)][_0x49ba3e(0x12e)])return await(0x0,utils_1[_0x49ba3e(0x16d)])(this['AUTH_WAIT_TIME']),this[_0x49ba3e(0x15c)]();if(this[_0x49ba3e(0x140)]===auth_state_enum_1[_0x49ba3e(0x167)][_0x49ba3e(0x131)])throw new invalid_refresh_token_error_1[(_0x49ba3e(0x125))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);await this[_0x49ba3e(0x16b)]();}async[a107_0x5d641d(0x13e)](){const _0x210b9b=a107_0x5d641d;if(this[_0x210b9b(0x140)]===auth_state_enum_1['AuthState'][_0x210b9b(0x131)]){this[_0x210b9b(0x153)][_0x210b9b(0x168)](_0x210b9b(0x12f));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x210b9b(0x140)]!==auth_state_enum_1[_0x210b9b(0x167)][_0x210b9b(0x161)])return this['logger'][_0x210b9b(0x168)](_0x210b9b(0x162)),await(0x0,utils_1[_0x210b9b(0x16d)])(this[_0x210b9b(0x13b)]),this[_0x210b9b(0x13e)]();return{'baseURL':this[_0x210b9b(0x129)],'headers':{'accept':_0x210b9b(0x130),'content-type':_0x210b9b(0x130),'authorization':this[_0x210b9b(0x170)]+'\x20'+this[_0x210b9b(0x14c)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a107_0x5d641d(0x141)])(),__metadata(a107_0x5d641d(0x164),[salesforce_settings_service_1[a107_0x5d641d(0x14a)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;