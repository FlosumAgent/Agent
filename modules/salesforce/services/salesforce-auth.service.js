function a107_0x362f(_0x1f8511,_0x1cc96e){const _0x1694a8=a107_0x33a2();return a107_0x362f=function(_0x73e85,_0x27b5d9){_0x73e85=_0x73e85-0x176;let _0x33a259=_0x1694a8[_0x73e85];return _0x33a259;},a107_0x362f(_0x1f8511,_0x1cc96e);}const a107_0x326dc2=a107_0x362f;(function(_0x106da7,_0x273303){const _0x532cc8=a107_0x362f,_0x4560c7=_0x106da7();while(!![]){try{const _0x478430=-parseInt(_0x532cc8(0x1bf))/0x1+-parseInt(_0x532cc8(0x1b7))/0x2*(parseInt(_0x532cc8(0x19c))/0x3)+parseInt(_0x532cc8(0x1b5))/0x4+-parseInt(_0x532cc8(0x182))/0x5+-parseInt(_0x532cc8(0x19b))/0x6+parseInt(_0x532cc8(0x196))/0x7+-parseInt(_0x532cc8(0x1a9))/0x8*(-parseInt(_0x532cc8(0x195))/0x9);if(_0x478430===_0x273303)break;else _0x4560c7['push'](_0x4560c7['shift']());}catch(_0x4b46bf){_0x4560c7['push'](_0x4560c7['shift']());}}}(a107_0x33a2,0x947ad));const a107_0x27b5d9=function(){let _0x163a68=!![];return function(_0xf81045,_0x41c2dc){const _0x362e85=_0x163a68?function(){const _0x4d72c3=a107_0x362f;if(_0x41c2dc){const _0x296646=_0x41c2dc[_0x4d72c3(0x190)](_0xf81045,arguments);return _0x41c2dc=null,_0x296646;}}:function(){};return _0x163a68=![],_0x362e85;};}(),a107_0x73e85=a107_0x27b5d9(this,function(){const _0x46391a=a107_0x362f;return a107_0x73e85[_0x46391a(0x1c0)]()[_0x46391a(0x192)](_0x46391a(0x1bd))[_0x46391a(0x1c0)]()[_0x46391a(0x181)](a107_0x73e85)[_0x46391a(0x192)](_0x46391a(0x1bd));});a107_0x73e85();'use strict';var __decorate=this&&this[a107_0x326dc2(0x198)]||function(_0xefcdb5,_0x4ea719,_0x55cbe3,_0x5d11c8){const _0x4b75b0=a107_0x326dc2;var _0x3deb03=arguments['length'],_0x444987=_0x3deb03<0x3?_0x4ea719:_0x5d11c8===null?_0x5d11c8=Object[_0x4b75b0(0x179)](_0x4ea719,_0x55cbe3):_0x5d11c8,_0x1eb476;if(typeof Reflect==='object'&&typeof Reflect[_0x4b75b0(0x17f)]===_0x4b75b0(0x18c))_0x444987=Reflect[_0x4b75b0(0x17f)](_0xefcdb5,_0x4ea719,_0x55cbe3,_0x5d11c8);else{for(var _0x5f0094=_0xefcdb5[_0x4b75b0(0x1ad)]-0x1;_0x5f0094>=0x0;_0x5f0094--)if(_0x1eb476=_0xefcdb5[_0x5f0094])_0x444987=(_0x3deb03<0x3?_0x1eb476(_0x444987):_0x3deb03>0x3?_0x1eb476(_0x4ea719,_0x55cbe3,_0x444987):_0x1eb476(_0x4ea719,_0x55cbe3))||_0x444987;}return _0x3deb03>0x3&&_0x444987&&Object[_0x4b75b0(0x1b4)](_0x4ea719,_0x55cbe3,_0x444987),_0x444987;},__metadata=this&&this[a107_0x326dc2(0x176)]||function(_0x85c7dd,_0x7600bc){const _0x3f5b92=a107_0x326dc2;if(typeof Reflect===_0x3f5b92(0x191)&&typeof Reflect[_0x3f5b92(0x1b2)]===_0x3f5b92(0x18c))return Reflect[_0x3f5b92(0x1b2)](_0x85c7dd,_0x7600bc);},__importDefault=this&&this[a107_0x326dc2(0x185)]||function(_0x3049d2){const _0x59ecb0=a107_0x326dc2;return _0x3049d2&&_0x3049d2[_0x59ecb0(0x178)]?_0x3049d2:{'default':_0x3049d2};},SalesforceAuthService_1;Object[a107_0x326dc2(0x1b4)](exports,a107_0x326dc2(0x178),{'value':!![]}),exports['SalesforceAuthService']=void 0x0;const typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),core_1=require(a107_0x326dc2(0x1aa)),salesforce_settings_service_1=require(a107_0x326dc2(0x1c4)),axios_1=__importDefault(require(a107_0x326dc2(0x18d))),utils_1=require(a107_0x326dc2(0x19f)),invalid_refresh_token_error_1=require(a107_0x326dc2(0x177)),auth_state_enum_1=require(a107_0x326dc2(0x18b)),unauthorized_salesforce_error_1=require(a107_0x326dc2(0x1a3)),constants_1=require(a107_0x326dc2(0x197));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x4365d2){const _0x16ec02=a107_0x326dc2;this[_0x16ec02(0x1be)]=_0x4365d2,this[_0x16ec02(0x18a)]=0x1388,this['authState']=auth_state_enum_1['AuthState'][_0x16ec02(0x1b9)],this[_0x16ec02(0x194)]=new core_1[(_0x16ec02(0x199))](SalesforceAuthService_1['name']),this[_0x16ec02(0x19d)]();}get[a107_0x326dc2(0x1bb)](){const _0x5074c3=a107_0x326dc2;return this[_0x5074c3(0x1be)][_0x5074c3(0x1bb)];}async['setAuthDetails'](){const _0x378827=a107_0x326dc2;this[_0x378827(0x194)][_0x378827(0x1a4)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1[_0x378827(0x1ac)][this[_0x378827(0x1ae)]]);try{if(this[_0x378827(0x1ae)]===auth_state_enum_1[_0x378827(0x1ac)][_0x378827(0x1a5)])return;if(this[_0x378827(0x1ae)]===auth_state_enum_1[_0x378827(0x1ac)][_0x378827(0x1b9)])await this['updateAccessToken']();else{const _0xdcbb5=await this[_0x378827(0x1a6)](),_0x3c4f78=await axios_1[_0x378827(0x1c2)][_0x378827(0x17a)](_0x378827(0x1ba)+constants_1[_0x378827(0x1af)],_0xdcbb5)['then'](()=>!![])['catch'](()=>![]);!_0x3c4f78&&await this[_0x378827(0x188)]();}}catch(_0x541a39){}}async['updateAccessToken'](){const _0xf1d36d=a107_0x326dc2;var _0x86d7d2,_0x3e3958,_0x3d4396;this[_0xf1d36d(0x194)][_0xf1d36d(0x1a4)]('update\x20access\x20token');try{this[_0xf1d36d(0x1ae)]=auth_state_enum_1['AuthState']['Updating'];const {refreshToken:_0x54b926,clientId:_0x5b863d,clientSecret:_0x11f47e}=this[_0xf1d36d(0x1bb)],{data:_0x585b91}=await axios_1[_0xf1d36d(0x1c2)][_0xf1d36d(0x18f)]((0x0,utils_1[_0xf1d36d(0x1a0)])(this[_0xf1d36d(0x1be)][_0xf1d36d(0x184)],'/services/oauth2/token'),null,{'params':{'grant_type':_0xf1d36d(0x19e),'refresh_token':_0x54b926,'client_id':_0x5b863d,'client_secret':_0x11f47e}});this[_0xf1d36d(0x1a2)]=_0x585b91[_0xf1d36d(0x186)],this[_0xf1d36d(0x183)]=_0x585b91[_0xf1d36d(0x180)],this[_0xf1d36d(0x1a7)]=_0x585b91[_0xf1d36d(0x1b1)],this[_0xf1d36d(0x1ae)]=auth_state_enum_1[_0xf1d36d(0x1ac)][_0xf1d36d(0x17b)],this['logger']['log']('access\x20token\x20updated\x20for\x20%s',this['instanceUrl']);}catch(_0x45e097){const _0xf6fcb4=((_0x3e3958=(_0x86d7d2=_0x45e097===null||_0x45e097===void 0x0?void 0x0:_0x45e097['response'])===null||_0x86d7d2===void 0x0?void 0x0:_0x86d7d2[_0xf1d36d(0x1b0)])===null||_0x3e3958===void 0x0?void 0x0:_0x3e3958[_0xf1d36d(0x1c3)])||((_0x3d4396=_0x45e097===null||_0x45e097===void 0x0?void 0x0:_0x45e097[_0xf1d36d(0x1c1)])===null||_0x3d4396===void 0x0?void 0x0:_0x3d4396[_0xf1d36d(0x1b0)])||_0x45e097[_0xf1d36d(0x19a)];this[_0xf1d36d(0x194)][_0xf1d36d(0x1c3)](_0xf1d36d(0x1b6),_0xf6fcb4),this[_0xf1d36d(0x1ae)]=auth_state_enum_1[_0xf1d36d(0x1ac)][_0xf1d36d(0x1a5)];throw new invalid_refresh_token_error_1[(_0xf1d36d(0x1ab))](errors_1[_0xf1d36d(0x1b3)]);}}async[a107_0x326dc2(0x193)](){const _0x5c3b31=a107_0x326dc2;this['logger']['log'](_0x5c3b31(0x187));if(this['authState']===auth_state_enum_1[_0x5c3b31(0x1ac)][_0x5c3b31(0x1bc)]||this[_0x5c3b31(0x1ae)]===auth_state_enum_1['AuthState']['Idle'])return await(0x0,utils_1[_0x5c3b31(0x189)])(this[_0x5c3b31(0x18a)]),this[_0x5c3b31(0x193)]();if(this[_0x5c3b31(0x1ae)]===auth_state_enum_1['AuthState'][_0x5c3b31(0x1a5)])throw new invalid_refresh_token_error_1[(_0x5c3b31(0x1ab))](errors_1[_0x5c3b31(0x1b3)]);await this[_0x5c3b31(0x188)]();}async[a107_0x326dc2(0x1a6)](){const _0x513ec7=a107_0x326dc2;if(this['authState']===auth_state_enum_1[_0x513ec7(0x1ac)][_0x513ec7(0x1a5)]){this[_0x513ec7(0x194)][_0x513ec7(0x1a4)](_0x513ec7(0x18e));throw new unauthorized_salesforce_error_1[(_0x513ec7(0x1a8))]();}if(this[_0x513ec7(0x1ae)]!==auth_state_enum_1[_0x513ec7(0x1ac)][_0x513ec7(0x17b)])return this['logger'][_0x513ec7(0x1a4)](_0x513ec7(0x17d)),await(0x0,utils_1[_0x513ec7(0x189)])(this['AUTH_WAIT_TIME']),this[_0x513ec7(0x1a6)]();return{'baseURL':this['instanceUrl'],'headers':{'accept':_0x513ec7(0x17e),'content-type':_0x513ec7(0x17e),'authorization':this[_0x513ec7(0x1a7)]+'\x20'+this[_0x513ec7(0x183)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1[a107_0x326dc2(0x17c)])(),__metadata(a107_0x326dc2(0x1b8),[salesforce_settings_service_1[a107_0x326dc2(0x1a1)]])],SalesforceAuthService),exports['SalesforceAuthService']=SalesforceAuthService;function a107_0x33a2(){const _0xcf3da6=['UnauthorizedSalesforceError','8hYRwfl','../../../core','InvalidRefreshTokenError','AuthState','length','authState','SALESFORCE_API_VERSION','data','token_type','metadata','ERR_INVALID_SALESFORCE_TOKEN','defineProperty','4566696ofNFvf','update\x20access\x20token\x20failed:\x20%s','6rDCYvK','design:paramtypes','Idle','services/data/','settings','Updating','(((.+)+)+)+$','salesforseSettings','970927eEjHrx','toString','response','default','error','../../shared/services/salesforce-settings.service','__metadata','../errors/invalid-refresh-token.error','__esModule','getOwnPropertyDescriptor','get','Active','Service','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','application/json','decorate','access_token','constructor','4097020xFoDMy','accessToken','loginUrl','__importDefault','instance_url','force\x20update\x20token','updateAccessToken','sleep','AUTH_WAIT_TIME','../enums/auth-state.enum','function','axios','create\x20authorized\x20request\x20failed:\x20authorization\x20error','post','apply','object','search','forceUpdateToken','logger','8096994sgLDLm','8307663FZxaQb','../../../constants','__decorate','Logger','message','4969644iKBuiR','1371SoMrtR','setAuthDetails','refresh_token','../../shared/utils','joinURL','SalesforceSettingsService','instanceUrl','../errors/unauthorized-salesforce.error','log','Error','requestConfig','tokenType'];a107_0x33a2=function(){return _0xcf3da6;};return a107_0x33a2();}