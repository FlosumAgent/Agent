const a106_0x41c7=['constructor','2Jltxqm','metadata','164692CttXjr','application/json','../errors/unauthorized-salesforce.error','InvalidRefreshTokenError','return\x20/\x22\x20+\x20this\x20+\x20\x22/','92343QsPczn','logger','apply','1qVBbhh','access\x20token\x20updated\x20for\x20%s','check\x20auth:\x20current\x20state\x20-\x20%s','token_type','1057580UyeRvS','authState','../../shared/utils','SALESFORCE_API_VERSION','ERR_INVALID_SALESFORCE_TOKEN','../../shared/services/salesforce-settings.service','response','access_token','sleep','get','then','update\x20access\x20token','default','1183921JuVhAP','getOwnPropertyDescriptor','Idle','typedi','refresh_token','4bVtYma','settings','defineProperty','requestConfig','../../../constants','function','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','747181RWMkbR','salesforseSettings','log','/services/oauth2/token','232876dOlzsX','Error','AUTH_WAIT_TIME','updateAccessToken','data','object','__decorate','__importDefault','Updating','decorate','__metadata','UnauthorizedSalesforceError','post','../enums/auth-state.enum','SalesforceAuthService','services/data/','Logger','AuthState','instanceUrl','Active','catch','name','tokenType','__esModule','error','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../../../core','forceUpdateToken','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','update\x20access\x20token\x20failed:\x20%s','../../../constants/errors','1001030VtjhJB','test','1pCnWNA'];const a106_0x120318=a106_0x5305;(function(_0x228fb6,_0x25bf3e){const _0x24016a=a106_0x5305;while(!![]){try{const _0x55b204=parseInt(_0x24016a(0x76))*-parseInt(_0x24016a(0x72))+-parseInt(_0x24016a(0x8f))*parseInt(_0x24016a(0xb4))+parseInt(_0x24016a(0xb6))*-parseInt(_0x24016a(0xb8))+parseInt(_0x24016a(0x88))*parseInt(_0x24016a(0x6f))+parseInt(_0x24016a(0xb2))+parseInt(_0x24016a(0x83))+parseInt(_0x24016a(0x93));if(_0x55b204===_0x25bf3e)break;else _0x228fb6['push'](_0x228fb6['shift']());}catch(_0x17d285){_0x228fb6['push'](_0x228fb6['shift']());}}}(a106_0x41c7,0x9f6fe));const a106_0x4bede2=function(){let _0x5a6981=!![];return function(_0x42e8f6,_0x57f9af){const _0x152c56=_0x5a6981?function(){const _0x3b1f14=a106_0x5305;if(_0x57f9af){const _0x1eef41=_0x57f9af[_0x3b1f14(0x71)](_0x42e8f6,arguments);return _0x57f9af=null,_0x1eef41;}}:function(){};return _0x5a6981=![],_0x152c56;};}(),a106_0xafc72=a106_0x4bede2(this,function(){const _0x1d9593=function(){const _0x20a567=a106_0x5305,_0x20f851=_0x1d9593[_0x20a567(0xb5)](_0x20a567(0x6e))()[_0x20a567(0xb5)](_0x20a567(0xaf));return!_0x20f851[_0x20a567(0xb3)](a106_0xafc72);};return _0x1d9593();});a106_0xafc72();function a106_0x5305(_0x3902bf,_0x226c67){return a106_0x5305=function(_0x11abfc,_0xafc72){_0x11abfc=_0x11abfc-0x6d;let _0x4bede2=a106_0x41c7[_0x11abfc];return _0x4bede2;},a106_0x5305(_0x3902bf,_0x226c67);}'use strict';var __decorate=this&&this[a106_0x120318(0x99)]||function(_0x21edd3,_0x3235cb,_0x43250,_0x3816f2){const _0x3c84f9=a106_0x120318;var _0x34c639=arguments['length'],_0x1ad23d=_0x34c639<0x3?_0x3235cb:_0x3816f2===null?_0x3816f2=Object[_0x3c84f9(0x84)](_0x3235cb,_0x43250):_0x3816f2,_0x2559b9;if(typeof Reflect==='object'&&typeof Reflect[_0x3c84f9(0x9c)]==='function')_0x1ad23d=Reflect[_0x3c84f9(0x9c)](_0x21edd3,_0x3235cb,_0x43250,_0x3816f2);else{for(var _0x2bda8=_0x21edd3['length']-0x1;_0x2bda8>=0x0;_0x2bda8--)if(_0x2559b9=_0x21edd3[_0x2bda8])_0x1ad23d=(_0x34c639<0x3?_0x2559b9(_0x1ad23d):_0x34c639>0x3?_0x2559b9(_0x3235cb,_0x43250,_0x1ad23d):_0x2559b9(_0x3235cb,_0x43250))||_0x1ad23d;}return _0x34c639>0x3&&_0x1ad23d&&Object[_0x3c84f9(0x8a)](_0x3235cb,_0x43250,_0x1ad23d),_0x1ad23d;},__metadata=this&&this[a106_0x120318(0x9d)]||function(_0x3f6488,_0x104b1a){const _0x307423=a106_0x120318;if(typeof Reflect===_0x307423(0x98)&&typeof Reflect[_0x307423(0xb7)]===_0x307423(0x8d))return Reflect[_0x307423(0xb7)](_0x3f6488,_0x104b1a);},__importDefault=this&&this[a106_0x120318(0x9a)]||function(_0x55cd07){const _0x28e120=a106_0x120318;return _0x55cd07&&_0x55cd07[_0x28e120(0xaa)]?_0x55cd07:{'default':_0x55cd07};},SalesforceAuthService_1;Object['defineProperty'](exports,a106_0x120318(0xaa),{'value':!![]}),exports[a106_0x120318(0xa1)]=void 0x0;const typedi_1=require(a106_0x120318(0x86)),errors_1=require(a106_0x120318(0xb1)),core_1=require(a106_0x120318(0xad)),salesforce_settings_service_1=require(a106_0x120318(0x7b)),axios_1=__importDefault(require('axios')),utils_1=require(a106_0x120318(0x78)),invalid_refresh_token_error_1=require('../errors/invalid-refresh-token.error'),auth_state_enum_1=require(a106_0x120318(0xa0)),unauthorized_salesforce_error_1=require(a106_0x120318(0xba)),constants_1=require(a106_0x120318(0x8c));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x2e39e5){const _0x5cf811=a106_0x120318;this[_0x5cf811(0x90)]=_0x2e39e5,this['AUTH_WAIT_TIME']=0x1388,this[_0x5cf811(0x77)]=auth_state_enum_1[_0x5cf811(0xa4)][_0x5cf811(0x85)],this[_0x5cf811(0x70)]=new core_1[(_0x5cf811(0xa3))](SalesforceAuthService_1[_0x5cf811(0xa8)]),this['setAuthDetails']();}get['settings'](){const _0x3dbe17=a106_0x120318;return this[_0x3dbe17(0x90)][_0x3dbe17(0x89)];}async['setAuthDetails'](){const _0xb7c9a0=a106_0x120318;this[_0xb7c9a0(0x70)][_0xb7c9a0(0x91)](_0xb7c9a0(0x74),auth_state_enum_1['AuthState'][this[_0xb7c9a0(0x77)]]);try{if(this['authState']===auth_state_enum_1[_0xb7c9a0(0xa4)][_0xb7c9a0(0x94)])return;if(this['authState']===auth_state_enum_1[_0xb7c9a0(0xa4)][_0xb7c9a0(0x85)])await this[_0xb7c9a0(0x96)]();else{const _0x404785=await this['requestConfig'](),_0x5e93d9=await axios_1[_0xb7c9a0(0x82)][_0xb7c9a0(0x7f)](_0xb7c9a0(0xa2)+constants_1[_0xb7c9a0(0x79)],_0x404785)[_0xb7c9a0(0x80)](()=>!![])[_0xb7c9a0(0xa7)](()=>![]);!_0x5e93d9&&await this['updateAccessToken']();}}catch(_0x155632){}}async[a106_0x120318(0x96)](){const _0x31a554=a106_0x120318;var _0x3af127,_0x55b083,_0x255621;this[_0x31a554(0x70)]['log'](_0x31a554(0x81));try{this[_0x31a554(0x77)]=auth_state_enum_1[_0x31a554(0xa4)][_0x31a554(0x9b)];const {refreshToken:_0x2ffaea,clientId:_0x30b15c,clientSecret:_0x74106e}=this[_0x31a554(0x89)],{data:_0x165488}=await axios_1[_0x31a554(0x82)][_0x31a554(0x9f)](utils_1['joinURL'](this[_0x31a554(0x90)]['loginUrl'],_0x31a554(0x92)),null,{'params':{'grant_type':_0x31a554(0x87),'refresh_token':_0x2ffaea,'client_id':_0x30b15c,'client_secret':_0x74106e}});this[_0x31a554(0xa5)]=_0x165488['instance_url'],this['accessToken']=_0x165488[_0x31a554(0x7d)],this[_0x31a554(0xa9)]=_0x165488[_0x31a554(0x75)],this[_0x31a554(0x77)]=auth_state_enum_1[_0x31a554(0xa4)][_0x31a554(0xa6)],this[_0x31a554(0x70)][_0x31a554(0x91)](_0x31a554(0x73),this[_0x31a554(0xa5)]);}catch(_0x4b951a){const _0x5820db=((_0x55b083=(_0x3af127=_0x4b951a===null||_0x4b951a===void 0x0?void 0x0:_0x4b951a[_0x31a554(0x7c)])===null||_0x3af127===void 0x0?void 0x0:_0x3af127[_0x31a554(0x97)])===null||_0x55b083===void 0x0?void 0x0:_0x55b083['error'])||((_0x255621=_0x4b951a===null||_0x4b951a===void 0x0?void 0x0:_0x4b951a[_0x31a554(0x7c)])===null||_0x255621===void 0x0?void 0x0:_0x255621['data'])||_0x4b951a['message'];this['logger'][_0x31a554(0xab)](_0x31a554(0xb0),_0x5820db),this[_0x31a554(0x77)]=auth_state_enum_1['AuthState'][_0x31a554(0x94)];throw new invalid_refresh_token_error_1[(_0x31a554(0x6d))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a106_0x120318(0xae)](){const _0xdc7dee=a106_0x120318;this[_0xdc7dee(0x70)][_0xdc7dee(0x91)]('force\x20update\x20token');if(this[_0xdc7dee(0x77)]===auth_state_enum_1[_0xdc7dee(0xa4)][_0xdc7dee(0x9b)]||this[_0xdc7dee(0x77)]===auth_state_enum_1[_0xdc7dee(0xa4)][_0xdc7dee(0x85)])return await utils_1['sleep'](this[_0xdc7dee(0x95)]),this['forceUpdateToken']();if(this[_0xdc7dee(0x77)]===auth_state_enum_1[_0xdc7dee(0xa4)][_0xdc7dee(0x94)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0xdc7dee(0x7a)]);await this[_0xdc7dee(0x96)]();}async[a106_0x120318(0x8b)](){const _0x189a54=a106_0x120318;if(this[_0x189a54(0x77)]===auth_state_enum_1['AuthState'][_0x189a54(0x94)]){this[_0x189a54(0x70)][_0x189a54(0x91)](_0x189a54(0xac));throw new unauthorized_salesforce_error_1[(_0x189a54(0x9e))]();}if(this[_0x189a54(0x77)]!==auth_state_enum_1[_0x189a54(0xa4)][_0x189a54(0xa6)])return this[_0x189a54(0x70)][_0x189a54(0x91)](_0x189a54(0x8e)),await utils_1[_0x189a54(0x7e)](this[_0x189a54(0x95)]),this['requestConfig']();return{'baseURL':this['instanceUrl'],'headers':{'accept':'application/json','content-type':_0x189a54(0xb9),'authorization':this[_0x189a54(0xa9)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata('design:paramtypes',[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a106_0x120318(0xa1)]=SalesforceAuthService;