const a106_0x53b2=['return\x20/\x22\x20+\x20this\x20+\x20\x22/','updateAccessToken','refresh_token','response','ERR_INVALID_SALESFORCE_TOKEN','name','settings','AUTH_WAIT_TIME','metadata','230288MymoJp','joinURL','function','441878ENHOZH','Updating','sleep','logger','force\x20update\x20token','test','typedi','344110NqsnWw','log','__esModule','salesforseSettings','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','data','1143141bJnJNh','../errors/invalid-refresh-token.error','InvalidRefreshTokenError','access_token','then','defineProperty','length','update\x20access\x20token','accessToken','requestConfig','375546RzBFpI','Error','47sprTKP','access\x20token\x20updated\x20for\x20%s','message','catch','AuthState','459165vlAsvw','object','error','Active','SalesforceAuthService','/services/oauth2/token','Idle','getOwnPropertyDescriptor','default','tokenType','setAuthDetails','application/json','constructor','9281mFXjWu','update\x20access\x20token\x20failed:\x20%s','design:paramtypes','create\x20authorized\x20request\x20failed:\x20authorization\x20error','../errors/unauthorized-salesforce.error','post','axios','loginUrl','decorate','__decorate','check\x20auth:\x20current\x20state\x20-\x20%s','apply','get','instanceUrl','forceUpdateToken','../../shared/services/salesforce-settings.service','token_type','authState'];const a106_0x3116ff=a106_0x1020;(function(_0x3d2307,_0xd7b8a7){const _0x4fefe2=a106_0x1020;while(!![]){try{const _0x186647=-parseInt(_0x4fefe2(0x12b))+-parseInt(_0x4fefe2(0x132))+-parseInt(_0x4fefe2(0x12d))*-parseInt(_0x4fefe2(0x13f))+-parseInt(_0x4fefe2(0x111))+parseInt(_0x4fefe2(0x114))+-parseInt(_0x4fefe2(0x11b))+parseInt(_0x4fefe2(0x121));if(_0x186647===_0xd7b8a7)break;else _0x3d2307['push'](_0x3d2307['shift']());}catch(_0x17a2f0){_0x3d2307['push'](_0x3d2307['shift']());}}}(a106_0x53b2,0x95715));const a106_0x562ed1=function(){let _0x57970e=!![];return function(_0x16da28,_0x356797){const _0x4af610=_0x57970e?function(){const _0x163b0a=a106_0x1020;if(_0x356797){const _0x201c34=_0x356797[_0x163b0a(0x14a)](_0x16da28,arguments);return _0x356797=null,_0x201c34;}}:function(){};return _0x57970e=![],_0x4af610;};}(),a106_0x1d4fc2=a106_0x562ed1(this,function(){const _0x3ff511=function(){const _0x50c54d=a106_0x1020,_0x1f187e=_0x3ff511[_0x50c54d(0x13e)](_0x50c54d(0x108))()[_0x50c54d(0x13e)](_0x50c54d(0x11f));return!_0x1f187e[_0x50c54d(0x119)](a106_0x1d4fc2);};return _0x3ff511();});a106_0x1d4fc2();'use strict';var __decorate=this&&this[a106_0x3116ff(0x148)]||function(_0x2ed670,_0x1d21a1,_0x48df4e,_0xb0fed6){const _0x590c92=a106_0x3116ff;var _0x489557=arguments['length'],_0x582c30=_0x489557<0x3?_0x1d21a1:_0xb0fed6===null?_0xb0fed6=Object[_0x590c92(0x139)](_0x1d21a1,_0x48df4e):_0xb0fed6,_0x4111da;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x590c92(0x113))_0x582c30=Reflect[_0x590c92(0x147)](_0x2ed670,_0x1d21a1,_0x48df4e,_0xb0fed6);else{for(var _0x29607a=_0x2ed670[_0x590c92(0x127)]-0x1;_0x29607a>=0x0;_0x29607a--)if(_0x4111da=_0x2ed670[_0x29607a])_0x582c30=(_0x489557<0x3?_0x4111da(_0x582c30):_0x489557>0x3?_0x4111da(_0x1d21a1,_0x48df4e,_0x582c30):_0x4111da(_0x1d21a1,_0x48df4e))||_0x582c30;}return _0x489557>0x3&&_0x582c30&&Object['defineProperty'](_0x1d21a1,_0x48df4e,_0x582c30),_0x582c30;},__metadata=this&&this['__metadata']||function(_0x402a4e,_0x343cd6){const _0x17e1ac=a106_0x3116ff;if(typeof Reflect===_0x17e1ac(0x133)&&typeof Reflect[_0x17e1ac(0x110)]===_0x17e1ac(0x113))return Reflect['metadata'](_0x402a4e,_0x343cd6);},__importDefault=this&&this['__importDefault']||function(_0x59b578){const _0x2e8a2c=a106_0x3116ff;return _0x59b578&&_0x59b578[_0x2e8a2c(0x11d)]?_0x59b578:{'default':_0x59b578};},SalesforceAuthService_1;Object[a106_0x3116ff(0x126)](exports,'__esModule',{'value':!![]}),exports[a106_0x3116ff(0x136)]=void 0x0;const typedi_1=require(a106_0x3116ff(0x11a)),errors_1=require('../../../constants/errors'),core_1=require('../../../core'),salesforce_settings_service_1=require(a106_0x3116ff(0x14e)),axios_1=__importDefault(require(a106_0x3116ff(0x145))),utils_1=require('../../shared/utils'),invalid_refresh_token_error_1=require(a106_0x3116ff(0x122)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a106_0x3116ff(0x143)),constants_1=require('../../../constants');function a106_0x1020(_0x5134e1,_0x243475){return a106_0x1020=function(_0xe2ba3e,_0x1d4fc2){_0xe2ba3e=_0xe2ba3e-0x106;let _0x562ed1=a106_0x53b2[_0xe2ba3e];return _0x562ed1;},a106_0x1020(_0x5134e1,_0x243475);}let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x37dc1e){const _0x550d1f=a106_0x3116ff;this['salesforseSettings']=_0x37dc1e,this['AUTH_WAIT_TIME']=0x1388,this[_0x550d1f(0x107)]=auth_state_enum_1[_0x550d1f(0x131)][_0x550d1f(0x138)],this[_0x550d1f(0x117)]=new core_1['Logger'](SalesforceAuthService_1[_0x550d1f(0x10d)]),this[_0x550d1f(0x13c)]();}get['settings'](){const _0x204ab4=a106_0x3116ff;return this['salesforseSettings'][_0x204ab4(0x10e)];}async[a106_0x3116ff(0x13c)](){const _0x31f7ca=a106_0x3116ff;this['logger'][_0x31f7ca(0x11c)](_0x31f7ca(0x149),auth_state_enum_1[_0x31f7ca(0x131)][this[_0x31f7ca(0x107)]]);try{if(this['authState']===auth_state_enum_1[_0x31f7ca(0x131)][_0x31f7ca(0x12c)])return;if(this['authState']===auth_state_enum_1[_0x31f7ca(0x131)]['Idle'])await this[_0x31f7ca(0x109)]();else{const _0x2b908b=await this[_0x31f7ca(0x12a)](),_0x119c00=await axios_1[_0x31f7ca(0x13a)][_0x31f7ca(0x14b)]('services/data/'+constants_1['SALESFORCE_API_VERSION'],_0x2b908b)[_0x31f7ca(0x125)](()=>!![])[_0x31f7ca(0x130)](()=>![]);!_0x119c00&&await this[_0x31f7ca(0x109)]();}}catch(_0x2760aa){}}async['updateAccessToken'](){const _0x10cab6=a106_0x3116ff;var _0x49dcfa,_0x30a3ac,_0x465fd;this[_0x10cab6(0x117)][_0x10cab6(0x11c)](_0x10cab6(0x128));try{this[_0x10cab6(0x107)]=auth_state_enum_1[_0x10cab6(0x131)][_0x10cab6(0x115)];const {refreshToken:_0x14c8ce,clientId:_0x27e7d1,clientSecret:_0x3f0f7e}=this[_0x10cab6(0x10e)],{data:_0x3f9fc2}=await axios_1['default'][_0x10cab6(0x144)](utils_1[_0x10cab6(0x112)](this[_0x10cab6(0x11e)][_0x10cab6(0x146)],_0x10cab6(0x137)),null,{'params':{'grant_type':_0x10cab6(0x10a),'refresh_token':_0x14c8ce,'client_id':_0x27e7d1,'client_secret':_0x3f0f7e}});this['instanceUrl']=_0x3f9fc2['instance_url'],this[_0x10cab6(0x129)]=_0x3f9fc2[_0x10cab6(0x124)],this[_0x10cab6(0x13b)]=_0x3f9fc2[_0x10cab6(0x106)],this[_0x10cab6(0x107)]=auth_state_enum_1[_0x10cab6(0x131)]['Active'],this[_0x10cab6(0x117)][_0x10cab6(0x11c)](_0x10cab6(0x12e),this[_0x10cab6(0x14c)]);}catch(_0xdd2013){const _0x13cbc7=((_0x30a3ac=(_0x49dcfa=_0xdd2013===null||_0xdd2013===void 0x0?void 0x0:_0xdd2013[_0x10cab6(0x10b)])===null||_0x49dcfa===void 0x0?void 0x0:_0x49dcfa['data'])===null||_0x30a3ac===void 0x0?void 0x0:_0x30a3ac[_0x10cab6(0x134)])||((_0x465fd=_0xdd2013===null||_0xdd2013===void 0x0?void 0x0:_0xdd2013['response'])===null||_0x465fd===void 0x0?void 0x0:_0x465fd[_0x10cab6(0x120)])||_0xdd2013[_0x10cab6(0x12f)];this[_0x10cab6(0x117)][_0x10cab6(0x134)](_0x10cab6(0x140),_0x13cbc7),this[_0x10cab6(0x107)]=auth_state_enum_1[_0x10cab6(0x131)][_0x10cab6(0x12c)];throw new invalid_refresh_token_error_1[(_0x10cab6(0x123))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x2402dc=a106_0x3116ff;this[_0x2402dc(0x117)][_0x2402dc(0x11c)](_0x2402dc(0x118));if(this[_0x2402dc(0x107)]===auth_state_enum_1[_0x2402dc(0x131)]['Updating']||this[_0x2402dc(0x107)]===auth_state_enum_1[_0x2402dc(0x131)][_0x2402dc(0x138)])return await utils_1[_0x2402dc(0x116)](this['AUTH_WAIT_TIME']),this[_0x2402dc(0x14d)]();if(this[_0x2402dc(0x107)]===auth_state_enum_1[_0x2402dc(0x131)][_0x2402dc(0x12c)])throw new invalid_refresh_token_error_1[(_0x2402dc(0x123))](errors_1[_0x2402dc(0x10c)]);await this[_0x2402dc(0x109)]();}async['requestConfig'](){const _0x5bd184=a106_0x3116ff;if(this[_0x5bd184(0x107)]===auth_state_enum_1[_0x5bd184(0x131)]['Error']){this[_0x5bd184(0x117)][_0x5bd184(0x11c)](_0x5bd184(0x142));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x5bd184(0x107)]!==auth_state_enum_1[_0x5bd184(0x131)][_0x5bd184(0x135)])return this[_0x5bd184(0x117)]['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x5bd184(0x116)](this[_0x5bd184(0x10f)]),this['requestConfig']();return{'baseURL':this[_0x5bd184(0x14c)],'headers':{'accept':_0x5bd184(0x13d),'content-type':_0x5bd184(0x13d),'authorization':this['tokenType']+'\x20'+this[_0x5bd184(0x129)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([typedi_1['Service'](),__metadata(a106_0x3116ff(0x141),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a106_0x3116ff(0x136)]=SalesforceAuthService;