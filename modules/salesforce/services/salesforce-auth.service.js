const a105_0x3950=['access_token','constructor','1MvVaMv','apply','Logger','create\x20authorized\x20request\x20failed:\x20authorization\x20error','check\x20auth:\x20current\x20state\x20-\x20%s','AUTH_WAIT_TIME','98575AUlrms','post','accessToken','log','tokenType','__decorate','loginUrl','Active','salesforseSettings','../../../constants/errors','services/data/','../../../constants','default','Updating','error','41PZiulY','252891TZcPrf','__importDefault','decorate','1hrUqNz','authState','ERR_INVALID_SALESFORCE_TOKEN','AuthState','instance_url','message','updateAccessToken','function','3ItxhOD','update\x20access\x20token','2BtLbFV','setAuthDetails','instanceUrl','sleep','15319CalNQv','Error','Idle','then','application/json','typedi','210645XvFBJE','SalesforceSettingsService','refresh_token','../enums/auth-state.enum','force\x20update\x20token','../../shared/utils','../../../core','1056863abYHJA','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','object','InvalidRefreshTokenError','design:paramtypes','5lqbVfw','SalesforceAuthService','../errors/unauthorized-salesforce.error','get','data','856238NaZjbN','forceUpdateToken','length','requestConfig','response','access\x20token\x20updated\x20for\x20%s','update\x20access\x20token\x20failed:\x20%s','629782ZGqUqR','UnauthorizedSalesforceError','settings','test','../errors/invalid-refresh-token.error'];const a105_0x3d5659=a105_0xf8b8;(function(_0x3839de,_0x243883){const _0x57982c=a105_0xf8b8;while(!![]){try{const _0x5e0b76=-parseInt(_0x57982c(0xd5))*parseInt(_0x57982c(0xa1))+-parseInt(_0x57982c(0xb6))*parseInt(_0x57982c(0xc8))+parseInt(_0x57982c(0xe6))+-parseInt(_0x57982c(0xba))*parseInt(_0x57982c(0xb7))+-parseInt(_0x57982c(0xce))*-parseInt(_0x57982c(0xc2))+parseInt(_0x57982c(0xda))*-parseInt(_0x57982c(0xa7))+-parseInt(_0x57982c(0xdf))*-parseInt(_0x57982c(0xc4));if(_0x5e0b76===_0x243883)break;else _0x3839de['push'](_0x3839de['shift']());}catch(_0x17a2e6){_0x3839de['push'](_0x3839de['shift']());}}}(a105_0x3950,0x84afd));function a105_0xf8b8(_0x51602e,_0x3a17dc){return a105_0xf8b8=function(_0x336e8e,_0x123596){_0x336e8e=_0x336e8e-0x9c;let _0x250340=a105_0x3950[_0x336e8e];return _0x250340;},a105_0xf8b8(_0x51602e,_0x3a17dc);}const a105_0x250340=function(){let _0x24a853=!![];return function(_0x30c93e,_0x118ec4){const _0x23e97e=_0x24a853?function(){const _0x18b560=a105_0xf8b8;if(_0x118ec4){const _0x2c7fc8=_0x118ec4[_0x18b560(0xa2)](_0x30c93e,arguments);return _0x118ec4=null,_0x2c7fc8;}}:function(){};return _0x24a853=![],_0x23e97e;};}(),a105_0x123596=a105_0x250340(this,function(){const _0x55c961=function(){const _0x458c25=a105_0xf8b8,_0x516327=_0x55c961[_0x458c25(0xa0)]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x458c25(0xa0)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x516327[_0x458c25(0x9d)](a105_0x123596);};return _0x55c961();});a105_0x123596();'use strict';var __decorate=this&&this[a105_0x3d5659(0xac)]||function(_0x4cd623,_0x18a3d4,_0x515582,_0x117e95){const _0x33e8d8=a105_0x3d5659;var _0x16e59b=arguments['length'],_0x4f2b3f=_0x16e59b<0x3?_0x18a3d4:_0x117e95===null?_0x117e95=Object['getOwnPropertyDescriptor'](_0x18a3d4,_0x515582):_0x117e95,_0x422fcc;if(typeof Reflect===_0x33e8d8(0xd7)&&typeof Reflect[_0x33e8d8(0xb9)]==='function')_0x4f2b3f=Reflect[_0x33e8d8(0xb9)](_0x4cd623,_0x18a3d4,_0x515582,_0x117e95);else{for(var _0x1fc500=_0x4cd623[_0x33e8d8(0xe1)]-0x1;_0x1fc500>=0x0;_0x1fc500--)if(_0x422fcc=_0x4cd623[_0x1fc500])_0x4f2b3f=(_0x16e59b<0x3?_0x422fcc(_0x4f2b3f):_0x16e59b>0x3?_0x422fcc(_0x18a3d4,_0x515582,_0x4f2b3f):_0x422fcc(_0x18a3d4,_0x515582))||_0x4f2b3f;}return _0x16e59b>0x3&&_0x4f2b3f&&Object['defineProperty'](_0x18a3d4,_0x515582,_0x4f2b3f),_0x4f2b3f;},__metadata=this&&this['__metadata']||function(_0x539796,_0x52a348){const _0x1756c0=a105_0x3d5659;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1756c0(0xc1))return Reflect['metadata'](_0x539796,_0x52a348);},__importDefault=this&&this[a105_0x3d5659(0xb8)]||function(_0x4203b5){return _0x4203b5&&_0x4203b5['__esModule']?_0x4203b5:{'default':_0x4203b5};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a105_0x3d5659(0xdb)]=void 0x0;const typedi_1=require(a105_0x3d5659(0xcd)),errors_1=require(a105_0x3d5659(0xb0)),core_1=require(a105_0x3d5659(0xd4)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a105_0x3d5659(0xd3)),invalid_refresh_token_error_1=require(a105_0x3d5659(0x9e)),auth_state_enum_1=require(a105_0x3d5659(0xd1)),unauthorized_salesforce_error_1=require(a105_0x3d5659(0xdc)),constants_1=require(a105_0x3d5659(0xb2)),logger=new core_1[(a105_0x3d5659(0xa3))]('salesforce-auth-service');let SalesforceAuthService=class SalesforceAuthService{constructor(_0xd21a34){const _0x3a8511=a105_0x3d5659;this[_0x3a8511(0xaf)]=_0xd21a34,this['AUTH_WAIT_TIME']=0x1388,this[_0x3a8511(0xbb)]=auth_state_enum_1[_0x3a8511(0xbd)][_0x3a8511(0xca)],this[_0x3a8511(0xc5)]();}get['settings'](){const _0x1a0990=a105_0x3d5659;return this[_0x1a0990(0xaf)][_0x1a0990(0x9c)];}async[a105_0x3d5659(0xc5)](){const _0x35737f=a105_0x3d5659;logger[_0x35737f(0xaa)](_0x35737f(0xa5),auth_state_enum_1[_0x35737f(0xbd)][this[_0x35737f(0xbb)]]);try{if(this[_0x35737f(0xbb)]===auth_state_enum_1[_0x35737f(0xbd)][_0x35737f(0xc9)])return;if(this['authState']===auth_state_enum_1[_0x35737f(0xbd)][_0x35737f(0xca)])await this['updateAccessToken']();else{const _0x5b6394=await this[_0x35737f(0xe2)](),_0x4ef6ad=await axios_1['default'][_0x35737f(0xdd)](_0x35737f(0xb1)+constants_1['SALESFORCE_API_VERSION'],_0x5b6394)[_0x35737f(0xcb)](()=>!![])['catch'](()=>![]);!_0x4ef6ad&&await this[_0x35737f(0xc0)]();}}catch(_0x903c87){}}async[a105_0x3d5659(0xc0)](){const _0x1e6b6a=a105_0x3d5659;var _0x4d412d,_0x421763,_0x50ea01;logger['log'](_0x1e6b6a(0xc3));try{this[_0x1e6b6a(0xbb)]=auth_state_enum_1[_0x1e6b6a(0xbd)]['Updating'];const {refreshToken:_0x2ed38b,clientId:_0x5c9a33,clientSecret:_0x5ce5d0}=this['settings'],{data:_0x151f37}=await axios_1[_0x1e6b6a(0xb3)][_0x1e6b6a(0xa8)](utils_1['joinURL'](this['salesforseSettings'][_0x1e6b6a(0xad)],'/services/oauth2/token'),null,{'params':{'grant_type':_0x1e6b6a(0xd0),'refresh_token':_0x2ed38b,'client_id':_0x5c9a33,'client_secret':_0x5ce5d0}});this[_0x1e6b6a(0xc6)]=_0x151f37[_0x1e6b6a(0xbe)],this[_0x1e6b6a(0xa9)]=_0x151f37[_0x1e6b6a(0x9f)],this['tokenType']=_0x151f37['token_type'],this[_0x1e6b6a(0xbb)]=auth_state_enum_1['AuthState'][_0x1e6b6a(0xae)],logger['log'](_0x1e6b6a(0xe4),this['instanceUrl']);}catch(_0x50539d){const _0x1de8fe=((_0x421763=(_0x4d412d=_0x50539d===null||_0x50539d===void 0x0?void 0x0:_0x50539d[_0x1e6b6a(0xe3)])===null||_0x4d412d===void 0x0?void 0x0:_0x4d412d['data'])===null||_0x421763===void 0x0?void 0x0:_0x421763[_0x1e6b6a(0xb5)])||((_0x50ea01=_0x50539d===null||_0x50539d===void 0x0?void 0x0:_0x50539d[_0x1e6b6a(0xe3)])===null||_0x50ea01===void 0x0?void 0x0:_0x50ea01[_0x1e6b6a(0xde)])||_0x50539d[_0x1e6b6a(0xbf)];logger['error'](_0x1e6b6a(0xe5),_0x1de8fe),this['authState']=auth_state_enum_1[_0x1e6b6a(0xbd)][_0x1e6b6a(0xc9)];throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x1e6b6a(0xbc)]);}}async[a105_0x3d5659(0xe0)](){const _0x30714c=a105_0x3d5659;logger[_0x30714c(0xaa)](_0x30714c(0xd2));if(this[_0x30714c(0xbb)]===auth_state_enum_1[_0x30714c(0xbd)][_0x30714c(0xb4)]||this[_0x30714c(0xbb)]===auth_state_enum_1[_0x30714c(0xbd)][_0x30714c(0xca)])return await utils_1[_0x30714c(0xc7)](this[_0x30714c(0xa6)]),this[_0x30714c(0xe0)]();if(this['authState']===auth_state_enum_1['AuthState'][_0x30714c(0xc9)])throw new invalid_refresh_token_error_1[(_0x30714c(0xd8))](errors_1[_0x30714c(0xbc)]);await this['updateAccessToken']();}async[a105_0x3d5659(0xe2)](){const _0x36cd22=a105_0x3d5659;if(this[_0x36cd22(0xbb)]===auth_state_enum_1[_0x36cd22(0xbd)]['Error']){logger['log'](_0x36cd22(0xa4));throw new unauthorized_salesforce_error_1[(_0x36cd22(0xe7))]();}if(this[_0x36cd22(0xbb)]!==auth_state_enum_1['AuthState'][_0x36cd22(0xae)])return logger[_0x36cd22(0xaa)](_0x36cd22(0xd6)),await utils_1[_0x36cd22(0xc7)](this[_0x36cd22(0xa6)]),this[_0x36cd22(0xe2)]();return{'baseURL':this[_0x36cd22(0xc6)],'headers':{'accept':_0x36cd22(0xcc),'content-type':_0x36cd22(0xcc),'authorization':this[_0x36cd22(0xab)]+'\x20'+this[_0x36cd22(0xa9)]}};}};SalesforceAuthService=__decorate([typedi_1['Service'](),__metadata(a105_0x3d5659(0xd9),[salesforce_settings_service_1[a105_0x3d5659(0xcf)]])],SalesforceAuthService),exports[a105_0x3d5659(0xdb)]=SalesforceAuthService;