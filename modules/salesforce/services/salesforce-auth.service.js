const a108_0x406154=a108_0x5154;(function(_0x114858,_0xccb28e){const _0x2cd715=a108_0x5154,_0x13276d=_0x114858();while(!![]){try{const _0x1557c1=-parseInt(_0x2cd715(0xf7))/0x1+-parseInt(_0x2cd715(0xf6))/0x2*(parseInt(_0x2cd715(0xfe))/0x3)+-parseInt(_0x2cd715(0xcd))/0x4*(-parseInt(_0x2cd715(0xea))/0x5)+-parseInt(_0x2cd715(0xce))/0x6+-parseInt(_0x2cd715(0xf5))/0x7+-parseInt(_0x2cd715(0xd9))/0x8*(parseInt(_0x2cd715(0xe1))/0x9)+parseInt(_0x2cd715(0xda))/0xa;if(_0x1557c1===_0xccb28e)break;else _0x13276d['push'](_0x13276d['shift']());}catch(_0x813c7a){_0x13276d['push'](_0x13276d['shift']());}}}(a108_0x4e25,0x51b9e));const a108_0x2a5cc6=function(){let _0x90383c=!![];return function(_0x227a39,_0x4bef63){const _0x3960bf=_0x90383c?function(){const _0x5f050e=a108_0x5154;if(_0x4bef63){const _0x211464=_0x4bef63[_0x5f050e(0xe3)](_0x227a39,arguments);return _0x4bef63=null,_0x211464;}}:function(){};return _0x90383c=![],_0x3960bf;};}(),a108_0x4614d7=a108_0x2a5cc6(this,function(){const _0x3102ce=a108_0x5154;return a108_0x4614d7[_0x3102ce(0xe7)]()[_0x3102ce(0xbf)](_0x3102ce(0xd8))[_0x3102ce(0xe7)]()[_0x3102ce(0xb8)](a108_0x4614d7)[_0x3102ce(0xbf)]('(((.+)+)+)+$');});a108_0x4614d7();function a108_0x5154(_0x3c1b5b,_0x9c55a){const _0x3ebcb4=a108_0x4e25();return a108_0x5154=function(_0x4614d7,_0x2a5cc6){_0x4614d7=_0x4614d7-0xb5;let _0x4e2576=_0x3ebcb4[_0x4614d7];return _0x4e2576;},a108_0x5154(_0x3c1b5b,_0x9c55a);}'use strict';var __decorate=this&&this[a108_0x406154(0xe2)]||function(_0x57d967,_0x352491,_0x9ef8a1,_0xa2e242){const _0x4ab938=a108_0x406154;var _0x10bb95=arguments[_0x4ab938(0xcf)],_0x5aa7e5=_0x10bb95<0x3?_0x352491:_0xa2e242===null?_0xa2e242=Object['getOwnPropertyDescriptor'](_0x352491,_0x9ef8a1):_0xa2e242,_0x1040d4;if(typeof Reflect===_0x4ab938(0xed)&&typeof Reflect['decorate']===_0x4ab938(0xfb))_0x5aa7e5=Reflect['decorate'](_0x57d967,_0x352491,_0x9ef8a1,_0xa2e242);else{for(var _0x5f1686=_0x57d967[_0x4ab938(0xcf)]-0x1;_0x5f1686>=0x0;_0x5f1686--)if(_0x1040d4=_0x57d967[_0x5f1686])_0x5aa7e5=(_0x10bb95<0x3?_0x1040d4(_0x5aa7e5):_0x10bb95>0x3?_0x1040d4(_0x352491,_0x9ef8a1,_0x5aa7e5):_0x1040d4(_0x352491,_0x9ef8a1))||_0x5aa7e5;}return _0x10bb95>0x3&&_0x5aa7e5&&Object['defineProperty'](_0x352491,_0x9ef8a1,_0x5aa7e5),_0x5aa7e5;},__metadata=this&&this['__metadata']||function(_0x2b7a30,_0xff2420){const _0x17c7e5=a108_0x406154;if(typeof Reflect===_0x17c7e5(0xed)&&typeof Reflect[_0x17c7e5(0xc8)]===_0x17c7e5(0xfb))return Reflect[_0x17c7e5(0xc8)](_0x2b7a30,_0xff2420);},__importDefault=this&&this[a108_0x406154(0xbd)]||function(_0x5e934b){const _0x44f462=a108_0x406154;return _0x5e934b&&_0x5e934b[_0x44f462(0xb9)]?_0x5e934b:{'default':_0x5e934b};},SalesforceAuthService_1;Object[a108_0x406154(0xbe)](exports,'__esModule',{'value':!![]}),exports[a108_0x406154(0xfd)]=void 0x0;const typedi_1=require(a108_0x406154(0xdd)),errors_1=require(a108_0x406154(0xc0)),core_1=require('../../../core'),salesforce_settings_service_1=require(a108_0x406154(0xe4)),axios_1=__importDefault(require(a108_0x406154(0xee))),utils_1=require(a108_0x406154(0xba)),invalid_refresh_token_error_1=require(a108_0x406154(0xb5)),auth_state_enum_1=require(a108_0x406154(0xb7)),unauthorized_salesforce_error_1=require(a108_0x406154(0xf9)),constants_1=require(a108_0x406154(0xe6));let SalesforceAuthService=SalesforceAuthService_1=class SalesforceAuthService{constructor(_0x23764e){const _0xcf11d8=a108_0x406154;this['salesforseSettings']=_0x23764e,this[_0xcf11d8(0xf0)]=0x1388,this[_0xcf11d8(0xcc)]=auth_state_enum_1['AuthState'][_0xcf11d8(0xca)],this[_0xcf11d8(0xec)]=new core_1[(_0xcf11d8(0xc9))](SalesforceAuthService_1['name']),this[_0xcf11d8(0xf2)]();}get[a108_0x406154(0xd5)](){const _0x3433b1=a108_0x406154;return this[_0x3433b1(0xeb)]['settings'];}async[a108_0x406154(0xf2)](){const _0x3a55b8=a108_0x406154;this[_0x3a55b8(0xec)][_0x3a55b8(0xd4)](_0x3a55b8(0xc4),auth_state_enum_1['AuthState'][this[_0x3a55b8(0xcc)]]);try{if(this[_0x3a55b8(0xcc)]===auth_state_enum_1['AuthState'][_0x3a55b8(0xd6)])return;if(this[_0x3a55b8(0xcc)]===auth_state_enum_1[_0x3a55b8(0x100)][_0x3a55b8(0xca)])await this['updateAccessToken']();else{const _0x127d28=await this[_0x3a55b8(0xd7)](),_0x26b72f=await axios_1['default'][_0x3a55b8(0xc2)](_0x3a55b8(0xfa)+constants_1['SALESFORCE_API_VERSION'],_0x127d28)[_0x3a55b8(0xf8)](()=>!![])[_0x3a55b8(0xfc)](()=>![]);!_0x26b72f&&await this[_0x3a55b8(0xc3)]();}}catch(_0x41e056){}}async[a108_0x406154(0xc3)](){const _0x5bd5e7=a108_0x406154;var _0x5997fb,_0x4bfb08,_0x42bc96;this['logger'][_0x5bd5e7(0xd4)](_0x5bd5e7(0xf3));try{this[_0x5bd5e7(0xcc)]=auth_state_enum_1[_0x5bd5e7(0x100)]['Updating'];const {refreshToken:_0x51b6f5,clientId:_0x4752bd,clientSecret:_0x1916a5}=this[_0x5bd5e7(0xd5)],{data:_0xcfb4ba}=await axios_1[_0x5bd5e7(0xdc)]['post']((0x0,utils_1[_0x5bd5e7(0xd0)])(this[_0x5bd5e7(0xeb)][_0x5bd5e7(0xf1)],'/services/oauth2/token'),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x51b6f5,'client_id':_0x4752bd,'client_secret':_0x1916a5}});this[_0x5bd5e7(0xc6)]=_0xcfb4ba[_0x5bd5e7(0xe0)],this[_0x5bd5e7(0xb6)]=_0xcfb4ba[_0x5bd5e7(0xf4)],this['tokenType']=_0xcfb4ba[_0x5bd5e7(0xd1)],this[_0x5bd5e7(0xcc)]=auth_state_enum_1['AuthState'][_0x5bd5e7(0xe5)],this[_0x5bd5e7(0xec)][_0x5bd5e7(0xd4)](_0x5bd5e7(0xdf),this[_0x5bd5e7(0xc6)]);}catch(_0x3c5f33){const _0x311f16=((_0x4bfb08=(_0x5997fb=_0x3c5f33===null||_0x3c5f33===void 0x0?void 0x0:_0x3c5f33['response'])===null||_0x5997fb===void 0x0?void 0x0:_0x5997fb['data'])===null||_0x4bfb08===void 0x0?void 0x0:_0x4bfb08[_0x5bd5e7(0xde)])||((_0x42bc96=_0x3c5f33===null||_0x3c5f33===void 0x0?void 0x0:_0x3c5f33['response'])===null||_0x42bc96===void 0x0?void 0x0:_0x42bc96[_0x5bd5e7(0xbc)])||_0x3c5f33[_0x5bd5e7(0xff)];this[_0x5bd5e7(0xec)][_0x5bd5e7(0xde)](_0x5bd5e7(0xc1),_0x311f16),this[_0x5bd5e7(0xcc)]=auth_state_enum_1[_0x5bd5e7(0x100)][_0x5bd5e7(0xd6)];throw new invalid_refresh_token_error_1[(_0x5bd5e7(0xe9))](errors_1[_0x5bd5e7(0xbb)]);}}async['forceUpdateToken'](){const _0x94f1ac=a108_0x406154;this[_0x94f1ac(0xec)][_0x94f1ac(0xd4)](_0x94f1ac(0xd2));if(this[_0x94f1ac(0xcc)]===auth_state_enum_1[_0x94f1ac(0x100)][_0x94f1ac(0xc7)]||this['authState']===auth_state_enum_1[_0x94f1ac(0x100)][_0x94f1ac(0xca)])return await(0x0,utils_1[_0x94f1ac(0xef)])(this['AUTH_WAIT_TIME']),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1['AuthState'][_0x94f1ac(0xd6)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x94f1ac(0xbb)]);await this['updateAccessToken']();}async[a108_0x406154(0xd7)](){const _0x17b2a2=a108_0x406154;if(this[_0x17b2a2(0xcc)]===auth_state_enum_1[_0x17b2a2(0x100)][_0x17b2a2(0xd6)]){this[_0x17b2a2(0xec)]['log'](_0x17b2a2(0xe8));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x17b2a2(0xcc)]!==auth_state_enum_1[_0x17b2a2(0x100)][_0x17b2a2(0xe5)])return this[_0x17b2a2(0xec)][_0x17b2a2(0xd4)](_0x17b2a2(0xcb)),await(0x0,utils_1[_0x17b2a2(0xef)])(this[_0x17b2a2(0xf0)]),this[_0x17b2a2(0xd7)]();return{'baseURL':this[_0x17b2a2(0xc6)],'headers':{'accept':_0x17b2a2(0xd3),'content-type':'application/json','authorization':this[_0x17b2a2(0xc5)]+'\x20'+this[_0x17b2a2(0xb6)]}};}};SalesforceAuthService=SalesforceAuthService_1=__decorate([(0x0,typedi_1['Service'])(),__metadata(a108_0x406154(0xdb),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a108_0x406154(0xfd)]=SalesforceAuthService;function a108_0x4e25(){const _0x213b9e=['object','axios','sleep','AUTH_WAIT_TIME','loginUrl','setAuthDetails','update\x20access\x20token','access_token','2083963cNhkSX','3676OZnnPU','323784xfROio','then','../errors/unauthorized-salesforce.error','services/data/','function','catch','SalesforceAuthService','840JdeWBP','message','AuthState','../errors/invalid-refresh-token.error','accessToken','../enums/auth-state.enum','constructor','__esModule','../../shared/utils','ERR_INVALID_SALESFORCE_TOKEN','data','__importDefault','defineProperty','search','../../../constants/errors','update\x20access\x20token\x20failed:\x20%s','get','updateAccessToken','check\x20auth:\x20current\x20state\x20-\x20%s','tokenType','instanceUrl','Updating','metadata','Logger','Idle','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','authState','4pbkmBp','2691864ElIiFq','length','joinURL','token_type','force\x20update\x20token','application/json','log','settings','Error','requestConfig','(((.+)+)+)+$','24WpibQn','19411040QktXCm','design:paramtypes','default','typedi','error','access\x20token\x20updated\x20for\x20%s','instance_url','1254024LGrwYr','__decorate','apply','../../shared/services/salesforce-settings.service','Active','../../../constants','toString','create\x20authorized\x20request\x20failed:\x20authorization\x20error','InvalidRefreshTokenError','1982155UyTwZN','salesforseSettings','logger'];a108_0x4e25=function(){return _0x213b9e;};return a108_0x4e25();}