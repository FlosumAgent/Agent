const a103_0x189131=a103_0x5661;(function(_0x4d9854,_0x248c7e){const _0x2e7e08=a103_0x5661,_0x5df539=_0x4d9854();while(!![]){try{const _0xd6e15a=-parseInt(_0x2e7e08(0xeb))/0x1*(-parseInt(_0x2e7e08(0x107))/0x2)+-parseInt(_0x2e7e08(0x113))/0x3*(parseInt(_0x2e7e08(0x124))/0x4)+-parseInt(_0x2e7e08(0x12a))/0x5+-parseInt(_0x2e7e08(0x10f))/0x6*(-parseInt(_0x2e7e08(0xe9))/0x7)+-parseInt(_0x2e7e08(0xf3))/0x8*(parseInt(_0x2e7e08(0x110))/0x9)+-parseInt(_0x2e7e08(0xf0))/0xa+parseInt(_0x2e7e08(0x114))/0xb;if(_0xd6e15a===_0x248c7e)break;else _0x5df539['push'](_0x5df539['shift']());}catch(_0x4b9a1d){_0x5df539['push'](_0x5df539['shift']());}}}(a103_0x4dd0,0x1e06f));const a103_0x2e1da1=function(){let _0xe9edc6=!![];return function(_0x5df7f7,_0x283a6d){const _0x342c22=_0xe9edc6?function(){if(_0x283a6d){const _0x511994=_0x283a6d['apply'](_0x5df7f7,arguments);return _0x283a6d=null,_0x511994;}}:function(){};return _0xe9edc6=![],_0x342c22;};}(),a103_0x392d10=a103_0x2e1da1(this,function(){const _0x56fdf5=a103_0x5661;return a103_0x392d10[_0x56fdf5(0x10c)]()['search']('(((.+)+)+)+$')['toString']()[_0x56fdf5(0xf8)](a103_0x392d10)[_0x56fdf5(0x104)]('(((.+)+)+)+$');});a103_0x392d10();function a103_0x4dd0(){const _0x166e1b=['78801uLNoZF','988130OpQWxZ','forceUpdateToken','Active','__metadata','length','get','getOwnPropertyDescriptor','ERR_INVALID_SALESFORCE_TOKEN','../../../constants/errors','accessToken','updateAccessToken','UnauthorizedSalesforceError','access_token','application/json','error','instance_url','16gdmhxX','setAuthDetails','../errors/invalid-refresh-token.error','decorate','SalesforceAuthService','defineProperty','366325KlJfvM','/services/oauth2/token','sleep','access\x20token\x20updated\x20for\x20%s','../../shared/utils','post','__importDefault','create\x20authorized\x20request\x20failed:\x20authorization\x20error','77rFTfUk','Error','1OzYAIO','../errors/unauthorized-salesforce.error','loginUrl','InvalidRefreshTokenError','../../../core','213300UDUhfk','log','tokenType','411672VFSsYB','Idle','typedi','function','authState','constructor','catch','token_type','default','AuthState','response','AUTH_WAIT_TIME','object','SalesforceSettingsService','settings','requestConfig','instanceUrl','search','Updating','__decorate','127378rAiEhc','salesforseSettings','data','update\x20access\x20token','salesforce-auth-service','toString','design:paramtypes','../../../constants','120324BEJiSM','9kBdOLx','services/data/','check\x20auth:\x20current\x20state\x20-\x20%s'];a103_0x4dd0=function(){return _0x166e1b;};return a103_0x4dd0();}'use strict';var __decorate=this&&this[a103_0x189131(0x106)]||function(_0x43270f,_0x46cee9,_0xae0837,_0x451213){const _0x1f91d1=a103_0x189131;var _0x519878=arguments[_0x1f91d1(0x118)],_0x3c6e68=_0x519878<0x3?_0x46cee9:_0x451213===null?_0x451213=Object[_0x1f91d1(0x11a)](_0x46cee9,_0xae0837):_0x451213,_0x2c4cac;if(typeof Reflect===_0x1f91d1(0xff)&&typeof Reflect[_0x1f91d1(0x127)]===_0x1f91d1(0xf6))_0x3c6e68=Reflect['decorate'](_0x43270f,_0x46cee9,_0xae0837,_0x451213);else{for(var _0x1480c0=_0x43270f[_0x1f91d1(0x118)]-0x1;_0x1480c0>=0x0;_0x1480c0--)if(_0x2c4cac=_0x43270f[_0x1480c0])_0x3c6e68=(_0x519878<0x3?_0x2c4cac(_0x3c6e68):_0x519878>0x3?_0x2c4cac(_0x46cee9,_0xae0837,_0x3c6e68):_0x2c4cac(_0x46cee9,_0xae0837))||_0x3c6e68;}return _0x519878>0x3&&_0x3c6e68&&Object[_0x1f91d1(0x129)](_0x46cee9,_0xae0837,_0x3c6e68),_0x3c6e68;},__metadata=this&&this[a103_0x189131(0x117)]||function(_0x12242d,_0x53d3b7){const _0x1d3a26=a103_0x189131;if(typeof Reflect===_0x1d3a26(0xff)&&typeof Reflect['metadata']===_0x1d3a26(0xf6))return Reflect['metadata'](_0x12242d,_0x53d3b7);},__importDefault=this&&this[a103_0x189131(0x130)]||function(_0x17433b){return _0x17433b&&_0x17433b['__esModule']?_0x17433b:{'default':_0x17433b};};Object[a103_0x189131(0x129)](exports,'__esModule',{'value':!![]}),exports['SalesforceAuthService']=void 0x0;function a103_0x5661(_0x4e3e8f,_0x559180){const _0x16a95f=a103_0x4dd0();return a103_0x5661=function(_0x392d10,_0x2e1da1){_0x392d10=_0x392d10-0xe8;let _0x4dd0de=_0x16a95f[_0x392d10];return _0x4dd0de;},a103_0x5661(_0x4e3e8f,_0x559180);}const typedi_1=require(a103_0x189131(0xf5)),errors_1=require(a103_0x189131(0x11c)),core_1=require(a103_0x189131(0xef)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require('axios')),utils_1=require(a103_0x189131(0x12e)),invalid_refresh_token_error_1=require(a103_0x189131(0x126)),auth_state_enum_1=require('../enums/auth-state.enum'),unauthorized_salesforce_error_1=require(a103_0x189131(0xec)),constants_1=require(a103_0x189131(0x10e)),logger=new core_1['Logger'](a103_0x189131(0x10b));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x335141){const _0x459191=a103_0x189131;this[_0x459191(0x108)]=_0x335141,this[_0x459191(0xfe)]=0x1388,this[_0x459191(0xf7)]=auth_state_enum_1['AuthState'][_0x459191(0xf4)],this[_0x459191(0x125)]();}get['settings'](){const _0x2843e6=a103_0x189131;return this[_0x2843e6(0x108)][_0x2843e6(0x101)];}async['setAuthDetails'](){const _0x5a3de1=a103_0x189131;logger[_0x5a3de1(0xf1)](_0x5a3de1(0x112),auth_state_enum_1[_0x5a3de1(0xfc)][this[_0x5a3de1(0xf7)]]);try{if(this[_0x5a3de1(0xf7)]===auth_state_enum_1[_0x5a3de1(0xfc)][_0x5a3de1(0xea)])return;if(this['authState']===auth_state_enum_1[_0x5a3de1(0xfc)][_0x5a3de1(0xf4)])await this[_0x5a3de1(0x11e)]();else{const _0x24bc4e=await this['requestConfig'](),_0x5764d6=await axios_1[_0x5a3de1(0xfb)][_0x5a3de1(0x119)](_0x5a3de1(0x111)+constants_1['SALESFORCE_API_VERSION'],_0x24bc4e)['then'](()=>!![])[_0x5a3de1(0xf9)](()=>![]);!_0x5764d6&&await this[_0x5a3de1(0x11e)]();}}catch(_0x3ceeb){}}async[a103_0x189131(0x11e)](){const _0x3d3f24=a103_0x189131;var _0x5a68eb,_0x53d951,_0x347f76;logger[_0x3d3f24(0xf1)](_0x3d3f24(0x10a));try{this[_0x3d3f24(0xf7)]=auth_state_enum_1[_0x3d3f24(0xfc)]['Updating'];const {refreshToken:_0x21bd08,clientId:_0x2a2c7f,clientSecret:_0xa8f07e}=this[_0x3d3f24(0x101)],{data:_0x43167a}=await axios_1['default'][_0x3d3f24(0x12f)](utils_1['joinURL'](this[_0x3d3f24(0x108)][_0x3d3f24(0xed)],_0x3d3f24(0x12b)),null,{'params':{'grant_type':'refresh_token','refresh_token':_0x21bd08,'client_id':_0x2a2c7f,'client_secret':_0xa8f07e}});this[_0x3d3f24(0x103)]=_0x43167a[_0x3d3f24(0x123)],this[_0x3d3f24(0x11d)]=_0x43167a[_0x3d3f24(0x120)],this['tokenType']=_0x43167a[_0x3d3f24(0xfa)],this[_0x3d3f24(0xf7)]=auth_state_enum_1['AuthState'][_0x3d3f24(0x116)],logger[_0x3d3f24(0xf1)](_0x3d3f24(0x12d),this[_0x3d3f24(0x103)]);}catch(_0x5bf13a){const _0x4a45ec=((_0x53d951=(_0x5a68eb=_0x5bf13a===null||_0x5bf13a===void 0x0?void 0x0:_0x5bf13a['response'])===null||_0x5a68eb===void 0x0?void 0x0:_0x5a68eb['data'])===null||_0x53d951===void 0x0?void 0x0:_0x53d951[_0x3d3f24(0x122)])||((_0x347f76=_0x5bf13a===null||_0x5bf13a===void 0x0?void 0x0:_0x5bf13a[_0x3d3f24(0xfd)])===null||_0x347f76===void 0x0?void 0x0:_0x347f76[_0x3d3f24(0x109)])||_0x5bf13a['message'];logger[_0x3d3f24(0x122)]('update\x20access\x20token\x20failed:\x20%s',_0x4a45ec),this[_0x3d3f24(0xf7)]=auth_state_enum_1[_0x3d3f24(0xfc)][_0x3d3f24(0xea)];throw new invalid_refresh_token_error_1[(_0x3d3f24(0xee))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async[a103_0x189131(0x115)](){const _0x4a7c87=a103_0x189131;logger[_0x4a7c87(0xf1)]('force\x20update\x20token');if(this['authState']===auth_state_enum_1[_0x4a7c87(0xfc)][_0x4a7c87(0x105)]||this[_0x4a7c87(0xf7)]===auth_state_enum_1[_0x4a7c87(0xfc)][_0x4a7c87(0xf4)])return await utils_1[_0x4a7c87(0x12c)](this['AUTH_WAIT_TIME']),this[_0x4a7c87(0x115)]();if(this[_0x4a7c87(0xf7)]===auth_state_enum_1['AuthState'][_0x4a7c87(0xea)])throw new invalid_refresh_token_error_1[(_0x4a7c87(0xee))](errors_1[_0x4a7c87(0x11b)]);await this['updateAccessToken']();}async[a103_0x189131(0x102)](){const _0x544dcf=a103_0x189131;if(this[_0x544dcf(0xf7)]===auth_state_enum_1[_0x544dcf(0xfc)][_0x544dcf(0xea)]){logger[_0x544dcf(0xf1)](_0x544dcf(0xe8));throw new unauthorized_salesforce_error_1[(_0x544dcf(0x11f))]();}if(this[_0x544dcf(0xf7)]!==auth_state_enum_1['AuthState'][_0x544dcf(0x116)])return logger[_0x544dcf(0xf1)]('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x544dcf(0x12c)](this[_0x544dcf(0xfe)]),this[_0x544dcf(0x102)]();return{'baseURL':this[_0x544dcf(0x103)],'headers':{'accept':_0x544dcf(0x121),'content-type':_0x544dcf(0x121),'authorization':this[_0x544dcf(0xf2)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=__decorate([typedi_1['Service'](),__metadata(a103_0x189131(0x10d),[salesforce_settings_service_1[a103_0x189131(0x100)]])],SalesforceAuthService),exports[a103_0x189131(0x128)]=SalesforceAuthService;