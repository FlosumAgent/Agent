const a103_0x18d0=['../enums/auth-state.enum','setAuthDetails','InvalidRefreshTokenError','apply','../errors/invalid-refresh-token.error','../../../constants/errors','__decorate','constructor','authState','design:paramtypes','function','log','150842nrTOhz','1yfhnBj','axios','SalesforceSettingsService','/services/oauth2/token','1EuEsKY','updateAccessToken','10IvIBvl','SalesforceAuthService','../../../constants','force\x20update\x20token','response','104723ywVNRl','salesforseSettings','accessToken','check\x20auth:\x20current\x20state\x20-\x20%s','refresh_token','791375aaGiuT','../../../core','1073971OshNIG','decorate','create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done','ERR_INVALID_SALESFORCE_TOKEN','create\x20authorized\x20request','Active','Updating','defineProperty','517811MROzKk','salesforce-auth-service','create\x20authorized\x20request\x20failed:\x20authorization\x20error','default','__metadata','length','test','settings','AUTH_WAIT_TIME','access_token','132536JMOvjC','data','requestConfig','Idle','sleep','loginUrl','update\x20access\x20token\x20failed:\x20%s','token_type','tokenType','instanceUrl','error','catch','instance_url','../../shared/utils','post','access\x20token\x20updated\x20for\x20%s','message','typedi','getOwnPropertyDescriptor','return\x20/\x22\x20+\x20this\x20+\x20\x22/','1144792uQOttV','__esModule','AuthState','__importDefault','Error','metadata','SALESFORCE_API_VERSION'];const a103_0x393790=a103_0x275a;(function(_0x2e1da2,_0x267256){const _0x5a1e32=a103_0x275a;while(!![]){try{const _0x59392b=parseInt(_0x5a1e32(0x145))+parseInt(_0x5a1e32(0x10c))+-parseInt(_0x5a1e32(0x11e))*parseInt(_0x5a1e32(0x14c))+parseInt(_0x5a1e32(0x132))+-parseInt(_0x5a1e32(0x10a))+parseInt(_0x5a1e32(0x105))*-parseInt(_0x5a1e32(0x146))+parseInt(_0x5a1e32(0x14a))*parseInt(_0x5a1e32(0x114));if(_0x59392b===_0x267256)break;else _0x2e1da2['push'](_0x2e1da2['shift']());}catch(_0x39d5c6){_0x2e1da2['push'](_0x2e1da2['shift']());}}}(a103_0x18d0,0xa2966));const a103_0x1a1e35=function(){let _0x1c4791=!![];return function(_0x3e428a,_0x5e032f){const _0xe49f98=_0x1c4791?function(){const _0x3444d8=a103_0x275a;if(_0x5e032f){const _0x10a214=_0x5e032f[_0x3444d8(0x13c)](_0x3e428a,arguments);return _0x5e032f=null,_0x10a214;}}:function(){};return _0x1c4791=![],_0xe49f98;};}(),a103_0x5ceee1=a103_0x1a1e35(this,function(){const _0x2a7e9c=function(){const _0x24eea0=a103_0x275a,_0x1e2808=_0x2a7e9c[_0x24eea0(0x140)](_0x24eea0(0x131))()[_0x24eea0(0x140)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x1e2808[_0x24eea0(0x11a)](a103_0x5ceee1);};return _0x2a7e9c();});a103_0x5ceee1();'use strict';var __decorate=this&&this[a103_0x393790(0x13f)]||function(_0x3fb1f9,_0xdfd7ac,_0x35983d,_0x24ef81){const _0x4ad94c=a103_0x393790;var _0x2b4425=arguments['length'],_0x1e0aaa=_0x2b4425<0x3?_0xdfd7ac:_0x24ef81===null?_0x24ef81=Object[_0x4ad94c(0x130)](_0xdfd7ac,_0x35983d):_0x24ef81,_0x321d9f;if(typeof Reflect==='object'&&typeof Reflect[_0x4ad94c(0x10d)]==='function')_0x1e0aaa=Reflect[_0x4ad94c(0x10d)](_0x3fb1f9,_0xdfd7ac,_0x35983d,_0x24ef81);else{for(var _0x4491a6=_0x3fb1f9[_0x4ad94c(0x119)]-0x1;_0x4491a6>=0x0;_0x4491a6--)if(_0x321d9f=_0x3fb1f9[_0x4491a6])_0x1e0aaa=(_0x2b4425<0x3?_0x321d9f(_0x1e0aaa):_0x2b4425>0x3?_0x321d9f(_0xdfd7ac,_0x35983d,_0x1e0aaa):_0x321d9f(_0xdfd7ac,_0x35983d))||_0x1e0aaa;}return _0x2b4425>0x3&&_0x1e0aaa&&Object[_0x4ad94c(0x113)](_0xdfd7ac,_0x35983d,_0x1e0aaa),_0x1e0aaa;},__metadata=this&&this[a103_0x393790(0x118)]||function(_0x26409f,_0x14930a){const _0x1a1993=a103_0x393790;if(typeof Reflect==='object'&&typeof Reflect[_0x1a1993(0x137)]===_0x1a1993(0x143))return Reflect[_0x1a1993(0x137)](_0x26409f,_0x14930a);},__importDefault=this&&this[a103_0x393790(0x135)]||function(_0x7cd3c9){const _0x4ee71b=a103_0x393790;return _0x7cd3c9&&_0x7cd3c9[_0x4ee71b(0x133)]?_0x7cd3c9:{'default':_0x7cd3c9};};function a103_0x275a(_0x2451ef,_0x418eb2){return a103_0x275a=function(_0x2fece4,_0x5ceee1){_0x2fece4=_0x2fece4-0x101;let _0x1a1e35=a103_0x18d0[_0x2fece4];return _0x1a1e35;},a103_0x275a(_0x2451ef,_0x418eb2);}Object[a103_0x393790(0x113)](exports,a103_0x393790(0x133),{'value':!![]}),exports[a103_0x393790(0x101)]=void 0x0;const typedi_1=require(a103_0x393790(0x12f)),errors_1=require(a103_0x393790(0x13e)),core_1=require(a103_0x393790(0x10b)),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),axios_1=__importDefault(require(a103_0x393790(0x147))),utils_1=require(a103_0x393790(0x12b)),invalid_refresh_token_error_1=require(a103_0x393790(0x13d)),auth_state_enum_1=require(a103_0x393790(0x139)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a103_0x393790(0x102)),logger=new core_1['Logger'](a103_0x393790(0x115));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x4245d6){const _0x1d0528=a103_0x393790;this[_0x1d0528(0x106)]=_0x4245d6,this[_0x1d0528(0x11c)]=0x1388,this[_0x1d0528(0x141)]=auth_state_enum_1[_0x1d0528(0x134)][_0x1d0528(0x121)],this['setAuthDetails']();}get[a103_0x393790(0x11b)](){const _0x142082=a103_0x393790;return this[_0x142082(0x106)][_0x142082(0x11b)];}async[a103_0x393790(0x13a)](){const _0x3a96dd=a103_0x393790;logger[_0x3a96dd(0x144)](_0x3a96dd(0x108),auth_state_enum_1['AuthState'][this[_0x3a96dd(0x141)]]);try{if(this[_0x3a96dd(0x141)]===auth_state_enum_1['AuthState'][_0x3a96dd(0x136)])return;if(this['authState']===auth_state_enum_1[_0x3a96dd(0x134)][_0x3a96dd(0x121)])await this[_0x3a96dd(0x14b)]();else{const _0x907508=await this[_0x3a96dd(0x120)](),_0xf91d6e=await axios_1[_0x3a96dd(0x117)]['get']('services/data/'+constants_1[_0x3a96dd(0x138)],_0x907508)['then'](()=>!![])[_0x3a96dd(0x129)](()=>![]);!_0xf91d6e&&await this[_0x3a96dd(0x14b)]();}}catch(_0xb24129){}}async[a103_0x393790(0x14b)](){const _0x5c6e49=a103_0x393790;var _0x46cad2,_0x29aedd,_0x146b9b;logger[_0x5c6e49(0x144)]('update\x20access\x20token');try{this[_0x5c6e49(0x141)]=auth_state_enum_1['AuthState'][_0x5c6e49(0x112)];const {refreshToken:_0x2bd803,clientId:_0x4dff9f,clientSecret:_0x382923}=this[_0x5c6e49(0x11b)],{data:_0x194681}=await axios_1['default'][_0x5c6e49(0x12c)](utils_1['joinURL'](this[_0x5c6e49(0x106)][_0x5c6e49(0x123)],_0x5c6e49(0x149)),null,{'params':{'grant_type':_0x5c6e49(0x109),'refresh_token':_0x2bd803,'client_id':_0x4dff9f,'client_secret':_0x382923}});this[_0x5c6e49(0x127)]=_0x194681[_0x5c6e49(0x12a)],this[_0x5c6e49(0x107)]=_0x194681[_0x5c6e49(0x11d)],this[_0x5c6e49(0x126)]=_0x194681[_0x5c6e49(0x125)],this[_0x5c6e49(0x141)]=auth_state_enum_1[_0x5c6e49(0x134)][_0x5c6e49(0x111)],logger[_0x5c6e49(0x144)](_0x5c6e49(0x12d),this[_0x5c6e49(0x127)]);}catch(_0x239251){const _0x43cf9d=((_0x29aedd=(_0x46cad2=_0x239251===null||_0x239251===void 0x0?void 0x0:_0x239251[_0x5c6e49(0x104)])===null||_0x46cad2===void 0x0?void 0x0:_0x46cad2[_0x5c6e49(0x11f)])===null||_0x29aedd===void 0x0?void 0x0:_0x29aedd['error'])||((_0x146b9b=_0x239251===null||_0x239251===void 0x0?void 0x0:_0x239251[_0x5c6e49(0x104)])===null||_0x146b9b===void 0x0?void 0x0:_0x146b9b[_0x5c6e49(0x11f)])||_0x239251[_0x5c6e49(0x12e)];logger[_0x5c6e49(0x128)](_0x5c6e49(0x124),_0x43cf9d),this['authState']=auth_state_enum_1[_0x5c6e49(0x134)]['Error'];throw new invalid_refresh_token_error_1[(_0x5c6e49(0x13b))](errors_1['ERR_INVALID_SALESFORCE_TOKEN']);}}async['forceUpdateToken'](){const _0x3fdef9=a103_0x393790;logger[_0x3fdef9(0x144)](_0x3fdef9(0x103));if(this[_0x3fdef9(0x141)]===auth_state_enum_1[_0x3fdef9(0x134)][_0x3fdef9(0x112)]||this[_0x3fdef9(0x141)]===auth_state_enum_1[_0x3fdef9(0x134)][_0x3fdef9(0x121)])return await utils_1[_0x3fdef9(0x122)](this[_0x3fdef9(0x11c)]),this['forceUpdateToken']();if(this['authState']===auth_state_enum_1[_0x3fdef9(0x134)][_0x3fdef9(0x136)])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x3fdef9(0x10f)]);await this[_0x3fdef9(0x14b)]();}async[a103_0x393790(0x120)](){const _0x2bc4b1=a103_0x393790;if(this[_0x2bc4b1(0x141)]===auth_state_enum_1[_0x2bc4b1(0x134)][_0x2bc4b1(0x136)]){logger[_0x2bc4b1(0x144)](_0x2bc4b1(0x116));throw new unauthorized_salesforce_error_1['UnauthorizedSalesforceError']();}if(this[_0x2bc4b1(0x141)]!==auth_state_enum_1['AuthState'][_0x2bc4b1(0x111)])return logger[_0x2bc4b1(0x144)](_0x2bc4b1(0x10e)),await utils_1[_0x2bc4b1(0x122)](this[_0x2bc4b1(0x11c)]),this[_0x2bc4b1(0x120)]();return logger[_0x2bc4b1(0x144)](_0x2bc4b1(0x110)),{'baseURL':this[_0x2bc4b1(0x127)],'headers':{'accept':'application/json','authorization':this['tokenType']+'\x20'+this[_0x2bc4b1(0x107)]}};}};SalesforceAuthService=__decorate([typedi_1['Service'](),__metadata(a103_0x393790(0x142),[salesforce_settings_service_1[a103_0x393790(0x148)]])],SalesforceAuthService),exports[a103_0x393790(0x101)]=SalesforceAuthService;