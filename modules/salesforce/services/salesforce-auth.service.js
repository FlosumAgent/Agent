const a103_0x18f3=['catch','719537CtfRDO','17tpsqlq','create\x20authorized\x20request\x20failed:\x20authorization\x20error','test','constructor','get','force\x20update\x20token','error','Service','__metadata','typedi','__esModule','52kpyyCW','/services/oauth2/token','467471CkhiPk','message','../../../constants/errors','update\x20access\x20token','../../shared/utils','Idle','application/json','salesforseSettings','salesforce-auth-service','Active','tokenType','settings','loginUrl','Logger','access\x20token\x20updated\x20for\x20%s','__importDefault','refresh_token','design:paramtypes','../enums/auth-state.enum','log','defineProperty','default','AUTH_WAIT_TIME','getOwnPropertyDescriptor','response','639193NXAxry','109305tjBUir','length','Error','../errors/invalid-refresh-token.error','AuthState','post','../../shared/services/salesforce-settings.service','services/data/','../../../constants','decorate','InvalidRefreshTokenError','1964124EoYljX','function','__decorate','SALESFORCE_API_VERSION','ERR_INVALID_SALESFORCE_TOKEN','SalesforceAuthService','updateAccessToken','requestConfig','axios','UnauthorizedSalesforceError','return\x20/\x22\x20+\x20this\x20+\x20\x22/','authState','18301sslqQT','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','sleep','setAuthDetails','access_token','forceUpdateToken','../../../core','61aDjpWc','instanceUrl','metadata','data','apply'];const a103_0x16f20b=a103_0x5eee;(function(_0x367ca4,_0x274dc2){const _0x4e5ead=a103_0x5eee;while(!![]){try{const _0x4fbbfe=-parseInt(_0x4e5ead(0x8f))+parseInt(_0x4e5ead(0xa8))+-parseInt(_0x4e5ead(0x8d))*parseInt(_0x4e5ead(0xc0))+parseInt(_0x4e5ead(0xa9))+parseInt(_0x4e5ead(0x82))*-parseInt(_0x4e5ead(0x7b))+-parseInt(_0x4e5ead(0x81))+parseInt(_0x4e5ead(0xb4));if(_0x4fbbfe===_0x274dc2)break;else _0x367ca4['push'](_0x367ca4['shift']());}catch(_0x1ac0a3){_0x367ca4['push'](_0x367ca4['shift']());}}}(a103_0x18f3,0x8bdfd));const a103_0x5b47c2=function(){let _0x554d44=!![];return function(_0xc406de,_0x45654c){const _0x1930b4=_0x554d44?function(){const _0x403be0=a103_0x5eee;if(_0x45654c){const _0x56c436=_0x45654c[_0x403be0(0x7f)](_0xc406de,arguments);return _0x45654c=null,_0x56c436;}}:function(){};return _0x554d44=![],_0x1930b4;};}(),a103_0x1dbab9=a103_0x5b47c2(this,function(){const _0x29c74e=function(){const _0xa3bafb=a103_0x5eee,_0x1064ca=_0x29c74e[_0xa3bafb(0x85)](_0xa3bafb(0xbe))()[_0xa3bafb(0x85)](_0xa3bafb(0xc1));return!_0x1064ca[_0xa3bafb(0x84)](a103_0x1dbab9);};return _0x29c74e();});a103_0x1dbab9();'use strict';function a103_0x5eee(_0x55df7c,_0x324666){return a103_0x5eee=function(_0x3b4c50,_0x1dbab9){_0x3b4c50=_0x3b4c50-0x78;let _0x5b47c2=a103_0x18f3[_0x3b4c50];return _0x5b47c2;},a103_0x5eee(_0x55df7c,_0x324666);}var __decorate=this&&this[a103_0x16f20b(0xb6)]||function(_0x5de57a,_0x296fa3,_0x385c17,_0x15fd7f){const _0x25c043=a103_0x16f20b;var _0x158796=arguments['length'],_0x56f504=_0x158796<0x3?_0x296fa3:_0x15fd7f===null?_0x15fd7f=Object[_0x25c043(0xa6)](_0x296fa3,_0x385c17):_0x15fd7f,_0x52e0c9;if(typeof Reflect==='object'&&typeof Reflect[_0x25c043(0xb2)]===_0x25c043(0xb5))_0x56f504=Reflect[_0x25c043(0xb2)](_0x5de57a,_0x296fa3,_0x385c17,_0x15fd7f);else{for(var _0x32503d=_0x5de57a[_0x25c043(0xaa)]-0x1;_0x32503d>=0x0;_0x32503d--)if(_0x52e0c9=_0x5de57a[_0x32503d])_0x56f504=(_0x158796<0x3?_0x52e0c9(_0x56f504):_0x158796>0x3?_0x52e0c9(_0x296fa3,_0x385c17,_0x56f504):_0x52e0c9(_0x296fa3,_0x385c17))||_0x56f504;}return _0x158796>0x3&&_0x56f504&&Object[_0x25c043(0xa3)](_0x296fa3,_0x385c17,_0x56f504),_0x56f504;},__metadata=this&&this[a103_0x16f20b(0x8a)]||function(_0x2f3ae6,_0x4f1e76){const _0xa4cd01=a103_0x16f20b;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0xa4cd01(0x7d)](_0x2f3ae6,_0x4f1e76);},__importDefault=this&&this[a103_0x16f20b(0x9e)]||function(_0x2e596c){const _0x347825=a103_0x16f20b;return _0x2e596c&&_0x2e596c[_0x347825(0x8c)]?_0x2e596c:{'default':_0x2e596c};};Object[a103_0x16f20b(0xa3)](exports,a103_0x16f20b(0x8c),{'value':!![]}),exports[a103_0x16f20b(0xb9)]=void 0x0;const typedi_1=require(a103_0x16f20b(0x8b)),errors_1=require(a103_0x16f20b(0x91)),core_1=require(a103_0x16f20b(0x7a)),salesforce_settings_service_1=require(a103_0x16f20b(0xaf)),axios_1=__importDefault(require(a103_0x16f20b(0xbc))),utils_1=require(a103_0x16f20b(0x93)),invalid_refresh_token_error_1=require(a103_0x16f20b(0xac)),auth_state_enum_1=require(a103_0x16f20b(0xa1)),unauthorized_salesforce_error_1=require('../errors/unauthorized-salesforce.error'),constants_1=require(a103_0x16f20b(0xb1)),logger=new core_1[(a103_0x16f20b(0x9c))](a103_0x16f20b(0x97));let SalesforceAuthService=class SalesforceAuthService{constructor(_0x50e21b){const _0x1d8cb4=a103_0x16f20b;this[_0x1d8cb4(0x96)]=_0x50e21b,this[_0x1d8cb4(0xa5)]=0x1388,this['authState']=auth_state_enum_1[_0x1d8cb4(0xad)]['Idle'],this[_0x1d8cb4(0xc3)]();}get[a103_0x16f20b(0x9a)](){const _0x416f39=a103_0x16f20b;return this[_0x416f39(0x96)][_0x416f39(0x9a)];}async[a103_0x16f20b(0xc3)](){const _0x2273fd=a103_0x16f20b;logger[_0x2273fd(0xa2)]('check\x20auth:\x20current\x20state\x20-\x20%s',auth_state_enum_1['AuthState'][this['authState']]);try{if(this[_0x2273fd(0xbf)]===auth_state_enum_1['AuthState'][_0x2273fd(0xab)])return;if(this['authState']===auth_state_enum_1[_0x2273fd(0xad)][_0x2273fd(0x94)])await this['updateAccessToken']();else{const _0x22c3c7=await this[_0x2273fd(0xbb)](),_0x5b3857=await axios_1[_0x2273fd(0xa4)][_0x2273fd(0x86)](_0x2273fd(0xb0)+constants_1[_0x2273fd(0xb7)],_0x22c3c7)['then'](()=>!![])[_0x2273fd(0x80)](()=>![]);!_0x5b3857&&await this[_0x2273fd(0xba)]();}}catch(_0x3caf30){}}async['updateAccessToken'](){const _0x423f26=a103_0x16f20b;var _0x4c794f,_0x3a556d,_0x36d724;logger['log'](_0x423f26(0x92));try{this['authState']=auth_state_enum_1[_0x423f26(0xad)]['Updating'];const {refreshToken:_0x2ec22e,clientId:_0x241f6b,clientSecret:_0x5ee29c}=this['settings'],{data:_0x1279f9}=await axios_1['default'][_0x423f26(0xae)](utils_1['joinURL'](this[_0x423f26(0x96)][_0x423f26(0x9b)],_0x423f26(0x8e)),null,{'params':{'grant_type':_0x423f26(0x9f),'refresh_token':_0x2ec22e,'client_id':_0x241f6b,'client_secret':_0x5ee29c}});this[_0x423f26(0x7c)]=_0x1279f9['instance_url'],this['accessToken']=_0x1279f9[_0x423f26(0x78)],this['tokenType']=_0x1279f9['token_type'],this['authState']=auth_state_enum_1[_0x423f26(0xad)][_0x423f26(0x98)],logger[_0x423f26(0xa2)](_0x423f26(0x9d),this[_0x423f26(0x7c)]);}catch(_0x59db10){const _0x346dfd=((_0x3a556d=(_0x4c794f=_0x59db10===null||_0x59db10===void 0x0?void 0x0:_0x59db10[_0x423f26(0xa7)])===null||_0x4c794f===void 0x0?void 0x0:_0x4c794f[_0x423f26(0x7e)])===null||_0x3a556d===void 0x0?void 0x0:_0x3a556d[_0x423f26(0x88)])||((_0x36d724=_0x59db10===null||_0x59db10===void 0x0?void 0x0:_0x59db10[_0x423f26(0xa7)])===null||_0x36d724===void 0x0?void 0x0:_0x36d724['data'])||_0x59db10[_0x423f26(0x90)];logger[_0x423f26(0x88)]('update\x20access\x20token\x20failed:\x20%s',_0x346dfd),this['authState']=auth_state_enum_1[_0x423f26(0xad)]['Error'];throw new invalid_refresh_token_error_1[(_0x423f26(0xb3))](errors_1[_0x423f26(0xb8)]);}}async[a103_0x16f20b(0x79)](){const _0x33cd5e=a103_0x16f20b;logger[_0x33cd5e(0xa2)](_0x33cd5e(0x87));if(this[_0x33cd5e(0xbf)]===auth_state_enum_1[_0x33cd5e(0xad)]['Updating']||this[_0x33cd5e(0xbf)]===auth_state_enum_1[_0x33cd5e(0xad)][_0x33cd5e(0x94)])return await utils_1[_0x33cd5e(0xc2)](this[_0x33cd5e(0xa5)]),this[_0x33cd5e(0x79)]();if(this[_0x33cd5e(0xbf)]===auth_state_enum_1[_0x33cd5e(0xad)]['Error'])throw new invalid_refresh_token_error_1['InvalidRefreshTokenError'](errors_1[_0x33cd5e(0xb8)]);await this[_0x33cd5e(0xba)]();}async[a103_0x16f20b(0xbb)](){const _0x26a69b=a103_0x16f20b;if(this[_0x26a69b(0xbf)]===auth_state_enum_1[_0x26a69b(0xad)][_0x26a69b(0xab)]){logger[_0x26a69b(0xa2)](_0x26a69b(0x83));throw new unauthorized_salesforce_error_1[(_0x26a69b(0xbd))]();}if(this['authState']!==auth_state_enum_1[_0x26a69b(0xad)][_0x26a69b(0x98)])return logger['log']('create\x20authorized\x20request\x20failed:\x20authorization\x20is\x20not\x20done'),await utils_1[_0x26a69b(0xc2)](this['AUTH_WAIT_TIME']),this[_0x26a69b(0xbb)]();return{'baseURL':this[_0x26a69b(0x7c)],'headers':{'accept':'application/json','content-type':_0x26a69b(0x95),'authorization':this[_0x26a69b(0x99)]+'\x20'+this['accessToken']}};}};SalesforceAuthService=__decorate([typedi_1[a103_0x16f20b(0x89)](),__metadata(a103_0x16f20b(0xa0),[salesforce_settings_service_1['SalesforceSettingsService']])],SalesforceAuthService),exports[a103_0x16f20b(0xb9)]=SalesforceAuthService;