const a126_0x1de6f0=a126_0x392e;function a126_0x392e(_0x5df3e1,_0x2ea043){const _0x43c6da=a126_0x43a2();return a126_0x392e=function(_0x27b474,_0x2ea0f4){_0x27b474=_0x27b474-0x168;let _0x43a2cd=_0x43c6da[_0x27b474];return _0x43a2cd;},a126_0x392e(_0x5df3e1,_0x2ea043);}(function(_0x40daa9,_0x27f260){const _0x5c4550=a126_0x392e,_0x196e4a=_0x40daa9();while(!![]){try{const _0xab76a9=parseInt(_0x5c4550(0x16c))/0x1+parseInt(_0x5c4550(0x171))/0x2*(parseInt(_0x5c4550(0x1a6))/0x3)+parseInt(_0x5c4550(0x199))/0x4+parseInt(_0x5c4550(0x197))/0x5*(-parseInt(_0x5c4550(0x16e))/0x6)+parseInt(_0x5c4550(0x190))/0x7+parseInt(_0x5c4550(0x184))/0x8+-parseInt(_0x5c4550(0x192))/0x9;if(_0xab76a9===_0x27f260)break;else _0x196e4a['push'](_0x196e4a['shift']());}catch(_0x11402b){_0x196e4a['push'](_0x196e4a['shift']());}}}(a126_0x43a2,0x26096));const a126_0x2ea0f4=function(){let _0x304748=!![];return function(_0x206072,_0x34c0ca){const _0x3918da=_0x304748?function(){if(_0x34c0ca){const _0x2b4853=_0x34c0ca['apply'](_0x206072,arguments);return _0x34c0ca=null,_0x2b4853;}}:function(){};return _0x304748=![],_0x3918da;};}(),a126_0x27b474=a126_0x2ea0f4(this,function(){const _0x31e0ce=a126_0x392e;return a126_0x27b474[_0x31e0ce(0x17e)]()['search'](_0x31e0ce(0x176))[_0x31e0ce(0x17e)]()[_0x31e0ce(0x19c)](a126_0x27b474)['search']('(((.+)+)+)+$');});a126_0x27b474();'use strict';var __importDefault=this&&this[a126_0x1de6f0(0x1ac)]||function(_0xcdff17){const _0x51b334=a126_0x1de6f0;return _0xcdff17&&_0xcdff17[_0x51b334(0x18f)]?_0xcdff17:{'default':_0xcdff17};};Object['defineProperty'](exports,a126_0x1de6f0(0x18f),{'value':!![]}),exports[a126_0x1de6f0(0x1ab)]=void 0x0;const core_1=require(a126_0x1de6f0(0x172)),typedi_1=__importDefault(require(a126_0x1de6f0(0x194))),constants_1=require(a126_0x1de6f0(0x1a4)),utils_1=require(a126_0x1de6f0(0x187)),salesforce_error_1=require('../errors/salesforce.error'),composite_utils_1=require(a126_0x1de6f0(0x183)),salesforce_components_manager_service_1=require(a126_0x1de6f0(0x1af)),salesforce_composite_service_1=require(a126_0x1de6f0(0x1a7)),salesforce_git_sync_service_1=require(a126_0x1de6f0(0x17b));class SalesforceCommitsManager{constructor(_0x46a03c){const _0xbe3da4=a126_0x1de6f0;this['options']=_0x46a03c,this[_0xbe3da4(0x19f)]=0x3,this[_0xbe3da4(0x180)]=new core_1[(_0xbe3da4(0x16a))](SalesforceCommitsManager[_0xbe3da4(0x169)]),this[_0xbe3da4(0x18a)]=this[_0xbe3da4(0x17f)][_0xbe3da4(0x180)],this['composite']=typedi_1[_0xbe3da4(0x173)][_0xbe3da4(0x177)](salesforce_composite_service_1[_0xbe3da4(0x19e)]),this[_0xbe3da4(0x182)]=typedi_1[_0xbe3da4(0x173)]['get'](salesforce_git_sync_service_1[_0xbe3da4(0x1ad)]),this['proceededComponentsMeta']=[];}async[a126_0x1de6f0(0x16b)](_0x15beff,_0xe8b821=![]){const _0x135492=a126_0x1de6f0,_0x33d876=(this[_0x135492(0x19f)]+ +_0xe8b821)*0x3,_0x56fbd0=utils_1[_0x135492(0x1a9)](_0x15beff,_0x33d876);try{while(_0x56fbd0['length']){const _0x2843d1=_0x56fbd0[_0x135492(0x1a8)](0x0,Math[_0x135492(0x178)](constants_1['SALESFORCE_MAX_GRAPH_NODES_PER_REQUEST']/_0x33d876));await this[_0x135492(0x18a)][_0x135492(0x18c)]('[INFO]\x20Sending\x20'+_0x2843d1['length']*_0x33d876+_0x135492(0x198))[_0x135492(0x18d)]();const _0x34ccfb=_0x2843d1[_0x135492(0x1a5)]((_0x287a13,_0x49dd5c)=>({'graphId':_0x135492(0x16f)+_0x49dd5c,'compositeRequest':_0x287a13})),_0x31f086=await this['composite'][_0x135492(0x186)](_0x34ccfb);if(_0xe8b821){const _0x2bfcde=composite_utils_1['extractComponentIdsFromGraphsResponse'](_0x31f086);for(const {id:_0x1db80d,ref:_0x23b9b6}of _0x2bfcde){const _0x39bab3=this[_0x135492(0x193)][_0x135492(0x179)](_0x16cabb=>_0x16cabb['reference']===_0x23b9b6);_0x39bab3&&(_0x39bab3['componentId']=_0x1db80d);}}}}catch(_0x4fb6ac){this['logger']['error'](_0x4fb6ac instanceof salesforce_error_1[_0x135492(0x1aa)]?JSON[_0x135492(0x18e)](_0x4fb6ac[_0x135492(0x185)](),null,0x2):_0x4fb6ac),this['sfLogger'][_0x135492(0x18c)](_0x4fb6ac instanceof salesforce_error_1[_0x135492(0x1aa)]?JSON[_0x135492(0x18e)](_0x4fb6ac['toJSON'](),null,0x2):_0x4fb6ac['toString']());throw _0x4fb6ac;}}async['proceedCommitsToRepository'](_0x414e64){const _0x532fd8=a126_0x1de6f0;for(const _0x158341 of _0x414e64){if(!_0x158341[_0x532fd8(0x16d)][_0x532fd8(0x196)]&&!_0x158341['modified'][_0x532fd8(0x196)]&&!_0x158341[_0x532fd8(0x18b)][_0x532fd8(0x196)])continue;let _0x39c75d='';(_0x158341[_0x532fd8(0x19b)][_0x532fd8(0x196)]||_0x158341[_0x532fd8(0x16d)][_0x532fd8(0x196)])&&(_0x39c75d=await this[_0x532fd8(0x182)][_0x532fd8(0x1a2)](_0x158341[_0x532fd8(0x188)],this['options']['repositoryId']));const _0x44eaec=[],_0x74e48f=[],_0x37aaea=new salesforce_components_manager_service_1[(_0x532fd8(0x17c))](this[_0x532fd8(0x17f)][_0x532fd8(0x17a)],this[_0x532fd8(0x17f)]['branchId'],_0x158341['author'],this[_0x532fd8(0x17f)][_0x532fd8(0x1ae)],this[_0x532fd8(0x193)]);_0x44eaec['push'](...await _0x37aaea[_0x532fd8(0x1a1)](_0x158341[_0x532fd8(0x16d)],_0x39c75d)),_0x44eaec[_0x532fd8(0x19d)](...await _0x37aaea['update'](_0x158341[_0x532fd8(0x19b)],_0x39c75d)),_0x74e48f[_0x532fd8(0x19d)](await _0x37aaea[_0x532fd8(0x17d)](_0x158341[_0x532fd8(0x18b)],!![])),this[_0x532fd8(0x193)]=_0x37aaea[_0x532fd8(0x1a3)](),await this[_0x532fd8(0x16b)](_0x44eaec,!![]);for(const _0x1d7008 of _0x74e48f){_0x1d7008[_0x532fd8(0x168)][_0x532fd8(0x196)]&&await this['proceedRequests'](_0x1d7008[_0x532fd8(0x168)],!![]),_0x1d7008[_0x532fd8(0x19a)][_0x532fd8(0x196)]&&await this[_0x532fd8(0x16b)](_0x1d7008[_0x532fd8(0x19a)],!![]),_0x1d7008['componentsToDelete'][_0x532fd8(0x196)]&&await this[_0x532fd8(0x16b)](_0x1d7008[_0x532fd8(0x175)],!![]);}this[_0x532fd8(0x180)][_0x532fd8(0x18c)]('have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(repository)',_0x44eaec[_0x532fd8(0x196)]);}}async['proceedCommitsToBranch'](_0x5f5179){const _0x1188d2=a126_0x1de6f0,_0x17c1e6=[],_0x5e83b5=[];for(const _0x105b3d of _0x5f5179){if(!_0x105b3d[_0x1188d2(0x16d)][_0x1188d2(0x196)]&&!_0x105b3d[_0x1188d2(0x19b)][_0x1188d2(0x196)]&&!_0x105b3d['removed'][_0x1188d2(0x196)])continue;const _0x2e7be4=new salesforce_components_manager_service_1[(_0x1188d2(0x17c))](this['options'][_0x1188d2(0x17a)],this[_0x1188d2(0x17f)][_0x1188d2(0x170)],_0x105b3d['author'],this[_0x1188d2(0x17f)][_0x1188d2(0x1ae)],[]);_0x17c1e6[_0x1188d2(0x19d)](...await _0x2e7be4[_0x1188d2(0x1a1)](_0x105b3d['inserted'])),_0x17c1e6[_0x1188d2(0x19d)](...await _0x2e7be4[_0x1188d2(0x1a0)](_0x105b3d[_0x1188d2(0x19b)])),_0x5e83b5[_0x1188d2(0x19d)](await _0x2e7be4[_0x1188d2(0x17d)](_0x105b3d[_0x1188d2(0x18b)]));}this[_0x1188d2(0x180)][_0x1188d2(0x18c)](_0x1188d2(0x195),_0x17c1e6[_0x1188d2(0x196)]),await this[_0x1188d2(0x16b)](_0x17c1e6);const _0x124468=_0x5e83b5[_0x1188d2(0x181)]((_0x18f306,_0x584e31)=>({'manifests':[..._0x18f306[_0x1188d2(0x168)],..._0x584e31[_0x1188d2(0x168)]],'componentsToDelete':[..._0x18f306['componentsToDelete'],..._0x584e31[_0x1188d2(0x175)]],'componentsToUpdate':[..._0x18f306[_0x1188d2(0x19a)],..._0x584e31[_0x1188d2(0x19a)]]}),{'manifests':[],'componentsToDelete':[],'componentsToUpdate':[]});_0x124468[_0x1188d2(0x168)][_0x1188d2(0x196)]&&await this[_0x1188d2(0x16b)](_0x124468['manifests'],!![]),_0x124468[_0x1188d2(0x19a)]['length']&&await this[_0x1188d2(0x16b)](_0x124468[_0x1188d2(0x19a)],!![]),_0x124468[_0x1188d2(0x175)][_0x1188d2(0x196)]&&await this['proceedRequests'](_0x124468[_0x1188d2(0x175)],!![]);}async[a126_0x1de6f0(0x174)](_0x5f116f){const _0x164dd2=a126_0x1de6f0;this[_0x164dd2(0x17f)]['branchId']?await this[_0x164dd2(0x191)](_0x5f116f):await this[_0x164dd2(0x189)](_0x5f116f);}}exports[a126_0x1de6f0(0x1ab)]=SalesforceCommitsManager;function a126_0x43a2(){const _0x393464=['__importDefault','SalesforceGitSyncService','recordTypes','./salesforce-components-manager.service','manifests','name','Logger','proceedRequests','33894leMhTr','inserted','90pVzwoi','graph','branchId','3132uhCHbG','../../../core','default','proceedCommits','componentsToDelete','(((.+)+)+)+$','get','floor','find','repositoryId','./salesforce-git-sync.service','SalesforceComponentsManager','delete','toString','options','logger','reduce','gitSync','../utils/composite.utils','1086856wgFtVL','toJSON','executeGraphs','../../shared/utils','message','proceedCommitsToRepository','sfLogger','removed','log','send','stringify','__esModule','1624077IXgwDc','proceedCommitsToBranch','2278053aLVNNw','proceededComponentsMeta','typedi','have\x20to\x20proceed\x20%d\x20composite\x20requests\x20(branch)','length','53395DafPGr','\x20requests\x20to\x20composite\x20api.','268456lQbvVA','componentsToUpdate','modified','constructor','push','SalesforceCompositeService','COMPONENTS_PER_CHUNK','update','insert','createCommit','getProceededComponentsMeta','../../../constants','map','192GsenPF','./salesforce-composite.service','splice','chunkArray','SalesforceError','SalesforceCommitsManager'];a126_0x43a2=function(){return _0x393464;};return a126_0x43a2();}