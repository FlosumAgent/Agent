const a135_0x3a4b52=a135_0x5b16;(function(_0x294850,_0x3ae4e8){const _0x291fb6=a135_0x5b16,_0x4faf20=_0x294850();while(!![]){try{const _0x5e342d=-parseInt(_0x291fb6(0x207))/0x1+-parseInt(_0x291fb6(0x20b))/0x2+parseInt(_0x291fb6(0x22d))/0x3*(parseInt(_0x291fb6(0x1fb))/0x4)+-parseInt(_0x291fb6(0x202))/0x5*(parseInt(_0x291fb6(0x210))/0x6)+-parseInt(_0x291fb6(0x215))/0x7*(parseInt(_0x291fb6(0x20f))/0x8)+-parseInt(_0x291fb6(0x226))/0x9*(-parseInt(_0x291fb6(0x21c))/0xa)+parseInt(_0x291fb6(0x20e))/0xb;if(_0x5e342d===_0x3ae4e8)break;else _0x4faf20['push'](_0x4faf20['shift']());}catch(_0x2cd64f){_0x4faf20['push'](_0x4faf20['shift']());}}}(a135_0xa5e3,0x449f7));const a135_0x4753bd=function(){let _0x4c7f7b=!![];return function(_0xb382ca,_0x41c1c){const _0x37293e=_0x4c7f7b?function(){const _0x126d7b=a135_0x5b16;if(_0x41c1c){const _0x3bc0b6=_0x41c1c[_0x126d7b(0x216)](_0xb382ca,arguments);return _0x41c1c=null,_0x3bc0b6;}}:function(){};return _0x4c7f7b=![],_0x37293e;};}(),a135_0x4588f1=a135_0x4753bd(this,function(){const _0x37dfe7=a135_0x5b16;return a135_0x4588f1['toString']()[_0x37dfe7(0x1e9)](_0x37dfe7(0x217))[_0x37dfe7(0x20a)]()[_0x37dfe7(0x1ff)](a135_0x4588f1)['search'](_0x37dfe7(0x217));});a135_0x4588f1();'use strict';var __decorate=this&&this['__decorate']||function(_0x777c78,_0x1413bd,_0x1368a0,_0x8968c0){const _0x28ad4d=a135_0x5b16;var _0x49affe=arguments[_0x28ad4d(0x20d)],_0x5f533e=_0x49affe<0x3?_0x1413bd:_0x8968c0===null?_0x8968c0=Object[_0x28ad4d(0x23a)](_0x1413bd,_0x1368a0):_0x8968c0,_0x593af8;if(typeof Reflect===_0x28ad4d(0x218)&&typeof Reflect[_0x28ad4d(0x1eb)]===_0x28ad4d(0x1ed))_0x5f533e=Reflect['decorate'](_0x777c78,_0x1413bd,_0x1368a0,_0x8968c0);else{for(var _0x386672=_0x777c78[_0x28ad4d(0x20d)]-0x1;_0x386672>=0x0;_0x386672--)if(_0x593af8=_0x777c78[_0x386672])_0x5f533e=(_0x49affe<0x3?_0x593af8(_0x5f533e):_0x49affe>0x3?_0x593af8(_0x1413bd,_0x1368a0,_0x5f533e):_0x593af8(_0x1413bd,_0x1368a0))||_0x5f533e;}return _0x49affe>0x3&&_0x5f533e&&Object[_0x28ad4d(0x200)](_0x1413bd,_0x1368a0,_0x5f533e),_0x5f533e;},__metadata=this&&this['__metadata']||function(_0x2210a9,_0x57adff){const _0x10c854=a135_0x5b16;if(typeof Reflect===_0x10c854(0x218)&&typeof Reflect[_0x10c854(0x206)]==='function')return Reflect[_0x10c854(0x206)](_0x2210a9,_0x57adff);};Object[a135_0x3a4b52(0x200)](exports,'__esModule',{'value':!![]}),exports[a135_0x3a4b52(0x1f6)]=void 0x0;function a135_0xa5e3(){const _0x3960ab=['186858wfeaAf','salesforceService','objectId','repositoryId','FLOSUM_NAMESPACE','77DbNmth','apply','(((.+)+)+)+$','object','getRepositoryRecords','Service','Git_Settings__c','3370MWoiTM','getRepositoryRecord','GET_WAITING_BRANCHES_QUERY','%id%','getAttachmentId','Branch\x20','getRepositoryRecordByName','SalesforceService','Repository\x20','getRemoteStateAttachmentId','1467tulGku','FLOSUM_GIT_NAMESPACE','GET_WAITING_REPOSITORIES_QUERY','encodeBase64','GET_ATTACHMENT_BY_PARENT_ID_AND_NAME_QUERY','../dto/flosum-repository-sync.dto','push','1353uuuynx','typedi','replace','GET_BRANCH_BY_NAME_QUERY','patchObject','fromBranchRecord','../queries','SYNC_ATTACHMENT_FOR_BRANCH_NAME','../../../constants/errors','Components__r','./salesforce.service','\x20not\x20found\x20on\x20salesforce','\x0a\x20\x20\x20\x20\x20\x20','getOwnPropertyDescriptor','design:paramtypes','setStatus','createObject','Attachment','GET_COMPONENTS_QUERY','ERR_INVALID_ATTACHMENT_ID','search','getComponents','decorate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','function','getBranchComponents','%name%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Branch__c\x20=\x20\x27','text/plain','GET_REPOSITORY_QUERY','SalesforceNotFoundError','./salesforce-query.service','../errors/not-found.error','SalesforceSyncService','map','../../shared/utils','Sync_In_Progress__c','stringify','312LzIckd','fromRepositoryRecord','disableSync','records','constructor','defineProperty','GET_REPOSITORY_BY_NAME_QUERY','30jLjKBa','Synchronization_Status__c','salesforceQuery','query','metadata','251416xzLHnV','FlosumRepositorySyncDto','SYNC_ATTACHMENT_FOR_REPOSITORY_NAME','toString','442858nFDGlb','%parentId%','length','15326696AhgtJI','394664WpwIqx'];a135_0xa5e3=function(){return _0x3960ab;};return a135_0xa5e3();}function a135_0x5b16(_0x3201a7,_0x794ba8){const _0xb7720e=a135_0xa5e3();return a135_0x5b16=function(_0x4588f1,_0x4753bd){_0x4588f1=_0x4588f1-0x1e4;let _0xa5e3ed=_0xb7720e[_0x4588f1];return _0xa5e3ed;},a135_0x5b16(_0x3201a7,_0x794ba8);}const typedi_1=require(a135_0x3a4b52(0x22e)),constants_1=require('../../../constants'),errors_1=require(a135_0x3a4b52(0x235)),utils_1=require(a135_0x3a4b52(0x1f8)),flosum_repository_sync_dto_1=require(a135_0x3a4b52(0x22b)),not_found_error_1=require(a135_0x3a4b52(0x1f5)),queries_1=require(a135_0x3a4b52(0x233)),salesforce_query_service_1=require(a135_0x3a4b52(0x1f4)),salesforce_service_1=require(a135_0x3a4b52(0x237));let SalesforceSyncService=class SalesforceSyncService{constructor(_0x5f3f40,_0x367bb2){const _0x18bf26=a135_0x3a4b52;this[_0x18bf26(0x204)]=_0x5f3f40,this[_0x18bf26(0x211)]=_0x367bb2;}async['getComponents'](_0x1a581b){const _0x5c99dd=a135_0x3a4b52;var _0x19e8d4;const _0x5797b4=await this[_0x5c99dd(0x204)][_0x5c99dd(0x205)](_0x1a581b),_0x187681=[];for(const _0x4f9806 of _0x5797b4){const _0x2cca4d=(_0x19e8d4=_0x4f9806[constants_1[_0x5c99dd(0x214)]+_0x5c99dd(0x236)])===null||_0x19e8d4===void 0x0?void 0x0:_0x19e8d4[_0x5c99dd(0x1fe)];_0x2cca4d&&_0x2cca4d['length']&&_0x187681[_0x5c99dd(0x22c)](_0x2cca4d[0x0]['Id']);}return _0x187681;}async[a135_0x3a4b52(0x219)](){const _0xda8e48=a135_0x3a4b52,_0x4f39a6=await this['salesforceQuery'][_0xda8e48(0x205)](queries_1[_0xda8e48(0x228)]);return _0x4f39a6[_0xda8e48(0x1f7)](_0x3eda0f=>flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0xda8e48(0x1fc)](_0x3eda0f));}async['getBranchRecords'](){const _0x168a30=a135_0x3a4b52,_0x13c3cf=await this['salesforceQuery'][_0x168a30(0x205)](queries_1[_0x168a30(0x21e)]);return _0x13c3cf['map'](_0x553e11=>flosum_repository_sync_dto_1[_0x168a30(0x208)]['fromBranchRecord'](_0x553e11));}async[a135_0x3a4b52(0x21d)](_0x43450c){const _0x12d4e3=a135_0x3a4b52,_0x3e86fa=await this[_0x12d4e3(0x204)][_0x12d4e3(0x205)](queries_1[_0x12d4e3(0x1f2)]['replace'](_0x12d4e3(0x21f),_0x43450c));if(_0x3e86fa['length']===0x0)throw new not_found_error_1['SalesforceNotFoundError']('Repository\x20with\x20Id\x20'+_0x43450c+_0x12d4e3(0x238));return flosum_repository_sync_dto_1[_0x12d4e3(0x208)][_0x12d4e3(0x1fc)](_0x3e86fa[0x0]);}async['getBranchRecord'](_0x2ad808){const _0x5518a8=a135_0x3a4b52,_0x2da566=await this['salesforceQuery'][_0x5518a8(0x205)](queries_1['GET_BRANCH_QUERY']['replace'](_0x5518a8(0x21f),_0x2ad808));if(_0x2da566[_0x5518a8(0x20d)]===0x0)throw new not_found_error_1[(_0x5518a8(0x1f3))]('Branch\x20with\x20Id\x20'+_0x2ad808+_0x5518a8(0x238));return flosum_repository_sync_dto_1[_0x5518a8(0x208)][_0x5518a8(0x232)](_0x2da566[0x0]);}async['getBranchRecordByName'](_0x12c996){const _0xa9928f=a135_0x3a4b52,_0x5c31d7=await this[_0xa9928f(0x204)][_0xa9928f(0x205)](queries_1[_0xa9928f(0x230)][_0xa9928f(0x22f)](_0xa9928f(0x1ef),_0x12c996));if(_0x5c31d7[_0xa9928f(0x20d)]===0x0)throw new not_found_error_1[(_0xa9928f(0x1f3))](_0xa9928f(0x221)+_0x12c996+_0xa9928f(0x238));return flosum_repository_sync_dto_1[_0xa9928f(0x208)][_0xa9928f(0x232)](_0x5c31d7[0x0]);}async[a135_0x3a4b52(0x222)](_0x5520fc){const _0x3eea49=a135_0x3a4b52,_0x15aab0=await this[_0x3eea49(0x204)][_0x3eea49(0x205)](queries_1[_0x3eea49(0x201)]['replace'](_0x3eea49(0x1ef),_0x5520fc));if(_0x15aab0[_0x3eea49(0x20d)]===0x0)throw new not_found_error_1[(_0x3eea49(0x1f3))](_0x3eea49(0x224)+_0x5520fc+'\x20not\x20found\x20on\x20salesforce');return flosum_repository_sync_dto_1['FlosumRepositorySyncDto'][_0x3eea49(0x1fc)](_0x15aab0[0x0]);}async['getComponentsFromRepository'](_0xda7c9e){const _0x136c93=a135_0x3a4b52,_0x282303=_0x136c93(0x239)+queries_1[_0x136c93(0x1e7)]+'\x0a\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20%flosum_namespace%Repository__c\x20=\x27'+_0xda7c9e+'\x27';return this[_0x136c93(0x1ea)](_0x282303);}async[a135_0x3a4b52(0x1ee)](_0x227c51){const _0x140940=a135_0x3a4b52,_0x47dfee=_0x140940(0x1ec)+queries_1['GET_COMPONENTS_QUERY']+_0x140940(0x1f0)+_0x227c51+'\x27';return this['getComponents'](_0x47dfee);}async[a135_0x3a4b52(0x220)](_0x874ab4){const _0x14c827=a135_0x3a4b52;var _0x710ca1;const _0x4dec1e=queries_1[_0x14c827(0x22a)][_0x14c827(0x22f)](_0x14c827(0x20c),_0x874ab4[_0x14c827(0x212)])[_0x14c827(0x22f)]('%name%',_0x874ab4[_0x14c827(0x213)]?constants_1[_0x14c827(0x209)]:constants_1['SYNC_ATTACHMENT_FOR_BRANCH_NAME']),_0x4f2591=await this['salesforceQuery']['query'](_0x4dec1e),_0x5161fb=(_0x710ca1=_0x4f2591[0x0])===null||_0x710ca1===void 0x0?void 0x0:_0x710ca1['Id'];if(!_0x5161fb)throw new Error(errors_1[_0x14c827(0x1e8)]);return _0x5161fb;}async[a135_0x3a4b52(0x225)](_0x4e11ce){const _0x5109b6=a135_0x3a4b52;let _0x13b1c2=await this[_0x5109b6(0x220)](_0x4e11ce)['catch'](()=>null);return!_0x13b1c2&&(_0x13b1c2=await this[_0x5109b6(0x211)][_0x5109b6(0x1e5)]('Attachment',{'Body':utils_1[_0x5109b6(0x229)]('{}'),'ParentId':_0x4e11ce[_0x5109b6(0x212)],'ContentType':_0x5109b6(0x1f1),'Name':_0x4e11ce[_0x5109b6(0x213)]?constants_1[_0x5109b6(0x209)]:constants_1[_0x5109b6(0x234)]})),_0x13b1c2;}async['updateRemoteState'](_0xbd9b13,_0x5dad83){const _0x378970=a135_0x3a4b52,_0x535e0a=await this[_0x378970(0x225)](_0xbd9b13);await this[_0x378970(0x211)]['patchObject'](_0x378970(0x1e6),_0x535e0a,{'Body':utils_1['encodeBase64'](JSON[_0x378970(0x1fa)](_0x5dad83))});}async[a135_0x3a4b52(0x1e4)](_0x2b6513,_0x48f235){const _0xf2c5a=a135_0x3a4b52;await this[_0xf2c5a(0x211)][_0xf2c5a(0x231)](_0x2b6513['objectType'],_0x2b6513[_0xf2c5a(0x212)],{[constants_1[_0xf2c5a(0x227)]+_0xf2c5a(0x203)]:_0x48f235});}async[a135_0x3a4b52(0x1fd)](_0x27c60c){const _0x12b029=a135_0x3a4b52;await this[_0x12b029(0x211)]['patchObject'](constants_1[_0x12b029(0x227)]+_0x12b029(0x21b),_0x27c60c,{[constants_1[_0x12b029(0x227)]+_0x12b029(0x1f9)]:![]});}};SalesforceSyncService=__decorate([typedi_1[a135_0x3a4b52(0x21a)](),__metadata(a135_0x3a4b52(0x23b),[salesforce_query_service_1['SalesforceQueryService'],salesforce_service_1[a135_0x3a4b52(0x223)]])],SalesforceSyncService),exports[a135_0x3a4b52(0x1f6)]=SalesforceSyncService;