const a109_0x5177=['default','map','defineProperty','270098TQtUPP','constructor','retrieveAttachment','1YCewBL','70QeTNro','retrieveLastComponents','../dto/flosum-component-history.dto','components','filename','manually\x20retrieved\x20%d/%d\x20components','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','retrieveComponentIdsFromHistoryIds','5765656hjwvGe','1162033XnvQSY','logger','__esModule','17HOsEvQ','GET_COMPONENT_HISTORIES_BY_IDS','length','all','test','query','apply','1JHrVXc','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','72608WpCNHQ','1322761cWAXXU','replace','SalesforceRetrieverService','fileType','COMPONENTS_PER_QUERY','name','base64','%ids%','COMPONENTS_PER_REQUEST','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','return\x20/\x22\x20+\x20this\x20+\x20\x22/','fileName','1360516fbOTuI','push','FlosumComponentHistoryDto','run','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','ids','toString','__importDefault','join','splice','SalesforceQueryService','log','find','../../../core','salesforceService','then','3414BKxAfF','info'];const a109_0x571dee=a109_0x5557;(function(_0xd7330e,_0x51ba6c){const _0x238f17=a109_0x5557;while(!![]){try{const _0x1f3441=-parseInt(_0x238f17(0x1e5))*-parseInt(_0x238f17(0x1e8))+parseInt(_0x238f17(0x1e0))*-parseInt(_0x238f17(0x1e9))+-parseInt(_0x238f17(0x1fe))*parseInt(_0x238f17(0x1f5))+-parseInt(_0x238f17(0x1fc))*parseInt(_0x238f17(0x1ff))+-parseInt(_0x238f17(0x1f2))+-parseInt(_0x238f17(0x20b))+parseInt(_0x238f17(0x1f1));if(_0x1f3441===_0x51ba6c)break;else _0xd7330e['push'](_0xd7330e['shift']());}catch(_0x441925){_0xd7330e['push'](_0xd7330e['shift']());}}}(a109_0x5177,0xaf148));const a109_0x1f5f72=function(){let _0x31af67=!![];return function(_0x36a9c7,_0x412259){const _0x2ac1e3=_0x31af67?function(){const _0x153967=a109_0x5557;if(_0x412259){const _0x521d9d=_0x412259[_0x153967(0x1fb)](_0x36a9c7,arguments);return _0x412259=null,_0x521d9d;}}:function(){};return _0x31af67=![],_0x2ac1e3;};}(),a109_0x473604=a109_0x1f5f72(this,function(){const _0x2a67dd=function(){const _0x51e5ab=a109_0x5557,_0x7d3a8e=_0x2a67dd['constructor'](_0x51e5ab(0x209))()[_0x51e5ab(0x1e6)](_0x51e5ab(0x1ef));return!_0x7d3a8e[_0x51e5ab(0x1f9)](a109_0x473604);};return _0x2a67dd();});a109_0x473604();'use strict';var __importDefault=this&&this[a109_0x571dee(0x1d7)]||function(_0x2ad5de){const _0x82e72a=a109_0x571dee;return _0x2ad5de&&_0x2ad5de[_0x82e72a(0x1f4)]?_0x2ad5de:{'default':_0x2ad5de};};function a109_0x5557(_0x58b616,_0x4d5c54){return a109_0x5557=function(_0x1069f4,_0x473604){_0x1069f4=_0x1069f4-0x1d4;let _0x1f5f72=a109_0x5177[_0x1069f4];return _0x1f5f72;},a109_0x5557(_0x58b616,_0x4d5c54);}Object[a109_0x571dee(0x1e4)](exports,'__esModule',{'value':!![]}),exports[a109_0x571dee(0x201)]=void 0x0;const core_1=require(a109_0x571dee(0x1dd)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require('../queries'),flosum_component_history_dto_1=require(a109_0x571dee(0x1eb));class SalesforceRetrieverService{constructor(_0x37d2c4){const _0x3338a4=a109_0x571dee;this['salesforceService']=_0x37d2c4,this[_0x3338a4(0x1f3)]=new core_1['Logger'](SalesforceRetrieverService[_0x3338a4(0x204)]),this[_0x3338a4(0x207)]=0xbb8,this[_0x3338a4(0x203)]=0x1f4;}async[a109_0x571dee(0x1f0)](_0x4fb243){const _0x2165be=a109_0x571dee;this[_0x2165be(0x1f3)][_0x2165be(0x1e1)](_0x2165be(0x1fd),_0x4fb243[_0x2165be(0x1f7)]);const _0x309c62=typedi_1[_0x2165be(0x1e2)]['get'](salesforce_query_service_1[_0x2165be(0x1da)]),_0x48ba21=_0x4fb243[_0x2165be(0x1e3)](_0x39b84e=>'\x27'+_0x39b84e+'\x27'),_0x1348e9=[];while(_0x48ba21[_0x2165be(0x1f7)]){const _0x23fc84=_0x48ba21[_0x2165be(0x1d9)](0x0,this[_0x2165be(0x203)]),_0x444440=_0x309c62[_0x2165be(0x1fa)](queries_1[_0x2165be(0x1d4)][_0x2165be(0x200)]('%parent_ids%',_0x23fc84[_0x2165be(0x1d8)]())),_0x57192b=_0x309c62['query'](queries_1[_0x2165be(0x1f6)]['replace'](_0x2165be(0x206),_0x23fc84[_0x2165be(0x1d8)]()))[_0x2165be(0x1df)](_0x5cbbed=>_0x5cbbed[_0x2165be(0x1e3)](_0x556fa8=>flosum_component_history_dto_1[_0x2165be(0x20d)]['fromSalesforce'](_0x556fa8))),[_0x813d75,_0x14cf32]=await Promise[_0x2165be(0x1f8)]([_0x444440,_0x57192b]);for(const _0x1e59b0 of _0x14cf32){const _0x57467a=_0x813d75[_0x2165be(0x1dc)](_0x5b5a2d=>_0x5b5a2d['ParentId']===_0x1e59b0['id']);_0x1348e9[_0x2165be(0x20c)]({'fileType':_0x57467a['Name'],'fileName':_0x1e59b0[_0x2165be(0x1ed)],'attachmentId':_0x57467a['Id']});}}return _0x1348e9;}async[a109_0x571dee(0x1ea)](_0x637929){const _0x398921=a109_0x571dee,_0x53b8ab=await this[_0x398921(0x1f0)](_0x637929);this['logger'][_0x398921(0x1e1)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x573077=[];for(const _0x48b96c of _0x53b8ab){const _0x36e4bf=await this[_0x398921(0x1de)][_0x398921(0x1e7)](_0x48b96c['attachmentId'],!![]);_0x573077[_0x398921(0x20c)]({'body':_0x36e4bf[_0x398921(0x1d6)](_0x398921(0x205)),'fileName':_0x48b96c[_0x398921(0x20a)],'fileType':_0x48b96c[_0x398921(0x202)]}),this[_0x398921(0x1f3)][_0x398921(0x1e1)](_0x398921(0x1ee),_0x573077[_0x398921(0x1f7)],_0x637929[_0x398921(0x1f7)]);}return _0x573077;}async[a109_0x571dee(0x20e)](_0x8a8318){const _0x37bd58=a109_0x571dee,_0x597b9e=[..._0x8a8318],_0x1dd691=[],_0x3901ca=[];while(_0x597b9e[_0x37bd58(0x1f7)]){const _0x29f107=_0x597b9e[_0x37bd58(0x1d9)](0x0,this[_0x37bd58(0x207)]),_0x4676d5=await this[_0x37bd58(0x1de)]['retrieveComponents'](_0x29f107);_0x29f107['length']!==_0x4676d5['ids']['length']?(_0x597b9e['push'](..._0x4676d5[_0x37bd58(0x1d5)]),_0x1dd691[_0x37bd58(0x20c)](..._0x4676d5[_0x37bd58(0x1ec)])):_0x3901ca[_0x37bd58(0x20c)](..._0x29f107),this[_0x37bd58(0x1f3)][_0x37bd58(0x1db)](_0x37bd58(0x208),_0x8a8318['length']-_0x597b9e[_0x37bd58(0x1f7)],_0x8a8318[_0x37bd58(0x1f7)]);}if(_0x3901ca['length']){const _0x10a338=await this[_0x37bd58(0x1ea)](_0x3901ca);_0x1dd691[_0x37bd58(0x20c)](..._0x10a338);}return _0x1dd691;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;