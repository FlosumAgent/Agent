const a110_0x3d01d3=a110_0x2f52;function a110_0x2288(){const _0x36ec59=['join','ParentId','find','22350ndLvUn','147bsblMk','components','442960ocMjBO','then','retrieveComponents','165gCCvWK','salesforceService','get','44HVoHei','__importDefault','1735802WbdBYD','SalesforceQueryService','%ids%','constructor','1669036jLwcRD','../../../core','7925208YoBhSU','fromSalesforce','retrieveComponentIdsFromHistoryIds','../dto/flosum-component-history.dto','log','Name','apply','attachmentId','logger','18hUivIz','query','(((.+)+)+)+$','defineProperty','manually\x20retrieving\x20components\x20from\x20salesforce','ids','COMPONENTS_PER_QUERY','length','../queries','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','%parent_ids%','default','name','COMPONENTS_PER_REQUEST','replace','5wnsOHH','search','toString','retrieveLastComponents','Logger','./salesforce-query.service','push','base64','info','splice','map','fileName','5918300mJNuzp','manually\x20retrieved\x20%d/%d\x20components','SalesforceRetrieverService','55156LYzyyY','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','filename','fileType'];a110_0x2288=function(){return _0x36ec59;};return a110_0x2288();}(function(_0x197688,_0x167564){const _0x3c9d35=a110_0x2f52,_0x57b60a=_0x197688();while(!![]){try{const _0xe3f248=-parseInt(_0x3c9d35(0x11f))/0x1+-parseInt(_0x3c9d35(0x11b))/0x2+-parseInt(_0x3c9d35(0x116))/0x3*(-parseInt(_0x3c9d35(0x109))/0x4)+parseInt(_0x3c9d35(0x139))/0x5*(-parseInt(_0x3c9d35(0x110))/0x6)+parseInt(_0x3c9d35(0x111))/0x7*(parseInt(_0x3c9d35(0x113))/0x8)+-parseInt(_0x3c9d35(0x12a))/0x9*(parseInt(_0x3c9d35(0x106))/0xa)+-parseInt(_0x3c9d35(0x119))/0xb*(-parseInt(_0x3c9d35(0x121))/0xc);if(_0xe3f248===_0x167564)break;else _0x57b60a['push'](_0x57b60a['shift']());}catch(_0x29b3fc){_0x57b60a['push'](_0x57b60a['shift']());}}}(a110_0x2288,0xccbb3));const a110_0xc60fc2=function(){let _0x3ae8b5=!![];return function(_0x17efae,_0xd30e2){const _0x2c64c9=_0x3ae8b5?function(){const _0x1197f4=a110_0x2f52;if(_0xd30e2){const _0x3d2f3f=_0xd30e2[_0x1197f4(0x127)](_0x17efae,arguments);return _0xd30e2=null,_0x3d2f3f;}}:function(){};return _0x3ae8b5=![],_0x2c64c9;};}(),a110_0x4e8b17=a110_0xc60fc2(this,function(){const _0x395e19=a110_0x2f52;return a110_0x4e8b17[_0x395e19(0x13b)]()[_0x395e19(0x13a)](_0x395e19(0x12c))[_0x395e19(0x13b)]()[_0x395e19(0x11e)](a110_0x4e8b17)[_0x395e19(0x13a)]('(((.+)+)+)+$');});a110_0x4e8b17();'use strict';var __importDefault=this&&this[a110_0x3d01d3(0x11a)]||function(_0xdac8b5){return _0xdac8b5&&_0xdac8b5['__esModule']?_0xdac8b5:{'default':_0xdac8b5};};Object[a110_0x3d01d3(0x12d)](exports,'__esModule',{'value':!![]}),exports[a110_0x3d01d3(0x108)]=void 0x0;function a110_0x2f52(_0x4a952d,_0x340b34){const _0x5d8334=a110_0x2288();return a110_0x2f52=function(_0x4e8b17,_0xc60fc2){_0x4e8b17=_0x4e8b17-0xff;let _0x22886b=_0x5d8334[_0x4e8b17];return _0x22886b;},a110_0x2f52(_0x4a952d,_0x340b34);}const core_1=require(a110_0x3d01d3(0x120)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a110_0x3d01d3(0xff)),queries_1=require(a110_0x3d01d3(0x132)),flosum_component_history_dto_1=require(a110_0x3d01d3(0x124));class SalesforceRetrieverService{constructor(_0x5a34b2){const _0x466c7c=a110_0x3d01d3;this[_0x466c7c(0x117)]=_0x5a34b2,this[_0x466c7c(0x129)]=new core_1[(_0x466c7c(0x13d))](SalesforceRetrieverService[_0x466c7c(0x136)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x466c7c(0x130)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x5580d0){const _0x4b560f=a110_0x3d01d3;this[_0x4b560f(0x129)][_0x4b560f(0x102)](_0x4b560f(0x10a),_0x5580d0[_0x4b560f(0x131)]);const _0x57fc97=typedi_1[_0x4b560f(0x135)][_0x4b560f(0x118)](salesforce_query_service_1[_0x4b560f(0x11c)]),_0xeb557a=_0x5580d0['map'](_0x282793=>'\x27'+_0x282793+'\x27'),_0x951b05=[];while(_0xeb557a['length']){const _0x1b540a=_0xeb557a[_0x4b560f(0x103)](0x0,this['COMPONENTS_PER_QUERY']),_0x4c90ff=_0x57fc97[_0x4b560f(0x12b)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x4b560f(0x138)](_0x4b560f(0x134),_0x1b540a[_0x4b560f(0x10d)]())),_0x21dbd6=_0x57fc97[_0x4b560f(0x12b)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS'][_0x4b560f(0x138)](_0x4b560f(0x11d),_0x1b540a[_0x4b560f(0x10d)]()))[_0x4b560f(0x114)](_0x2c6de1=>_0x2c6de1[_0x4b560f(0x104)](_0x2d732f=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x4b560f(0x122)](_0x2d732f))),[_0x37bd08,_0x5a31d0]=await Promise['all']([_0x4c90ff,_0x21dbd6]);for(const _0x28a4ce of _0x5a31d0){const _0x165a9d=_0x37bd08[_0x4b560f(0x10f)](_0x37d256=>_0x37d256[_0x4b560f(0x10e)]===_0x28a4ce['id']);_0x951b05[_0x4b560f(0x100)]({'fileType':_0x165a9d[_0x4b560f(0x126)],'fileName':_0x28a4ce[_0x4b560f(0x10b)],'attachmentId':_0x165a9d['Id']});}}return _0x951b05;}async[a110_0x3d01d3(0x13c)](_0x44a128){const _0x4e5d97=a110_0x3d01d3,_0x266702=await this[_0x4e5d97(0x123)](_0x44a128);this['logger'][_0x4e5d97(0x102)](_0x4e5d97(0x12e));const _0x40d0f5=[];for(const _0x1f128c of _0x266702){const _0x2260e8=await this['salesforceService']['retrieveAttachment'](_0x1f128c[_0x4e5d97(0x128)],!![]);_0x40d0f5[_0x4e5d97(0x100)]({'body':_0x2260e8['toString'](_0x4e5d97(0x101)),'fileName':_0x1f128c[_0x4e5d97(0x105)],'fileType':_0x1f128c[_0x4e5d97(0x10c)]}),this[_0x4e5d97(0x129)][_0x4e5d97(0x102)](_0x4e5d97(0x107),_0x40d0f5['length'],_0x44a128[_0x4e5d97(0x131)]);}return _0x40d0f5;}async['run'](_0x59f99f){const _0x29ccc1=a110_0x3d01d3,_0x13acff=[..._0x59f99f],_0x1d338f=[],_0x434611=[];while(_0x13acff[_0x29ccc1(0x131)]){const _0x3ea290=_0x13acff[_0x29ccc1(0x103)](0x0,this[_0x29ccc1(0x137)]),_0x2480f4=await this[_0x29ccc1(0x117)][_0x29ccc1(0x115)](_0x3ea290);_0x3ea290['length']!==_0x2480f4[_0x29ccc1(0x12f)]['length']?(_0x13acff[_0x29ccc1(0x100)](..._0x2480f4[_0x29ccc1(0x12f)]),_0x1d338f[_0x29ccc1(0x100)](..._0x2480f4[_0x29ccc1(0x112)])):_0x434611[_0x29ccc1(0x100)](..._0x3ea290),this[_0x29ccc1(0x129)][_0x29ccc1(0x125)](_0x29ccc1(0x133),_0x59f99f['length']-_0x13acff[_0x29ccc1(0x131)],_0x59f99f['length']);}if(_0x434611['length']){const _0x5cf248=await this[_0x29ccc1(0x13c)](_0x434611);_0x1d338f[_0x29ccc1(0x100)](..._0x5cf248);}return _0x1d338f;}}exports[a110_0x3d01d3(0x108)]=SalesforceRetrieverService;