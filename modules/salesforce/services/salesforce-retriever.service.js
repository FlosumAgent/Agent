const a134_0x2b7fa0=a134_0x5d44;(function(_0x3f8d57,_0x415cb5){const _0x372850=a134_0x5d44,_0x49924e=_0x3f8d57();while(!![]){try{const _0xcb0047=-parseInt(_0x372850(0xc6))/0x1*(-parseInt(_0x372850(0xcf))/0x2)+parseInt(_0x372850(0xd5))/0x3+-parseInt(_0x372850(0xb1))/0x4+-parseInt(_0x372850(0xce))/0x5+-parseInt(_0x372850(0xa7))/0x6+-parseInt(_0x372850(0xc1))/0x7*(-parseInt(_0x372850(0xa8))/0x8)+parseInt(_0x372850(0xbc))/0x9;if(_0xcb0047===_0x415cb5)break;else _0x49924e['push'](_0x49924e['shift']());}catch(_0x2f37c5){_0x49924e['push'](_0x49924e['shift']());}}}(a134_0x2520,0xdc284));const a134_0x4a6f01=function(){let _0x16ac39=!![];return function(_0x40ac9b,_0x4fc5e3){const _0x5f1355=_0x16ac39?function(){const _0x1ef248=a134_0x5d44;if(_0x4fc5e3){const _0x568190=_0x4fc5e3[_0x1ef248(0xd6)](_0x40ac9b,arguments);return _0x4fc5e3=null,_0x568190;}}:function(){};return _0x16ac39=![],_0x5f1355;};}(),a134_0x5b11a4=a134_0x4a6f01(this,function(){const _0x447002=a134_0x5d44;return a134_0x5b11a4[_0x447002(0xba)]()[_0x447002(0xd9)](_0x447002(0xaf))[_0x447002(0xba)]()[_0x447002(0xb9)](a134_0x5b11a4)[_0x447002(0xd9)]('(((.+)+)+)+$');});a134_0x5b11a4();'use strict';function a134_0x5d44(_0x340aaf,_0x301265){const _0x1ca77d=a134_0x2520();return a134_0x5d44=function(_0x5b11a4,_0x4a6f01){_0x5b11a4=_0x5b11a4-0xa2;let _0x252041=_0x1ca77d[_0x5b11a4];return _0x252041;},a134_0x5d44(_0x340aaf,_0x301265);}var __importDefault=this&&this['__importDefault']||function(_0x613d61){const _0x2b86fc=a134_0x5d44;return _0x613d61&&_0x613d61[_0x2b86fc(0xdf)]?_0x613d61:{'default':_0x613d61};};Object[a134_0x2b7fa0(0xd7)](exports,'__esModule',{'value':!![]}),exports[a134_0x2b7fa0(0xde)]=void 0x0;const core_1=require(a134_0x2b7fa0(0xc8)),typedi_1=__importDefault(require(a134_0x2b7fa0(0xbf))),salesforce_query_service_1=require(a134_0x2b7fa0(0xaa)),queries_1=require('../queries'),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');function a134_0x2520(){const _0x459ca9=['all','3188904Xgusbx','apply','defineProperty','then','search','Logger','components','GET_COMPONENT_HISTORIES_BY_IDS','SalesforceQueryService','SalesforceRetrieverService','__esModule','retrieveLastComponents','manually\x20retrieved\x20%d/%d\x20components','fromSalesforce','retrieveAttachment','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','10391748WpuCwx','504pXIlIV','info','./salesforce-query.service','length','get','default','attachmentId','(((.+)+)+)+$','query','5551700hiUTSy','splice','Name','ids','salesforceService','log','manually\x20retrieving\x20components\x20from\x20salesforce','join','constructor','toString','%parent_ids%','21925908tqszDT','fileName','replace','typedi','logger','98504cshSNy','retrieveComponentIdsFromHistoryIds','filename','fileType','push','238POmgKs','map','../../../core','retrieveComponents','name','run','find','%ids%','3128155UgQaLH','2198FMNdZL','COMPONENTS_PER_QUERY','FlosumComponentHistoryDto','COMPONENTS_PER_REQUEST','base64'];a134_0x2520=function(){return _0x459ca9;};return a134_0x2520();}class SalesforceRetrieverService{constructor(_0x2e4d95){const _0x2112b3=a134_0x2b7fa0;this['salesforceService']=_0x2e4d95,this[_0x2112b3(0xc0)]=new core_1[(_0x2112b3(0xda))](SalesforceRetrieverService[_0x2112b3(0xca)]),this[_0x2112b3(0xd2)]=0xbb8,this[_0x2112b3(0xd0)]=0x1f4;}async[a134_0x2b7fa0(0xc2)](_0x1b0845){const _0x3effdc=a134_0x2b7fa0;this[_0x3effdc(0xc0)][_0x3effdc(0xa9)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x1b0845[_0x3effdc(0xab)]);const _0x3a2440=typedi_1[_0x3effdc(0xad)][_0x3effdc(0xac)](salesforce_query_service_1[_0x3effdc(0xdd)]),_0x321087=_0x1b0845[_0x3effdc(0xc7)](_0x273039=>'\x27'+_0x273039+'\x27'),_0x2ca8cb=[];while(_0x321087['length']){const _0x2f170e=_0x321087[_0x3effdc(0xb2)](0x0,this[_0x3effdc(0xd0)]),_0x264bfc=_0x3a2440[_0x3effdc(0xb0)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x3effdc(0xbe)](_0x3effdc(0xbb),_0x2f170e[_0x3effdc(0xb8)]())),_0x1ea631=_0x3a2440[_0x3effdc(0xb0)](queries_1[_0x3effdc(0xdc)][_0x3effdc(0xbe)](_0x3effdc(0xcd),_0x2f170e[_0x3effdc(0xb8)]()))[_0x3effdc(0xd8)](_0x24c5c2=>_0x24c5c2['map'](_0xdd3d0d=>flosum_component_history_dto_1[_0x3effdc(0xd1)][_0x3effdc(0xa4)](_0xdd3d0d))),[_0x21f68f,_0x4c0e8b]=await Promise[_0x3effdc(0xd4)]([_0x264bfc,_0x1ea631]);for(const _0x10b23b of _0x4c0e8b){const _0x3fb045=_0x21f68f[_0x3effdc(0xcc)](_0x163198=>_0x163198['ParentId']===_0x10b23b['id']);_0x3fb045&&_0x2ca8cb[_0x3effdc(0xc5)]({'fileType':_0x3fb045[_0x3effdc(0xb3)],'fileName':_0x10b23b[_0x3effdc(0xc3)],'attachmentId':_0x3fb045['Id']});}}return _0x2ca8cb;}async[a134_0x2b7fa0(0xa2)](_0x4bfade){const _0x1ac29e=a134_0x2b7fa0,_0x4f9911=await this[_0x1ac29e(0xc2)](_0x4bfade);this[_0x1ac29e(0xc0)][_0x1ac29e(0xa9)](_0x1ac29e(0xb7));const _0x395492=[];for(const _0x5241f8 of _0x4f9911){const _0x47cc58=await this[_0x1ac29e(0xb5)][_0x1ac29e(0xa5)](_0x5241f8[_0x1ac29e(0xae)],!![]);_0x395492[_0x1ac29e(0xc5)]({'body':_0x47cc58[_0x1ac29e(0xba)](_0x1ac29e(0xd3)),'fileName':_0x5241f8[_0x1ac29e(0xbd)],'fileType':_0x5241f8[_0x1ac29e(0xc4)]}),this[_0x1ac29e(0xc0)]['info'](_0x1ac29e(0xa3),_0x395492[_0x1ac29e(0xab)],_0x4bfade[_0x1ac29e(0xab)]);}return _0x395492;}async[a134_0x2b7fa0(0xcb)](_0x52b7ca){const _0x435335=a134_0x2b7fa0,_0x1ae3c1=[..._0x52b7ca],_0x294067=[],_0x2a6db7=[];while(_0x1ae3c1['length']){const _0x2fd430=_0x1ae3c1[_0x435335(0xb2)](0x0,this[_0x435335(0xd2)]),_0x4de5de=await this['salesforceService'][_0x435335(0xc9)](_0x2fd430);_0x2fd430['length']!==_0x4de5de[_0x435335(0xb4)]['length']?(_0x1ae3c1['push'](..._0x4de5de['ids']),_0x294067[_0x435335(0xc5)](..._0x4de5de[_0x435335(0xdb)])):_0x2a6db7['push'](..._0x2fd430),this[_0x435335(0xc0)][_0x435335(0xb6)](_0x435335(0xa6),_0x52b7ca[_0x435335(0xab)]-_0x1ae3c1['length'],_0x52b7ca[_0x435335(0xab)]);}if(_0x2a6db7[_0x435335(0xab)]){const _0xf87a22=await this[_0x435335(0xa2)](_0x2a6db7);_0x294067[_0x435335(0xc5)](..._0xf87a22);}return _0x294067;}}exports[a134_0x2b7fa0(0xde)]=SalesforceRetrieverService;