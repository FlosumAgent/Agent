const a109_0x30aa=['return\x20/\x22\x20+\x20this\x20+\x20\x22/','2mEpEgt','retrieveLastComponents','apply','get','1heqwdk','log','retrieveComponentIdsFromHistoryIds','342197njIXIR','map','428674MViULw','24152kbRZRf','manually\x20retrieved\x20%d/%d\x20components','COMPONENTS_PER_REQUEST','attachmentId','486545JWSZNr','query','FlosumComponentHistoryDto','1sNqhfp','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','default','GET_COMPONENT_HISTORIES_BY_IDS','splice','__esModule','SalesforceRetrieverService','name','typedi','join','test','786685tHJtPy','replace','length','__importDefault','salesforceService','push','run','COMPONENTS_PER_QUERY','Logger','info','911135Idbrra','toString','26aZZqzm','then','filename','%ids%','./salesforce-query.service','Name','ids','logger','all','1znxEIL','618823UoFkYK','../../../core','constructor'];const a109_0x47332d=a109_0x1c6f;(function(_0x4024f6,_0x49bca5){const _0x27b74d=a109_0x1c6f;while(!![]){try{const _0x380eb0=parseInt(_0x27b74d(0x135))+-parseInt(_0x27b74d(0x141))*parseInt(_0x27b74d(0x120))+-parseInt(_0x27b74d(0x140))*-parseInt(_0x27b74d(0x12b))+-parseInt(_0x27b74d(0x153))+-parseInt(_0x27b74d(0x14f))*parseInt(_0x27b74d(0x137))+parseInt(_0x27b74d(0x14c))*-parseInt(_0x27b74d(0x149))+-parseInt(_0x27b74d(0x14e))*-parseInt(_0x27b74d(0x145));if(_0x380eb0===_0x49bca5)break;else _0x4024f6['push'](_0x4024f6['shift']());}catch(_0x5ac279){_0x4024f6['push'](_0x4024f6['shift']());}}}(a109_0x30aa,0x751a3));const a109_0x1b72e7=function(){let _0x3ab1f2=!![];return function(_0x7c68c1,_0x563dce){const _0x9c3d58=_0x3ab1f2?function(){const _0x156d92=a109_0x1c6f;if(_0x563dce){const _0x3e47ad=_0x563dce[_0x156d92(0x147)](_0x7c68c1,arguments);return _0x563dce=null,_0x3e47ad;}}:function(){};return _0x3ab1f2=![],_0x9c3d58;};}(),a109_0x38beed=a109_0x1b72e7(this,function(){const _0x362ba3=function(){const _0x27fe63=a109_0x1c6f,_0x3cdce3=_0x362ba3['constructor'](_0x27fe63(0x144))()[_0x27fe63(0x143)](_0x27fe63(0x121));return!_0x3cdce3[_0x27fe63(0x12a)](a109_0x38beed);};return _0x362ba3();});a109_0x38beed();'use strict';var __importDefault=this&&this[a109_0x47332d(0x12e)]||function(_0x4a04d8){const _0x1690c7=a109_0x47332d;return _0x4a04d8&&_0x4a04d8[_0x1690c7(0x125)]?_0x4a04d8:{'default':_0x4a04d8};};Object['defineProperty'](exports,a109_0x47332d(0x125),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require(a109_0x47332d(0x142)),typedi_1=__importDefault(require(a109_0x47332d(0x128))),salesforce_query_service_1=require(a109_0x47332d(0x13b)),queries_1=require('../queries'),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');class SalesforceRetrieverService{constructor(_0x2ef67a){const _0x28686d=a109_0x47332d;this[_0x28686d(0x12f)]=_0x2ef67a,this[_0x28686d(0x13e)]=new core_1[(_0x28686d(0x133))](SalesforceRetrieverService[_0x28686d(0x127)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x28686d(0x132)]=0x1f4;}async[a109_0x47332d(0x14b)](_0x32302e){const _0x4f2732=a109_0x47332d;this['logger'][_0x4f2732(0x134)]('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x32302e[_0x4f2732(0x12d)]);const _0x14c035=typedi_1[_0x4f2732(0x122)][_0x4f2732(0x148)](salesforce_query_service_1['SalesforceQueryService']),_0x2ddb90=_0x32302e[_0x4f2732(0x14d)](_0x33b74f=>'\x27'+_0x33b74f+'\x27'),_0x21ae3c=[];while(_0x2ddb90['length']){const _0x55b660=_0x2ddb90['splice'](0x0,this[_0x4f2732(0x132)]),_0x13883c=_0x14c035[_0x4f2732(0x11e)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x4f2732(0x12c)]('%parent_ids%',_0x55b660[_0x4f2732(0x129)]())),_0x150078=_0x14c035[_0x4f2732(0x11e)](queries_1[_0x4f2732(0x123)][_0x4f2732(0x12c)](_0x4f2732(0x13a),_0x55b660['join']()))[_0x4f2732(0x138)](_0x5a78b6=>_0x5a78b6[_0x4f2732(0x14d)](_0x3c8594=>flosum_component_history_dto_1[_0x4f2732(0x11f)]['fromSalesforce'](_0x3c8594))),[_0x1c949e,_0x358458]=await Promise[_0x4f2732(0x13f)]([_0x13883c,_0x150078]);for(const _0x51df63 of _0x358458){const _0xdab1e3=_0x1c949e['find'](_0x184f08=>_0x184f08['ParentId']===_0x51df63['id']);_0x21ae3c[_0x4f2732(0x130)]({'fileType':_0xdab1e3[_0x4f2732(0x13c)],'fileName':_0x51df63[_0x4f2732(0x139)],'attachmentId':_0xdab1e3['Id']});}}return _0x21ae3c;}async[a109_0x47332d(0x146)](_0x4ec910){const _0x30d2b1=a109_0x47332d,_0x3ed55d=await this['retrieveComponentIdsFromHistoryIds'](_0x4ec910);this['logger'][_0x30d2b1(0x134)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x3499b3=[];for(const _0x567660 of _0x3ed55d){const _0x46fd19=await this[_0x30d2b1(0x12f)]['retrieveAttachment'](_0x567660[_0x30d2b1(0x152)],!![]);_0x3499b3[_0x30d2b1(0x130)]({'body':_0x46fd19[_0x30d2b1(0x136)]('base64'),'fileName':_0x567660['fileName'],'fileType':_0x567660['fileType']}),this[_0x30d2b1(0x13e)][_0x30d2b1(0x134)](_0x30d2b1(0x150),_0x3499b3[_0x30d2b1(0x12d)],_0x4ec910[_0x30d2b1(0x12d)]);}return _0x3499b3;}async[a109_0x47332d(0x131)](_0x48d22d){const _0x375d43=a109_0x47332d,_0x4eb8db=[..._0x48d22d],_0x245be6=[],_0x3b2bcd=[];while(_0x4eb8db[_0x375d43(0x12d)]){const _0x55d569=_0x4eb8db[_0x375d43(0x124)](0x0,this[_0x375d43(0x151)]),_0x4147e3=await this[_0x375d43(0x12f)]['retrieveComponents'](_0x55d569);_0x55d569[_0x375d43(0x12d)]!==_0x4147e3[_0x375d43(0x13d)][_0x375d43(0x12d)]?(_0x4eb8db[_0x375d43(0x130)](..._0x4147e3[_0x375d43(0x13d)]),_0x245be6[_0x375d43(0x130)](..._0x4147e3['components'])):_0x3b2bcd[_0x375d43(0x130)](..._0x55d569),this['logger'][_0x375d43(0x14a)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x48d22d['length']-_0x4eb8db[_0x375d43(0x12d)],_0x48d22d[_0x375d43(0x12d)]);}if(_0x3b2bcd[_0x375d43(0x12d)]){const _0x892bf4=await this[_0x375d43(0x146)](_0x3b2bcd);_0x245be6[_0x375d43(0x130)](..._0x892bf4);}return _0x245be6;}}function a109_0x1c6f(_0x3df5cb,_0x35c4db){return a109_0x1c6f=function(_0xabf573,_0x38beed){_0xabf573=_0xabf573-0x11e;let _0x1b72e7=a109_0x30aa[_0xabf573];return _0x1b72e7;},a109_0x1c6f(_0x3df5cb,_0x35c4db);}exports[a109_0x47332d(0x126)]=SalesforceRetrieverService;