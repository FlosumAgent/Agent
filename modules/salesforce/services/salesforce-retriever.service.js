const a134_0x40e374=a134_0x5b1b;(function(_0x3f194b,_0x47c41f){const _0xf0373e=a134_0x5b1b,_0x205ee8=_0x3f194b();while(!![]){try{const _0x338094=-parseInt(_0xf0373e(0x12a))/0x1*(-parseInt(_0xf0373e(0x118))/0x2)+-parseInt(_0xf0373e(0x134))/0x3*(parseInt(_0xf0373e(0x11e))/0x4)+-parseInt(_0xf0373e(0x133))/0x5+-parseInt(_0xf0373e(0x132))/0x6+parseInt(_0xf0373e(0x10c))/0x7*(-parseInt(_0xf0373e(0x115))/0x8)+-parseInt(_0xf0373e(0x111))/0x9*(-parseInt(_0xf0373e(0x127))/0xa)+parseInt(_0xf0373e(0x11a))/0xb;if(_0x338094===_0x47c41f)break;else _0x205ee8['push'](_0x205ee8['shift']());}catch(_0x21ab60){_0x205ee8['push'](_0x205ee8['shift']());}}}(a134_0x4568,0x39999));const a134_0xf43c60=function(){let _0x52943c=!![];return function(_0x335fe0,_0x33f25e){const _0x2e2268=_0x52943c?function(){const _0x1ab7c4=a134_0x5b1b;if(_0x33f25e){const _0x71372f=_0x33f25e[_0x1ab7c4(0x131)](_0x335fe0,arguments);return _0x33f25e=null,_0x71372f;}}:function(){};return _0x52943c=![],_0x2e2268;};}(),a134_0x4558a2=a134_0xf43c60(this,function(){const _0xc97eb=a134_0x5b1b;return a134_0x4558a2[_0xc97eb(0x11f)]()[_0xc97eb(0x108)](_0xc97eb(0x121))['toString']()['constructor'](a134_0x4558a2)[_0xc97eb(0x108)](_0xc97eb(0x121));});a134_0x4558a2();function a134_0x5b1b(_0x46e1d3,_0x28ab92){const _0x1628e0=a134_0x4568();return a134_0x5b1b=function(_0x4558a2,_0xf43c60){_0x4558a2=_0x4558a2-0x105;let _0x456840=_0x1628e0[_0x4558a2];return _0x456840;},a134_0x5b1b(_0x46e1d3,_0x28ab92);}function a134_0x4568(){const _0x3caf6f=['fileType','%ids%','SalesforceQueryService','search','../queries','find','replace','60130yWwKwq','logger','retrieveAttachment','join','%parent_ids%','51867GxnpSa','components','Name','typedi','24XTnCcd','base64','retrieveComponents','22640xsLsJR','all','7085221wGhvqj','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','retrieveLastComponents','log','11964gDRRVu','toString','get','(((.+)+)+)+$','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','ParentId','info','../dto/flosum-component-history.dto','splice','370XsZYvK','manually\x20retrieved\x20%d/%d\x20components','SalesforceRetrieverService','4EmFcun','__esModule','query','attachmentId','COMPONENTS_PER_REQUEST','run','length','apply','1515132MwjevT','850290IsWjwG','219zvfjtl','push','COMPONENTS_PER_QUERY','name','FlosumComponentHistoryDto','defineProperty','fileName','filename','retrieveComponentIdsFromHistoryIds','map','ids','default'];a134_0x4568=function(){return _0x3caf6f;};return a134_0x4568();}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3aa37f){const _0x1f2fef=a134_0x5b1b;return _0x3aa37f&&_0x3aa37f[_0x1f2fef(0x12b)]?_0x3aa37f:{'default':_0x3aa37f};};Object[a134_0x40e374(0x139)](exports,'__esModule',{'value':!![]}),exports[a134_0x40e374(0x129)]=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require(a134_0x40e374(0x114))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a134_0x40e374(0x109)),flosum_component_history_dto_1=require(a134_0x40e374(0x125));class SalesforceRetrieverService{constructor(_0x2b41af){const _0x5222b9=a134_0x40e374;this['salesforceService']=_0x2b41af,this[_0x5222b9(0x10d)]=new core_1['Logger'](SalesforceRetrieverService[_0x5222b9(0x137)]),this[_0x5222b9(0x12e)]=0xbb8,this[_0x5222b9(0x136)]=0x1f4;}async[a134_0x40e374(0x13c)](_0x39c7bb){const _0x19be00=a134_0x40e374;this[_0x19be00(0x10d)]['info'](_0x19be00(0x122),_0x39c7bb['length']);const _0x346679=typedi_1[_0x19be00(0x13f)][_0x19be00(0x120)](salesforce_query_service_1[_0x19be00(0x107)]),_0x131c2f=_0x39c7bb[_0x19be00(0x13d)](_0x1a4fa8=>'\x27'+_0x1a4fa8+'\x27'),_0x43370a=[];while(_0x131c2f['length']){const _0x16fa2d=_0x131c2f[_0x19be00(0x126)](0x0,this[_0x19be00(0x136)]),_0x10eb19=_0x346679[_0x19be00(0x12c)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x19be00(0x10b)](_0x19be00(0x110),_0x16fa2d[_0x19be00(0x10f)]())),_0x39c30=_0x346679[_0x19be00(0x12c)](queries_1['GET_COMPONENT_HISTORIES_BY_IDS']['replace'](_0x19be00(0x106),_0x16fa2d[_0x19be00(0x10f)]()))['then'](_0x490497=>_0x490497[_0x19be00(0x13d)](_0x56b723=>flosum_component_history_dto_1[_0x19be00(0x138)]['fromSalesforce'](_0x56b723))),[_0x11752c,_0x5d80b5]=await Promise[_0x19be00(0x119)]([_0x10eb19,_0x39c30]);for(const _0x1546b9 of _0x5d80b5){const _0x4e243f=_0x11752c[_0x19be00(0x10a)](_0x134a16=>_0x134a16[_0x19be00(0x123)]===_0x1546b9['id']);_0x4e243f&&_0x43370a[_0x19be00(0x135)]({'fileType':_0x4e243f[_0x19be00(0x113)],'fileName':_0x1546b9[_0x19be00(0x13b)],'attachmentId':_0x4e243f['Id']});}}return _0x43370a;}async[a134_0x40e374(0x11c)](_0x2105ce){const _0xde2b46=a134_0x40e374,_0xe6972d=await this['retrieveComponentIdsFromHistoryIds'](_0x2105ce);this[_0xde2b46(0x10d)][_0xde2b46(0x124)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x97e90a=[];for(const _0x3789bc of _0xe6972d){const _0x47f3e8=await this['salesforceService'][_0xde2b46(0x10e)](_0x3789bc[_0xde2b46(0x12d)],!![]);_0x97e90a[_0xde2b46(0x135)]({'body':_0x47f3e8[_0xde2b46(0x11f)](_0xde2b46(0x116)),'fileName':_0x3789bc[_0xde2b46(0x13a)],'fileType':_0x3789bc[_0xde2b46(0x105)]}),this[_0xde2b46(0x10d)][_0xde2b46(0x124)](_0xde2b46(0x128),_0x97e90a['length'],_0x2105ce['length']);}return _0x97e90a;}async[a134_0x40e374(0x12f)](_0x2e93d5){const _0x166d1d=a134_0x40e374,_0xce2893=[..._0x2e93d5],_0x5009e4=[],_0x59bec9=[];while(_0xce2893['length']){const _0x4e1593=_0xce2893[_0x166d1d(0x126)](0x0,this['COMPONENTS_PER_REQUEST']),_0xecbbe5=await this['salesforceService'][_0x166d1d(0x117)](_0x4e1593);_0x4e1593[_0x166d1d(0x130)]!==_0xecbbe5[_0x166d1d(0x13e)]['length']?(_0xce2893[_0x166d1d(0x135)](..._0xecbbe5['ids']),_0x5009e4[_0x166d1d(0x135)](..._0xecbbe5[_0x166d1d(0x112)])):_0x59bec9[_0x166d1d(0x135)](..._0x4e1593),this['logger'][_0x166d1d(0x11d)](_0x166d1d(0x11b),_0x2e93d5[_0x166d1d(0x130)]-_0xce2893[_0x166d1d(0x130)],_0x2e93d5['length']);}if(_0x59bec9['length']){const _0x4a5473=await this[_0x166d1d(0x11c)](_0x59bec9);_0x5009e4['push'](..._0x4a5473);}return _0x5009e4;}}exports[a134_0x40e374(0x129)]=SalesforceRetrieverService;