const a109_0x2540f8=a109_0x1111;function a109_0x3074(){const _0x449e94=['retrieveAttachment','salesforceService','logger','../../../core','search','%ids%','then','SalesforceRetrieverService','Logger','length','splice','join','(((.+)+)+)+$','COMPONENTS_PER_QUERY','replace','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','query','2090sdFXDB','map','SalesforceQueryService','1982661EBAreD','info','retrieveComponentIdsFromHistoryIds','4GkBEcg','4AilNHm','toString','1111020JgYVYP','run','name','retrieveComponents','1722itArrB','find','ids','default','ParentId','FlosumComponentHistoryDto','push','../queries','typedi','5545uspZuo','GET_COMPONENT_HISTORIES_BY_IDS','__importDefault','defineProperty','2670NsBybb','5477877dHnjPe','constructor','__esModule','635782mkxctF','all','retrieveLastComponents','%parent_ids%','../dto/flosum-component-history.dto','COMPONENTS_PER_REQUEST','16sUDfOt','Name','158830JzwowK'];a109_0x3074=function(){return _0x449e94;};return a109_0x3074();}(function(_0x5e1212,_0x104bc1){const _0x5d8f8a=a109_0x1111,_0x3d1097=_0x5e1212();while(!![]){try{const _0x278cb1=parseInt(_0x5d8f8a(0xa7))/0x1*(parseInt(_0x5d8f8a(0x8f))/0x2)+-parseInt(_0x5d8f8a(0xa4))/0x3*(parseInt(_0x5d8f8a(0xa8))/0x4)+parseInt(_0x5d8f8a(0xb7))/0x5*(parseInt(_0x5d8f8a(0xae))/0x6)+-parseInt(_0x5d8f8a(0x87))/0x7*(parseInt(_0x5d8f8a(0x8d))/0x8)+parseInt(_0x5d8f8a(0xbc))/0x9+-parseInt(_0x5d8f8a(0xbb))/0xa*(-parseInt(_0x5d8f8a(0xa1))/0xb)+-parseInt(_0x5d8f8a(0xaa))/0xc;if(_0x278cb1===_0x104bc1)break;else _0x3d1097['push'](_0x3d1097['shift']());}catch(_0x3a9f56){_0x3d1097['push'](_0x3d1097['shift']());}}}(a109_0x3074,0x57f0a));const a109_0x205946=function(){let _0x46a568=!![];return function(_0x134bd6,_0x59bb69){const _0x21d7cf=_0x46a568?function(){if(_0x59bb69){const _0x584655=_0x59bb69['apply'](_0x134bd6,arguments);return _0x59bb69=null,_0x584655;}}:function(){};return _0x46a568=![],_0x21d7cf;};}(),a109_0x37b7ab=a109_0x205946(this,function(){const _0xafd41b=a109_0x1111;return a109_0x37b7ab[_0xafd41b(0xa9)]()[_0xafd41b(0x94)]('(((.+)+)+)+$')[_0xafd41b(0xa9)]()[_0xafd41b(0xbd)](a109_0x37b7ab)['search'](_0xafd41b(0x9c));});a109_0x37b7ab();'use strict';function a109_0x1111(_0x397996,_0x3fdb56){const _0x4a619a=a109_0x3074();return a109_0x1111=function(_0x37b7ab,_0x205946){_0x37b7ab=_0x37b7ab-0x87;let _0x30742f=_0x4a619a[_0x37b7ab];return _0x30742f;},a109_0x1111(_0x397996,_0x3fdb56);}var __importDefault=this&&this[a109_0x2540f8(0xb9)]||function(_0x1e2a3b){const _0x38b3fe=a109_0x2540f8;return _0x1e2a3b&&_0x1e2a3b[_0x38b3fe(0xbe)]?_0x1e2a3b:{'default':_0x1e2a3b};};Object[a109_0x2540f8(0xba)](exports,a109_0x2540f8(0xbe),{'value':!![]}),exports[a109_0x2540f8(0x97)]=void 0x0;const core_1=require(a109_0x2540f8(0x93)),typedi_1=__importDefault(require(a109_0x2540f8(0xb6))),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a109_0x2540f8(0xb5)),flosum_component_history_dto_1=require(a109_0x2540f8(0x8b));class SalesforceRetrieverService{constructor(_0x2735d0){const _0x14922d=a109_0x2540f8;this[_0x14922d(0x91)]=_0x2735d0,this[_0x14922d(0x92)]=new core_1[(_0x14922d(0x98))](SalesforceRetrieverService[_0x14922d(0xac)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x14922d(0x9d)]=0x1f4;}async[a109_0x2540f8(0xa6)](_0x3c868a){const _0x4bb709=a109_0x2540f8;this[_0x4bb709(0x92)]['info']('manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)',_0x3c868a[_0x4bb709(0x99)]);const _0xb99a92=typedi_1[_0x4bb709(0xb1)]['get'](salesforce_query_service_1[_0x4bb709(0xa3)]),_0x34328c=_0x3c868a[_0x4bb709(0xa2)](_0x1d3331=>'\x27'+_0x1d3331+'\x27'),_0x926b1=[];while(_0x34328c[_0x4bb709(0x99)]){const _0x450cc0=_0x34328c[_0x4bb709(0x9a)](0x0,this['COMPONENTS_PER_QUERY']),_0x372120=_0xb99a92['query'](queries_1[_0x4bb709(0x9f)][_0x4bb709(0x9e)](_0x4bb709(0x8a),_0x450cc0[_0x4bb709(0x9b)]())),_0x40080c=_0xb99a92[_0x4bb709(0xa0)](queries_1[_0x4bb709(0xb8)][_0x4bb709(0x9e)](_0x4bb709(0x95),_0x450cc0[_0x4bb709(0x9b)]()))[_0x4bb709(0x96)](_0x2b103c=>_0x2b103c['map'](_0x1c7e2c=>flosum_component_history_dto_1[_0x4bb709(0xb3)]['fromSalesforce'](_0x1c7e2c))),[_0x59c37c,_0x36427e]=await Promise[_0x4bb709(0x88)]([_0x372120,_0x40080c]);for(const _0x4dc2ee of _0x36427e){const _0x33e8ef=_0x59c37c[_0x4bb709(0xaf)](_0x31834f=>_0x31834f[_0x4bb709(0xb2)]===_0x4dc2ee['id']);_0x926b1[_0x4bb709(0xb4)]({'fileType':_0x33e8ef[_0x4bb709(0x8e)],'fileName':_0x4dc2ee['filename'],'attachmentId':_0x33e8ef['Id']});}}return _0x926b1;}async[a109_0x2540f8(0x89)](_0x5c9c22){const _0x2dba76=a109_0x2540f8,_0x22dfb9=await this['retrieveComponentIdsFromHistoryIds'](_0x5c9c22);this['logger'][_0x2dba76(0xa5)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x5aa12d=[];for(const _0x4ba50e of _0x22dfb9){const _0x2dec13=await this['salesforceService'][_0x2dba76(0x90)](_0x4ba50e['attachmentId'],!![]);_0x5aa12d[_0x2dba76(0xb4)]({'body':_0x2dec13[_0x2dba76(0xa9)]('base64'),'fileName':_0x4ba50e['fileName'],'fileType':_0x4ba50e['fileType']}),this[_0x2dba76(0x92)][_0x2dba76(0xa5)]('manually\x20retrieved\x20%d/%d\x20components',_0x5aa12d['length'],_0x5c9c22[_0x2dba76(0x99)]);}return _0x5aa12d;}async[a109_0x2540f8(0xab)](_0x5b6b33){const _0x3030a=a109_0x2540f8,_0xa9ed78=[..._0x5b6b33],_0x32fb97=[],_0x466849=[];while(_0xa9ed78[_0x3030a(0x99)]){const _0x19f209=_0xa9ed78[_0x3030a(0x9a)](0x0,this[_0x3030a(0x8c)]),_0x32d853=await this[_0x3030a(0x91)][_0x3030a(0xad)](_0x19f209);_0x19f209[_0x3030a(0x99)]!==_0x32d853[_0x3030a(0xb0)][_0x3030a(0x99)]?(_0xa9ed78[_0x3030a(0xb4)](..._0x32d853['ids']),_0x32fb97[_0x3030a(0xb4)](..._0x32d853['components'])):_0x466849[_0x3030a(0xb4)](..._0x19f209),this[_0x3030a(0x92)]['log']('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x5b6b33['length']-_0xa9ed78[_0x3030a(0x99)],_0x5b6b33['length']);}if(_0x466849[_0x3030a(0x99)]){const _0x39a749=await this[_0x3030a(0x89)](_0x466849);_0x32fb97[_0x3030a(0xb4)](..._0x39a749);}return _0x32fb97;}}exports[a109_0x2540f8(0x97)]=SalesforceRetrieverService;