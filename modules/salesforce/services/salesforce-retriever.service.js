const a110_0xc83b9f=a110_0x1e00;(function(_0x1aeab3,_0x194224){const _0x103227=a110_0x1e00,_0x2d715d=_0x1aeab3();while(!![]){try{const _0xf6d468=parseInt(_0x103227(0x10a))/0x1+-parseInt(_0x103227(0x109))/0x2+-parseInt(_0x103227(0x100))/0x3*(-parseInt(_0x103227(0xee))/0x4)+parseInt(_0x103227(0xef))/0x5+-parseInt(_0x103227(0x10d))/0x6*(parseInt(_0x103227(0x11d))/0x7)+-parseInt(_0x103227(0x106))/0x8+parseInt(_0x103227(0xed))/0x9*(-parseInt(_0x103227(0xf0))/0xa);if(_0xf6d468===_0x194224)break;else _0x2d715d['push'](_0x2d715d['shift']());}catch(_0x4a8e25){_0x2d715d['push'](_0x2d715d['shift']());}}}(a110_0x5065,0x19cf1));function a110_0x5065(){const _0x57deec=['log','default','438JYsFCy','attachmentId','query','push','FlosumComponentHistoryDto','info','COMPONENTS_PER_QUERY','ids','__esModule','name','defineProperty','%parent_ids%','(((.+)+)+)+$','Logger','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','toString','9443nnqGUM','SalesforceQueryService','replace','splice','fromSalesforce','COMPONENTS_PER_REQUEST','salesforceService','map','9kiDhso','681000YhIFAN','1017220KpziAD','673770CAKKzb','retrieveAttachment','../dto/flosum-component-history.dto','GET_COMPONENT_HISTORIES_BY_IDS','retrieveLastComponents','manually\x20retrieved\x20%d/%d\x20components','Name','retrieveComponents','filename','all','fileType','SalesforceRetrieverService','./salesforce-query.service','run','logger','typedi','3AytgIv','join','constructor','apply','retrieveComponentIdsFromHistoryIds','../../../core','847136eaDPdf','length','search','53812OkKUJF','30671KWSPlk'];a110_0x5065=function(){return _0x57deec;};return a110_0x5065();}const a110_0x5b5025=function(){let _0x3412d9=!![];return function(_0xf25048,_0x316eaa){const _0x1a43f0=_0x3412d9?function(){const _0x1d4a82=a110_0x1e00;if(_0x316eaa){const _0xbaa5e1=_0x316eaa[_0x1d4a82(0x103)](_0xf25048,arguments);return _0x316eaa=null,_0xbaa5e1;}}:function(){};return _0x3412d9=![],_0x1a43f0;};}(),a110_0x2bcfb2=a110_0x5b5025(this,function(){const _0x2d37e2=a110_0x1e00;return a110_0x2bcfb2[_0x2d37e2(0x11c)]()[_0x2d37e2(0x108)](_0x2d37e2(0x119))[_0x2d37e2(0x11c)]()[_0x2d37e2(0x102)](a110_0x2bcfb2)[_0x2d37e2(0x108)]('(((.+)+)+)+$');});a110_0x2bcfb2();function a110_0x1e00(_0x882c4a,_0x5e91ca){const _0x11cbf6=a110_0x5065();return a110_0x1e00=function(_0x2bcfb2,_0x5b5025){_0x2bcfb2=_0x2bcfb2-0xe8;let _0x50651b=_0x11cbf6[_0x2bcfb2];return _0x50651b;},a110_0x1e00(_0x882c4a,_0x5e91ca);}'use strict';var __importDefault=this&&this['__importDefault']||function(_0x28fe65){const _0x48ee33=a110_0x1e00;return _0x28fe65&&_0x28fe65[_0x48ee33(0x115)]?_0x28fe65:{'default':_0x28fe65};};Object[a110_0xc83b9f(0x117)](exports,a110_0xc83b9f(0x115),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require(a110_0xc83b9f(0x105)),typedi_1=__importDefault(require(a110_0xc83b9f(0xff))),salesforce_query_service_1=require(a110_0xc83b9f(0xfc)),queries_1=require('../queries'),flosum_component_history_dto_1=require(a110_0xc83b9f(0xf2));class SalesforceRetrieverService{constructor(_0x116b25){const _0x2845ef=a110_0xc83b9f;this[_0x2845ef(0xeb)]=_0x116b25,this['logger']=new core_1[(_0x2845ef(0x11a))](SalesforceRetrieverService[_0x2845ef(0x116)]),this[_0x2845ef(0xea)]=0xbb8,this['COMPONENTS_PER_QUERY']=0x1f4;}async[a110_0xc83b9f(0x104)](_0x4e3e7f){const _0x200e47=a110_0xc83b9f;this[_0x200e47(0xfe)][_0x200e47(0x112)](_0x200e47(0x11b),_0x4e3e7f[_0x200e47(0x107)]);const _0x41788f=typedi_1[_0x200e47(0x10c)]['get'](salesforce_query_service_1[_0x200e47(0x11e)]),_0x2d0191=_0x4e3e7f[_0x200e47(0xec)](_0x229b4a=>'\x27'+_0x229b4a+'\x27'),_0x3821a2=[];while(_0x2d0191[_0x200e47(0x107)]){const _0x46224e=_0x2d0191[_0x200e47(0xe8)](0x0,this[_0x200e47(0x113)]),_0x3e9fc8=_0x41788f[_0x200e47(0x10f)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x200e47(0x11f)](_0x200e47(0x118),_0x46224e[_0x200e47(0x101)]())),_0x3f055a=_0x41788f[_0x200e47(0x10f)](queries_1[_0x200e47(0xf3)]['replace']('%ids%',_0x46224e['join']()))['then'](_0xf776f3=>_0xf776f3[_0x200e47(0xec)](_0xb570b9=>flosum_component_history_dto_1[_0x200e47(0x111)][_0x200e47(0xe9)](_0xb570b9))),[_0x4d05a1,_0x22b1a1]=await Promise[_0x200e47(0xf9)]([_0x3e9fc8,_0x3f055a]);for(const _0x288697 of _0x22b1a1){const _0x6a517=_0x4d05a1['find'](_0x19a1c3=>_0x19a1c3['ParentId']===_0x288697['id']);_0x3821a2[_0x200e47(0x110)]({'fileType':_0x6a517[_0x200e47(0xf6)],'fileName':_0x288697[_0x200e47(0xf8)],'attachmentId':_0x6a517['Id']});}}return _0x3821a2;}async[a110_0xc83b9f(0xf4)](_0x5d9770){const _0x31e43c=a110_0xc83b9f,_0x8b8430=await this[_0x31e43c(0x104)](_0x5d9770);this[_0x31e43c(0xfe)][_0x31e43c(0x112)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x2ca92b=[];for(const _0x211ec9 of _0x8b8430){const _0x20e89f=await this[_0x31e43c(0xeb)][_0x31e43c(0xf1)](_0x211ec9[_0x31e43c(0x10e)],!![]);_0x2ca92b[_0x31e43c(0x110)]({'body':_0x20e89f[_0x31e43c(0x11c)]('base64'),'fileName':_0x211ec9['fileName'],'fileType':_0x211ec9[_0x31e43c(0xfa)]}),this['logger']['info'](_0x31e43c(0xf5),_0x2ca92b['length'],_0x5d9770['length']);}return _0x2ca92b;}async[a110_0xc83b9f(0xfd)](_0x52b382){const _0x7a4a21=a110_0xc83b9f,_0x439790=[..._0x52b382],_0x2480e4=[],_0x35762d=[];while(_0x439790[_0x7a4a21(0x107)]){const _0x3f8168=_0x439790[_0x7a4a21(0xe8)](0x0,this[_0x7a4a21(0xea)]),_0x233b01=await this[_0x7a4a21(0xeb)][_0x7a4a21(0xf7)](_0x3f8168);_0x3f8168[_0x7a4a21(0x107)]!==_0x233b01[_0x7a4a21(0x114)]['length']?(_0x439790['push'](..._0x233b01['ids']),_0x2480e4[_0x7a4a21(0x110)](..._0x233b01['components'])):_0x35762d[_0x7a4a21(0x110)](..._0x3f8168),this[_0x7a4a21(0xfe)][_0x7a4a21(0x10b)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x52b382[_0x7a4a21(0x107)]-_0x439790[_0x7a4a21(0x107)],_0x52b382[_0x7a4a21(0x107)]);}if(_0x35762d[_0x7a4a21(0x107)]){const _0x455dab=await this[_0x7a4a21(0xf4)](_0x35762d);_0x2480e4[_0x7a4a21(0x110)](..._0x455dab);}return _0x2480e4;}}exports[a110_0xc83b9f(0xfb)]=SalesforceRetrieverService;