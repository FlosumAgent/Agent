const a109_0x1782=['^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','test','typedi','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','retrieveComponents','query','attachmentId','default','COMPONENTS_PER_QUERY','logger','join','COMPONENTS_PER_REQUEST','678727mafIin','salesforceService','get','components','Logger','264Lniqoe','__esModule','manually\x20retrieved\x20%d/%d\x20components','137703fKRuHE','base64','../dto/flosum-component-history.dto','%ids%','3398WOZRTO','GET_COMPONENT_HISTORIES_BY_IDS','toString','fileName','then','ParentId','run','3TXSYPK','retrieveComponentIdsFromHistoryIds','map','length','1007555vrDYnV','ids','Name','fileType','apply','23879dhWCvu','26rbkFTe','2614zfkSbZ','SalesforceQueryService','defineProperty','info','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','name','all','log','replace','125369iYWXpn','fromSalesforce','return\x20/\x22\x20+\x20this\x20+\x20\x22/','../queries','217usFTHn','./salesforce-query.service','push','retrieveLastComponents','constructor','2WVxjsi'];const a109_0x40f678=a109_0x499f;function a109_0x499f(_0x5bb98c,_0x2ace34){return a109_0x499f=function(_0xf6229d,_0x498b30){_0xf6229d=_0xf6229d-0x12a;let _0x813835=a109_0x1782[_0xf6229d];return _0x813835;},a109_0x499f(_0x5bb98c,_0x2ace34);}(function(_0x5ef69e,_0x5c0b0e){const _0x406c1d=a109_0x499f;while(!![]){try{const _0x53d008=parseInt(_0x406c1d(0x133))*-parseInt(_0x406c1d(0x13e))+-parseInt(_0x406c1d(0x152))+parseInt(_0x406c1d(0x130))*parseInt(_0x406c1d(0x137))+-parseInt(_0x406c1d(0x12b))+-parseInt(_0x406c1d(0x156))*parseInt(_0x406c1d(0x149))+-parseInt(_0x406c1d(0x148))*parseInt(_0x406c1d(0x147))+-parseInt(_0x406c1d(0x142))*-parseInt(_0x406c1d(0x15b));if(_0x53d008===_0x5c0b0e)break;else _0x5ef69e['push'](_0x5ef69e['shift']());}catch(_0x32efc3){_0x5ef69e['push'](_0x5ef69e['shift']());}}}(a109_0x1782,0x7bc05));const a109_0x813835=function(){let _0x250b1a=!![];return function(_0x380df8,_0x4de524){const _0x34d08b=_0x250b1a?function(){const _0x258a5d=a109_0x499f;if(_0x4de524){const _0x5bb03e=_0x4de524[_0x258a5d(0x146)](_0x380df8,arguments);return _0x4de524=null,_0x5bb03e;}}:function(){};return _0x250b1a=![],_0x34d08b;};}(),a109_0x498b30=a109_0x813835(this,function(){const _0x3095e4=function(){const _0x524950=a109_0x499f,_0x391bbb=_0x3095e4['constructor'](_0x524950(0x154))()[_0x524950(0x15a)](_0x524950(0x15c));return!_0x391bbb[_0x524950(0x15d)](a109_0x498b30);};return _0x3095e4();});a109_0x498b30();'use strict';var __importDefault=this&&this['__importDefault']||function(_0x2da098){const _0x3139f3=a109_0x499f;return _0x2da098&&_0x2da098[_0x3139f3(0x131)]?_0x2da098:{'default':_0x2da098};};Object[a109_0x40f678(0x14b)](exports,a109_0x40f678(0x131),{'value':!![]}),exports['SalesforceRetrieverService']=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require(a109_0x40f678(0x15e))),salesforce_query_service_1=require(a109_0x40f678(0x157)),queries_1=require(a109_0x40f678(0x155)),flosum_component_history_dto_1=require(a109_0x40f678(0x135));class SalesforceRetrieverService{constructor(_0x366408){const _0x15b31d=a109_0x40f678;this[_0x15b31d(0x12c)]=_0x366408,this[_0x15b31d(0x165)]=new core_1[(_0x15b31d(0x12f))](SalesforceRetrieverService[_0x15b31d(0x14e)]),this['COMPONENTS_PER_REQUEST']=0xbb8,this[_0x15b31d(0x164)]=0x1f4;}async[a109_0x40f678(0x13f)](_0x29a0a4){const _0x1566e8=a109_0x40f678;this[_0x1566e8(0x165)][_0x1566e8(0x14c)](_0x1566e8(0x14d),_0x29a0a4['length']);const _0x28cddf=typedi_1[_0x1566e8(0x163)][_0x1566e8(0x12d)](salesforce_query_service_1[_0x1566e8(0x14a)]),_0x1f766a=_0x29a0a4[_0x1566e8(0x140)](_0x378780=>'\x27'+_0x378780+'\x27'),_0x5bd850=[];while(_0x1f766a[_0x1566e8(0x141)]){const _0x35d0bb=_0x1f766a['splice'](0x0,this[_0x1566e8(0x164)]),_0x1dd98f=_0x28cddf[_0x1566e8(0x161)](queries_1[_0x1566e8(0x15f)][_0x1566e8(0x151)]('%parent_ids%',_0x35d0bb['join']())),_0xc47690=_0x28cddf[_0x1566e8(0x161)](queries_1[_0x1566e8(0x138)]['replace'](_0x1566e8(0x136),_0x35d0bb[_0x1566e8(0x166)]()))[_0x1566e8(0x13b)](_0x241c3c=>_0x241c3c[_0x1566e8(0x140)](_0x11d3cb=>flosum_component_history_dto_1['FlosumComponentHistoryDto'][_0x1566e8(0x153)](_0x11d3cb))),[_0x10cf70,_0x23e6be]=await Promise[_0x1566e8(0x14f)]([_0x1dd98f,_0xc47690]);for(const _0x1b0e31 of _0x23e6be){const _0x1d60b7=_0x10cf70['find'](_0x2e1cd7=>_0x2e1cd7[_0x1566e8(0x13c)]===_0x1b0e31['id']);_0x5bd850[_0x1566e8(0x158)]({'fileType':_0x1d60b7[_0x1566e8(0x144)],'fileName':_0x1b0e31['filename'],'attachmentId':_0x1d60b7['Id']});}}return _0x5bd850;}async[a109_0x40f678(0x159)](_0x373942){const _0x3acddd=a109_0x40f678,_0x10ab8e=await this['retrieveComponentIdsFromHistoryIds'](_0x373942);this[_0x3acddd(0x165)][_0x3acddd(0x14c)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x489be2=[];for(const _0x3d2a11 of _0x10ab8e){const _0x467611=await this['salesforceService']['retrieveAttachment'](_0x3d2a11[_0x3acddd(0x162)],!![]);_0x489be2[_0x3acddd(0x158)]({'body':_0x467611[_0x3acddd(0x139)](_0x3acddd(0x134)),'fileName':_0x3d2a11[_0x3acddd(0x13a)],'fileType':_0x3d2a11[_0x3acddd(0x145)]}),this['logger']['info'](_0x3acddd(0x132),_0x489be2[_0x3acddd(0x141)],_0x373942[_0x3acddd(0x141)]);}return _0x489be2;}async[a109_0x40f678(0x13d)](_0x1675eb){const _0x68de8=a109_0x40f678,_0x4b5e39=[..._0x1675eb],_0x4eae63=[],_0x1f454b=[];while(_0x4b5e39[_0x68de8(0x141)]){const _0x41985c=_0x4b5e39['splice'](0x0,this[_0x68de8(0x12a)]),_0x5081fb=await this['salesforceService'][_0x68de8(0x160)](_0x41985c);_0x41985c[_0x68de8(0x141)]!==_0x5081fb[_0x68de8(0x143)][_0x68de8(0x141)]?(_0x4b5e39['push'](..._0x5081fb[_0x68de8(0x143)]),_0x4eae63[_0x68de8(0x158)](..._0x5081fb[_0x68de8(0x12e)])):_0x1f454b[_0x68de8(0x158)](..._0x41985c),this[_0x68de8(0x165)][_0x68de8(0x150)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x1675eb[_0x68de8(0x141)]-_0x4b5e39['length'],_0x1675eb[_0x68de8(0x141)]);}if(_0x1f454b[_0x68de8(0x141)]){const _0x5ae39d=await this['retrieveLastComponents'](_0x1f454b);_0x4eae63['push'](..._0x5ae39d);}return _0x4eae63;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;