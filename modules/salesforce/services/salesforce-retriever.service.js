const a109_0x46069b=a109_0x3a8e;(function(_0x24a485,_0x3fa7b3){const _0x2019ea=a109_0x3a8e,_0x505adf=_0x24a485();while(!![]){try{const _0x3386d0=-parseInt(_0x2019ea(0xaf))/0x1*(parseInt(_0x2019ea(0xac))/0x2)+parseInt(_0x2019ea(0x8e))/0x3+-parseInt(_0x2019ea(0x8c))/0x4+parseInt(_0x2019ea(0xa9))/0x5*(parseInt(_0x2019ea(0x94))/0x6)+-parseInt(_0x2019ea(0xb7))/0x7+-parseInt(_0x2019ea(0xad))/0x8+parseInt(_0x2019ea(0x92))/0x9;if(_0x3386d0===_0x3fa7b3)break;else _0x505adf['push'](_0x505adf['shift']());}catch(_0x22925d){_0x505adf['push'](_0x505adf['shift']());}}}(a109_0xf85b,0x333b4));const a109_0x4ed8c5=function(){let _0x2c60f8=!![];return function(_0x30597a,_0x298db8){const _0x23c022=_0x2c60f8?function(){const _0x3eac6b=a109_0x3a8e;if(_0x298db8){const _0x71e797=_0x298db8[_0x3eac6b(0xb2)](_0x30597a,arguments);return _0x298db8=null,_0x71e797;}}:function(){};return _0x2c60f8=![],_0x23c022;};}(),a109_0x478e1f=a109_0x4ed8c5(this,function(){const _0x4880b1=a109_0x3a8e;return a109_0x478e1f['toString']()[_0x4880b1(0xa6)](_0x4880b1(0x8f))[_0x4880b1(0xa2)]()['constructor'](a109_0x478e1f)[_0x4880b1(0xa6)](_0x4880b1(0x8f));});a109_0x478e1f();'use strict';var __importDefault=this&&this[a109_0x46069b(0xb9)]||function(_0x4a140e){const _0x2d0cc4=a109_0x46069b;return _0x4a140e&&_0x4a140e[_0x2d0cc4(0xc0)]?_0x4a140e:{'default':_0x4a140e};};function a109_0xf85b(){const _0x49a1ae=['defineProperty','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','salesforceService','%parent_ids%','filename','splice','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','../../../core','map','get','join','query','toString','SalesforceQueryService','run','ParentId','search','replace','retrieveLastComponents','95pNemvl','push','fromSalesforce','48628rrSZFk','2024104QrnpJo','length','15jAbojD','fileName','../queries','apply','SalesforceRetrieverService','attachmentId','all','retrieveComponents','939918QwyBIF','retrieveAttachment','__importDefault','GET_COMPONENT_HISTORIES_BY_IDS','COMPONENTS_PER_QUERY','default','manually\x20retrieving\x20components\x20from\x20salesforce','info','FlosumComponentHistoryDto','__esModule','name','logger','959396DtpLsO','%ids%','282525WLISDH','(((.+)+)+)+$','components','log','9805185XuUddY','ids','5700jYsrQd','COMPONENTS_PER_REQUEST'];a109_0xf85b=function(){return _0x49a1ae;};return a109_0xf85b();}Object[a109_0x46069b(0x96)](exports,a109_0x46069b(0xc0),{'value':!![]}),exports[a109_0x46069b(0xb3)]=void 0x0;const core_1=require(a109_0x46069b(0x9d)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a109_0x46069b(0xb1)),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');function a109_0x3a8e(_0x148dc3,_0x390d82){const _0x3cdf11=a109_0xf85b();return a109_0x3a8e=function(_0x478e1f,_0x4ed8c5){_0x478e1f=_0x478e1f-0x8b;let _0xf85b56=_0x3cdf11[_0x478e1f];return _0xf85b56;},a109_0x3a8e(_0x148dc3,_0x390d82);}class SalesforceRetrieverService{constructor(_0xfd9a69){const _0x3d2a61=a109_0x46069b;this[_0x3d2a61(0x98)]=_0xfd9a69,this[_0x3d2a61(0x8b)]=new core_1['Logger'](SalesforceRetrieverService[_0x3d2a61(0xc1)]),this[_0x3d2a61(0x95)]=0xbb8,this[_0x3d2a61(0xbb)]=0x1f4;}async['retrieveComponentIdsFromHistoryIds'](_0x3a81af){const _0x585d94=a109_0x46069b;this[_0x585d94(0x8b)][_0x585d94(0xbe)](_0x585d94(0x9c),_0x3a81af[_0x585d94(0xae)]);const _0x3c7706=typedi_1[_0x585d94(0xbc)][_0x585d94(0x9f)](salesforce_query_service_1[_0x585d94(0xa3)]),_0xb51768=_0x3a81af[_0x585d94(0x9e)](_0x30198e=>'\x27'+_0x30198e+'\x27'),_0x120ba2=[];while(_0xb51768[_0x585d94(0xae)]){const _0x48834f=_0xb51768[_0x585d94(0x9b)](0x0,this['COMPONENTS_PER_QUERY']),_0x6fe767=_0x3c7706[_0x585d94(0xa1)](queries_1['GET_ATTACHMENT_BY_PARENT_IDS_QUERY'][_0x585d94(0xa7)](_0x585d94(0x99),_0x48834f[_0x585d94(0xa0)]())),_0x5843c4=_0x3c7706[_0x585d94(0xa1)](queries_1[_0x585d94(0xba)][_0x585d94(0xa7)](_0x585d94(0x8d),_0x48834f[_0x585d94(0xa0)]()))['then'](_0x12c844=>_0x12c844['map'](_0x3e3068=>flosum_component_history_dto_1[_0x585d94(0xbf)][_0x585d94(0xab)](_0x3e3068))),[_0x410820,_0x53975d]=await Promise[_0x585d94(0xb5)]([_0x6fe767,_0x5843c4]);for(const _0x3fc9c5 of _0x53975d){const _0x24135d=_0x410820['find'](_0x1193f3=>_0x1193f3[_0x585d94(0xa5)]===_0x3fc9c5['id']);_0x120ba2['push']({'fileType':_0x24135d['Name'],'fileName':_0x3fc9c5[_0x585d94(0x9a)],'attachmentId':_0x24135d['Id']});}}return _0x120ba2;}async[a109_0x46069b(0xa8)](_0x1d644a){const _0x2f558b=a109_0x46069b,_0x1d75dc=await this['retrieveComponentIdsFromHistoryIds'](_0x1d644a);this[_0x2f558b(0x8b)][_0x2f558b(0xbe)](_0x2f558b(0xbd));const _0x2ade4e=[];for(const _0x15821b of _0x1d75dc){const _0x476e8a=await this['salesforceService'][_0x2f558b(0xb8)](_0x15821b[_0x2f558b(0xb4)],!![]);_0x2ade4e['push']({'body':_0x476e8a[_0x2f558b(0xa2)]('base64'),'fileName':_0x15821b[_0x2f558b(0xb0)],'fileType':_0x15821b['fileType']}),this[_0x2f558b(0x8b)][_0x2f558b(0xbe)]('manually\x20retrieved\x20%d/%d\x20components',_0x2ade4e[_0x2f558b(0xae)],_0x1d644a[_0x2f558b(0xae)]);}return _0x2ade4e;}async[a109_0x46069b(0xa4)](_0x2b7a39){const _0x1cae09=a109_0x46069b,_0x10ae4f=[..._0x2b7a39],_0x3c1d99=[],_0x590465=[];while(_0x10ae4f[_0x1cae09(0xae)]){const _0x4e1e5e=_0x10ae4f[_0x1cae09(0x9b)](0x0,this['COMPONENTS_PER_REQUEST']),_0x408755=await this[_0x1cae09(0x98)][_0x1cae09(0xb6)](_0x4e1e5e);_0x4e1e5e[_0x1cae09(0xae)]!==_0x408755[_0x1cae09(0x93)][_0x1cae09(0xae)]?(_0x10ae4f[_0x1cae09(0xaa)](..._0x408755[_0x1cae09(0x93)]),_0x3c1d99[_0x1cae09(0xaa)](..._0x408755[_0x1cae09(0x90)])):_0x590465[_0x1cae09(0xaa)](..._0x4e1e5e),this[_0x1cae09(0x8b)][_0x1cae09(0x91)](_0x1cae09(0x97),_0x2b7a39[_0x1cae09(0xae)]-_0x10ae4f['length'],_0x2b7a39['length']);}if(_0x590465[_0x1cae09(0xae)]){const _0x299e38=await this[_0x1cae09(0xa8)](_0x590465);_0x3c1d99[_0x1cae09(0xaa)](..._0x299e38);}return _0x3c1d99;}}exports[a109_0x46069b(0xb3)]=SalesforceRetrieverService;