const a109_0x1393=['log','find','toString','constructor','%ids%','323984kGCWXe','1206383wJtRqg','logger','get','length','replace','base64','retrieveAttachment','63993caPQdh','ids','FlosumComponentHistoryDto','42RiaOXu','7268oZdChf','default','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','COMPONENTS_PER_REQUEST','test','then','attachmentId','filename','SalesforceQueryService','defineProperty','1112902gljQAQ','1114887gZjuPP','retrieveComponents','./salesforce-query.service','%parent_ids%','GET_COMPONENT_HISTORIES_BY_IDS','fromSalesforce','ParentId','retrieveComponentIdsFromHistoryIds','splice','__importDefault','2JcyrHF','map','retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest','retrieveLastComponents','fileName','1WqnYjz','join','SalesforceRetrieverService','__esModule','query','push','run','319409tWoOll','fileType','info','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','salesforceService','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}'];const a109_0x5b2258=a109_0x20fa;function a109_0x20fa(_0x10a07b,_0x37ce7f){return a109_0x20fa=function(_0x381018,_0x1f1133){_0x381018=_0x381018-0xf5;let _0x45b8ac=a109_0x1393[_0x381018];return _0x45b8ac;},a109_0x20fa(_0x10a07b,_0x37ce7f);}(function(_0x5196f7,_0x515c58){const _0x2fbea7=a109_0x20fa;while(!![]){try{const _0x4d5fa2=-parseInt(_0x2fbea7(0x108))+-parseInt(_0x2fbea7(0x11f))+parseInt(_0x2fbea7(0xfe))*parseInt(_0x2fbea7(0x113))+-parseInt(_0x2fbea7(0x12a))+-parseInt(_0x2fbea7(0x12b))*parseInt(_0x2fbea7(0x118))+parseInt(_0x2fbea7(0x109))+-parseInt(_0x2fbea7(0xfd))*-parseInt(_0x2fbea7(0xfa));if(_0x4d5fa2===_0x515c58)break;else _0x5196f7['push'](_0x5196f7['shift']());}catch(_0x3ff1ca){_0x5196f7['push'](_0x5196f7['shift']());}}}(a109_0x1393,0xd09b3));const a109_0x45b8ac=function(){let _0x35e9bf=!![];return function(_0x3d4a09,_0x15a9bb){const _0x15ebf8=_0x35e9bf?function(){if(_0x15a9bb){const _0x2d3a01=_0x15a9bb['apply'](_0x3d4a09,arguments);return _0x15a9bb=null,_0x2d3a01;}}:function(){};return _0x35e9bf=![],_0x15ebf8;};}(),a109_0x1f1133=a109_0x45b8ac(this,function(){const _0x2c018c=function(){const _0x515425=a109_0x20fa,_0xeef31c=_0x2c018c[_0x515425(0x128)]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x515425(0x128)](_0x515425(0x124));return!_0xeef31c[_0x515425(0x102)](a109_0x1f1133);};return _0x2c018c();});a109_0x1f1133();'use strict';var __importDefault=this&&this[a109_0x5b2258(0x112)]||function(_0x4c9b5d){const _0x3ad83e=a109_0x5b2258;return _0x4c9b5d&&_0x4c9b5d[_0x3ad83e(0x11b)]?_0x4c9b5d:{'default':_0x4c9b5d};};Object[a109_0x5b2258(0x107)](exports,a109_0x5b2258(0x11b),{'value':!![]}),exports[a109_0x5b2258(0x11a)]=void 0x0;const core_1=require('../../../core'),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require(a109_0x5b2258(0x10b)),queries_1=require('../queries'),flosum_component_history_dto_1=require('../dto/flosum-component-history.dto');class SalesforceRetrieverService{constructor(_0x1a62a9){const _0x2908c1=a109_0x5b2258;this[_0x2908c1(0x123)]=_0x1a62a9,this['logger']=new core_1['Logger'](SalesforceRetrieverService['name']),this['COMPONENTS_PER_REQUEST']=0xbb8;}async[a109_0x5b2258(0x110)](_0x548a8e){const _0xacf71f=a109_0x5b2258;this[_0xacf71f(0x12c)][_0xacf71f(0x121)](_0xacf71f(0x100),_0x548a8e[_0xacf71f(0xf6)]);const _0x1058ee=typedi_1[_0xacf71f(0xff)][_0xacf71f(0xf5)](salesforce_query_service_1[_0xacf71f(0x106)]),_0x4281c0=_0x548a8e[_0xacf71f(0x114)](_0x3e59da=>'\x27'+_0x3e59da+'\x27')[_0xacf71f(0x119)](),_0x19cefb=_0x1058ee['query'](queries_1[_0xacf71f(0x122)][_0xacf71f(0xf7)](_0xacf71f(0x10c),_0x4281c0)),_0xc48ef0=_0x1058ee[_0xacf71f(0x11c)](queries_1[_0xacf71f(0x10d)][_0xacf71f(0xf7)](_0xacf71f(0x129),_0x4281c0))[_0xacf71f(0x103)](_0x10883e=>_0x10883e[_0xacf71f(0x114)](_0x2d5a5c=>flosum_component_history_dto_1[_0xacf71f(0xfc)][_0xacf71f(0x10e)](_0x2d5a5c))),[_0x57dc63,_0x4fe71c]=await Promise['all']([_0x19cefb,_0xc48ef0]),_0x1fd376=[];for(const _0x6c852f of _0x4fe71c){const _0x67fdf9=_0x57dc63[_0xacf71f(0x126)](_0x3106d5=>_0x3106d5[_0xacf71f(0x10f)]===_0x6c852f['id']);_0x1fd376[_0xacf71f(0x11d)]({'fileType':_0x67fdf9['Name'],'fileName':_0x6c852f[_0xacf71f(0x105)],'attachmentId':_0x67fdf9['Id']});}return _0x1fd376;}async[a109_0x5b2258(0x116)](_0x2ad530){const _0x3b5ce3=a109_0x5b2258,_0x3ec348=await this[_0x3b5ce3(0x110)](_0x2ad530);this[_0x3b5ce3(0x12c)][_0x3b5ce3(0x121)]('manually\x20retrieving\x20components\x20from\x20salesforce');const _0x1930c7=[];for(const _0x4a04be of _0x3ec348){const _0x710d4e=await this['salesforceService'][_0x3b5ce3(0xf9)](_0x4a04be[_0x3b5ce3(0x104)],!![]);_0x1930c7[_0x3b5ce3(0x11d)]({'body':_0x710d4e[_0x3b5ce3(0x127)](_0x3b5ce3(0xf8)),'fileName':_0x4a04be[_0x3b5ce3(0x117)],'fileType':_0x4a04be[_0x3b5ce3(0x120)]}),this[_0x3b5ce3(0x12c)][_0x3b5ce3(0x121)]('manually\x20retrieved\x20%d/%d\x20components',_0x1930c7[_0x3b5ce3(0xf6)],_0x2ad530[_0x3b5ce3(0xf6)]);}return _0x1930c7;}async[a109_0x5b2258(0x11e)](_0x181004){const _0x27f288=a109_0x5b2258,_0xbb1db4=[..._0x181004],_0x242c81=[],_0x43d414=[];while(_0xbb1db4[_0x27f288(0xf6)]){const _0xffd3b=_0xbb1db4[_0x27f288(0x111)](0x0,this[_0x27f288(0x101)]),_0x2b3913=await this[_0x27f288(0x123)][_0x27f288(0x10a)](_0xffd3b);_0xffd3b[_0x27f288(0xf6)]!==_0x2b3913[_0x27f288(0xfb)][_0x27f288(0xf6)]?(_0xbb1db4[_0x27f288(0x11d)](..._0x2b3913[_0x27f288(0xfb)]),_0x242c81[_0x27f288(0x11d)](..._0x2b3913['components'])):_0x43d414[_0x27f288(0x11d)](..._0xffd3b),this[_0x27f288(0x12c)][_0x27f288(0x125)](_0x27f288(0x115),_0x181004[_0x27f288(0xf6)]-_0xbb1db4[_0x27f288(0xf6)],_0x181004[_0x27f288(0xf6)]);}if(_0x43d414[_0x27f288(0xf6)]){const _0x46c715=await this['retrieveLastComponents'](_0x43d414);_0x242c81[_0x27f288(0x11d)](..._0x46c715);}return _0x242c81;}}exports['SalesforceRetrieverService']=SalesforceRetrieverService;