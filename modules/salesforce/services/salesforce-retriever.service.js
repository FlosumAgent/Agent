const a128_0x4f5c96=a128_0x1c78;(function(_0x4121ff,_0xa24745){const _0x45e99a=a128_0x1c78,_0x56861c=_0x4121ff();while(!![]){try{const _0x509ada=parseInt(_0x45e99a(0x1cf))/0x1*(parseInt(_0x45e99a(0x1e9))/0x2)+-parseInt(_0x45e99a(0x1d9))/0x3+parseInt(_0x45e99a(0x1fd))/0x4+-parseInt(_0x45e99a(0x1ee))/0x5*(-parseInt(_0x45e99a(0x1f9))/0x6)+parseInt(_0x45e99a(0x1e4))/0x7+parseInt(_0x45e99a(0x1ea))/0x8*(-parseInt(_0x45e99a(0x1d3))/0x9)+parseInt(_0x45e99a(0x1e7))/0xa*(parseInt(_0x45e99a(0x1f3))/0xb);if(_0x509ada===_0xa24745)break;else _0x56861c['push'](_0x56861c['shift']());}catch(_0x24df43){_0x56861c['push'](_0x56861c['shift']());}}}(a128_0x24ee,0x979e8));const a128_0x39c2b5=function(){let _0x4563f3=!![];return function(_0x563789,_0x195c31){const _0x191685=_0x4563f3?function(){const _0x5da28d=a128_0x1c78;if(_0x195c31){const _0x37e86f=_0x195c31[_0x5da28d(0x1fa)](_0x563789,arguments);return _0x195c31=null,_0x37e86f;}}:function(){};return _0x4563f3=![],_0x191685;};}(),a128_0x10ab33=a128_0x39c2b5(this,function(){const _0x483dc3=a128_0x1c78;return a128_0x10ab33[_0x483dc3(0x1ce)]()[_0x483dc3(0x1ed)](_0x483dc3(0x1e5))[_0x483dc3(0x1ce)]()['constructor'](a128_0x10ab33)[_0x483dc3(0x1ed)](_0x483dc3(0x1e5));});a128_0x10ab33();'use strict';function a128_0x1c78(_0x27c98d,_0x575e66){const _0x4ba869=a128_0x24ee();return a128_0x1c78=function(_0x10ab33,_0x39c2b5){_0x10ab33=_0x10ab33-0x1cc;let _0x24ee2d=_0x4ba869[_0x10ab33];return _0x24ee2d;},a128_0x1c78(_0x27c98d,_0x575e66);}var __importDefault=this&&this[a128_0x4f5c96(0x1dd)]||function(_0x4f5980){const _0x3a76e2=a128_0x4f5c96;return _0x4f5980&&_0x4f5980[_0x3a76e2(0x1e3)]?_0x4f5980:{'default':_0x4f5980};};Object['defineProperty'](exports,a128_0x4f5c96(0x1e3),{'value':!![]}),exports[a128_0x4f5c96(0x1d0)]=void 0x0;function a128_0x24ee(){const _0x16e641=['push','ParentId','toString','2739KxgnKF','SalesforceRetrieverService','SalesforceQueryService','retrieveLastComponents','616509UNiLtU','query','retrieveComponentIdsFromHistoryIds','get','default','fromSalesforce','737577TVsZCU','../../../core','manually\x20retrieving\x20component\x20ids\x20from\x20history\x20ids\x20(%d)','log','__importDefault','map','retrieveAttachment','find','GET_ATTACHMENT_BY_PARENT_IDS_QUERY','then','__esModule','2198875TINypA','(((.+)+)+)+$','COMPONENTS_PER_REQUEST','9370850wDUesJ','logger','94RNQUJz','112mzvZGw','replace','COMPONENTS_PER_QUERY','search','20990HzOfUa','info','../dto/flosum-component-history.dto','base64','components','11wCuZLb','splice','length','manually\x20retrieving\x20components\x20from\x20salesforce','run','%parent_ids%','84SgoArw','apply','fileName','join','1548760bUrnnC','../queries','ids','FlosumComponentHistoryDto','GET_COMPONENT_HISTORIES_BY_IDS','retrieveComponents','salesforceService','fileType'];a128_0x24ee=function(){return _0x16e641;};return a128_0x24ee();}const core_1=require(a128_0x4f5c96(0x1da)),typedi_1=__importDefault(require('typedi')),salesforce_query_service_1=require('./salesforce-query.service'),queries_1=require(a128_0x4f5c96(0x1fe)),flosum_component_history_dto_1=require(a128_0x4f5c96(0x1f0));class SalesforceRetrieverService{constructor(_0x5066d6){const _0x2417af=a128_0x4f5c96;this[_0x2417af(0x203)]=_0x5066d6,this[_0x2417af(0x1e8)]=new core_1['Logger'](SalesforceRetrieverService['name']),this[_0x2417af(0x1e6)]=0xbb8,this[_0x2417af(0x1ec)]=0x1f4;}async[a128_0x4f5c96(0x1d5)](_0x46980a){const _0x4a3266=a128_0x4f5c96;this['logger'][_0x4a3266(0x1ef)](_0x4a3266(0x1db),_0x46980a['length']);const _0x186500=typedi_1[_0x4a3266(0x1d7)][_0x4a3266(0x1d6)](salesforce_query_service_1[_0x4a3266(0x1d1)]),_0xc39dcf=_0x46980a[_0x4a3266(0x1de)](_0x3058dd=>'\x27'+_0x3058dd+'\x27'),_0x3aca4c=[];while(_0xc39dcf['length']){const _0x3f0e7a=_0xc39dcf[_0x4a3266(0x1f4)](0x0,this['COMPONENTS_PER_QUERY']),_0x1e0348=_0x186500[_0x4a3266(0x1d4)](queries_1[_0x4a3266(0x1e1)]['replace'](_0x4a3266(0x1f8),_0x3f0e7a[_0x4a3266(0x1fc)]())),_0x5458d7=_0x186500[_0x4a3266(0x1d4)](queries_1[_0x4a3266(0x201)][_0x4a3266(0x1eb)]('%ids%',_0x3f0e7a['join']()))[_0x4a3266(0x1e2)](_0xffa8bc=>_0xffa8bc[_0x4a3266(0x1de)](_0x1238fd=>flosum_component_history_dto_1[_0x4a3266(0x200)][_0x4a3266(0x1d8)](_0x1238fd))),[_0x14f06b,_0x55addb]=await Promise['all']([_0x1e0348,_0x5458d7]);for(const _0x59f638 of _0x55addb){const _0x3e81c9=_0x14f06b[_0x4a3266(0x1e0)](_0x161103=>_0x161103[_0x4a3266(0x1cd)]===_0x59f638['id']);_0x3e81c9&&_0x3aca4c[_0x4a3266(0x1cc)]({'fileType':_0x3e81c9['Name'],'fileName':_0x59f638['filename'],'attachmentId':_0x3e81c9['Id']});}}return _0x3aca4c;}async[a128_0x4f5c96(0x1d2)](_0x50b0b1){const _0x506b1c=a128_0x4f5c96,_0x32e1c9=await this[_0x506b1c(0x1d5)](_0x50b0b1);this[_0x506b1c(0x1e8)][_0x506b1c(0x1ef)](_0x506b1c(0x1f6));const _0x418b8a=[];for(const _0x5b74d2 of _0x32e1c9){const _0x490da5=await this[_0x506b1c(0x203)][_0x506b1c(0x1df)](_0x5b74d2['attachmentId'],!![]);_0x418b8a[_0x506b1c(0x1cc)]({'body':_0x490da5['toString'](_0x506b1c(0x1f1)),'fileName':_0x5b74d2[_0x506b1c(0x1fb)],'fileType':_0x5b74d2[_0x506b1c(0x204)]}),this[_0x506b1c(0x1e8)][_0x506b1c(0x1ef)]('manually\x20retrieved\x20%d/%d\x20components',_0x418b8a['length'],_0x50b0b1['length']);}return _0x418b8a;}async[a128_0x4f5c96(0x1f7)](_0x5c1952){const _0x4ae395=a128_0x4f5c96,_0x61c5a9=[..._0x5c1952],_0x422fee=[],_0x35bc80=[];while(_0x61c5a9['length']){const _0x2df514=_0x61c5a9[_0x4ae395(0x1f4)](0x0,this[_0x4ae395(0x1e6)]),_0x4b0cb2=await this['salesforceService'][_0x4ae395(0x202)](_0x2df514);_0x2df514[_0x4ae395(0x1f5)]!==_0x4b0cb2[_0x4ae395(0x1ff)][_0x4ae395(0x1f5)]?(_0x61c5a9[_0x4ae395(0x1cc)](..._0x4b0cb2['ids']),_0x422fee[_0x4ae395(0x1cc)](..._0x4b0cb2[_0x4ae395(0x1f2)])):_0x35bc80[_0x4ae395(0x1cc)](..._0x2df514),this['logger'][_0x4ae395(0x1dc)]('retrieved\x20%d/%d\x20components\x20from\x20salesforce\x20rest',_0x5c1952['length']-_0x61c5a9[_0x4ae395(0x1f5)],_0x5c1952[_0x4ae395(0x1f5)]);}if(_0x35bc80[_0x4ae395(0x1f5)]){const _0x396365=await this[_0x4ae395(0x1d2)](_0x35bc80);_0x422fee[_0x4ae395(0x1cc)](..._0x396365);}return _0x422fee;}}exports[a128_0x4f5c96(0x1d0)]=SalesforceRetrieverService;