const a97_0x287b=['retrieve\x20attachment\x20%s\x20from\x20salesforce','__esModule','4190ewYGLh','67153YeVzoq','/flosum_git','apply','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','data','appSettings','26zcYvqX','production','../../shared/services/app-settings.service','188886GlqbVD','design:paramtypes','defineProperty','remove\x20commit\x20%s','Logger','hasAuthorizedCredentials','refreshToken','sobject','env','apex','constructor','length','default','__metadata','salesforce-service','message','oauth2','end','decorate','delete','InternalServerError','connect','update','function','loggerId','loginUrl','settings','Body','119100urlcQA','salesforseSettings','retrieveAttachment','test','SalesforceSettingsService','error','[LID:%s]\x20log\x20message\x20to\x20salesforce','../../shared/services/salesforce-settings.service','../../../core/errors/internal-server.error','ERR_MISSING_SALEFORCE_CONFIGURATION','blob','object','__decorate','177832MpzpmY','AppSettingsService','[LID:%s]\x20retrieve\x20components\x20from\x20salesforce','262judTYF','UnauthorizedError','namespace','SalesforceService','log','Connection','push','record','1138KRKwGq','post','107633KkHUli','hasCredentials','create\x20new\x20oauth\x20connection\x20from\x20given\x20credentials','Attachment','/attachments','trying\x20to\x20establish\x20connection\x20to\x20salesforce','connection'];const a97_0x94e78f=a97_0x19e3;(function(_0x49c225,_0x4ce677){const _0x29827a=a97_0x19e3;while(!![]){try{const _0x4ea391=-parseInt(_0x29827a(0xee))+-parseInt(_0x29827a(0x113))+-parseInt(_0x29827a(0xe4))+-parseInt(_0x29827a(0x120))+parseInt(_0x29827a(0xf7))+parseInt(_0x29827a(0xf4))*parseInt(_0x29827a(0xed))+parseInt(_0x29827a(0xe2))*parseInt(_0x29827a(0x123));if(_0x4ea391===_0x4ce677)break;else _0x49c225['push'](_0x49c225['shift']());}catch(_0x47b86b){_0x49c225['push'](_0x49c225['shift']());}}}(a97_0x287b,0x1e568));function a97_0x19e3(_0x2e2c6c,_0x2c8409){return a97_0x19e3=function(_0x4ba3cf,_0x1a28fe){_0x4ba3cf=_0x4ba3cf-0xdd;let _0x29b0bb=a97_0x287b[_0x4ba3cf];return _0x29b0bb;},a97_0x19e3(_0x2e2c6c,_0x2c8409);}const a97_0x29b0bb=function(){let _0x262d85=!![];return function(_0x4965f7,_0x10d66d){const _0x4cf524=_0x262d85?function(){const _0x41aacf=a97_0x19e3;if(_0x10d66d){const _0x119a40=_0x10d66d[_0x41aacf(0xf0)](_0x4965f7,arguments);return _0x10d66d=null,_0x119a40;}}:function(){};return _0x262d85=![],_0x4cf524;};}(),a97_0x1a28fe=a97_0x29b0bb(this,function(){const _0x18c641=function(){const _0x34142d=a97_0x19e3,_0x5db273=_0x18c641['constructor']('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x34142d(0x101)](_0x34142d(0xf1));return!_0x5db273[_0x34142d(0x116)](a97_0x1a28fe);};return _0x18c641();});a97_0x1a28fe();'use strict';var __decorate=this&&this[a97_0x94e78f(0x11f)]||function(_0x27ae01,_0x48a2f5,_0x30ed1c,_0x546c6e){const _0x6f02dd=a97_0x94e78f;var _0x569c2d=arguments['length'],_0x51f402=_0x569c2d<0x3?_0x48a2f5:_0x546c6e===null?_0x546c6e=Object['getOwnPropertyDescriptor'](_0x48a2f5,_0x30ed1c):_0x546c6e,_0x5f4330;if(typeof Reflect===_0x6f02dd(0x11e)&&typeof Reflect['decorate']==='function')_0x51f402=Reflect[_0x6f02dd(0x109)](_0x27ae01,_0x48a2f5,_0x30ed1c,_0x546c6e);else{for(var _0x6c8da8=_0x27ae01[_0x6f02dd(0x102)]-0x1;_0x6c8da8>=0x0;_0x6c8da8--)if(_0x5f4330=_0x27ae01[_0x6c8da8])_0x51f402=(_0x569c2d<0x3?_0x5f4330(_0x51f402):_0x569c2d>0x3?_0x5f4330(_0x48a2f5,_0x30ed1c,_0x51f402):_0x5f4330(_0x48a2f5,_0x30ed1c))||_0x51f402;}return _0x569c2d>0x3&&_0x51f402&&Object[_0x6f02dd(0xf9)](_0x48a2f5,_0x30ed1c,_0x51f402),_0x51f402;},__metadata=this&&this[a97_0x94e78f(0x104)]||function(_0xf37c9d,_0x242538){const _0x1ff23c=a97_0x94e78f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x1ff23c(0x10e))return Reflect['metadata'](_0xf37c9d,_0x242538);},__importDefault=this&&this['__importDefault']||function(_0x3ddebc){const _0xf14815=a97_0x94e78f;return _0x3ddebc&&_0x3ddebc[_0xf14815(0xec)]?_0x3ddebc:{'default':_0x3ddebc};};Object['defineProperty'](exports,a97_0x94e78f(0xec),{'value':!![]}),exports[a97_0x94e78f(0xdd)]=void 0x0;const typedi_1=require('typedi'),jsforce_1=__importDefault(require('jsforce')),unauthorized_error_1=require('../../../core/errors/unauthorized.error'),errors_1=require('../../../constants/errors'),core_1=require('../../../core'),salesforce_settings_service_1=require(a97_0x94e78f(0x11a)),app_settings_service_1=require(a97_0x94e78f(0xf6)),internal_server_error_1=require(a97_0x94e78f(0x11b)),logger=new core_1[(a97_0x94e78f(0xfb))](a97_0x94e78f(0x105));let SalesforceService=class SalesforceService{constructor(_0x522155,_0xb7910f){const _0x867e25=a97_0x94e78f;this[_0x867e25(0x114)]=_0x522155,this[_0x867e25(0xf3)]=_0xb7910f,this[_0x867e25(0x125)]=this['appSettings'][_0x867e25(0xff)]===_0x867e25(0xf5)?_0x867e25(0xef):'';}get['settings'](){const _0x4a9d0e=a97_0x94e78f;return this['salesforseSettings'][_0x4a9d0e(0x111)];}async[a97_0x94e78f(0x10c)](){const _0x344c4d=a97_0x94e78f;logger['log'](_0x344c4d(0xe9));if(!this[_0x344c4d(0x114)][_0x344c4d(0xe5)])throw new unauthorized_error_1[(_0x344c4d(0x124))](errors_1[_0x344c4d(0x11c)]);const {clientId:_0x37857f,clientSecret:_0x368ab3,refreshToken:_0x3875ba}=this[_0x344c4d(0x111)],_0xa522ff={'clientId':_0x37857f,'clientSecret':_0x368ab3,'loginUrl':this[_0x344c4d(0x114)][_0x344c4d(0x110)]};if(!this[_0x344c4d(0x114)][_0x344c4d(0xfc)]){logger[_0x344c4d(0xde)](_0x344c4d(0xe6));const _0x53bbd2=new jsforce_1[(_0x344c4d(0x103))][(_0x344c4d(0xdf))](_0xa522ff),{access_token:_0x1b8931,instance_url:_0x360e6e}=await _0x53bbd2[_0x344c4d(0x107)][_0x344c4d(0xfd)](_0x3875ba);await this[_0x344c4d(0x114)][_0x344c4d(0x10d)]({'accessToken':_0x1b8931,'instanceUrl':_0x360e6e});}const {accessToken:_0x50a8e1,instanceUrl:_0x24a18e}=this['settings'];this[_0x344c4d(0xea)]=new jsforce_1[(_0x344c4d(0x103))][(_0x344c4d(0xdf))]({'oauth2':_0xa522ff,'refreshToken':_0x3875ba,'accessToken':_0x50a8e1,'instanceUrl':_0x24a18e}),logger[_0x344c4d(0xde)]('salesforce\x20connection\x20established');}async['retrieve'](_0x13d454){const _0x47ad85=a97_0x94e78f;logger[_0x47ad85(0xde)](_0x47ad85(0x122),this[_0x47ad85(0x111)]['loggerId']);try{const _0xfd532c=await this[_0x47ad85(0xea)][_0x47ad85(0x100)]['post'](this[_0x47ad85(0x125)]+_0x47ad85(0xe8),{'componentIds':_0x13d454,'loggerId':this[_0x47ad85(0x111)][_0x47ad85(0x10f)]});return _0xfd532c;}catch(_0x3cd6e2){throw new internal_server_error_1[(_0x47ad85(0x10b))](_0x3cd6e2);}}async['deleteCommit'](_0x500f69){const _0x5d5f42=a97_0x94e78f;logger[_0x5d5f42(0xde)](_0x5d5f42(0xfa),_0x500f69);try{await this[_0x5d5f42(0xea)][_0x5d5f42(0xfe)](_0x5d5f42(0xe7))['record'](_0x500f69)[_0x5d5f42(0x10a)]();}catch(_0x7c81b7){await this[_0x5d5f42(0xde)](_0x7c81b7[_0x5d5f42(0x106)]);}}async[a97_0x94e78f(0x115)](_0x268f5e){const _0x151c9f=a97_0x94e78f;try{logger[_0x151c9f(0xde)](_0x151c9f(0xeb),_0x268f5e);const _0x24ef15=await new Promise((_0x38d500,_0xe62fdf)=>{const _0x41261f=_0x151c9f,_0x22b1f7=[],_0x34a654=this[_0x41261f(0xea)][_0x41261f(0xfe)](_0x41261f(0xe7))[_0x41261f(0xe1)](_0x268f5e)[_0x41261f(0x11d)](_0x41261f(0x112));_0x34a654['on'](_0x41261f(0x118),_0xe62fdf),_0x34a654['on'](_0x41261f(0xf2),_0x1504cc=>_0x22b1f7[_0x41261f(0xe0)](_0x1504cc)),_0x34a654['on'](_0x41261f(0x108),()=>_0x38d500(_0x22b1f7['join']('')));});return _0x24ef15;}catch(_0x23aca1){this[_0x151c9f(0xde)](_0x23aca1['message']);throw new internal_server_error_1[(_0x151c9f(0x10b))](_0x23aca1);}}async[a97_0x94e78f(0xde)](_0x4d6d5c){const _0x20f6d1=a97_0x94e78f;try{logger['log'](_0x20f6d1(0x119),this['settings'][_0x20f6d1(0x10f)]),await this[_0x20f6d1(0xea)][_0x20f6d1(0x100)][_0x20f6d1(0xe3)](this[_0x20f6d1(0x125)]+'/logger',{'message':_0x4d6d5c,'loggerId':this[_0x20f6d1(0x111)][_0x20f6d1(0x10f)]});}catch(_0x43389c){throw new internal_server_error_1[(_0x20f6d1(0x10b))](_0x43389c);}}};SalesforceService=__decorate([typedi_1['Service'](),__metadata(a97_0x94e78f(0xf8),[salesforce_settings_service_1[a97_0x94e78f(0x117)],app_settings_service_1[a97_0x94e78f(0x121)]])],SalesforceService),exports['SalesforceService']=SalesforceService;