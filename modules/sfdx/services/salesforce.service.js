const a97_0x4ee6=['loggerId','Connection','deleteCommit','AppSettingsService','sobject','ERR_MISSING_SALEFORCE_CONFIGURATION','create\x20new\x20oauth\x20connection\x20from\x20given\x20credentials','24dqVXZP','connection','17keGpqh','jsforce','record','apply','blob','../../shared/services/app-settings.service','../../../constants/errors','connect','object','metadata','message','oauth2','[LID:%s]\x20retrieve\x20components\x20from\x20salesforce','return\x20/\x22\x20+\x20this\x20+\x20\x22/','__decorate','2PmTfea','refreshToken','331143pvVmPz','536956BJkNYM','8545dDiiiQ','namespace','__esModule','production','hasAuthorizedCredentials','decorate','update','SalesforceSettingsService','[LID:%s]\x20log\x20message\x20to\x20salesforce','__importDefault','constructor','typedi','end','../../../core/errors/unauthorized.error','log','/logger','1ILLNqp','env','push','default','SalesforceService','post','settings','function','87367bvrMdv','hasCredentials','__metadata','411568wOggHo','trying\x20to\x20establish\x20connection\x20to\x20salesforce','retrieve','480727qLWheF','test','length','error','salesforce-service','Service','data','defineProperty','apex','Attachment','retrieveAttachment','salesforseSettings','../../../core/errors/internal-server.error','/flosum_git','InternalServerError','22171uJUrLh','delete'];const a97_0x4077d2=a97_0x271d;(function(_0x50359d,_0x1647d7){const _0x2fd7e=a97_0x271d;while(!![]){try{const _0x4d439b=-parseInt(_0x2fd7e(0xdc))+-parseInt(_0x2fd7e(0xdd))+parseInt(_0x2fd7e(0xda))*parseInt(_0x2fd7e(0xde))+parseInt(_0x2fd7e(0xee))*-parseInt(_0x2fd7e(0xfc))+-parseInt(_0x2fd7e(0xf9))+parseInt(_0x2fd7e(0xc0))*parseInt(_0x2fd7e(0xc9))+-parseInt(_0x2fd7e(0xf6))*-parseInt(_0x2fd7e(0xcb));if(_0x4d439b===_0x1647d7)break;else _0x50359d['push'](_0x50359d['shift']());}catch(_0x230ac1){_0x50359d['push'](_0x50359d['shift']());}}}(a97_0x4ee6,0x42e77));const a97_0x22afe8=function(){let _0x27abeb=!![];return function(_0xe790fd,_0x1d31a1){const _0x3ad8f=_0x27abeb?function(){const _0x1bc1cd=a97_0x271d;if(_0x1d31a1){const _0xbf838c=_0x1d31a1[_0x1bc1cd(0xce)](_0xe790fd,arguments);return _0x1d31a1=null,_0xbf838c;}}:function(){};return _0x27abeb=![],_0x3ad8f;};}(),a97_0x17a197=a97_0x22afe8(this,function(){const _0x16eb86=function(){const _0x5a2987=a97_0x271d,_0x17d7ba=_0x16eb86[_0x5a2987(0xe8)](_0x5a2987(0xd8))()[_0x5a2987(0xe8)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x17d7ba[_0x5a2987(0xfd)](a97_0x17a197);};return _0x16eb86();});a97_0x17a197();function a97_0x271d(_0x26cb29,_0x56bbcb){return a97_0x271d=function(_0x2ece2c,_0x17a197){_0x2ece2c=_0x2ece2c-0xb3;let _0x22afe8=a97_0x4ee6[_0x2ece2c];return _0x22afe8;},a97_0x271d(_0x26cb29,_0x56bbcb);}'use strict';var __decorate=this&&this[a97_0x4077d2(0xd9)]||function(_0x183778,_0x1ed894,_0x1c6d00,_0x1d6d7c){const _0x894a62=a97_0x4077d2;var _0x1c5e23=arguments[_0x894a62(0xb3)],_0x1658b7=_0x1c5e23<0x3?_0x1ed894:_0x1d6d7c===null?_0x1d6d7c=Object['getOwnPropertyDescriptor'](_0x1ed894,_0x1c6d00):_0x1d6d7c,_0xfc7721;if(typeof Reflect===_0x894a62(0xd3)&&typeof Reflect[_0x894a62(0xe3)]===_0x894a62(0xf5))_0x1658b7=Reflect[_0x894a62(0xe3)](_0x183778,_0x1ed894,_0x1c6d00,_0x1d6d7c);else{for(var _0x5bd6a4=_0x183778[_0x894a62(0xb3)]-0x1;_0x5bd6a4>=0x0;_0x5bd6a4--)if(_0xfc7721=_0x183778[_0x5bd6a4])_0x1658b7=(_0x1c5e23<0x3?_0xfc7721(_0x1658b7):_0x1c5e23>0x3?_0xfc7721(_0x1ed894,_0x1c6d00,_0x1658b7):_0xfc7721(_0x1ed894,_0x1c6d00))||_0x1658b7;}return _0x1c5e23>0x3&&_0x1658b7&&Object['defineProperty'](_0x1ed894,_0x1c6d00,_0x1658b7),_0x1658b7;},__metadata=this&&this[a97_0x4077d2(0xf8)]||function(_0x5e2058,_0x1e7de3){const _0xc49eab=a97_0x4077d2;if(typeof Reflect==='object'&&typeof Reflect[_0xc49eab(0xd4)]==='function')return Reflect[_0xc49eab(0xd4)](_0x5e2058,_0x1e7de3);},__importDefault=this&&this[a97_0x4077d2(0xe7)]||function(_0x15f92f){return _0x15f92f&&_0x15f92f['__esModule']?_0x15f92f:{'default':_0x15f92f};};Object[a97_0x4077d2(0xb8)](exports,a97_0x4077d2(0xe0),{'value':!![]}),exports[a97_0x4077d2(0xf2)]=void 0x0;const typedi_1=require(a97_0x4077d2(0xe9)),jsforce_1=__importDefault(require(a97_0x4077d2(0xcc))),unauthorized_error_1=require(a97_0x4077d2(0xeb)),errors_1=require(a97_0x4077d2(0xd1)),core_1=require('../../../core'),salesforce_settings_service_1=require('../../shared/services/salesforce-settings.service'),app_settings_service_1=require(a97_0x4077d2(0xd0)),internal_server_error_1=require(a97_0x4077d2(0xbd)),logger=new core_1['Logger'](a97_0x4077d2(0xb5));let SalesforceService=class SalesforceService{constructor(_0x1ec136,_0x1994e9){const _0x418fd9=a97_0x4077d2;this[_0x418fd9(0xbc)]=_0x1ec136,this['appSettings']=_0x1994e9,this[_0x418fd9(0xdf)]=this['appSettings'][_0x418fd9(0xef)]===_0x418fd9(0xe1)?_0x418fd9(0xbe):'';}get[a97_0x4077d2(0xf4)](){const _0x53595a=a97_0x4077d2;return this[_0x53595a(0xbc)]['settings'];}async[a97_0x4077d2(0xd2)](){const _0x2d1b0c=a97_0x4077d2;logger[_0x2d1b0c(0xec)](_0x2d1b0c(0xfa));if(!this[_0x2d1b0c(0xbc)][_0x2d1b0c(0xf7)])throw new unauthorized_error_1['UnauthorizedError'](errors_1[_0x2d1b0c(0xc7)]);const {clientId:_0x364042,clientSecret:_0x46de84,refreshToken:_0x5caa8b}=this['settings'],_0x573ba6={'clientId':_0x364042,'clientSecret':_0x46de84,'loginUrl':this[_0x2d1b0c(0xbc)]['loginUrl']};if(!this['salesforseSettings'][_0x2d1b0c(0xe2)]){logger[_0x2d1b0c(0xec)](_0x2d1b0c(0xc8));const _0x266526=new jsforce_1[(_0x2d1b0c(0xf1))]['Connection'](_0x573ba6),{access_token:_0x17026f,instance_url:_0x5bf03b}=await _0x266526[_0x2d1b0c(0xd6)][_0x2d1b0c(0xdb)](_0x5caa8b);await this[_0x2d1b0c(0xbc)][_0x2d1b0c(0xe4)]({'accessToken':_0x17026f,'instanceUrl':_0x5bf03b});}const {accessToken:_0x141aac,instanceUrl:_0x25e84c}=this[_0x2d1b0c(0xf4)];this[_0x2d1b0c(0xca)]=new jsforce_1['default'][(_0x2d1b0c(0xc3))]({'oauth2':_0x573ba6,'refreshToken':_0x5caa8b,'accessToken':_0x141aac,'instanceUrl':_0x25e84c}),logger['log']('salesforce\x20connection\x20established');}async[a97_0x4077d2(0xfb)](_0x412ca9){const _0x205af9=a97_0x4077d2;logger['log'](_0x205af9(0xd7),this[_0x205af9(0xf4)][_0x205af9(0xc2)]);try{const _0x1247bc=await this[_0x205af9(0xca)][_0x205af9(0xb9)][_0x205af9(0xf3)](this['namespace']+'/attachments',{'componentIds':_0x412ca9,'loggerId':this['settings'][_0x205af9(0xc2)]});return _0x1247bc;}catch(_0x48bbb6){throw new internal_server_error_1[(_0x205af9(0xbf))](_0x48bbb6);}}async[a97_0x4077d2(0xc4)](_0x4c41e0){const _0x312a93=a97_0x4077d2;logger[_0x312a93(0xec)]('remove\x20commit\x20%s',_0x4c41e0);try{await this[_0x312a93(0xca)][_0x312a93(0xc6)](_0x312a93(0xba))['record'](_0x4c41e0)[_0x312a93(0xc1)]();}catch(_0x490701){await this['log'](_0x490701[_0x312a93(0xd5)]);}}async[a97_0x4077d2(0xbb)](_0x506844){const _0x26eb27=a97_0x4077d2;try{logger['log']('retrieve\x20attachment\x20%s\x20from\x20salesforce',_0x506844);const _0x476dbe=await new Promise((_0x1646de,_0xcf5a1d)=>{const _0x3ed86e=a97_0x271d,_0x821567=[],_0x18d129=this[_0x3ed86e(0xca)][_0x3ed86e(0xc6)](_0x3ed86e(0xba))[_0x3ed86e(0xcd)](_0x506844)[_0x3ed86e(0xcf)]('Body');_0x18d129['on'](_0x3ed86e(0xb4),_0xcf5a1d),_0x18d129['on'](_0x3ed86e(0xb7),_0x274e1b=>_0x821567[_0x3ed86e(0xf0)](_0x274e1b)),_0x18d129['on'](_0x3ed86e(0xea),()=>_0x1646de(_0x821567['join']('')));});return _0x476dbe;}catch(_0x24cc5b){this[_0x26eb27(0xec)](_0x24cc5b[_0x26eb27(0xd5)]);throw new internal_server_error_1[(_0x26eb27(0xbf))](_0x24cc5b);}}async[a97_0x4077d2(0xec)](_0x2aaa9c){const _0x45cb08=a97_0x4077d2;try{logger[_0x45cb08(0xec)](_0x45cb08(0xe6),this[_0x45cb08(0xf4)][_0x45cb08(0xc2)]),await this[_0x45cb08(0xca)][_0x45cb08(0xb9)][_0x45cb08(0xf3)](this[_0x45cb08(0xdf)]+_0x45cb08(0xed),{'message':_0x2aaa9c,'loggerId':this[_0x45cb08(0xf4)]['loggerId']});}catch(_0x5a9e93){throw new internal_server_error_1[(_0x45cb08(0xbf))](_0x5a9e93);}}};SalesforceService=__decorate([typedi_1[a97_0x4077d2(0xb6)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a97_0x4077d2(0xe5)],app_settings_service_1[a97_0x4077d2(0xc5)]])],SalesforceService),exports[a97_0x4077d2(0xf2)]=SalesforceService;