const a97_0x2ec8=['push','salesforseSettings','env','apply','metadata','retrieve','../../../core/errors/internal-server.error','../../../core','error','object','27gpHjKS','default','50497ZoeWYr','19942gDCqwU','retrieve\x20attachment\x20%s\x20from\x20salesforce','/logger','end','refreshToken','__importDefault','SalesforceService','salesforce-service','10IFyTbQ','deleteCommit','../../../core/errors/unauthorized.error','appSettings','__esModule','apex','connection','5fhxgKr','Body','SalesforceSettingsService','462926bHRDxG','InternalServerError','[LID:%s]\x20log\x20message\x20to\x20salesforce','connect','remove\x20commit\x20%s','loggerId','getOwnPropertyDescriptor','delete','decorate','loginUrl','21JDnues','35115kNOKvp','blob','[LID:%s]\x20retrieve\x20components\x20from\x20salesforce','log','record','Logger','typedi','oauth2','join','30967topSkM','length','test','1302125RgaDAd','update','constructor','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','116434utrdAs','../../shared/services/app-settings.service','ERR_MISSING_SALEFORCE_CONFIGURATION','/flosum_git','defineProperty','create\x20new\x20oauth\x20connection\x20from\x20given\x20credentials','Attachment','retrieveAttachment','__metadata','namespace','return\x20/\x22\x20+\x20this\x20+\x20\x22/','function','production','../../shared/services/salesforce-settings.service','sobject','settings','../../../constants/errors','UnauthorizedError','Service'];const a97_0x54caf9=a97_0x5efb;(function(_0x5f02b3,_0x4f4209){const _0x2566b0=a97_0x5efb;while(!![]){try{const _0x1b57a4=-parseInt(_0x2566b0(0x118))+parseInt(_0x2566b0(0x13c))+parseInt(_0x2566b0(0x115))*-parseInt(_0x2566b0(0x10b))+-parseInt(_0x2566b0(0x139))*parseInt(_0x2566b0(0x13b))+-parseInt(_0x2566b0(0x11c))*parseInt(_0x2566b0(0xfe))+parseInt(_0x2566b0(0x10c))+-parseInt(_0x2566b0(0xf7))*-parseInt(_0x2566b0(0x101));if(_0x1b57a4===_0x4f4209)break;else _0x5f02b3['push'](_0x5f02b3['shift']());}catch(_0x487bf0){_0x5f02b3['push'](_0x5f02b3['shift']());}}}(a97_0x2ec8,0xbff78));const a97_0x18574f=function(){let _0x5bd468=!![];return function(_0x42b072,_0x159c33){const _0x18e961=_0x5bd468?function(){const _0xbc4326=a97_0x5efb;if(_0x159c33){const _0x5b7ec0=_0x159c33[_0xbc4326(0x132)](_0x42b072,arguments);return _0x159c33=null,_0x5b7ec0;}}:function(){};return _0x5bd468=![],_0x18e961;};}(),a97_0x141b65=a97_0x18574f(this,function(){const _0x1c1706=function(){const _0x13bc4b=a97_0x5efb,_0x45bee0=_0x1c1706[_0x13bc4b(0x11a)](_0x13bc4b(0x126))()[_0x13bc4b(0x11a)](_0x13bc4b(0x11b));return!_0x45bee0[_0x13bc4b(0x117)](a97_0x141b65);};return _0x1c1706();});a97_0x141b65();'use strict';var __decorate=this&&this['__decorate']||function(_0x369ea1,_0xc554b1,_0x59722d,_0x72188d){const _0x495019=a97_0x5efb;var _0x359ebb=arguments['length'],_0x2f0c6c=_0x359ebb<0x3?_0xc554b1:_0x72188d===null?_0x72188d=Object[_0x495019(0x107)](_0xc554b1,_0x59722d):_0x72188d,_0x208cd9;if(typeof Reflect===_0x495019(0x138)&&typeof Reflect[_0x495019(0x109)]===_0x495019(0x127))_0x2f0c6c=Reflect[_0x495019(0x109)](_0x369ea1,_0xc554b1,_0x59722d,_0x72188d);else{for(var _0x5c5c8c=_0x369ea1[_0x495019(0x116)]-0x1;_0x5c5c8c>=0x0;_0x5c5c8c--)if(_0x208cd9=_0x369ea1[_0x5c5c8c])_0x2f0c6c=(_0x359ebb<0x3?_0x208cd9(_0x2f0c6c):_0x359ebb>0x3?_0x208cd9(_0xc554b1,_0x59722d,_0x2f0c6c):_0x208cd9(_0xc554b1,_0x59722d))||_0x2f0c6c;}return _0x359ebb>0x3&&_0x2f0c6c&&Object[_0x495019(0x120)](_0xc554b1,_0x59722d,_0x2f0c6c),_0x2f0c6c;},__metadata=this&&this[a97_0x54caf9(0x124)]||function(_0x1656f1,_0x1bd44b){const _0x33aa9a=a97_0x54caf9;if(typeof Reflect===_0x33aa9a(0x138)&&typeof Reflect[_0x33aa9a(0x133)]===_0x33aa9a(0x127))return Reflect[_0x33aa9a(0x133)](_0x1656f1,_0x1bd44b);},__importDefault=this&&this[a97_0x54caf9(0x141)]||function(_0x2cf171){const _0x6f8d35=a97_0x54caf9;return _0x2cf171&&_0x2cf171[_0x6f8d35(0xfb)]?_0x2cf171:{'default':_0x2cf171};};Object['defineProperty'](exports,a97_0x54caf9(0xfb),{'value':!![]}),exports[a97_0x54caf9(0xf5)]=void 0x0;function a97_0x5efb(_0x276db5,_0x2a96ef){return a97_0x5efb=function(_0x535ee9,_0x141b65){_0x535ee9=_0x535ee9-0xf5;let _0x18574f=a97_0x2ec8[_0x535ee9];return _0x18574f;},a97_0x5efb(_0x276db5,_0x2a96ef);}const typedi_1=require(a97_0x54caf9(0x112)),jsforce_1=__importDefault(require('jsforce')),unauthorized_error_1=require(a97_0x54caf9(0xf9)),errors_1=require(a97_0x54caf9(0x12c)),core_1=require(a97_0x54caf9(0x136)),salesforce_settings_service_1=require(a97_0x54caf9(0x129)),app_settings_service_1=require(a97_0x54caf9(0x11d)),internal_server_error_1=require(a97_0x54caf9(0x135)),logger=new core_1[(a97_0x54caf9(0x111))](a97_0x54caf9(0xf6));let SalesforceService=class SalesforceService{constructor(_0x5134c3,_0x1d27d8){const _0x7e2685=a97_0x54caf9;this[_0x7e2685(0x130)]=_0x5134c3,this[_0x7e2685(0xfa)]=_0x1d27d8,this['namespace']=this['appSettings'][_0x7e2685(0x131)]===_0x7e2685(0x128)?_0x7e2685(0x11f):'';}get[a97_0x54caf9(0x12b)](){const _0x31cd0f=a97_0x54caf9;return this[_0x31cd0f(0x130)][_0x31cd0f(0x12b)];}async[a97_0x54caf9(0x104)](){const _0x429237=a97_0x54caf9;logger[_0x429237(0x10f)]('trying\x20to\x20establish\x20connection\x20to\x20salesforce');if(!this[_0x429237(0x130)]['hasCredentials'])throw new unauthorized_error_1[(_0x429237(0x12d))](errors_1[_0x429237(0x11e)]);const {clientId:_0x2d0559,clientSecret:_0x599523,refreshToken:_0x11d8f7}=this[_0x429237(0x12b)],_0x375c1a={'clientId':_0x2d0559,'clientSecret':_0x599523,'loginUrl':this[_0x429237(0x130)][_0x429237(0x10a)]};if(!this['salesforseSettings']['hasAuthorizedCredentials']){logger[_0x429237(0x10f)](_0x429237(0x121));const _0x3e4157=new jsforce_1['default']['Connection'](_0x375c1a),{access_token:_0x58287c,instance_url:_0x562232}=await _0x3e4157[_0x429237(0x113)][_0x429237(0x140)](_0x11d8f7);await this['salesforseSettings'][_0x429237(0x119)]({'accessToken':_0x58287c,'instanceUrl':_0x562232});}const {accessToken:_0x17c6ff,instanceUrl:_0x38c4d2}=this[_0x429237(0x12b)];this[_0x429237(0xfd)]=new jsforce_1[(_0x429237(0x13a))]['Connection']({'oauth2':_0x375c1a,'refreshToken':_0x11d8f7,'accessToken':_0x17c6ff,'instanceUrl':_0x38c4d2}),logger[_0x429237(0x10f)]('salesforce\x20connection\x20established');}async[a97_0x54caf9(0x134)](_0x5c24c7){const _0x3d3d65=a97_0x54caf9;logger[_0x3d3d65(0x10f)](_0x3d3d65(0x10e),this[_0x3d3d65(0x12b)]['loggerId']);try{const _0x457864=await this[_0x3d3d65(0xfd)]['apex']['post'](this['namespace']+'/attachments',{'componentIds':_0x5c24c7,'loggerId':this['settings'][_0x3d3d65(0x106)]});return _0x457864;}catch(_0x4c8a14){throw new internal_server_error_1[(_0x3d3d65(0x102))](_0x4c8a14);}}async[a97_0x54caf9(0xf8)](_0x12dad6){const _0x249710=a97_0x54caf9;logger[_0x249710(0x10f)](_0x249710(0x105),_0x12dad6);try{await this[_0x249710(0xfd)][_0x249710(0x12a)](_0x249710(0x122))[_0x249710(0x110)](_0x12dad6)[_0x249710(0x108)]();}catch(_0x5a33fd){await this[_0x249710(0x10f)](_0x5a33fd['message']);}}async[a97_0x54caf9(0x123)](_0x1ae886){const _0x51d441=a97_0x54caf9;try{logger[_0x51d441(0x10f)](_0x51d441(0x13d),_0x1ae886);const _0xdfb588=await new Promise((_0x1d2f61,_0x597bb3)=>{const _0x14c3fc=_0x51d441,_0x1c45f4=[],_0x10c0da=this['connection'][_0x14c3fc(0x12a)]('Attachment')['record'](_0x1ae886)[_0x14c3fc(0x10d)](_0x14c3fc(0xff));_0x10c0da['on'](_0x14c3fc(0x137),_0x597bb3),_0x10c0da['on']('data',_0x4ac55=>_0x1c45f4[_0x14c3fc(0x12f)](_0x4ac55)),_0x10c0da['on'](_0x14c3fc(0x13f),()=>_0x1d2f61(_0x1c45f4[_0x14c3fc(0x114)]('')));});return _0xdfb588;}catch(_0x5de4be){this[_0x51d441(0x10f)](_0x5de4be['message']);throw new internal_server_error_1[(_0x51d441(0x102))](_0x5de4be);}}async[a97_0x54caf9(0x10f)](_0x4fed85){const _0xb9ee2b=a97_0x54caf9;try{logger['log'](_0xb9ee2b(0x103),this[_0xb9ee2b(0x12b)]['loggerId']),await this[_0xb9ee2b(0xfd)][_0xb9ee2b(0xfc)]['post'](this[_0xb9ee2b(0x125)]+_0xb9ee2b(0x13e),{'message':_0x4fed85,'loggerId':this[_0xb9ee2b(0x12b)]['loggerId']});}catch(_0x504eff){throw new internal_server_error_1[(_0xb9ee2b(0x102))](_0x504eff);}}};SalesforceService=__decorate([typedi_1[a97_0x54caf9(0x12e)](),__metadata('design:paramtypes',[salesforce_settings_service_1[a97_0x54caf9(0x100)],app_settings_service_1['AppSettingsService']])],SalesforceService),exports['SalesforceService']=SalesforceService;