const a145_0xbd8d=['commitJob','patchObject','1201376IqYpxv','syncRepositoryId','typedi','encodeBase64','commitAttachmentId','270349WdORgt','stringify','gitUrl','test','then','4CozsjV','getComponentsToWrite','__decorate','243543FXXXwe','../../salesforce/services/salesforce-retriever.service','getOwnPropertyDescriptor','metadata','[ERROR]\x20','exec','deleteAttachmentId','3NUzyoM','sha','branchName','Attachment','CommitComponentsJob','4hZGNll','getComponentsToDelete','all','name','repositoryName','handleCommitJobError','salesforceSync','map','constructor','getCommitDto','FlosumCommitJob','salesforceService','getRepoService','user','Service','branch','SalesforceService','setLoggerId','repo','defineProperty','CommitComponentsDto','repository','1104069JdcQww','branches','deleteAttachment','design:paramtypes','gitManager','object','getRepositoryRecord',']\x20[Repository:\x20','function','logger','syncBranchId','../../shared/git-provider.manager','run','Completed','../../../constants/errors',']\x20[Branch:\x20','convertToSFDX','message','SalesforceSyncService','updateLastCommit','fetchRepositoryData','GitProviderManager','ERR_UNKNOWN_SYNC_RECORD_ID','BadRequestError','send','../../salesforce/services/salesforce-sync.service','10481nBwMLn','setStatus','../dto/commit-components.dto','apply','retrieveAttachment','repositoryData','In\x20Progress','split','return\x20/\x22\x20+\x20this\x20+\x20\x22/','__esModule','Error','trim','log','Logger','255669yriBCk','SalesforceRetrieverService','getOne','toUpperCase','getBranchRecord','../../../core','41aSSyHh','1061435tDeqsv','commitData'];const a145_0x24c7f3=a145_0x1b64;(function(_0x260684,_0xf92e73){const _0x148c04=a145_0x1b64;while(!![]){try{const _0x1547f0=-parseInt(_0x148c04(0x1d5))*-parseInt(_0x148c04(0x197))+parseInt(_0x148c04(0x1ad))+-parseInt(_0x148c04(0x192))*parseInt(_0x148c04(0x1ed))+-parseInt(_0x148c04(0x1e0))+-parseInt(_0x148c04(0x1e5))*-parseInt(_0x148c04(0x1ea))+-parseInt(_0x148c04(0x1dc))+-parseInt(_0x148c04(0x1db))*-parseInt(_0x148c04(0x1c7));if(_0x1547f0===_0xf92e73)break;else _0x260684['push'](_0x260684['shift']());}catch(_0x46a502){_0x260684['push'](_0x260684['shift']());}}}(a145_0xbd8d,0x9d546));const a145_0xae7e3d=function(){let _0x578ad7=!![];return function(_0x4aa96b,_0x239b49){const _0x17f3d0=_0x578ad7?function(){const _0x2ede1d=a145_0x1b64;if(_0x239b49){const _0xc95d89=_0x239b49[_0x2ede1d(0x1ca)](_0x4aa96b,arguments);return _0x239b49=null,_0xc95d89;}}:function(){};return _0x578ad7=![],_0x17f3d0;};}(),a145_0x4fd6e6=a145_0xae7e3d(this,function(){const _0x40e6ed=function(){const _0x4827d3=a145_0x1b64,_0x181024=_0x40e6ed['constructor'](_0x4827d3(0x1cf))()[_0x4827d3(0x19f)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x181024[_0x4827d3(0x1e8)](a145_0x4fd6e6);};return _0x40e6ed();});a145_0x4fd6e6();'use strict';var __decorate=this&&this[a145_0x24c7f3(0x1ec)]||function(_0x4190f9,_0x44f2e5,_0x6f2c4c,_0x3ef734){const _0x49a9c9=a145_0x24c7f3;var _0x5e77d3=arguments['length'],_0x5dad09=_0x5e77d3<0x3?_0x44f2e5:_0x3ef734===null?_0x3ef734=Object[_0x49a9c9(0x1ef)](_0x44f2e5,_0x6f2c4c):_0x3ef734,_0x37a02c;if(typeof Reflect===_0x49a9c9(0x1b2)&&typeof Reflect['decorate']===_0x49a9c9(0x1b5))_0x5dad09=Reflect['decorate'](_0x4190f9,_0x44f2e5,_0x6f2c4c,_0x3ef734);else{for(var _0x2203bd=_0x4190f9['length']-0x1;_0x2203bd>=0x0;_0x2203bd--)if(_0x37a02c=_0x4190f9[_0x2203bd])_0x5dad09=(_0x5e77d3<0x3?_0x37a02c(_0x5dad09):_0x5e77d3>0x3?_0x37a02c(_0x44f2e5,_0x6f2c4c,_0x5dad09):_0x37a02c(_0x44f2e5,_0x6f2c4c))||_0x5dad09;}return _0x5e77d3>0x3&&_0x5dad09&&Object[_0x49a9c9(0x1aa)](_0x44f2e5,_0x6f2c4c,_0x5dad09),_0x5dad09;},__metadata=this&&this['__metadata']||function(_0x55a029,_0x4b3172){const _0x3486eb=a145_0x24c7f3;if(typeof Reflect===_0x3486eb(0x1b2)&&typeof Reflect[_0x3486eb(0x18e)]===_0x3486eb(0x1b5))return Reflect[_0x3486eb(0x18e)](_0x55a029,_0x4b3172);};Object['defineProperty'](exports,a145_0x24c7f3(0x1d0),{'value':!![]}),exports[a145_0x24c7f3(0x1a1)]=void 0x0;const core_1=require(a145_0x24c7f3(0x1da)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a145_0x24c7f3(0x1b8)),typedi_1=require(a145_0x24c7f3(0x1e2)),errors_1=require(a145_0x24c7f3(0x1bb)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a145_0x24c7f3(0x1ee)),salesforce_sync_service_1=require(a145_0x24c7f3(0x1c6)),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a145_0x24c7f3(0x1c9)),commit_components_job_1=require('./commit-components.job'),logger=new core_1[(a145_0x24c7f3(0x1d4))]('flosum-commit-job');let FlosumCommitJob=class FlosumCommitJob{constructor(_0x4166e4,_0x2761b4,_0x155c3e,_0x5db06e){const _0x4bac63=a145_0x24c7f3;this[_0x4bac63(0x1a2)]=_0x4166e4,this[_0x4bac63(0x1de)]=_0x2761b4,this['salesforceSync']=_0x155c3e,this[_0x4bac63(0x1b1)]=_0x5db06e,this['repoService']=this['gitManager'][_0x4bac63(0x1a3)]();}['log'](_0x431f61){const _0x1a176d=a145_0x24c7f3;return this['logger'][_0x1a176d(0x1d3)]('[COMMIT]\x20['+this[_0x1a176d(0x1b1)]['provider'][_0x1a176d(0x1d8)]()+_0x1a176d(0x1b4)+this[_0x1a176d(0x1ac)][_0x1a176d(0x19a)]+_0x1a176d(0x1bc)+this[_0x1a176d(0x1a6)]['name']+']\x20'+_0x431f61);}async[a145_0x24c7f3(0x1c1)](){const _0x5fc62c=a145_0x24c7f3;try{if(this['commitData'][_0x5fc62c(0x1e1)])this[_0x5fc62c(0x1cc)]=await this[_0x5fc62c(0x19d)][_0x5fc62c(0x1b3)](this[_0x5fc62c(0x1dd)][_0x5fc62c(0x1e1)]);else this[_0x5fc62c(0x1dd)][_0x5fc62c(0x1b7)]&&(this[_0x5fc62c(0x1cc)]=await this[_0x5fc62c(0x19d)][_0x5fc62c(0x1d9)](this['commitData'][_0x5fc62c(0x1b7)]));}catch(_0x3168dd){throw new bad_request_error_1[(_0x5fc62c(0x1c4))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a145_0x24c7f3(0x1eb)](){const _0x55a38e=a145_0x24c7f3;if(!this[_0x55a38e(0x1dd)]['commitAttachmentId'])return[];const _0xfa12a0=await this[_0x55a38e(0x1a2)][_0x55a38e(0x1cb)](this[_0x55a38e(0x1dd)]['commitAttachmentId'])[_0x55a38e(0x1e9)](_0x4bbd94=>_0x4bbd94[_0x55a38e(0x1ce)]('\x20')[_0x55a38e(0x19e)](_0x5a2005=>_0x5a2005[_0x55a38e(0x1d2)]())),_0x4088ce=new salesforce_retriever_service_1[(_0x55a38e(0x1d6))](this[_0x55a38e(0x1a2)]),_0x4f674c=await _0x4088ce[_0x55a38e(0x1b9)](_0xfa12a0);return _0x4f674c;}async[a145_0x24c7f3(0x198)](){const _0x539da4=a145_0x24c7f3;if(!this[_0x539da4(0x1dd)][_0x539da4(0x191)])return[];const _0xc4e600=await this[_0x539da4(0x1a2)][_0x539da4(0x1cb)](this['commitData'][_0x539da4(0x191)]);return _0xc4e600;}async[a145_0x24c7f3(0x1a0)](){const _0x4d70f3=a145_0x24c7f3,_0x28a5e1=new commit_components_dto_1[(_0x4d70f3(0x1ab))](),[_0x9596ac,_0x469963]=await Promise[_0x4d70f3(0x199)]([this[_0x4d70f3(0x1eb)](),this[_0x4d70f3(0x198)]()]);return _0x28a5e1[_0x4d70f3(0x1be)]=this[_0x4d70f3(0x1dd)][_0x4d70f3(0x1be)],_0x28a5e1[_0x4d70f3(0x1a4)]=this['commitData'][_0x4d70f3(0x1a4)],_0x28a5e1['components']={'writed':_0x9596ac,'deleted':_0x469963},_0x28a5e1['convertToSFDX']=this[_0x4d70f3(0x1dd)][_0x4d70f3(0x1bd)],_0x28a5e1[_0x4d70f3(0x1a9)]=this[_0x4d70f3(0x1ac)],_0x28a5e1[_0x4d70f3(0x1a6)]=this['branch'],_0x28a5e1;}async[a145_0x24c7f3(0x1c0)](_0x44157c=![]){const _0x1656b5=a145_0x24c7f3,_0x416fe5=await this[_0x1656b5(0x19d)]['getAttachmentId'](this[_0x1656b5(0x1cc)]);if(_0x44157c)await this[_0x1656b5(0x1a2)][_0x1656b5(0x1df)](_0x1656b5(0x195),_0x416fe5,{'Body':utils_1[_0x1656b5(0x1e3)](JSON[_0x1656b5(0x1e6)]({}))});else{const _0x372632=await this[_0x1656b5(0x1ac)][_0x1656b5(0x1ae)][_0x1656b5(0x1d7)](this[_0x1656b5(0x1a6)][_0x1656b5(0x19a)]);this[_0x1656b5(0x1d3)]('[INFO]\x20Update\x20remote\x20state.');const _0x396233={[this[_0x1656b5(0x1ac)][_0x1656b5(0x1e7)]]:{'lastCommit':_0x372632[_0x1656b5(0x193)]}};await this[_0x1656b5(0x1a2)][_0x1656b5(0x1df)]('Attachment',_0x416fe5,{'Body':utils_1[_0x1656b5(0x1e3)](JSON[_0x1656b5(0x1e6)](_0x396233))});}}async['exec'](){const _0x1e357f=a145_0x24c7f3,_0x57a9e7=await this[_0x1e357f(0x1a0)]();this['commitJob'][_0x1e357f(0x1b6)]=this[_0x1e357f(0x1b6)],await this[_0x1e357f(0x19d)][_0x1e357f(0x1c8)](this['repositoryData'],_0x1e357f(0x1cd)),await this[_0x1e357f(0x1de)][_0x1e357f(0x1b9)](_0x57a9e7),await this[_0x1e357f(0x1c0)](),this['commitData']['commitAttachmentId']&&await this[_0x1e357f(0x1a2)]['deleteAttachment'](this['commitData'][_0x1e357f(0x1e4)]),this['commitData']['deleteAttachmentId']&&await this[_0x1e357f(0x1a2)][_0x1e357f(0x1af)](this['commitData'][_0x1e357f(0x191)]),await this['salesforceSync'][_0x1e357f(0x1c8)](this[_0x1e357f(0x1cc)],_0x1e357f(0x1ba));}async[a145_0x24c7f3(0x19c)](_0x335618){const _0x2b2ffa=a145_0x24c7f3;try{this[_0x2b2ffa(0x1b6)][_0x2b2ffa(0x1d3)](_0x2b2ffa(0x18f)+_0x335618),await this[_0x2b2ffa(0x1b6)][_0x2b2ffa(0x1c5)](),await this['updateLastCommit'](!![]),await this['salesforceSync']['setStatus'](this['repositoryData'],_0x2b2ffa(0x1d1));}catch(_0x1c569f){logger['error'](_0x1c569f);}}async[a145_0x24c7f3(0x1b9)](_0x5835c3,_0x5ef648){const _0x225dfe=a145_0x24c7f3;try{this[_0x225dfe(0x1dd)]=_0x5835c3,this[_0x225dfe(0x1a2)][_0x225dfe(0x1a8)](_0x5ef648),this[_0x225dfe(0x1b6)]=this[_0x225dfe(0x1a2)]['getLogger'](),await this[_0x225dfe(0x1c1)]();if(!this[_0x225dfe(0x1cc)])throw new bad_request_error_1[(_0x225dfe(0x1c4))](errors_1[_0x225dfe(0x1c3)]);this[_0x225dfe(0x1ac)]=await this['repoService'][_0x225dfe(0x1d7)](this[_0x225dfe(0x1cc)][_0x225dfe(0x19b)]),this[_0x225dfe(0x1a6)]=await this[_0x225dfe(0x1ac)][_0x225dfe(0x1ae)][_0x225dfe(0x1d7)](this[_0x225dfe(0x1cc)][_0x225dfe(0x194)]),this[_0x225dfe(0x1d3)]('[INFO]\x20Start\x20commit\x20job'),this[_0x225dfe(0x190)]()['catch'](_0x1d42d6=>this['handleCommitJobError'](_0x1d42d6));}catch(_0x3fce6c){this[_0x225dfe(0x1dd)]=undefined,logger['error'](_0x3fce6c);throw _0x3fce6c;}}};function a145_0x1b64(_0x332823,_0x47ab45){return a145_0x1b64=function(_0x47fed0,_0x4fd6e6){_0x47fed0=_0x47fed0-0x18e;let _0xae7e3d=a145_0xbd8d[_0x47fed0];return _0xae7e3d;},a145_0x1b64(_0x332823,_0x47ab45);}FlosumCommitJob=__decorate([typedi_1[a145_0x24c7f3(0x1a5)]({'transient':!![]}),__metadata(a145_0x24c7f3(0x1b0),[salesforce_service_1[a145_0x24c7f3(0x1a7)],commit_components_job_1[a145_0x24c7f3(0x196)],salesforce_sync_service_1[a145_0x24c7f3(0x1bf)],git_provider_manager_1[a145_0x24c7f3(0x1c2)]])],FlosumCommitJob),exports[a145_0x24c7f3(0x1a1)]=FlosumCommitJob;