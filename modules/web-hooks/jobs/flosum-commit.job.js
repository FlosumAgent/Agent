const a147_0x424604=a147_0x2152;(function(_0x53a13c,_0xa26020){const _0xdf56ab=a147_0x2152,_0x471fdf=_0x53a13c();while(!![]){try{const _0x32d637=parseInt(_0xdf56ab(0xb4))/0x1*(parseInt(_0xdf56ab(0xb3))/0x2)+-parseInt(_0xdf56ab(0xd8))/0x3+-parseInt(_0xdf56ab(0xaa))/0x4*(-parseInt(_0xdf56ab(0xe0))/0x5)+parseInt(_0xdf56ab(0xf7))/0x6+-parseInt(_0xdf56ab(0x102))/0x7+-parseInt(_0xdf56ab(0xad))/0x8+-parseInt(_0xdf56ab(0xef))/0x9*(parseInt(_0xdf56ab(0xd4))/0xa);if(_0x32d637===_0xa26020)break;else _0x471fdf['push'](_0x471fdf['shift']());}catch(_0x3a1bf4){_0x471fdf['push'](_0x471fdf['shift']());}}}(a147_0xb0bc,0xe5b48));const a147_0xb009dc=function(){let _0x320ef8=!![];return function(_0x4cb369,_0x2aa63){const _0x2c4f8c=_0x320ef8?function(){if(_0x2aa63){const _0x2d9856=_0x2aa63['apply'](_0x4cb369,arguments);return _0x2aa63=null,_0x2d9856;}}:function(){};return _0x320ef8=![],_0x2c4f8c;};}(),a147_0x3422d9=a147_0xb009dc(this,function(){const _0x5b95f9=a147_0x2152;return a147_0x3422d9[_0x5b95f9(0xf2)]()[_0x5b95f9(0xdb)](_0x5b95f9(0xea))[_0x5b95f9(0xf2)]()['constructor'](a147_0x3422d9)[_0x5b95f9(0xdb)](_0x5b95f9(0xea));});function a147_0xb0bc(){const _0x86d7f2=['9512148xyjoSc','syncRepositoryId','In\x20Progress','typedi','trim','SalesforceSyncService','Service','repositoryName','commitData','getRepositoryRecord','repoService','293055ITgahf','metadata','message','setStatus','catch','map','run','convertToSFDX','branchName','272908ZyMfoi','../../../core','send','1769048KPuhBT','design:paramtypes','[COMMIT]\x20[','SalesforceService','error','decorate','46oufKeg','24117vtYTwF','defineProperty','provider',']\x20[Repository:\x20','deleteAttachmentId','BadRequestError','split','FlosumCommitJob','getLogger','all','user','getOwnPropertyDescriptor','SalesforceRetrieverService','salesforceService','getComponentsToWrite','repo','flosum-commit-job','CommitComponentsJob','handleCommitJobError','getOne','../dto/commit-components.dto','branches','log','setLoggerId','function','Completed','repositoryData','../../salesforce/services/salesforce-retriever.service','repository','getComponentsToDelete','exec',']\x20[Branch:\x20','327010ABtITI','updateLastCommit','then','syncBranchId','845202nWvPhU','updateRemoteState','ERR_UNKNOWN_SYNC_RECORD_ID','search','[INFO]\x20Update\x20remote\x20state.','getCommitDto','gitUrl','toUpperCase','115fPnUMf','commitJob','fetchRepositoryData','logger','../../salesforce/services/salesforce.service','commitAttachmentId','branch','name','gitManager','getBranchRecord','(((.+)+)+)+$','CommitComponentsDto','object','[INFO]\x20Start\x20commit\x20job','../../../constants/errors','612TzvHCp','salesforceSync','retrieveAttachment','toString','deleteAttachment','getRepoService','components','[ERROR]\x20'];a147_0xb0bc=function(){return _0x86d7f2;};return a147_0xb0bc();}a147_0x3422d9();function a147_0x2152(_0xc23341,_0x31f17a){const _0x2a74b6=a147_0xb0bc();return a147_0x2152=function(_0x3422d9,_0xb009dc){_0x3422d9=_0x3422d9-0xa3;let _0xb0bc42=_0x2a74b6[_0x3422d9];return _0xb0bc42;},a147_0x2152(_0xc23341,_0x31f17a);}'use strict';var __decorate=this&&this['__decorate']||function(_0x4c0166,_0x2969dc,_0x376e0f,_0x4e014c){const _0x4dd944=a147_0x2152;var _0x4db602=arguments['length'],_0x1a1a99=_0x4db602<0x3?_0x2969dc:_0x4e014c===null?_0x4e014c=Object[_0x4dd944(0xbf)](_0x2969dc,_0x376e0f):_0x4e014c,_0x27657f;if(typeof Reflect===_0x4dd944(0xec)&&typeof Reflect[_0x4dd944(0xb2)]==='function')_0x1a1a99=Reflect[_0x4dd944(0xb2)](_0x4c0166,_0x2969dc,_0x376e0f,_0x4e014c);else{for(var _0x415f4b=_0x4c0166['length']-0x1;_0x415f4b>=0x0;_0x415f4b--)if(_0x27657f=_0x4c0166[_0x415f4b])_0x1a1a99=(_0x4db602<0x3?_0x27657f(_0x1a1a99):_0x4db602>0x3?_0x27657f(_0x2969dc,_0x376e0f,_0x1a1a99):_0x27657f(_0x2969dc,_0x376e0f))||_0x1a1a99;}return _0x4db602>0x3&&_0x1a1a99&&Object['defineProperty'](_0x2969dc,_0x376e0f,_0x1a1a99),_0x1a1a99;},__metadata=this&&this['__metadata']||function(_0x365350,_0x2cbc06){const _0x56d602=a147_0x2152;if(typeof Reflect===_0x56d602(0xec)&&typeof Reflect[_0x56d602(0x103)]===_0x56d602(0xcc))return Reflect[_0x56d602(0x103)](_0x365350,_0x2cbc06);};Object[a147_0x424604(0xb5)](exports,'__esModule',{'value':!![]}),exports[a147_0x424604(0xbb)]=void 0x0;const core_1=require(a147_0x424604(0xab)),salesforce_service_1=require(a147_0x424604(0xe4)),git_provider_manager_1=require('../../shared/git-provider.manager'),typedi_1=require(a147_0x424604(0xfa)),errors_1=require(a147_0x424604(0xee)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a147_0x424604(0xcf)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a147_0x424604(0xc8)),commit_components_job_1=require('./commit-components.job'),logger=new core_1['Logger'](a147_0x424604(0xc4));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x280df4,_0x17b348,_0x3562c9,_0x385388){const _0x148e1e=a147_0x424604;this['salesforceService']=_0x280df4,this[_0x148e1e(0xe1)]=_0x17b348,this[_0x148e1e(0xf0)]=_0x3562c9,this[_0x148e1e(0xe8)]=_0x385388,this['repoService']=this[_0x148e1e(0xe8)][_0x148e1e(0xf4)]();}[a147_0x424604(0xca)](_0x379bd3){const _0x46d742=a147_0x424604;return this[_0x46d742(0xe3)]['log'](_0x46d742(0xaf)+this['gitManager'][_0x46d742(0xb6)][_0x46d742(0xdf)]()+_0x46d742(0xb7)+this[_0x46d742(0xd0)][_0x46d742(0xe7)]+_0x46d742(0xd3)+this[_0x46d742(0xe6)]['name']+']\x20'+_0x379bd3);}async[a147_0x424604(0xe2)](){const _0x44c5eb=a147_0x424604;try{if(this[_0x44c5eb(0xff)]['syncRepositoryId'])this[_0x44c5eb(0xce)]=await this[_0x44c5eb(0xf0)][_0x44c5eb(0x100)](this[_0x44c5eb(0xff)][_0x44c5eb(0xf8)]);else this[_0x44c5eb(0xff)][_0x44c5eb(0xd7)]&&(this[_0x44c5eb(0xce)]=await this['salesforceSync'][_0x44c5eb(0xe9)](this[_0x44c5eb(0xff)]['syncBranchId']));}catch(_0x2c8861){throw new bad_request_error_1['BadRequestError'](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a147_0x424604(0xc2)](){const _0x57cae1=a147_0x424604;if(!this[_0x57cae1(0xff)][_0x57cae1(0xe5)])return[];const _0x4a59c1=await this[_0x57cae1(0xc1)][_0x57cae1(0xf1)](this[_0x57cae1(0xff)]['commitAttachmentId'])[_0x57cae1(0xd6)](_0x4248b3=>_0x4248b3[_0x57cae1(0xba)]('\x20')[_0x57cae1(0xa6)](_0x433dd7=>_0x433dd7[_0x57cae1(0xfb)]())),_0x5072e7=new salesforce_retriever_service_1[(_0x57cae1(0xc0))](this[_0x57cae1(0xc1)]),_0xf5a5=await _0x5072e7[_0x57cae1(0xa7)](_0x4a59c1);return _0xf5a5;}async[a147_0x424604(0xd1)](){const _0x13dd2b=a147_0x424604;if(!this[_0x13dd2b(0xff)][_0x13dd2b(0xb8)])return[];const _0x26f44d=await this['salesforceService'][_0x13dd2b(0xf1)](this[_0x13dd2b(0xff)]['deleteAttachmentId']);return _0x26f44d;}async['getCommitDto'](){const _0x2c0f12=a147_0x424604,_0x200471=new commit_components_dto_1[(_0x2c0f12(0xeb))](),[_0x367911,_0x283d3d]=await Promise[_0x2c0f12(0xbd)]([this[_0x2c0f12(0xc2)](),this['getComponentsToDelete']()]);return _0x200471['message']=this[_0x2c0f12(0xff)][_0x2c0f12(0xa3)],_0x200471[_0x2c0f12(0xbe)]=this[_0x2c0f12(0xff)][_0x2c0f12(0xbe)],_0x200471[_0x2c0f12(0xf5)]={'writed':_0x367911,'deleted':_0x283d3d},_0x200471[_0x2c0f12(0xa8)]=this[_0x2c0f12(0xff)]['convertToSFDX'],_0x200471[_0x2c0f12(0xc3)]=this['repository'],_0x200471[_0x2c0f12(0xe6)]=this[_0x2c0f12(0xe6)],_0x200471;}async[a147_0x424604(0xd5)](_0x93de13=![]){const _0x5916cd=a147_0x424604;if(_0x93de13)await this['salesforceSync'][_0x5916cd(0xd9)](this[_0x5916cd(0xce)],{});else{const _0x3cb156=await this['repository'][_0x5916cd(0xc9)][_0x5916cd(0xc7)](this[_0x5916cd(0xe6)][_0x5916cd(0xe7)]);this[_0x5916cd(0xca)](_0x5916cd(0xdc));const _0x2854d0={[this[_0x5916cd(0xd0)][_0x5916cd(0xde)]]:{'lastCommit':_0x3cb156['sha']}};await this['salesforceSync'][_0x5916cd(0xd9)](this[_0x5916cd(0xce)],_0x2854d0);}}async[a147_0x424604(0xd2)](){const _0x1845c9=a147_0x424604,_0x68c2a7=await this[_0x1845c9(0xdd)]();this[_0x1845c9(0xe1)][_0x1845c9(0xe3)]=this[_0x1845c9(0xe3)],await this['salesforceSync'][_0x1845c9(0xa4)](this[_0x1845c9(0xce)],_0x1845c9(0xf9)),await this[_0x1845c9(0xe1)][_0x1845c9(0xa7)](_0x68c2a7),await this[_0x1845c9(0xd5)](),this[_0x1845c9(0xff)][_0x1845c9(0xe5)]&&await this[_0x1845c9(0xc1)]['deleteAttachment'](this[_0x1845c9(0xff)][_0x1845c9(0xe5)]),this['commitData'][_0x1845c9(0xb8)]&&await this[_0x1845c9(0xc1)][_0x1845c9(0xf3)](this[_0x1845c9(0xff)][_0x1845c9(0xb8)]),await this[_0x1845c9(0xf0)][_0x1845c9(0xa4)](this[_0x1845c9(0xce)],_0x1845c9(0xcd));}async[a147_0x424604(0xc6)](_0x43abdd){const _0x23afb6=a147_0x424604;try{this[_0x23afb6(0xe3)][_0x23afb6(0xca)](_0x23afb6(0xf6)+_0x43abdd),await this[_0x23afb6(0xe3)][_0x23afb6(0xac)](),await this['updateLastCommit'](!![]),await this['salesforceSync'][_0x23afb6(0xa4)](this['repositoryData'],'Error');}catch(_0x50d478){logger[_0x23afb6(0xb1)](_0x50d478);}}async[a147_0x424604(0xa7)](_0x2f9d49,_0x49615d){const _0x13bbf2=a147_0x424604;try{this[_0x13bbf2(0xff)]=_0x2f9d49,this[_0x13bbf2(0xc1)][_0x13bbf2(0xcb)](_0x49615d),this['logger']=this['salesforceService'][_0x13bbf2(0xbc)](),await this[_0x13bbf2(0xe2)]();if(!this[_0x13bbf2(0xce)])throw new bad_request_error_1[(_0x13bbf2(0xb9))](errors_1[_0x13bbf2(0xda)]);this[_0x13bbf2(0xd0)]=await this[_0x13bbf2(0x101)]['getOne'](this[_0x13bbf2(0xce)][_0x13bbf2(0xfe)]),this[_0x13bbf2(0xe6)]=await this[_0x13bbf2(0xd0)][_0x13bbf2(0xc9)][_0x13bbf2(0xc7)](this[_0x13bbf2(0xce)][_0x13bbf2(0xa9)]),this['log'](_0x13bbf2(0xed)),this[_0x13bbf2(0xd2)]()[_0x13bbf2(0xa5)](_0xed9ace=>this[_0x13bbf2(0xc6)](_0xed9ace));}catch(_0x24cd1b){this[_0x13bbf2(0xff)]=undefined,logger[_0x13bbf2(0xb1)](_0x24cd1b);throw _0x24cd1b;}}};FlosumCommitJob=__decorate([(0x0,typedi_1[a147_0x424604(0xfd)])({'transient':!![]}),__metadata(a147_0x424604(0xae),[salesforce_service_1[a147_0x424604(0xb0)],commit_components_job_1[a147_0x424604(0xc5)],salesforce_sync_service_1[a147_0x424604(0xfc)],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports[a147_0x424604(0xbb)]=FlosumCommitJob;