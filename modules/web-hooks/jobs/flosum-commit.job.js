const a145_0x43dd=['Error','__decorate','repositoryData','./commit-components.job','stringify','getAttachmentId','repository','patchObject','run','SalesforceSyncService','getBranchRecord','retrieveAttachment','Service','getLogger','user','[ERROR]\x20','Attachment','getComponentsToDelete','CommitComponentsDto','commitData','Completed','deleteAttachment','SalesforceRetrieverService','[INFO]\x20Update\x20remote\x20state.','ERR_INVALID_SYNC_RECORD_ID','1paAPkg','length','typedi','exec','flosum-commit-job','91096WwfXwf','[COMMIT]\x20[','Logger','254277JQlyMo','465153oDehzg','getOne','return\x20/\x22\x20+\x20this\x20+\x20\x22/','setLoggerId','salesforceService','branch','FlosumCommitJob','../dto/commit-components.dto','error','121RqkVGz','ERR_UNKNOWN_SYNC_RECORD_ID','sha','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','message','catch','decorate',']\x20[Branch:\x20','syncRepositoryId','../../shared/git-provider.manager','salesforceSync','getComponentsToWrite','commitJob','syncBranchId','../../salesforce/services/salesforce-sync.service','trim','defineProperty','branches','../../../core/errors/bad-request.error','repositoryName','logger','BadRequestError','deleteAttachmentId','setStatus','name','test','handleCommitJobError','1613Timsib','gitUrl','gitManager','toUpperCase','send','repoService','then','object','encodeBase64','getRepositoryRecord','commitAttachmentId','log','SalesforceService','674535VrRkGg','convertToSFDX','provider','getCommitDto','updateLastCommit','1914176YkdNnK','constructor','118341Evztpx','../../salesforce/services/salesforce-retriever.service','../../salesforce/services/salesforce.service','metadata','function','GitProviderManager'];const a145_0x4c8458=a145_0x90ec;function a145_0x90ec(_0x2b9537,_0x5d4e4a){return a145_0x90ec=function(_0x17bf93,_0x1026bf){_0x17bf93=_0x17bf93-0x1e0;let _0x453286=a145_0x43dd[_0x17bf93];return _0x453286;},a145_0x90ec(_0x2b9537,_0x5d4e4a);}(function(_0x3b2df0,_0x4fd5b4){const _0x2f74ac=a145_0x90ec;while(!![]){try{const _0x499283=parseInt(_0x2f74ac(0x1ee))*-parseInt(_0x2f74ac(0x233))+-parseInt(_0x2f74ac(0x202))+-parseInt(_0x2f74ac(0x221))*-parseInt(_0x2f74ac(0x229))+-parseInt(_0x2f74ac(0x22a))+-parseInt(_0x2f74ac(0x226))+-parseInt(_0x2f74ac(0x1fb))+parseInt(_0x2f74ac(0x200));if(_0x499283===_0x4fd5b4)break;else _0x3b2df0['push'](_0x3b2df0['shift']());}catch(_0x2fc9ff){_0x3b2df0['push'](_0x3b2df0['shift']());}}}(a145_0x43dd,0x9861b));const a145_0x453286=function(){let _0x5ed510=!![];return function(_0x495299,_0x2ca079){const _0x1857a9=_0x5ed510?function(){if(_0x2ca079){const _0x2df2d8=_0x2ca079['apply'](_0x495299,arguments);return _0x2ca079=null,_0x2df2d8;}}:function(){};return _0x5ed510=![],_0x1857a9;};}(),a145_0x1026bf=a145_0x453286(this,function(){const _0x471c24=function(){const _0x5adbb1=a145_0x90ec,_0x151b89=_0x471c24[_0x5adbb1(0x201)](_0x5adbb1(0x22c))()[_0x5adbb1(0x201)](_0x5adbb1(0x236));return!_0x151b89[_0x5adbb1(0x1ec)](a145_0x1026bf);};return _0x471c24();});a145_0x1026bf();'use strict';var __decorate=this&&this[a145_0x4c8458(0x209)]||function(_0x3e1d8b,_0x39519f,_0x1f33cc,_0x4bcef1){const _0x15c359=a145_0x4c8458;var _0x947c27=arguments[_0x15c359(0x222)],_0x31f9c8=_0x947c27<0x3?_0x39519f:_0x4bcef1===null?_0x4bcef1=Object['getOwnPropertyDescriptor'](_0x39519f,_0x1f33cc):_0x4bcef1,_0x32a207;if(typeof Reflect===_0x15c359(0x1f5)&&typeof Reflect[_0x15c359(0x239)]==='function')_0x31f9c8=Reflect[_0x15c359(0x239)](_0x3e1d8b,_0x39519f,_0x1f33cc,_0x4bcef1);else{for(var _0x1ff030=_0x3e1d8b[_0x15c359(0x222)]-0x1;_0x1ff030>=0x0;_0x1ff030--)if(_0x32a207=_0x3e1d8b[_0x1ff030])_0x31f9c8=(_0x947c27<0x3?_0x32a207(_0x31f9c8):_0x947c27>0x3?_0x32a207(_0x39519f,_0x1f33cc,_0x31f9c8):_0x32a207(_0x39519f,_0x1f33cc))||_0x31f9c8;}return _0x947c27>0x3&&_0x31f9c8&&Object[_0x15c359(0x1e3)](_0x39519f,_0x1f33cc,_0x31f9c8),_0x31f9c8;},__metadata=this&&this['__metadata']||function(_0x311646,_0x471b5f){const _0x59fe7c=a145_0x4c8458;if(typeof Reflect===_0x59fe7c(0x1f5)&&typeof Reflect[_0x59fe7c(0x205)]===_0x59fe7c(0x206))return Reflect[_0x59fe7c(0x205)](_0x311646,_0x471b5f);};Object[a145_0x4c8458(0x1e3)](exports,'__esModule',{'value':!![]}),exports[a145_0x4c8458(0x230)]=void 0x0;const core_1=require('../../../core'),salesforce_service_1=require(a145_0x4c8458(0x204)),git_provider_manager_1=require(a145_0x4c8458(0x23c)),typedi_1=require(a145_0x4c8458(0x223)),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a145_0x4c8458(0x1e5)),salesforce_retriever_service_1=require(a145_0x4c8458(0x203)),salesforce_sync_service_1=require(a145_0x4c8458(0x1e1)),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a145_0x4c8458(0x231)),commit_components_job_1=require(a145_0x4c8458(0x20b)),logger=new core_1[(a145_0x4c8458(0x228))](a145_0x4c8458(0x225));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x370a8f,_0x2399c5,_0x24b5e7,_0x8ce51){const _0x98e3ef=a145_0x4c8458;this[_0x98e3ef(0x22e)]=_0x370a8f,this[_0x98e3ef(0x23f)]=_0x2399c5,this['salesforceSync']=_0x24b5e7,this['gitManager']=_0x8ce51,this[_0x98e3ef(0x1f3)]=this[_0x98e3ef(0x1f0)]['getRepoService']();}[a145_0x4c8458(0x1f9)](_0x5a226f){const _0x4fdfc8=a145_0x4c8458;return this['logger'][_0x4fdfc8(0x1f9)](_0x4fdfc8(0x227)+this[_0x4fdfc8(0x1f0)][_0x4fdfc8(0x1fd)][_0x4fdfc8(0x1f1)]()+']\x20[Repository:\x20'+this['repository'][_0x4fdfc8(0x1eb)]+_0x4fdfc8(0x23a)+this[_0x4fdfc8(0x22f)]['name']+']\x20'+_0x5a226f);}async['fetchRepositoryData'](){const _0x3bbda9=a145_0x4c8458;try{if(this['commitData'][_0x3bbda9(0x23b)])this[_0x3bbda9(0x20a)]=await this[_0x3bbda9(0x23d)][_0x3bbda9(0x1f7)](this[_0x3bbda9(0x21b)][_0x3bbda9(0x23b)]);else this[_0x3bbda9(0x21b)][_0x3bbda9(0x1e0)]&&(this[_0x3bbda9(0x20a)]=await this[_0x3bbda9(0x23d)][_0x3bbda9(0x212)](this['commitData']['syncBranchId']));}catch(_0xc521f0){throw new bad_request_error_1[(_0x3bbda9(0x1e8))](errors_1[_0x3bbda9(0x220)]);}}async['getComponentsToWrite'](){const _0xab9731=a145_0x4c8458;if(!this[_0xab9731(0x21b)]['commitAttachmentId'])return[];const _0x288417=await this['salesforceService']['retrieveAttachment'](this['commitData']['commitAttachmentId'])[_0xab9731(0x1f4)](_0x51f7d2=>_0x51f7d2['split']('\x20')['map'](_0x3fd84e=>_0x3fd84e[_0xab9731(0x1e2)]())),_0x3561b0=new salesforce_retriever_service_1[(_0xab9731(0x21e))](this[_0xab9731(0x22e)]),_0x326c41=await _0x3561b0[_0xab9731(0x210)](_0x288417);return _0x326c41;}async[a145_0x4c8458(0x219)](){const _0x1ded33=a145_0x4c8458;if(!this[_0x1ded33(0x21b)][_0x1ded33(0x1e9)])return[];const _0x455882=await this[_0x1ded33(0x22e)][_0x1ded33(0x213)](this['commitData'][_0x1ded33(0x1e9)]);return _0x455882;}async['getCommitDto'](){const _0x2ca7ef=a145_0x4c8458,_0x5e86c5=new commit_components_dto_1[(_0x2ca7ef(0x21a))](),[_0x24f465,_0x4376f9]=await Promise['all']([this[_0x2ca7ef(0x23e)](),this['getComponentsToDelete']()]);return _0x5e86c5[_0x2ca7ef(0x237)]=this[_0x2ca7ef(0x21b)][_0x2ca7ef(0x237)],_0x5e86c5[_0x2ca7ef(0x216)]=this[_0x2ca7ef(0x21b)][_0x2ca7ef(0x216)],_0x5e86c5['components']={'writed':_0x24f465,'deleted':_0x4376f9},_0x5e86c5[_0x2ca7ef(0x1fc)]=this[_0x2ca7ef(0x21b)][_0x2ca7ef(0x1fc)],_0x5e86c5['repo']=this[_0x2ca7ef(0x20e)],_0x5e86c5[_0x2ca7ef(0x22f)]=this['branch'],_0x5e86c5;}async['updateLastCommit'](_0x2de4eb=![]){const _0x2a6f83=a145_0x4c8458,_0x37e758=await this[_0x2a6f83(0x23d)][_0x2a6f83(0x20d)](this[_0x2a6f83(0x20a)]);if(_0x2de4eb)await this[_0x2a6f83(0x22e)][_0x2a6f83(0x20f)](_0x2a6f83(0x218),_0x37e758,{'Body':utils_1[_0x2a6f83(0x1f6)](JSON[_0x2a6f83(0x20c)]({}))});else{const _0x480a8e=await this[_0x2a6f83(0x20e)][_0x2a6f83(0x1e4)][_0x2a6f83(0x22b)](this[_0x2a6f83(0x22f)][_0x2a6f83(0x1eb)]);this[_0x2a6f83(0x1f9)](_0x2a6f83(0x21f));const _0x489cc6={[this[_0x2a6f83(0x20e)][_0x2a6f83(0x1ef)]]:{'lastCommit':_0x480a8e[_0x2a6f83(0x235)]}};await this[_0x2a6f83(0x22e)]['patchObject']('Attachment',_0x37e758,{'Body':utils_1[_0x2a6f83(0x1f6)](JSON['stringify'](_0x489cc6))});}}async['exec'](){const _0x13698d=a145_0x4c8458,_0x35bc7d=await this[_0x13698d(0x1fe)]();this['commitJob'][_0x13698d(0x1e7)]=this[_0x13698d(0x1e7)],await this['salesforceSync']['setStatus'](this[_0x13698d(0x20a)],'In\x20Progress'),await this[_0x13698d(0x23f)][_0x13698d(0x210)](_0x35bc7d),await this[_0x13698d(0x1ff)](),this[_0x13698d(0x21b)][_0x13698d(0x1f8)]&&await this['salesforceService'][_0x13698d(0x21d)](this[_0x13698d(0x21b)]['commitAttachmentId']),this['commitData']['deleteAttachmentId']&&await this[_0x13698d(0x22e)][_0x13698d(0x21d)](this['commitData']['deleteAttachmentId']),await this[_0x13698d(0x23d)][_0x13698d(0x1ea)](this['repositoryData'],_0x13698d(0x21c));}async[a145_0x4c8458(0x1ed)](_0x502182){const _0x4d0948=a145_0x4c8458;try{this[_0x4d0948(0x1e7)][_0x4d0948(0x1f9)](_0x4d0948(0x217)+_0x502182),await this['logger'][_0x4d0948(0x1f2)](),await this[_0x4d0948(0x1ff)](!![]),await this['salesforceSync'][_0x4d0948(0x1ea)](this[_0x4d0948(0x20a)],_0x4d0948(0x208));}catch(_0x1928af){logger['error'](_0x1928af);}}async['run'](_0x4a79b5,_0x49372d){const _0x574496=a145_0x4c8458;try{this[_0x574496(0x21b)]=_0x4a79b5,this[_0x574496(0x22e)][_0x574496(0x22d)](_0x49372d),this[_0x574496(0x1e7)]=this['salesforceService'][_0x574496(0x215)](),await this['fetchRepositoryData']();if(!this[_0x574496(0x20a)])throw new bad_request_error_1[(_0x574496(0x1e8))](errors_1[_0x574496(0x234)]);this['repository']=await this['repoService'][_0x574496(0x22b)](this[_0x574496(0x20a)][_0x574496(0x1e6)]),this[_0x574496(0x22f)]=await this[_0x574496(0x20e)][_0x574496(0x1e4)][_0x574496(0x22b)](this[_0x574496(0x20a)]['branchName']),this[_0x574496(0x1f9)]('[INFO]\x20Start\x20commit\x20job'),this[_0x574496(0x224)]()[_0x574496(0x238)](_0x244769=>this['handleCommitJobError'](_0x244769));}catch(_0x22a524){this['commitData']=undefined,logger[_0x574496(0x232)](_0x22a524);throw _0x22a524;}}};FlosumCommitJob=__decorate([typedi_1[a145_0x4c8458(0x214)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a145_0x4c8458(0x1fa)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a145_0x4c8458(0x211)],git_provider_manager_1[a145_0x4c8458(0x207)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;