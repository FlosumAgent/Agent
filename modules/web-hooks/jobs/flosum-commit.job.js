const a147_0x1f9898=a147_0x55cd;(function(_0xd82b8f,_0x4a7ac4){const _0x43c387=a147_0x55cd,_0x20b7d0=_0xd82b8f();while(!![]){try{const _0xf4ce1c=parseInt(_0x43c387(0xa5))/0x1*(-parseInt(_0x43c387(0xcb))/0x2)+parseInt(_0x43c387(0xbd))/0x3+parseInt(_0x43c387(0xbe))/0x4*(-parseInt(_0x43c387(0xfe))/0x5)+parseInt(_0x43c387(0xb3))/0x6*(parseInt(_0x43c387(0xab))/0x7)+-parseInt(_0x43c387(0xc3))/0x8*(-parseInt(_0x43c387(0xca))/0x9)+parseInt(_0x43c387(0xb0))/0xa+-parseInt(_0x43c387(0xe6))/0xb*(-parseInt(_0x43c387(0xa9))/0xc);if(_0xf4ce1c===_0x4a7ac4)break;else _0x20b7d0['push'](_0x20b7d0['shift']());}catch(_0x807c9){_0x20b7d0['push'](_0x20b7d0['shift']());}}}(a147_0x278f,0x220bf));const a147_0x5d9ef8=function(){let _0x197e9f=!![];return function(_0x2c1a20,_0x4b4cd9){const _0x103984=_0x197e9f?function(){const _0x3fb1c5=a147_0x55cd;if(_0x4b4cd9){const _0x26197e=_0x4b4cd9[_0x3fb1c5(0xed)](_0x2c1a20,arguments);return _0x4b4cd9=null,_0x26197e;}}:function(){};return _0x197e9f=![],_0x103984;};}(),a147_0x1ff0ff=a147_0x5d9ef8(this,function(){const _0x25e0dc=a147_0x55cd;return a147_0x1ff0ff[_0x25e0dc(0xdf)]()[_0x25e0dc(0x100)](_0x25e0dc(0xc0))[_0x25e0dc(0xdf)]()['constructor'](a147_0x1ff0ff)[_0x25e0dc(0x100)](_0x25e0dc(0xc0));});a147_0x1ff0ff();'use strict';var __decorate=this&&this[a147_0x1f9898(0xea)]||function(_0x4e1bab,_0x3473d1,_0x2d726e,_0x498c1b){const _0x511844=a147_0x1f9898;var _0x13cc29=arguments[_0x511844(0xe5)],_0x4d7b99=_0x13cc29<0x3?_0x3473d1:_0x498c1b===null?_0x498c1b=Object[_0x511844(0xd3)](_0x3473d1,_0x2d726e):_0x498c1b,_0x7719ec;if(typeof Reflect===_0x511844(0xbf)&&typeof Reflect[_0x511844(0xac)]===_0x511844(0xc9))_0x4d7b99=Reflect['decorate'](_0x4e1bab,_0x3473d1,_0x2d726e,_0x498c1b);else{for(var _0x1e399c=_0x4e1bab[_0x511844(0xe5)]-0x1;_0x1e399c>=0x0;_0x1e399c--)if(_0x7719ec=_0x4e1bab[_0x1e399c])_0x4d7b99=(_0x13cc29<0x3?_0x7719ec(_0x4d7b99):_0x13cc29>0x3?_0x7719ec(_0x3473d1,_0x2d726e,_0x4d7b99):_0x7719ec(_0x3473d1,_0x2d726e))||_0x4d7b99;}return _0x13cc29>0x3&&_0x4d7b99&&Object[_0x511844(0xd2)](_0x3473d1,_0x2d726e,_0x4d7b99),_0x4d7b99;},__metadata=this&&this['__metadata']||function(_0xf53f39,_0x4b5f40){const _0xf381d8=a147_0x1f9898;if(typeof Reflect===_0xf381d8(0xbf)&&typeof Reflect['metadata']==='function')return Reflect[_0xf381d8(0xad)](_0xf53f39,_0x4b5f40);};Object[a147_0x1f9898(0xd2)](exports,'__esModule',{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require('../../../core'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a147_0x1f9898(0xec)),typedi_1=require(a147_0x1f9898(0xb4)),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a147_0x1f9898(0xe2)),salesforce_retriever_service_1=require(a147_0x1f9898(0xbc)),salesforce_sync_service_1=require(a147_0x1f9898(0xdc)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a147_0x1f9898(0xfa)),logger=new core_1[(a147_0x1f9898(0xd6))](a147_0x1f9898(0xfc));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x4dee68,_0x3600fb,_0x32b637,_0x1b0336){const _0x4f5eff=a147_0x1f9898;this[_0x4f5eff(0xc2)]=_0x4dee68,this['commitJob']=_0x3600fb,this['salesforceSync']=_0x32b637,this['gitManager']=_0x1b0336,this[_0x4f5eff(0xf3)]=this[_0x4f5eff(0xe4)][_0x4f5eff(0xbb)]();}[a147_0x1f9898(0xcd)](_0x30f9ce){const _0x1e7df8=a147_0x1f9898;return this[_0x1e7df8(0x105)][_0x1e7df8(0xcd)](_0x1e7df8(0xa6)+this[_0x1e7df8(0xe4)][_0x1e7df8(0xcc)]['toUpperCase']()+_0x1e7df8(0xae)+this[_0x1e7df8(0xce)][_0x1e7df8(0xc7)]+_0x1e7df8(0xaa)+this[_0x1e7df8(0xdb)]['name']+']\x20'+_0x30f9ce);}async[a147_0x1f9898(0xb9)](){const _0x3da8b1=a147_0x1f9898;try{if(this[_0x3da8b1(0x104)]['syncRepositoryId'])this[_0x3da8b1(0xf9)]=await this['salesforceSync'][_0x3da8b1(0xfd)](this[_0x3da8b1(0x104)]['syncRepositoryId']);else this[_0x3da8b1(0x104)]['syncBranchId']&&(this[_0x3da8b1(0xf9)]=await this[_0x3da8b1(0xaf)][_0x3da8b1(0xb7)](this[_0x3da8b1(0x104)][_0x3da8b1(0xf2)]));}catch(_0x196a69){throw new bad_request_error_1[(_0x3da8b1(0xe0))](errors_1[_0x3da8b1(0xc8)]);}}async[a147_0x1f9898(0xe8)](){const _0x227072=a147_0x1f9898;if(!this['commitData'][_0x227072(0xb1)])return[];const _0x5a04ae=await this[_0x227072(0xc2)][_0x227072(0x103)](this['commitData'][_0x227072(0xb1)])[_0x227072(0xef)](_0x3ee113=>_0x3ee113[_0x227072(0xd5)]('\x20')[_0x227072(0xde)](_0x4a7459=>_0x4a7459[_0x227072(0xeb)]())),_0x1d47f0=new salesforce_retriever_service_1[(_0x227072(0xba))](this[_0x227072(0xc2)]),_0x5ffb2f=await _0x1d47f0['run'](_0x5a04ae);return _0x5ffb2f;}async[a147_0x1f9898(0xa8)](){const _0x240b05=a147_0x1f9898;if(!this[_0x240b05(0x104)][_0x240b05(0xe7)])return[];const _0x15432b=await this[_0x240b05(0xc2)][_0x240b05(0x103)](this[_0x240b05(0x104)][_0x240b05(0xe7)]);return _0x15432b;}async[a147_0x1f9898(0xf0)](){const _0x4d946c=a147_0x1f9898,_0x2bf6cf=new commit_components_dto_1[(_0x4d946c(0xda))](),[_0x2e9efa,_0x1eef86]=await Promise['all']([this['getComponentsToWrite'](),this['getComponentsToDelete']()]);return _0x2bf6cf[_0x4d946c(0xe1)]=this['commitData'][_0x4d946c(0xe1)],_0x2bf6cf[_0x4d946c(0xf8)]=this[_0x4d946c(0x104)][_0x4d946c(0xf8)],_0x2bf6cf[_0x4d946c(0xc1)]={'writed':_0x2e9efa,'deleted':_0x1eef86},_0x2bf6cf[_0x4d946c(0xb6)]=this['commitData'][_0x4d946c(0xb6)],_0x2bf6cf[_0x4d946c(0xfb)]=this[_0x4d946c(0xce)],_0x2bf6cf[_0x4d946c(0xdb)]=this[_0x4d946c(0xdb)],_0x2bf6cf;}async[a147_0x1f9898(0xf1)](_0xf2190f=![]){const _0x35e9a4=a147_0x1f9898;if(_0xf2190f)await this['salesforceSync'][_0x35e9a4(0xd8)](this[_0x35e9a4(0xf9)],{});else{const _0x2a8ae1=await this[_0x35e9a4(0xce)]['branches'][_0x35e9a4(0xd4)](this[_0x35e9a4(0xdb)][_0x35e9a4(0xc7)]);this[_0x35e9a4(0xcd)]('[INFO]\x20Update\x20remote\x20state.');const _0x2d76e1={[this[_0x35e9a4(0xce)][_0x35e9a4(0x102)]]:{'lastCommit':_0x2a8ae1[_0x35e9a4(0xff)]}};await this[_0x35e9a4(0xaf)][_0x35e9a4(0xd8)](this['repositoryData'],_0x2d76e1);}}async[a147_0x1f9898(0xcf)](){const _0x412ffb=a147_0x1f9898,_0x40c241=await this['getCommitDto']();this[_0x412ffb(0x106)][_0x412ffb(0x105)]=this[_0x412ffb(0x105)],await this[_0x412ffb(0xaf)][_0x412ffb(0xf5)](this[_0x412ffb(0xf9)],_0x412ffb(0xe9)),await this[_0x412ffb(0x106)]['run'](_0x40c241),await this[_0x412ffb(0xf1)](),this[_0x412ffb(0x104)][_0x412ffb(0xb1)]&&await this[_0x412ffb(0xc2)]['deleteAttachment'](this['commitData'][_0x412ffb(0xb1)]),this[_0x412ffb(0x104)]['deleteAttachmentId']&&await this[_0x412ffb(0xc2)][_0x412ffb(0xe3)](this[_0x412ffb(0x104)][_0x412ffb(0xe7)]),await this[_0x412ffb(0xaf)][_0x412ffb(0xf5)](this[_0x412ffb(0xf9)],_0x412ffb(0xee));}async[a147_0x1f9898(0xf7)](_0x3b7806){const _0x1c65e0=a147_0x1f9898;try{this[_0x1c65e0(0x105)][_0x1c65e0(0xcd)](_0x1c65e0(0xa7)+_0x3b7806),await this[_0x1c65e0(0x105)][_0x1c65e0(0xb2)](),await this[_0x1c65e0(0xf1)](!![]),await this[_0x1c65e0(0xaf)]['setStatus'](this[_0x1c65e0(0xf9)],'Error');}catch(_0x4f81d0){logger[_0x1c65e0(0xd0)](_0x4f81d0);}}async[a147_0x1f9898(0xd7)](_0x28a748,_0x443e28){const _0x5efcdb=a147_0x1f9898;try{this[_0x5efcdb(0x104)]=_0x28a748,this[_0x5efcdb(0xc2)][_0x5efcdb(0xc5)](_0x443e28),this['logger']=this[_0x5efcdb(0xc2)]['getLogger'](),await this['fetchRepositoryData']();if(!this[_0x5efcdb(0xf9)])throw new bad_request_error_1[(_0x5efcdb(0xe0))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);this[_0x5efcdb(0xce)]=await this[_0x5efcdb(0xf3)][_0x5efcdb(0xd4)](this[_0x5efcdb(0xf9)][_0x5efcdb(0xf4)]),this[_0x5efcdb(0xdb)]=await this['repository'][_0x5efcdb(0x101)]['getOne'](this['repositoryData'][_0x5efcdb(0xd1)]),this[_0x5efcdb(0xcd)]('[INFO]\x20Start\x20commit\x20job'),this[_0x5efcdb(0xcf)]()[_0x5efcdb(0xb8)](_0x5780a7=>this['handleCommitJobError'](_0x5780a7));}catch(_0x6a98a1){this[_0x5efcdb(0x104)]=undefined,logger[_0x5efcdb(0xd0)](_0x6a98a1);throw _0x6a98a1;}}};FlosumCommitJob=__decorate([(0x0,typedi_1[a147_0x1f9898(0xdd)])({'transient':!![]}),__metadata(a147_0x1f9898(0xb5),[salesforce_service_1[a147_0x1f9898(0xc4)],commit_components_job_1[a147_0x1f9898(0xd9)],salesforce_sync_service_1[a147_0x1f9898(0xf6)],git_provider_manager_1[a147_0x1f9898(0xc6)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;function a147_0x55cd(_0x32de9e,_0x470d2f){const _0x14768e=a147_0x278f();return a147_0x55cd=function(_0x1ff0ff,_0x5d9ef8){_0x1ff0ff=_0x1ff0ff-0xa5;let _0x278f8f=_0x14768e[_0x1ff0ff];return _0x278f8f;},a147_0x55cd(_0x32de9e,_0x470d2f);}function a147_0x278f(){const _0x47ef1f=['24nzwist','object','(((.+)+)+)+$','components','salesforceService','6728GMMCYD','SalesforceService','setLoggerId','GitProviderManager','name','ERR_INVALID_SYNC_RECORD_ID','function','531ZDEuZR','2SMmsmD','provider','log','repository','exec','error','branchName','defineProperty','getOwnPropertyDescriptor','getOne','split','Logger','run','updateRemoteState','CommitComponentsJob','CommitComponentsDto','branch','../../salesforce/services/salesforce-sync.service','Service','map','toString','BadRequestError','message','../../../core/errors/bad-request.error','deleteAttachment','gitManager','length','119702rSVEvx','deleteAttachmentId','getComponentsToWrite','In\x20Progress','__decorate','trim','../../shared/git-provider.manager','apply','Completed','then','getCommitDto','updateLastCommit','syncBranchId','repoService','repositoryName','setStatus','SalesforceSyncService','handleCommitJobError','user','repositoryData','./commit-components.job','repo','flosum-commit-job','getRepositoryRecord','148530DYfHQK','sha','search','branches','gitUrl','retrieveAttachment','commitData','logger','commitJob','148427IvDCPH','[COMMIT]\x20[','[ERROR]\x20','getComponentsToDelete','12vGyAzF',']\x20[Branch:\x20','133fEwVZB','decorate','metadata',']\x20[Repository:\x20','salesforceSync','659110DOapsp','commitAttachmentId','send','82410SZkdDT','typedi','design:paramtypes','convertToSFDX','getBranchRecord','catch','fetchRepositoryData','SalesforceRetrieverService','getRepoService','../../salesforce/services/salesforce-retriever.service','236223actrrZ'];a147_0x278f=function(){return _0x47ef1f;};return a147_0x278f();}