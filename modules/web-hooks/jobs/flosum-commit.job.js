const a118_0xabb7=['message','nothing\x20to\x20commit','all','path','8aLPQvA','Parser','__esModule','typedi','1253808DTAZbO','sfLogger','buffer','1iPINqS','getRepoService','2426gJrLkm','length','flosum-commit-job','map','mdapiToSource','__metadata','deleteCommit','getOne','getOwnPropertyDescriptor','now','780655PiXgvl','info','run','2dHgItp','remove\x20sfdx-project.json','__importStar','design:paramtypes','sleep','SalesforceService','Logger','commit\x20%s\x20took\x20%dms\x20to\x20proceed\x20%d\x20components','send\x20DELETE\x20commit\x20id\x20%s','../../internal/git.internal','commit\x20files\x20with\x20message\x20\x22%s\x22','SFDX','hasMoreIds','push\x20commit\x20to\x20branch\x20\x22%s\x22','set\x20credentials\x20{\x20name:\x20%s,\x20email:\x20%s\x20}','createEmptyProjectJson','../../internal/shell.internal','salesforceService','name','prototype','__createBinding','MAX_GIT_STATUS_CHECK','log','metadata','Service','../../sfdx/utils/sfdx','retrieveComponents','remove\x20git\x20repository\x20folder\x20','ERR_JOB_IS_NOT_DONE','__importDefault','baseDir','../../shared/utils','readFlosumComponents','return\x20/\x22\x20+\x20this\x20+\x20\x22/','exec','../../internal/fs.internal','Recieved\x20commit\x20to\x20proceed.\x20Branch\x20-\x20','create\x20empty\x20sfdx-project.json','GIT_STATUS_CHECK_INTERVAL','commitId','status','FlosumRetriever','Shell','__decorate','77524ZOSYrf','call','add\x20retrieved\x20components\x20to\x20commit','defineProperty','currentJob','decorate','repo','FlosumCommitJob','authSettings','../../../core','object','user','GitProviderManager','Clonning\x20repository','clonning\x20repository\x20from\x20%s','clone','branches','gitCredentials','createEmptyPackageXml','get','commit','\x20components','connect\x20to\x20salesforce','createWriteQueue','shift','../../../parser','function','WRITES_PER_TICK','https://','Job','__setModuleDefault','72500APWCfM','BadRequestError','data','36767sqrOVW','push','split','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','retrieveAttachment','../../sfdx/services/salesforce.service','create','default','constructor','setComponentIds','sfdx-project.json','179CvLEWe','credentials','forEach','add','42562SwxIXn','join','rm\x20-rf\x20'];const a118_0x2ffbae=a118_0x5de9;(function(_0x4d7ed3,_0x94d3d6){const _0x1aa1a9=a118_0x5de9;while(!![]){try{const _0x2b0dd1=-parseInt(_0x1aa1a9(0xf0))+parseInt(_0x1aa1a9(0xf3))*-parseInt(_0x1aa1a9(0x11f))+-parseInt(_0x1aa1a9(0x160))*-parseInt(_0x1aa1a9(0x14c))+-parseInt(_0x1aa1a9(0x13e))+parseInt(_0x1aa1a9(0x157))*-parseInt(_0x1aa1a9(0x141))+parseInt(_0x1aa1a9(0x15e))*parseInt(_0x1aa1a9(0x150))+parseInt(_0x1aa1a9(0x15b));if(_0x2b0dd1===_0x94d3d6)break;else _0x4d7ed3['push'](_0x4d7ed3['shift']());}catch(_0x1f8606){_0x4d7ed3['push'](_0x4d7ed3['shift']());}}}(a118_0xabb7,0x688fd));const a118_0x410ff2=function(){let _0x28ff79=!![];return function(_0x8c32ec,_0xb5204c){const _0x1b8d1d=_0x28ff79?function(){if(_0xb5204c){const _0x25bf44=_0xb5204c['apply'](_0x8c32ec,arguments);return _0xb5204c=null,_0x25bf44;}}:function(){};return _0x28ff79=![],_0x1b8d1d;};}(),a118_0x9bc3e2=a118_0x410ff2(this,function(){const _0x34275f=function(){const _0xb47407=a118_0x5de9,_0x32b60b=_0x34275f['constructor'](_0xb47407(0x114))()[_0xb47407(0x149)](_0xb47407(0x144));return!_0x32b60b['test'](a118_0x9bc3e2);};return _0x34275f();});a118_0x9bc3e2();'use strict';var __createBinding=this&&this[a118_0x2ffbae(0x107)]||(Object[a118_0x2ffbae(0x147)]?function(_0x1db05b,_0x21d6fa,_0x153430,_0x2598f2){if(_0x2598f2===undefined)_0x2598f2=_0x153430;Object['defineProperty'](_0x1db05b,_0x2598f2,{'enumerable':!![],'get':function(){return _0x21d6fa[_0x153430];}});}:function(_0x3c5bde,_0x22ff4a,_0x41f587,_0x220a3d){if(_0x220a3d===undefined)_0x220a3d=_0x41f587;_0x3c5bde[_0x220a3d]=_0x22ff4a[_0x41f587];}),__setModuleDefault=this&&this[a118_0x2ffbae(0x13d)]||(Object['create']?function(_0x47d81c,_0x3d8734){const _0x4b46a7=a118_0x2ffbae;Object['defineProperty'](_0x47d81c,_0x4b46a7(0x148),{'enumerable':!![],'value':_0x3d8734});}:function(_0x104cba,_0x1de314){const _0x1bc900=a118_0x2ffbae;_0x104cba[_0x1bc900(0x148)]=_0x1de314;}),__decorate=this&&this[a118_0x2ffbae(0x11e)]||function(_0x2e7e7f,_0x4f5278,_0x5c0794,_0x30aedd){const _0x295f66=a118_0x2ffbae;var _0x36e5e4=arguments[_0x295f66(0x161)],_0x5ae407=_0x36e5e4<0x3?_0x4f5278:_0x30aedd===null?_0x30aedd=Object[_0x295f66(0x168)](_0x4f5278,_0x5c0794):_0x30aedd,_0x40459f;if(typeof Reflect===_0x295f66(0x129)&&typeof Reflect['decorate']==='function')_0x5ae407=Reflect[_0x295f66(0x124)](_0x2e7e7f,_0x4f5278,_0x5c0794,_0x30aedd);else{for(var _0x34fa65=_0x2e7e7f[_0x295f66(0x161)]-0x1;_0x34fa65>=0x0;_0x34fa65--)if(_0x40459f=_0x2e7e7f[_0x34fa65])_0x5ae407=(_0x36e5e4<0x3?_0x40459f(_0x5ae407):_0x36e5e4>0x3?_0x40459f(_0x4f5278,_0x5c0794,_0x5ae407):_0x40459f(_0x4f5278,_0x5c0794))||_0x5ae407;}return _0x36e5e4>0x3&&_0x5ae407&&Object[_0x295f66(0x122)](_0x4f5278,_0x5c0794,_0x5ae407),_0x5ae407;},__importStar=this&&this[a118_0x2ffbae(0xf5)]||function(_0x162ef0){const _0xb231bf=a118_0x2ffbae;if(_0x162ef0&&_0x162ef0[_0xb231bf(0x159)])return _0x162ef0;var _0x4abcb6={};if(_0x162ef0!=null){for(var _0x2180e8 in _0x162ef0)if(_0x2180e8!==_0xb231bf(0x148)&&Object[_0xb231bf(0x106)]['hasOwnProperty'][_0xb231bf(0x120)](_0x162ef0,_0x2180e8))__createBinding(_0x4abcb6,_0x162ef0,_0x2180e8);}return __setModuleDefault(_0x4abcb6,_0x162ef0),_0x4abcb6;},__metadata=this&&this[a118_0x2ffbae(0x165)]||function(_0x212742,_0x4d0fb1){const _0x92674b=a118_0x2ffbae;if(typeof Reflect==='object'&&typeof Reflect[_0x92674b(0x10a)]===_0x92674b(0x139))return Reflect[_0x92674b(0x10a)](_0x212742,_0x4d0fb1);},__importDefault=this&&this[a118_0x2ffbae(0x110)]||function(_0x370d55){const _0x18fb57=a118_0x2ffbae;return _0x370d55&&_0x370d55[_0x18fb57(0x159)]?_0x370d55:{'default':_0x370d55};};Object['defineProperty'](exports,a118_0x2ffbae(0x159),{'value':!![]}),exports[a118_0x2ffbae(0x126)]=void 0x0;const errors_1=require('../../../constants/errors'),core_1=require(a118_0x2ffbae(0x128)),bad_request_error_1=require('../../../core/errors/bad-request.error'),fs_internal_1=require(a118_0x2ffbae(0x116)),git_internal_1=require(a118_0x2ffbae(0xfc)),shell_internal_1=require(a118_0x2ffbae(0x103)),salesforce_service_1=require(a118_0x2ffbae(0x146)),flosum_retriever_util_1=require('../../sfdx/utils/flosum-retriever.util'),sfdx_1=require(a118_0x2ffbae(0x10c)),git_provider_manager_1=require('../../shared/git-provider.manager'),auth_settings_service_1=require('../../shared/services/auth-settings.service'),utils_1=require(a118_0x2ffbae(0x112)),parser_1=require(a118_0x2ffbae(0x138)),path_1=__importDefault(require(a118_0x2ffbae(0x156))),typedi_1=__importStar(require(a118_0x2ffbae(0x15a))),job_1=require('./job'),logger=new core_1[(a118_0x2ffbae(0xf9))](a118_0x2ffbae(0x162));function a118_0x5de9(_0xde54dc,_0x5386cf){return a118_0x5de9=function(_0x3ed653,_0x9bc3e2){_0x3ed653=_0x3ed653-0xf0;let _0x410ff2=a118_0xabb7[_0x3ed653];return _0x410ff2;},a118_0x5de9(_0xde54dc,_0x5386cf);}let FlosumCommitJob=class FlosumCommitJob extends job_1[a118_0x2ffbae(0x13c)]{constructor(_0x52d91a,_0x31fa29){const _0x30c57a=a118_0x2ffbae;super(),this['authSettings']=_0x52d91a,this['salesforceService']=_0x31fa29,this[_0x30c57a(0x13a)]=0x3e8,this[_0x30c57a(0x108)]=0xa,this[_0x30c57a(0x119)]=0xbb8;}get[a118_0x2ffbae(0x14d)](){const _0x3e615b=a118_0x2ffbae;return this[_0x3e615b(0x127)][_0x3e615b(0x130)];}get[a118_0x2ffbae(0x11a)](){const _0x6e2bb3=a118_0x2ffbae;var _0x349590;return(_0x349590=this[_0x6e2bb3(0x123)])===null||_0x349590===void 0x0?void 0x0:_0x349590['id'];}async[a118_0x2ffbae(0x15c)](_0x14d62b){const _0x9253ce=a118_0x2ffbae;return this[_0x9253ce(0x104)][_0x9253ce(0x109)]('[CID:\x20'+this['commitId']+']\x20'+_0x14d62b);}[a118_0x2ffbae(0x136)](_0x24c188){const _0x1da1d1=a118_0x2ffbae,_0x47223a=[];for(const _0xa2335c in _0x24c188){const _0x1e7bf0=_0x24c188[_0xa2335c];_0x1e7bf0[_0x1da1d1(0x14e)]((_0x48fd3e,_0x3ad91f)=>{const _0x4f7af6=_0x1da1d1,_0x527f06={'name':_0xa2335c,'buffer':_0x48fd3e};_0x47223a[_0x3ad91f]?_0x47223a[_0x3ad91f][_0x4f7af6(0x142)](_0x527f06):_0x47223a[_0x4f7af6(0x142)]([_0x527f06]);});}return _0x47223a;}async[a118_0x2ffbae(0x10d)](_0x4bc359,_0x3757ab){const _0x20f76b=a118_0x2ffbae;this['sfLogger']('Start\x20retrieve\x20components\x20job');const _0xae9f52=path_1['default'][_0x20f76b(0x151)](_0x4bc359,'.mdapi-temp');logger['log'](_0x20f76b(0x118)),await sfdx_1[_0x20f76b(0xfe)][_0x20f76b(0x102)](_0x4bc359);const _0x28d458=typedi_1[_0x20f76b(0x148)][_0x20f76b(0x132)](flosum_retriever_util_1[_0x20f76b(0x11c)]);_0x28d458[_0x20f76b(0x14a)](_0x3757ab);let _0x196e26=0x0;do{const _0x3b11d7=await _0x28d458['retrieve'](),_0x5f521f=await parser_1[_0x20f76b(0x158)][_0x20f76b(0x113)](_0x3b11d7),_0x3322b2=this['createWriteQueue'](_0x5f521f);while(_0x3322b2[_0x20f76b(0x161)]>0x0){const _0x2c5b3c=_0x3322b2[_0x20f76b(0x137)]();_0x196e26+=_0x2c5b3c[_0x20f76b(0x161)];while(_0x2c5b3c['length']>0x0){const _0x9f0f18=_0x2c5b3c['splice'](0x0,this[_0x20f76b(0x13a)]),_0x920dbd=_0x9f0f18[_0x20f76b(0x163)](_0x7b9eff=>fs_internal_1['FS']['writeFile'](path_1[_0x20f76b(0x148)]['join'](_0xae9f52,_0x7b9eff[_0x20f76b(0x105)]),_0x7b9eff[_0x20f76b(0x15d)]));await Promise[_0x20f76b(0x155)](_0x920dbd);}logger['log']('create\x20empty\x20package.xml'),await sfdx_1[_0x20f76b(0xfe)][_0x20f76b(0x131)](_0xae9f52),await sfdx_1[_0x20f76b(0xfe)][_0x20f76b(0x164)](_0xae9f52,_0x4bc359),await shell_internal_1['Shell'][_0x20f76b(0x115)](_0x20f76b(0x152)+_0xae9f52+'/*');}this[_0x20f76b(0x15c)]('Retrieved\x20'+_0x196e26+'/'+_0x3757ab[_0x20f76b(0x161)]+_0x20f76b(0x134));}while(_0x28d458[_0x20f76b(0xff)]);logger['log'](_0x20f76b(0xf4)),await shell_internal_1[_0x20f76b(0x11d)][_0x20f76b(0x115)](_0x20f76b(0x152)+path_1[_0x20f76b(0x148)][_0x20f76b(0x151)](_0x4bc359,_0x20f76b(0x14b))),logger['log']('remove\x20temp\x20mdapi\x20folder'),await shell_internal_1[_0x20f76b(0x11d)][_0x20f76b(0x115)]('rm\x20-rf\x20'+_0xae9f52);}async[a118_0x2ffbae(0x115)](_0x209b4c){const _0x4222ad=a118_0x2ffbae,_0x36e2d2=Date[_0x4222ad(0x169)](),{commitId:_0x20a90a,branch:_0x4426d9,attachmentId:_0x56f3b3,message:_0x5a59ca}=this[_0x4222ad(0x123)][_0x4222ad(0x140)];logger['info'](_0x4222ad(0x135)),await this['salesforceService']['connect'](),this[_0x4222ad(0x15c)](_0x4222ad(0x117)+_0x4426d9);const _0x574708=[];try{const _0x410fa4=await this['salesforceService'][_0x4222ad(0x145)](_0x56f3b3);_0x574708['push'](..._0x410fa4[_0x4222ad(0x143)]('\x20')[_0x4222ad(0x163)](_0x35c54a=>_0x35c54a['trim']()));const {gitUrl:_0x2043c3}=_0x209b4c,_0x95ee0e=_0x2043c3['replace'](/https\:\/\/(.+@)?/,_0x4222ad(0x13b)+this[_0x4222ad(0x14d)]+'@');logger[_0x4222ad(0xf1)](_0x4222ad(0x12d),_0x95ee0e),this[_0x4222ad(0x15c)](_0x4222ad(0x12c));const _0x1ba428=await git_internal_1['Git'][_0x4222ad(0x12e)](_0x95ee0e,_0x20a90a,_0x4426d9),{name:_0x55b2a0,email:_0x2dce84}=this[_0x4222ad(0x123)][_0x4222ad(0x140)][_0x4222ad(0x12a)];logger[_0x4222ad(0xf1)](_0x4222ad(0x101),_0x55b2a0,_0x2dce84),await _0x1ba428['setCredentials'](_0x55b2a0,_0x2dce84),logger['info']('start\x20retrieving\x20components'),await this[_0x4222ad(0x10d)](_0x1ba428[_0x4222ad(0x111)],_0x574708),logger[_0x4222ad(0xf1)](_0x4222ad(0x121)),await _0x1ba428[_0x4222ad(0x14f)]('.'),logger[_0x4222ad(0xf1)](_0x4222ad(0xfd),_0x5a59ca);try{await _0x1ba428[_0x4222ad(0x133)](_0x5a59ca);}catch(_0x1b0761){let _0x2bf65c=0x0;do{_0x2bf65c++;const _0x3f3f57=await _0x1ba428[_0x4222ad(0x11b)]()['catch'](_0x58deb5=>_0x58deb5[_0x4222ad(0x153)]||_0x58deb5);if(_0x3f3f57['includes'](_0x4222ad(0x154))){_0x2bf65c=0x0;break;}await utils_1[_0x4222ad(0xf7)](this[_0x4222ad(0x119)]);}while(_0x2bf65c<this[_0x4222ad(0x108)]);if(_0x2bf65c===this[_0x4222ad(0x108)])throw _0x1b0761;}this[_0x4222ad(0x15c)]('Push\x20commit\x20to\x20branch'),logger['info'](_0x4222ad(0x100),_0x4426d9),await _0x1ba428[_0x4222ad(0x142)](_0x4426d9),logger[_0x4222ad(0xf1)](_0x4222ad(0x10e)+_0x1ba428['baseDir']),await shell_internal_1[_0x4222ad(0x11d)][_0x4222ad(0x115)]('rm\x20-rf\x20'+_0x1ba428[_0x4222ad(0x111)]),logger[_0x4222ad(0xf1)](_0x4222ad(0xfb),_0x20a90a),await this[_0x4222ad(0x104)][_0x4222ad(0x166)](_0x20a90a);}catch(_0x5e6831){this[_0x4222ad(0x15c)]('[ERROR]\x20'+(_0x5e6831['message']||_0x5e6831)),console['log']({'error':_0x5e6831});}finally{logger[_0x4222ad(0xf1)](_0x4222ad(0xfa),_0x20a90a,Date[_0x4222ad(0x169)]()-_0x36e2d2,_0x574708[_0x4222ad(0x161)]),this[_0x4222ad(0x123)]=undefined;}}async[a118_0x2ffbae(0xf2)](_0x2c901b){const _0xcd881d=a118_0x2ffbae;if(this[_0xcd881d(0x123)])throw new bad_request_error_1[(_0xcd881d(0x13f))](errors_1[_0xcd881d(0x10f)]);try{this[_0xcd881d(0x123)]=_0x2c901b;const _0x218ba0=typedi_1[_0xcd881d(0x148)]['get'](git_provider_manager_1[_0xcd881d(0x12b)])[_0xcd881d(0x15f)](),_0xd52182=await _0x218ba0[_0xcd881d(0x167)](_0x2c901b[_0xcd881d(0x140)][_0xcd881d(0x125)]);await _0xd52182[_0xcd881d(0x12f)]['getOne'](_0x2c901b[_0xcd881d(0x140)]['branch']),this[_0xcd881d(0x115)](_0xd52182);}catch(_0x2fcf3c){this[_0xcd881d(0x123)]=undefined;throw _0x2fcf3c;}}};FlosumCommitJob=__decorate([typedi_1[a118_0x2ffbae(0x10b)](),__metadata(a118_0x2ffbae(0xf6),[auth_settings_service_1['AuthSettingsService'],salesforce_service_1[a118_0x2ffbae(0xf8)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;