const a145_0x2e0c=['__esModule','provider','run','8KaVKXQ','syncBranchId','fetchRepositoryData','deleteAttachmentId','test','ERR_INVALID_SYNC_RECORD_ID','apply','7853HqFkuG','length','getComponentsToWrite','deleteAttachment','sha','map','branches','design:paramtypes','decorate','./commit-components.job','syncRepositoryId','Completed','../../shared/utils','../../../constants/errors','gitManager','__decorate','return\x20/\x22\x20+\x20this\x20+\x20\x22/','components',']\x20[Repository:\x20','defineProperty','2807PUJTcm','[ERROR]\x20','649232VoWCNz','commitAttachmentId','logger','object','365nFtnYs','../../../core','getLogger','branch','metadata','getComponentsToDelete','repoService','../../salesforce/services/salesforce-retriever.service','__metadata','176105VqclyW','BadRequestError','getRepositoryRecord','function','FlosumCommitJob','patchObject','retrieveAttachment','../../salesforce/services/salesforce.service','name','Service','getRepoService','../../../core/errors/bad-request.error','CommitComponentsJob','getAttachmentId','stringify','Attachment','../dto/commit-components.dto','GitProviderManager','user','getOwnPropertyDescriptor','trim','encodeBase64','10paPStb','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','log','updateLastCommit','In\x20Progress','setLoggerId','exec','CommitComponentsDto','all','repository','getBranchRecord','convertToSFDX','getOne','message',']\x20[Branch:\x20','salesforceService','gitUrl','setStatus','getCommitDto','Logger','844032YLEUzK','52891RUJUke','commitData','261607JQuuzg','repositoryData','error','Error','salesforceSync','[COMMIT]\x20['];const a145_0x3a2aa0=a145_0xd98f;(function(_0xc0812e,_0x2d7970){const _0x139f0d=a145_0xd98f;while(!![]){try{const _0x378ed8=parseInt(_0x139f0d(0x1a9))*-parseInt(_0x139f0d(0x1be))+-parseInt(_0x139f0d(0x186))+parseInt(_0x139f0d(0x1bd))+-parseInt(_0x139f0d(0x1c0))+parseInt(_0x139f0d(0x169))*parseInt(_0x139f0d(0x170))+parseInt(_0x139f0d(0x193))+parseInt(_0x139f0d(0x184))*parseInt(_0x139f0d(0x18a));if(_0x378ed8===_0x2d7970)break;else _0xc0812e['push'](_0xc0812e['shift']());}catch(_0x524e78){_0xc0812e['push'](_0xc0812e['shift']());}}}(a145_0x2e0c,0xa3077));const a145_0x1d5705=function(){let _0x2acaa2=!![];return function(_0x1a3d9b,_0x4729ce){const _0x428ec8=_0x2acaa2?function(){const _0x2f5f6b=a145_0xd98f;if(_0x4729ce){const _0x247bdd=_0x4729ce[_0x2f5f6b(0x16f)](_0x1a3d9b,arguments);return _0x4729ce=null,_0x247bdd;}}:function(){};return _0x2acaa2=![],_0x428ec8;};}(),a145_0x2d4d80=a145_0x1d5705(this,function(){const _0x689664=function(){const _0x5763d0=a145_0xd98f,_0x55e993=_0x689664['constructor'](_0x5763d0(0x180))()['constructor'](_0x5763d0(0x1aa));return!_0x55e993[_0x5763d0(0x16d)](a145_0x2d4d80);};return _0x689664();});a145_0x2d4d80();'use strict';var __decorate=this&&this[a145_0x3a2aa0(0x17f)]||function(_0x65e933,_0x4d0a07,_0x442011,_0x229e35){const _0x2ff937=a145_0x3a2aa0;var _0x270f80=arguments[_0x2ff937(0x171)],_0x4ed92f=_0x270f80<0x3?_0x4d0a07:_0x229e35===null?_0x229e35=Object[_0x2ff937(0x1a6)](_0x4d0a07,_0x442011):_0x229e35,_0x1a0513;if(typeof Reflect==='object'&&typeof Reflect[_0x2ff937(0x178)]==='function')_0x4ed92f=Reflect[_0x2ff937(0x178)](_0x65e933,_0x4d0a07,_0x442011,_0x229e35);else{for(var _0x375fc8=_0x65e933['length']-0x1;_0x375fc8>=0x0;_0x375fc8--)if(_0x1a0513=_0x65e933[_0x375fc8])_0x4ed92f=(_0x270f80<0x3?_0x1a0513(_0x4ed92f):_0x270f80>0x3?_0x1a0513(_0x4d0a07,_0x442011,_0x4ed92f):_0x1a0513(_0x4d0a07,_0x442011))||_0x4ed92f;}return _0x270f80>0x3&&_0x4ed92f&&Object[_0x2ff937(0x183)](_0x4d0a07,_0x442011,_0x4ed92f),_0x4ed92f;},__metadata=this&&this[a145_0x3a2aa0(0x192)]||function(_0xd869cb,_0x1fc9a5){const _0x484b68=a145_0x3a2aa0;if(typeof Reflect===_0x484b68(0x189)&&typeof Reflect[_0x484b68(0x18e)]===_0x484b68(0x196))return Reflect['metadata'](_0xd869cb,_0x1fc9a5);};Object[a145_0x3a2aa0(0x183)](exports,a145_0x3a2aa0(0x166),{'value':!![]}),exports[a145_0x3a2aa0(0x197)]=void 0x0;const core_1=require(a145_0x3a2aa0(0x18b)),salesforce_service_1=require(a145_0x3a2aa0(0x19a)),git_provider_manager_1=require('../../shared/git-provider.manager'),typedi_1=require('typedi'),errors_1=require(a145_0x3a2aa0(0x17d)),bad_request_error_1=require(a145_0x3a2aa0(0x19e)),salesforce_retriever_service_1=require(a145_0x3a2aa0(0x191)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),utils_1=require(a145_0x3a2aa0(0x17c)),commit_components_dto_1=require(a145_0x3a2aa0(0x1a3)),commit_components_job_1=require(a145_0x3a2aa0(0x179)),logger=new core_1[(a145_0x3a2aa0(0x1bc))]('flosum-commit-job');function a145_0xd98f(_0x3cf323,_0x2deeff){return a145_0xd98f=function(_0x38b694,_0x2d4d80){_0x38b694=_0x38b694-0x162;let _0x1d5705=a145_0x2e0c[_0x38b694];return _0x1d5705;},a145_0xd98f(_0x3cf323,_0x2deeff);}let FlosumCommitJob=class FlosumCommitJob{constructor(_0x592d7e,_0x22e575,_0x1e8010,_0x161dab){const _0x7c1f90=a145_0x3a2aa0;this[_0x7c1f90(0x1b8)]=_0x592d7e,this['commitJob']=_0x22e575,this[_0x7c1f90(0x164)]=_0x1e8010,this[_0x7c1f90(0x17e)]=_0x161dab,this[_0x7c1f90(0x190)]=this[_0x7c1f90(0x17e)][_0x7c1f90(0x19d)]();}[a145_0x3a2aa0(0x1ab)](_0x40482f){const _0x341d72=a145_0x3a2aa0;return this['logger'][_0x341d72(0x1ab)](_0x341d72(0x165)+this[_0x341d72(0x17e)][_0x341d72(0x167)]['toUpperCase']()+_0x341d72(0x182)+this[_0x341d72(0x1b2)]['name']+_0x341d72(0x1b7)+this['branch']['name']+']\x20'+_0x40482f);}async[a145_0x3a2aa0(0x16b)](){const _0x3b73b4=a145_0x3a2aa0;try{if(this['commitData'][_0x3b73b4(0x17a)])this[_0x3b73b4(0x1c1)]=await this[_0x3b73b4(0x164)][_0x3b73b4(0x195)](this['commitData'][_0x3b73b4(0x17a)]);else this[_0x3b73b4(0x1bf)][_0x3b73b4(0x16a)]&&(this[_0x3b73b4(0x1c1)]=await this[_0x3b73b4(0x164)][_0x3b73b4(0x1b3)](this[_0x3b73b4(0x1bf)]['syncBranchId']));}catch(_0x2e0513){throw new bad_request_error_1[(_0x3b73b4(0x194))](errors_1[_0x3b73b4(0x16e)]);}}async[a145_0x3a2aa0(0x172)](){const _0x1d9d60=a145_0x3a2aa0;if(!this[_0x1d9d60(0x1bf)][_0x1d9d60(0x187)])return[];const _0x49fc69=await this[_0x1d9d60(0x1b8)]['retrieveAttachment'](this[_0x1d9d60(0x1bf)][_0x1d9d60(0x187)])['then'](_0x57b40f=>_0x57b40f['split']('\x20')[_0x1d9d60(0x175)](_0x1ea944=>_0x1ea944[_0x1d9d60(0x1a7)]())),_0x263832=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x1d9d60(0x1b8)]),_0x1dacb6=await _0x263832['run'](_0x49fc69);return _0x1dacb6;}async[a145_0x3a2aa0(0x18f)](){const _0x1478a4=a145_0x3a2aa0;if(!this[_0x1478a4(0x1bf)][_0x1478a4(0x16c)])return[];const _0x5d8b32=await this['salesforceService'][_0x1478a4(0x199)](this[_0x1478a4(0x1bf)][_0x1478a4(0x16c)]);return _0x5d8b32;}async[a145_0x3a2aa0(0x1bb)](){const _0x2f1542=a145_0x3a2aa0,_0x2d17c8=new commit_components_dto_1[(_0x2f1542(0x1b0))](),[_0x2246f6,_0x9531eb]=await Promise[_0x2f1542(0x1b1)]([this[_0x2f1542(0x172)](),this['getComponentsToDelete']()]);return _0x2d17c8[_0x2f1542(0x1b6)]=this[_0x2f1542(0x1bf)][_0x2f1542(0x1b6)],_0x2d17c8[_0x2f1542(0x1a5)]=this['commitData'][_0x2f1542(0x1a5)],_0x2d17c8[_0x2f1542(0x181)]={'writed':_0x2246f6,'deleted':_0x9531eb},_0x2d17c8[_0x2f1542(0x1b4)]=this[_0x2f1542(0x1bf)][_0x2f1542(0x1b4)],_0x2d17c8['repo']=this[_0x2f1542(0x1b2)],_0x2d17c8[_0x2f1542(0x18d)]=this['branch'],_0x2d17c8;}async[a145_0x3a2aa0(0x1ac)](){const _0x2f2d83=a145_0x3a2aa0,_0xd0cab5=await this[_0x2f2d83(0x1b2)]['branches'][_0x2f2d83(0x1b5)](this[_0x2f2d83(0x18d)][_0x2f2d83(0x19b)]);this['log']('[INFO]\x20Update\x20remote\x20state.');const _0x2ebc09=await this[_0x2f2d83(0x164)][_0x2f2d83(0x1a0)](this[_0x2f2d83(0x1c1)]),_0x1c0477={[this[_0x2f2d83(0x1b2)][_0x2f2d83(0x1b9)]]:{'lastCommit':_0xd0cab5[_0x2f2d83(0x174)]}};await this[_0x2f2d83(0x1b8)][_0x2f2d83(0x198)](_0x2f2d83(0x1a2),_0x2ebc09,{'Body':utils_1[_0x2f2d83(0x1a8)](JSON[_0x2f2d83(0x1a1)](_0x1c0477))});}async[a145_0x3a2aa0(0x1af)](){const _0x18fa8d=a145_0x3a2aa0,_0x32b4f5=await this['getCommitDto']();this['commitJob'][_0x18fa8d(0x188)]=this[_0x18fa8d(0x188)],await this[_0x18fa8d(0x164)]['setStatus'](this[_0x18fa8d(0x1c1)],_0x18fa8d(0x1ad)),await this['commitJob']['run'](_0x32b4f5),await this['updateLastCommit'](),this['commitData'][_0x18fa8d(0x187)]&&await this[_0x18fa8d(0x1b8)][_0x18fa8d(0x173)](this[_0x18fa8d(0x1bf)][_0x18fa8d(0x187)]),this['commitData'][_0x18fa8d(0x16c)]&&await this[_0x18fa8d(0x1b8)][_0x18fa8d(0x173)](this[_0x18fa8d(0x1bf)][_0x18fa8d(0x16c)]),await this[_0x18fa8d(0x164)]['setStatus'](this[_0x18fa8d(0x1c1)],_0x18fa8d(0x17b));}async['handleCommitJobError'](_0x5e739a){const _0x5e96df=a145_0x3a2aa0;try{this['logger']['log'](_0x5e96df(0x185)+_0x5e739a),await this[_0x5e96df(0x188)]['send'](),await this[_0x5e96df(0x164)][_0x5e96df(0x1ba)](this[_0x5e96df(0x1c1)],_0x5e96df(0x163));}catch(_0x17609e){logger[_0x5e96df(0x162)](_0x17609e);}}async[a145_0x3a2aa0(0x168)](_0x4c7581,_0x3cc2aa){const _0x514652=a145_0x3a2aa0;try{this['commitData']=_0x4c7581,this[_0x514652(0x1b8)][_0x514652(0x1ae)](_0x3cc2aa),this[_0x514652(0x188)]=this['salesforceService'][_0x514652(0x18c)](),await this[_0x514652(0x16b)]();if(!this[_0x514652(0x1c1)])throw new bad_request_error_1[(_0x514652(0x194))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);this['repository']=await this[_0x514652(0x190)][_0x514652(0x1b5)](this['repositoryData']['repositoryName']),this[_0x514652(0x18d)]=await this['repository'][_0x514652(0x176)][_0x514652(0x1b5)](this[_0x514652(0x1c1)]['branchName']),this[_0x514652(0x1ab)]('[INFO]\x20Start\x20commit\x20job'),this[_0x514652(0x1af)]()['catch'](_0x5ce995=>this['handleCommitJobError'](_0x5ce995));}catch(_0x54aff4){this[_0x514652(0x1bf)]=undefined,logger[_0x514652(0x162)](_0x54aff4);throw _0x54aff4;}}};FlosumCommitJob=__decorate([typedi_1[a145_0x3a2aa0(0x19c)]({'transient':!![]}),__metadata(a145_0x3a2aa0(0x177),[salesforce_service_1['SalesforceService'],commit_components_job_1[a145_0x3a2aa0(0x19f)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a145_0x3a2aa0(0x1a4)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;