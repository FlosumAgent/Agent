const a145_0x4e7f=['[ERROR]\x20','../../shared/utils',']\x20[Branch:\x20','updateLastCommit','return\x20/\x22\x20+\x20this\x20+\x20\x22/','defineProperty','FlosumCommitJob','error','Completed','apply','GitProviderManager','../../salesforce/services/salesforce-sync.service','SalesforceService','getRepoService','./commit-components.job','[COMMIT]\x20[','logger','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','ERR_INVALID_SYNC_RECORD_ID','convertToSFDX','test','toUpperCase','47324RCKcwf','../../../core/errors/bad-request.error','getOne','constructor','SalesforceRetrieverService','user','exec','getComponentsToWrite','commitData','all','3EKfHVU','../../../constants/errors','repositoryName','getComponentsToDelete','../../shared/git-provider.manager','name','425365sORCfP','../../salesforce/services/salesforce.service','../../../core','stringify','patchObject','239546GepCNk','trim','syncRepositoryId','683267RwzKfw','../../salesforce/services/salesforce-retriever.service','SalesforceSyncService','commitAttachmentId','flosum-commit-job','branches','commitJob','479302jfCfit','gitManager','deleteAttachment','salesforceService','BadRequestError','retrieveAttachment','In\x20Progress','17471hcrhoI','run','send','CommitComponentsDto','setStatus','875682lNNReg','sha','metadata','[INFO]\x20Update\x20remote\x20state.','object','decorate','deleteAttachmentId','repoService','encodeBase64','then','ERR_UNKNOWN_SYNC_RECORD_ID','CommitComponentsJob','branch','catch','repositoryData','getLogger','split','salesforceSync','repo','log','handleCommitJobError','repository','length','getOwnPropertyDescriptor','function','components','Logger','__metadata'];const a145_0x32de0b=a145_0x34df;(function(_0x40a8bf,_0x30ef42){const _0x36de29=a145_0x34df;while(!![]){try{const _0xb9f6c0=parseInt(_0x36de29(0x1ad))*parseInt(_0x36de29(0x1b8))+-parseInt(_0x36de29(0x1a3))+parseInt(_0x36de29(0x1b3))+parseInt(_0x36de29(0x16c))+parseInt(_0x36de29(0x1bb))+-parseInt(_0x36de29(0x1c2))+-parseInt(_0x36de29(0x171));if(_0xb9f6c0===_0x30ef42)break;else _0x40a8bf['push'](_0x40a8bf['shift']());}catch(_0x27ee34){_0x40a8bf['push'](_0x40a8bf['shift']());}}}(a145_0x4e7f,0x6c041));const a145_0x459587=function(){let _0x58f861=!![];return function(_0x2997a4,_0x10f9c9){const _0x48d5b9=_0x58f861?function(){const _0x291bb7=a145_0x34df;if(_0x10f9c9){const _0x1b3e9f=_0x10f9c9[_0x291bb7(0x196)](_0x2997a4,arguments);return _0x10f9c9=null,_0x1b3e9f;}}:function(){};return _0x58f861=![],_0x48d5b9;};}(),a145_0x4fc92f=a145_0x459587(this,function(){const _0x2692e3=function(){const _0x21f942=a145_0x34df,_0x3e0598=_0x2692e3[_0x21f942(0x1a6)](_0x21f942(0x191))()['constructor'](_0x21f942(0x19e));return!_0x3e0598[_0x21f942(0x1a1)](a145_0x4fc92f);};return _0x2692e3();});a145_0x4fc92f();'use strict';var __decorate=this&&this['__decorate']||function(_0x15c3f6,_0x2efd16,_0x2be82b,_0x1dfe37){const _0x5b38f3=a145_0x34df;var _0x24ba5c=arguments['length'],_0xf7ea94=_0x24ba5c<0x3?_0x2efd16:_0x1dfe37===null?_0x1dfe37=Object[_0x5b38f3(0x188)](_0x2efd16,_0x2be82b):_0x1dfe37,_0x45fc2a;if(typeof Reflect===_0x5b38f3(0x175)&&typeof Reflect[_0x5b38f3(0x176)]===_0x5b38f3(0x189))_0xf7ea94=Reflect['decorate'](_0x15c3f6,_0x2efd16,_0x2be82b,_0x1dfe37);else{for(var _0x326b21=_0x15c3f6[_0x5b38f3(0x187)]-0x1;_0x326b21>=0x0;_0x326b21--)if(_0x45fc2a=_0x15c3f6[_0x326b21])_0xf7ea94=(_0x24ba5c<0x3?_0x45fc2a(_0xf7ea94):_0x24ba5c>0x3?_0x45fc2a(_0x2efd16,_0x2be82b,_0xf7ea94):_0x45fc2a(_0x2efd16,_0x2be82b))||_0xf7ea94;}return _0x24ba5c>0x3&&_0xf7ea94&&Object[_0x5b38f3(0x192)](_0x2efd16,_0x2be82b,_0xf7ea94),_0xf7ea94;},__metadata=this&&this[a145_0x32de0b(0x18c)]||function(_0x2d6489,_0x2f63e7){const _0x3ef94c=a145_0x32de0b;if(typeof Reflect===_0x3ef94c(0x175)&&typeof Reflect[_0x3ef94c(0x173)]===_0x3ef94c(0x189))return Reflect[_0x3ef94c(0x173)](_0x2d6489,_0x2f63e7);};function a145_0x34df(_0x5c2e7c,_0x5a4ded){return a145_0x34df=function(_0x34481b,_0x4fc92f){_0x34481b=_0x34481b-0x166;let _0x459587=a145_0x4e7f[_0x34481b];return _0x459587;},a145_0x34df(_0x5c2e7c,_0x5a4ded);}Object[a145_0x32de0b(0x192)](exports,'__esModule',{'value':!![]}),exports[a145_0x32de0b(0x193)]=void 0x0;const core_1=require(a145_0x32de0b(0x1b5)),salesforce_service_1=require(a145_0x32de0b(0x1b4)),git_provider_manager_1=require(a145_0x32de0b(0x1b1)),typedi_1=require('typedi'),errors_1=require(a145_0x32de0b(0x1ae)),bad_request_error_1=require(a145_0x32de0b(0x1a4)),salesforce_retriever_service_1=require(a145_0x32de0b(0x1bc)),salesforce_sync_service_1=require(a145_0x32de0b(0x198)),utils_1=require(a145_0x32de0b(0x18e)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a145_0x32de0b(0x19b)),logger=new core_1[(a145_0x32de0b(0x18b))](a145_0x32de0b(0x1bf));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x490d78,_0xbb30cd,_0x21012b,_0xe31db4){const _0x3de609=a145_0x32de0b;this[_0x3de609(0x168)]=_0x490d78,this['commitJob']=_0xbb30cd,this[_0x3de609(0x182)]=_0x21012b,this[_0x3de609(0x166)]=_0xe31db4,this[_0x3de609(0x178)]=this[_0x3de609(0x166)][_0x3de609(0x19a)]();}[a145_0x32de0b(0x184)](_0x56f32c){const _0x223abc=a145_0x32de0b;return this[_0x223abc(0x19d)][_0x223abc(0x184)](_0x223abc(0x19c)+this[_0x223abc(0x166)]['provider'][_0x223abc(0x1a2)]()+']\x20[Repository:\x20'+this[_0x223abc(0x186)][_0x223abc(0x1b2)]+_0x223abc(0x18f)+this[_0x223abc(0x17d)][_0x223abc(0x1b2)]+']\x20'+_0x56f32c);}async['fetchRepositoryData'](){const _0x283607=a145_0x32de0b;try{if(this['commitData'][_0x283607(0x1ba)])this[_0x283607(0x17f)]=await this[_0x283607(0x182)]['getRepositoryRecord'](this[_0x283607(0x1ab)][_0x283607(0x1ba)]);else this[_0x283607(0x1ab)]['syncBranchId']&&(this[_0x283607(0x17f)]=await this['salesforceSync']['getBranchRecord'](this[_0x283607(0x1ab)]['syncBranchId']));}catch(_0x867bff){throw new bad_request_error_1[(_0x283607(0x169))](errors_1[_0x283607(0x19f)]);}}async[a145_0x32de0b(0x1aa)](){const _0x50ea68=a145_0x32de0b;if(!this[_0x50ea68(0x1ab)][_0x50ea68(0x1be)])return[];const _0x135948=await this[_0x50ea68(0x168)][_0x50ea68(0x16a)](this[_0x50ea68(0x1ab)][_0x50ea68(0x1be)])[_0x50ea68(0x17a)](_0x177cd1=>_0x177cd1[_0x50ea68(0x181)]('\x20')['map'](_0x3884d6=>_0x3884d6[_0x50ea68(0x1b9)]())),_0x2d9c62=new salesforce_retriever_service_1[(_0x50ea68(0x1a7))](this[_0x50ea68(0x168)]),_0x1de14d=await _0x2d9c62[_0x50ea68(0x16d)](_0x135948);return _0x1de14d;}async[a145_0x32de0b(0x1b0)](){const _0x489371=a145_0x32de0b;if(!this['commitData'][_0x489371(0x177)])return[];const _0x3dc6a2=await this[_0x489371(0x168)][_0x489371(0x16a)](this['commitData'][_0x489371(0x177)]);return _0x3dc6a2;}async['getCommitDto'](){const _0x2eccc9=a145_0x32de0b,_0x172d53=new commit_components_dto_1[(_0x2eccc9(0x16f))](),[_0x3e6a36,_0x46053a]=await Promise[_0x2eccc9(0x1ac)]([this[_0x2eccc9(0x1aa)](),this[_0x2eccc9(0x1b0)]()]);return _0x172d53['message']=this[_0x2eccc9(0x1ab)]['message'],_0x172d53[_0x2eccc9(0x1a8)]=this[_0x2eccc9(0x1ab)][_0x2eccc9(0x1a8)],_0x172d53[_0x2eccc9(0x18a)]={'writed':_0x3e6a36,'deleted':_0x46053a},_0x172d53[_0x2eccc9(0x1a0)]=this['commitData'][_0x2eccc9(0x1a0)],_0x172d53[_0x2eccc9(0x183)]=this[_0x2eccc9(0x186)],_0x172d53['branch']=this[_0x2eccc9(0x17d)],_0x172d53;}async['updateLastCommit'](){const _0xe69704=a145_0x32de0b,_0x4db4b8=await this[_0xe69704(0x186)][_0xe69704(0x1c0)]['getOne'](this[_0xe69704(0x17d)]['name']);this[_0xe69704(0x184)](_0xe69704(0x174));const _0x17bd3e=await this[_0xe69704(0x182)]['getAttachmentId'](this[_0xe69704(0x17f)]),_0x4e0dc9={[this[_0xe69704(0x186)]['gitUrl']]:{'lastCommit':_0x4db4b8[_0xe69704(0x172)]}};await this[_0xe69704(0x168)][_0xe69704(0x1b7)]('Attachment',_0x17bd3e,{'Body':utils_1[_0xe69704(0x179)](JSON[_0xe69704(0x1b6)](_0x4e0dc9))});}async[a145_0x32de0b(0x1a9)](){const _0x569193=a145_0x32de0b,_0x1a61c3=await this['getCommitDto']();this[_0x569193(0x1c1)][_0x569193(0x19d)]=this['logger'],await this[_0x569193(0x182)][_0x569193(0x170)](this[_0x569193(0x17f)],_0x569193(0x16b)),await this['commitJob'][_0x569193(0x16d)](_0x1a61c3),await this[_0x569193(0x190)](),this[_0x569193(0x1ab)][_0x569193(0x1be)]&&await this['salesforceService'][_0x569193(0x167)](this[_0x569193(0x1ab)][_0x569193(0x1be)]),this[_0x569193(0x1ab)][_0x569193(0x177)]&&await this[_0x569193(0x168)][_0x569193(0x167)](this['commitData'][_0x569193(0x177)]),await this[_0x569193(0x182)][_0x569193(0x170)](this['repositoryData'],_0x569193(0x195));}async[a145_0x32de0b(0x185)](_0x4f6d28){const _0x4dd320=a145_0x32de0b;try{this[_0x4dd320(0x19d)]['log'](_0x4dd320(0x18d)+_0x4f6d28),await this[_0x4dd320(0x19d)][_0x4dd320(0x16e)](),await this[_0x4dd320(0x182)]['setStatus'](this[_0x4dd320(0x17f)],'Error');}catch(_0x298fac){logger[_0x4dd320(0x194)](_0x298fac);}}async[a145_0x32de0b(0x16d)](_0x1967e3,_0x4a4413){const _0x4b4fbb=a145_0x32de0b;try{this['commitData']=_0x1967e3,this['salesforceService']['setLoggerId'](_0x4a4413),this[_0x4b4fbb(0x19d)]=this[_0x4b4fbb(0x168)][_0x4b4fbb(0x180)](),await this['fetchRepositoryData']();if(!this['repositoryData'])throw new bad_request_error_1[(_0x4b4fbb(0x169))](errors_1[_0x4b4fbb(0x17b)]);this[_0x4b4fbb(0x186)]=await this['repoService'][_0x4b4fbb(0x1a5)](this['repositoryData'][_0x4b4fbb(0x1af)]),this['branch']=await this[_0x4b4fbb(0x186)][_0x4b4fbb(0x1c0)]['getOne'](this[_0x4b4fbb(0x17f)]['branchName']),this['log']('[INFO]\x20Start\x20commit\x20job'),this[_0x4b4fbb(0x1a9)]()[_0x4b4fbb(0x17e)](_0x57a8c7=>this[_0x4b4fbb(0x185)](_0x57a8c7));}catch(_0xd55ae8){this['commitData']=undefined,logger[_0x4b4fbb(0x194)](_0xd55ae8);throw _0xd55ae8;}}};FlosumCommitJob=__decorate([typedi_1['Service']({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a145_0x32de0b(0x199)],commit_components_job_1[a145_0x32de0b(0x17c)],salesforce_sync_service_1[a145_0x32de0b(0x1bd)],git_provider_manager_1[a145_0x32de0b(0x197)]])],FlosumCommitJob),exports[a145_0x32de0b(0x193)]=FlosumCommitJob;