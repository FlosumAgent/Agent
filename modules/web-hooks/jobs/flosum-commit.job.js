const a142_0x2288=['log','../../shared/git-provider.manager','branch','encodeBase64','branches','../../shared/utils','Logger','object','patchObject','apply','fetchRepositoryData','__esModule','getComponentsToWrite','syncBranchId','repositoryName','toUpperCase','updateLastCommit','defineProperty','805895GnJbAg','../../salesforce/services/salesforce.service','send','../../salesforce/services/salesforce-sync.service','retrieveAttachment','__decorate','1981dOXOqg','repository','flosum-commit-job','commitData','logger','message','repo','metadata','map','SalesforceService','deleteAttachmentId','244386jNcapB','Service','getOwnPropertyDescriptor','error','getAttachmentIdByParent','repositoryData','name','getComponentsToDelete','ERR_INVALID_SYNC_RECORD_ID','FlosumCommitJob','function','CommitComponentsDto','syncRepositoryId','constructor','convertToSFDX','design:paramtypes','test','245dMUftc','609EnOoIl','user','stringify','../../../core/errors/bad-request.error','../dto/commit-components.dto','ERR_UNKNOWN_SYNC_RECORD_ID',']\x20[Branch:\x20','../../../core','getRepositoryRecord','7741UFELwT','commitJob','getOne','branchName','commitAttachmentId','BadRequestError','GitProviderManager','./commit-components.job','[ERROR]\x20','repoService','SalesforceSyncService','return\x20/\x22\x20+\x20this\x20+\x20\x22/','then','getRepoService','components','salesforceSync','SalesforceRetrieverService','Completed','all','split','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','run','148399euXYfJ','decorate','sha','length','setStatus','getCommitDto','Attachment','gitManager','877119tcSJAB','677474NSBCRq',']\x20[Repository:\x20','deleteAttachment','salesforceService','../../salesforce/services/salesforce-retriever.service'];const a142_0x64ba52=a142_0x3f85;(function(_0x9a27ad,_0x3dc1d7){const _0x5a83be=a142_0x3f85;while(!![]){try{const _0x23058d=parseInt(_0x5a83be(0x183))+parseInt(_0x5a83be(0x1da))*parseInt(_0x5a83be(0x195))+parseInt(_0x5a83be(0x1d4))+parseInt(_0x5a83be(0x1b4))+-parseInt(_0x5a83be(0x1bd))+parseInt(_0x5a83be(0x1bc))+parseInt(_0x5a83be(0x19e))*-parseInt(_0x5a83be(0x194));if(_0x23058d===_0x3dc1d7)break;else _0x9a27ad['push'](_0x9a27ad['shift']());}catch(_0x2a7d98){_0x9a27ad['push'](_0x9a27ad['shift']());}}}(a142_0x2288,0xace71));const a142_0x5b137f=function(){let _0x378cce=!![];return function(_0x5c9eb7,_0x5277c2){const _0x1015ff=_0x378cce?function(){const _0x3ecbea=a142_0x3f85;if(_0x5277c2){const _0x151733=_0x5277c2[_0x3ecbea(0x1cb)](_0x5c9eb7,arguments);return _0x5277c2=null,_0x151733;}}:function(){};return _0x378cce=![],_0x1015ff;};}(),a142_0x5acef8=a142_0x5b137f(this,function(){const _0x25b41d=function(){const _0x5c2f97=a142_0x3f85,_0x185d83=_0x25b41d[_0x5c2f97(0x190)](_0x5c2f97(0x1a9))()[_0x5c2f97(0x190)](_0x5c2f97(0x1b2));return!_0x185d83[_0x5c2f97(0x193)](a142_0x5acef8);};return _0x25b41d();});a142_0x5acef8();'use strict';function a142_0x3f85(_0xf85f30,_0x4c01d5){return a142_0x3f85=function(_0x143e88,_0x5acef8){_0x143e88=_0x143e88-0x179;let _0x5b137f=a142_0x2288[_0x143e88];return _0x5b137f;},a142_0x3f85(_0xf85f30,_0x4c01d5);}var __decorate=this&&this[a142_0x64ba52(0x1d9)]||function(_0x4e6fad,_0x1b8208,_0x29dbf9,_0x284bfd){const _0x1c974b=a142_0x64ba52;var _0x27505c=arguments[_0x1c974b(0x1b7)],_0x1f76ad=_0x27505c<0x3?_0x1b8208:_0x284bfd===null?_0x284bfd=Object[_0x1c974b(0x185)](_0x1b8208,_0x29dbf9):_0x284bfd,_0x3b9230;if(typeof Reflect==='object'&&typeof Reflect[_0x1c974b(0x1b5)]==='function')_0x1f76ad=Reflect['decorate'](_0x4e6fad,_0x1b8208,_0x29dbf9,_0x284bfd);else{for(var _0x24d341=_0x4e6fad['length']-0x1;_0x24d341>=0x0;_0x24d341--)if(_0x3b9230=_0x4e6fad[_0x24d341])_0x1f76ad=(_0x27505c<0x3?_0x3b9230(_0x1f76ad):_0x27505c>0x3?_0x3b9230(_0x1b8208,_0x29dbf9,_0x1f76ad):_0x3b9230(_0x1b8208,_0x29dbf9))||_0x1f76ad;}return _0x27505c>0x3&&_0x1f76ad&&Object[_0x1c974b(0x1d3)](_0x1b8208,_0x29dbf9,_0x1f76ad),_0x1f76ad;},__metadata=this&&this['__metadata']||function(_0x89df48,_0x53a0a0){const _0x74253=a142_0x64ba52;if(typeof Reflect===_0x74253(0x1c9)&&typeof Reflect['metadata']===_0x74253(0x18d))return Reflect[_0x74253(0x17f)](_0x89df48,_0x53a0a0);};Object[a142_0x64ba52(0x1d3)](exports,a142_0x64ba52(0x1cd),{'value':!![]}),exports[a142_0x64ba52(0x18c)]=void 0x0;const core_1=require(a142_0x64ba52(0x19c)),salesforce_service_1=require(a142_0x64ba52(0x1d5)),git_provider_manager_1=require(a142_0x64ba52(0x1c3)),typedi_1=require('typedi'),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a142_0x64ba52(0x198)),salesforce_retriever_service_1=require(a142_0x64ba52(0x1c1)),salesforce_sync_service_1=require(a142_0x64ba52(0x1d7)),utils_1=require(a142_0x64ba52(0x1c7)),commit_components_dto_1=require(a142_0x64ba52(0x199)),commit_components_job_1=require(a142_0x64ba52(0x1a5)),logger=new core_1[(a142_0x64ba52(0x1c8))](a142_0x64ba52(0x17a));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x3bcd13,_0x961bd5,_0x667944,_0x20f798){const _0x45a86e=a142_0x64ba52;this[_0x45a86e(0x1c0)]=_0x3bcd13,this[_0x45a86e(0x19f)]=_0x961bd5,this[_0x45a86e(0x1ad)]=_0x667944,this[_0x45a86e(0x1bb)]=_0x20f798,this['repoService']=this[_0x45a86e(0x1bb)][_0x45a86e(0x1ab)]();}['log'](_0x1dd447){const _0x5e468e=a142_0x64ba52;return this[_0x5e468e(0x17c)][_0x5e468e(0x1c2)]('[COMMIT]\x20['+this[_0x5e468e(0x1bb)]['provider'][_0x5e468e(0x1d1)]()+_0x5e468e(0x1be)+this['repository']['name']+_0x5e468e(0x19b)+this[_0x5e468e(0x1c4)][_0x5e468e(0x189)]+']\x20'+_0x1dd447);}async[a142_0x64ba52(0x1cc)](){const _0x1bc945=a142_0x64ba52;try{if(this['commitData'][_0x1bc945(0x18f)])this[_0x1bc945(0x188)]=await this['salesforceSync'][_0x1bc945(0x19d)](this[_0x1bc945(0x17b)][_0x1bc945(0x18f)]);else this['commitData'][_0x1bc945(0x1cf)]&&(this[_0x1bc945(0x188)]=await this['salesforceSync']['getBranchRecord'](this['commitData'][_0x1bc945(0x1cf)]));}catch(_0x54611d){throw new bad_request_error_1[(_0x1bc945(0x1a3))](errors_1[_0x1bc945(0x18b)]);}}async[a142_0x64ba52(0x1ce)](){const _0x4d8314=a142_0x64ba52;if(!this[_0x4d8314(0x17b)]['commitAttachmentId'])return[];const _0x1ea69c=await this[_0x4d8314(0x1c0)][_0x4d8314(0x1d8)](this[_0x4d8314(0x17b)]['commitAttachmentId'])[_0x4d8314(0x1aa)](_0x5c10f7=>_0x5c10f7[_0x4d8314(0x1b1)]('\x20')[_0x4d8314(0x180)](_0x3fcdbc=>_0x3fcdbc['trim']())),_0x2d6c72=new salesforce_retriever_service_1[(_0x4d8314(0x1ae))](this[_0x4d8314(0x1c0)]),_0x16293f=await _0x2d6c72[_0x4d8314(0x1b3)](_0x1ea69c);return _0x16293f;}async[a142_0x64ba52(0x18a)](){const _0x1c531c=a142_0x64ba52;if(!this[_0x1c531c(0x17b)][_0x1c531c(0x182)])return[];const _0xac5259=await this[_0x1c531c(0x1c0)]['retrieveAttachment'](this['commitData'][_0x1c531c(0x182)]);return _0xac5259;}async[a142_0x64ba52(0x1b9)](){const _0x57b69e=a142_0x64ba52,_0xe77234=new commit_components_dto_1[(_0x57b69e(0x18e))](),[_0x30f835,_0x4cd834]=await Promise[_0x57b69e(0x1b0)]([this['getComponentsToWrite'](),this[_0x57b69e(0x18a)]()]);return _0xe77234[_0x57b69e(0x17d)]=this['commitData'][_0x57b69e(0x17d)],_0xe77234['user']=this[_0x57b69e(0x17b)][_0x57b69e(0x196)],_0xe77234[_0x57b69e(0x1ac)]={'writed':_0x30f835,'deleted':_0x4cd834},_0xe77234['convertToSFDX']=this[_0x57b69e(0x17b)][_0x57b69e(0x191)],_0xe77234[_0x57b69e(0x17e)]=this[_0x57b69e(0x179)],_0xe77234[_0x57b69e(0x1c4)]=this['branch'],_0xe77234;}async['updateLastCommit'](){const _0x452630=a142_0x64ba52,_0x57c5ff=await this[_0x452630(0x179)][_0x452630(0x1c6)][_0x452630(0x1a0)](this[_0x452630(0x1c4)][_0x452630(0x189)]);this[_0x452630(0x1c2)]('[INFO]\x20Update\x20remote\x20state.');const _0x12dab9=await this[_0x452630(0x1ad)][_0x452630(0x187)](this['repositoryData']['objectId']),_0x2c22ed={[this[_0x452630(0x179)]['gitUrl']]:{'lastCommit':_0x57c5ff[_0x452630(0x1b6)]}};await this[_0x452630(0x1c0)][_0x452630(0x1ca)](_0x452630(0x1ba),_0x12dab9,{'Body':utils_1[_0x452630(0x1c5)](JSON[_0x452630(0x197)](_0x2c22ed))});}async['exec'](){const _0x546198=a142_0x64ba52,_0x5b4c77=await this[_0x546198(0x1b9)]();this[_0x546198(0x19f)][_0x546198(0x17c)]=this['logger'],await this['salesforceSync'][_0x546198(0x1b8)](this[_0x546198(0x188)],'In\x20Progress'),await this[_0x546198(0x19f)]['run'](_0x5b4c77),await this[_0x546198(0x1d2)](),this[_0x546198(0x17b)][_0x546198(0x1a2)]&&await this[_0x546198(0x1c0)][_0x546198(0x1bf)](this[_0x546198(0x17b)][_0x546198(0x1a2)]),this[_0x546198(0x17b)][_0x546198(0x182)]&&await this[_0x546198(0x1c0)][_0x546198(0x1bf)](this[_0x546198(0x17b)][_0x546198(0x182)]),await this[_0x546198(0x1ad)]['setStatus'](this[_0x546198(0x188)],_0x546198(0x1af));}async[a142_0x64ba52(0x1b3)](_0x1a7ef9,_0x5dc3da){const _0x3749fc=a142_0x64ba52;try{this['commitData']=_0x1a7ef9,this[_0x3749fc(0x1c0)]['setLoggerId'](_0x5dc3da),this['logger']=this[_0x3749fc(0x1c0)]['getLogger'](),await this[_0x3749fc(0x1cc)]();if(!this['repositoryData'])throw new bad_request_error_1[(_0x3749fc(0x1a3))](errors_1[_0x3749fc(0x19a)]);this[_0x3749fc(0x179)]=await this[_0x3749fc(0x1a7)]['getOne'](this[_0x3749fc(0x188)][_0x3749fc(0x1d0)]),this[_0x3749fc(0x1c4)]=await this[_0x3749fc(0x179)]['branches'][_0x3749fc(0x1a0)](this[_0x3749fc(0x188)][_0x3749fc(0x1a1)]),this[_0x3749fc(0x1c2)]('[INFO]\x20Start\x20commit\x20job'),this['exec']()['catch'](async _0x3fa651=>{const _0x5f577b=_0x3749fc;return logger[_0x5f577b(0x186)](_0x3fa651),this['log'](_0x5f577b(0x1a6)+_0x3fa651),await this['salesforceSync'][_0x5f577b(0x1b8)](this[_0x5f577b(0x188)],'Error'),this['logger'][_0x5f577b(0x1d6)]();});}catch(_0x3d651a){this[_0x3749fc(0x17b)]=undefined,logger['error'](_0x3d651a);throw _0x3d651a;}}};FlosumCommitJob=__decorate([typedi_1[a142_0x64ba52(0x184)]({'transient':!![]}),__metadata(a142_0x64ba52(0x192),[salesforce_service_1[a142_0x64ba52(0x181)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a142_0x64ba52(0x1a8)],git_provider_manager_1[a142_0x64ba52(0x1a4)]])],FlosumCommitJob),exports[a142_0x64ba52(0x18c)]=FlosumCommitJob;