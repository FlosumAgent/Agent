const a145_0x27da66=a145_0x3b35;(function(_0x19deb6,_0x4e335f){const _0xbceab8=a145_0x3b35,_0x548e4f=_0x19deb6();while(!![]){try{const _0x3f5883=-parseInt(_0xbceab8(0x248))/0x1+parseInt(_0xbceab8(0x215))/0x2+-parseInt(_0xbceab8(0x221))/0x3*(parseInt(_0xbceab8(0x21a))/0x4)+-parseInt(_0xbceab8(0x1ea))/0x5+-parseInt(_0xbceab8(0x241))/0x6*(-parseInt(_0xbceab8(0x20b))/0x7)+-parseInt(_0xbceab8(0x1fe))/0x8+parseInt(_0xbceab8(0x207))/0x9;if(_0x3f5883===_0x4e335f)break;else _0x548e4f['push'](_0x548e4f['shift']());}catch(_0x27c399){_0x548e4f['push'](_0x548e4f['shift']());}}}(a145_0xa7ad,0x906f2));const a145_0x208e40=function(){let _0x31e037=!![];return function(_0x4c9162,_0x147bbd){const _0x50d8fd=_0x31e037?function(){const _0x249707=a145_0x3b35;if(_0x147bbd){const _0x46456d=_0x147bbd[_0x249707(0x245)](_0x4c9162,arguments);return _0x147bbd=null,_0x46456d;}}:function(){};return _0x31e037=![],_0x50d8fd;};}(),a145_0x516bfb=a145_0x208e40(this,function(){const _0xb2318a=a145_0x3b35;return a145_0x516bfb[_0xb2318a(0x22f)]()['search']('(((.+)+)+)+$')[_0xb2318a(0x22f)]()[_0xb2318a(0x211)](a145_0x516bfb)[_0xb2318a(0x23c)](_0xb2318a(0x213));});a145_0x516bfb();'use strict';var __decorate=this&&this['__decorate']||function(_0x444f47,_0x144a42,_0x516187,_0x52ea20){const _0x174ba3=a145_0x3b35;var _0x568670=arguments[_0x174ba3(0x24b)],_0x5bcf1f=_0x568670<0x3?_0x144a42:_0x52ea20===null?_0x52ea20=Object[_0x174ba3(0x205)](_0x144a42,_0x516187):_0x52ea20,_0x1310e8;if(typeof Reflect===_0x174ba3(0x236)&&typeof Reflect['decorate']===_0x174ba3(0x22e))_0x5bcf1f=Reflect[_0x174ba3(0x1f2)](_0x444f47,_0x144a42,_0x516187,_0x52ea20);else{for(var _0x2e21c4=_0x444f47['length']-0x1;_0x2e21c4>=0x0;_0x2e21c4--)if(_0x1310e8=_0x444f47[_0x2e21c4])_0x5bcf1f=(_0x568670<0x3?_0x1310e8(_0x5bcf1f):_0x568670>0x3?_0x1310e8(_0x144a42,_0x516187,_0x5bcf1f):_0x1310e8(_0x144a42,_0x516187))||_0x5bcf1f;}return _0x568670>0x3&&_0x5bcf1f&&Object[_0x174ba3(0x234)](_0x144a42,_0x516187,_0x5bcf1f),_0x5bcf1f;},__metadata=this&&this['__metadata']||function(_0x2f306c,_0x248200){const _0x42faf6=a145_0x3b35;if(typeof Reflect===_0x42faf6(0x236)&&typeof Reflect['metadata']===_0x42faf6(0x22e))return Reflect[_0x42faf6(0x23f)](_0x2f306c,_0x248200);};function a145_0x3b35(_0x22a593,_0x38eb93){const _0x516b37=a145_0xa7ad();return a145_0x3b35=function(_0x516bfb,_0x208e40){_0x516bfb=_0x516bfb-0x1e8;let _0xa7ad33=_0x516b37[_0x516bfb];return _0xa7ad33;},a145_0x3b35(_0x22a593,_0x38eb93);}Object[a145_0x27da66(0x234)](exports,a145_0x27da66(0x200),{'value':!![]}),exports[a145_0x27da66(0x1f4)]=void 0x0;function a145_0xa7ad(){const _0x217789=['function','toString','toUpperCase','ERR_INVALID_SYNC_RECORD_ID','[COMMIT]\x20[','getRepositoryRecord','defineProperty','run','object','branches','components','syncRepositoryId','repositoryData','Logger','search','fetchRepositoryData','../../../constants/errors','metadata','name','6SrrFbK','Attachment','updateLastCommit','syncBranchId','apply','SalesforceSyncService','commitJob','765394zvTyXa','branch','then','length','getCommitDto','repoService','Completed','2274325sAhjqy','BadRequestError','salesforceSync','../../../core/errors/bad-request.error','send','handleCommitJobError','setStatus','Error','decorate','setLoggerId','FlosumCommitJob','repositoryName','getBranchRecord','../../salesforce/services/salesforce-retriever.service','retrieveAttachment','getLogger','sha','error','SalesforceService','gitManager','7644488nhcEeZ','patchObject','__esModule','repository','trim','Service','CommitComponentsDto','getOwnPropertyDescriptor','map','11991132OLwxij','getAttachmentId','encodeBase64','getComponentsToDelete','7425929XtuRPp','repo','branchName','design:paramtypes','../dto/commit-components.dto','exec','constructor','../../shared/git-provider.manager','(((.+)+)+)+$','getOne','820584lYACUY','commitAttachmentId','commitData','logger','catch','144260CwQoZc','log','deleteAttachment','../../../core','In\x20Progress','CommitComponentsJob','../../salesforce/services/salesforce.service','3zugdyl','split','getRepoService','message','getComponentsToWrite',']\x20[Branch:\x20','user','salesforceService','ERR_UNKNOWN_SYNC_RECORD_ID','./commit-components.job','[INFO]\x20Update\x20remote\x20state.',']\x20[Repository:\x20','flosum-commit-job'];a145_0xa7ad=function(){return _0x217789;};return a145_0xa7ad();}const core_1=require(a145_0x27da66(0x21d)),salesforce_service_1=require(a145_0x27da66(0x220)),git_provider_manager_1=require(a145_0x27da66(0x212)),typedi_1=require('typedi'),errors_1=require(a145_0x27da66(0x23e)),bad_request_error_1=require(a145_0x27da66(0x1ed)),salesforce_retriever_service_1=require(a145_0x27da66(0x1f7)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a145_0x27da66(0x20f)),commit_components_job_1=require(a145_0x27da66(0x22a)),logger=new core_1[(a145_0x27da66(0x23b))](a145_0x27da66(0x22d));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x1f1cb4,_0x4f489b,_0x56ee62,_0xab56da){const _0x3ffb55=a145_0x27da66;this[_0x3ffb55(0x228)]=_0x1f1cb4,this[_0x3ffb55(0x247)]=_0x4f489b,this['salesforceSync']=_0x56ee62,this[_0x3ffb55(0x1fd)]=_0xab56da,this[_0x3ffb55(0x1e8)]=this[_0x3ffb55(0x1fd)][_0x3ffb55(0x223)]();}[a145_0x27da66(0x21b)](_0x453367){const _0x5c7f20=a145_0x27da66;return this['logger'][_0x5c7f20(0x21b)](_0x5c7f20(0x232)+this['gitManager']['provider'][_0x5c7f20(0x230)]()+_0x5c7f20(0x22c)+this[_0x5c7f20(0x201)][_0x5c7f20(0x240)]+_0x5c7f20(0x226)+this['branch'][_0x5c7f20(0x240)]+']\x20'+_0x453367);}async[a145_0x27da66(0x23d)](){const _0x497c3b=a145_0x27da66;try{if(this[_0x497c3b(0x217)][_0x497c3b(0x239)])this[_0x497c3b(0x23a)]=await this[_0x497c3b(0x1ec)][_0x497c3b(0x233)](this[_0x497c3b(0x217)]['syncRepositoryId']);else this[_0x497c3b(0x217)][_0x497c3b(0x244)]&&(this[_0x497c3b(0x23a)]=await this['salesforceSync'][_0x497c3b(0x1f6)](this['commitData'][_0x497c3b(0x244)]));}catch(_0x565e7b){throw new bad_request_error_1[(_0x497c3b(0x1eb))](errors_1[_0x497c3b(0x231)]);}}async['getComponentsToWrite'](){const _0x1da61a=a145_0x27da66;if(!this[_0x1da61a(0x217)]['commitAttachmentId'])return[];const _0x89552a=await this[_0x1da61a(0x228)][_0x1da61a(0x1f8)](this[_0x1da61a(0x217)][_0x1da61a(0x216)])[_0x1da61a(0x24a)](_0x257be7=>_0x257be7[_0x1da61a(0x222)]('\x20')[_0x1da61a(0x206)](_0x4b1314=>_0x4b1314[_0x1da61a(0x202)]())),_0x1c3d6f=new salesforce_retriever_service_1['SalesforceRetrieverService'](this['salesforceService']),_0x4f184d=await _0x1c3d6f[_0x1da61a(0x235)](_0x89552a);return _0x4f184d;}async[a145_0x27da66(0x20a)](){const _0x325368=a145_0x27da66;if(!this[_0x325368(0x217)]['deleteAttachmentId'])return[];const _0x1e2372=await this[_0x325368(0x228)]['retrieveAttachment'](this[_0x325368(0x217)]['deleteAttachmentId']);return _0x1e2372;}async[a145_0x27da66(0x24c)](){const _0x1d6a84=a145_0x27da66,_0x9b2d65=new commit_components_dto_1[(_0x1d6a84(0x204))](),[_0xa67ce8,_0x43ca2e]=await Promise['all']([this[_0x1d6a84(0x225)](),this[_0x1d6a84(0x20a)]()]);return _0x9b2d65[_0x1d6a84(0x224)]=this[_0x1d6a84(0x217)][_0x1d6a84(0x224)],_0x9b2d65[_0x1d6a84(0x227)]=this[_0x1d6a84(0x217)][_0x1d6a84(0x227)],_0x9b2d65[_0x1d6a84(0x238)]={'writed':_0xa67ce8,'deleted':_0x43ca2e},_0x9b2d65['convertToSFDX']=this[_0x1d6a84(0x217)]['convertToSFDX'],_0x9b2d65[_0x1d6a84(0x20c)]=this[_0x1d6a84(0x201)],_0x9b2d65[_0x1d6a84(0x249)]=this[_0x1d6a84(0x249)],_0x9b2d65;}async[a145_0x27da66(0x243)](_0x37d856=![]){const _0xceeac1=a145_0x27da66,_0x2b5ba6=await this[_0xceeac1(0x1ec)][_0xceeac1(0x208)](this[_0xceeac1(0x23a)]);if(_0x37d856)await this[_0xceeac1(0x228)][_0xceeac1(0x1ff)](_0xceeac1(0x242),_0x2b5ba6,{'Body':(0x0,utils_1[_0xceeac1(0x209)])(JSON['stringify']({}))});else{const _0x1743ee=await this[_0xceeac1(0x201)][_0xceeac1(0x237)][_0xceeac1(0x214)](this[_0xceeac1(0x249)][_0xceeac1(0x240)]);this[_0xceeac1(0x21b)](_0xceeac1(0x22b));const _0x3e9a8f={[this['repository']['gitUrl']]:{'lastCommit':_0x1743ee[_0xceeac1(0x1fa)]}};await this[_0xceeac1(0x228)][_0xceeac1(0x1ff)](_0xceeac1(0x242),_0x2b5ba6,{'Body':(0x0,utils_1[_0xceeac1(0x209)])(JSON['stringify'](_0x3e9a8f))});}}async['exec'](){const _0x2bf5a4=a145_0x27da66,_0xcc6351=await this[_0x2bf5a4(0x24c)]();this['commitJob']['logger']=this['logger'],await this[_0x2bf5a4(0x1ec)][_0x2bf5a4(0x1f0)](this['repositoryData'],_0x2bf5a4(0x21e)),await this[_0x2bf5a4(0x247)]['run'](_0xcc6351),await this[_0x2bf5a4(0x243)](),this[_0x2bf5a4(0x217)][_0x2bf5a4(0x216)]&&await this[_0x2bf5a4(0x228)][_0x2bf5a4(0x21c)](this[_0x2bf5a4(0x217)][_0x2bf5a4(0x216)]),this[_0x2bf5a4(0x217)]['deleteAttachmentId']&&await this['salesforceService'][_0x2bf5a4(0x21c)](this[_0x2bf5a4(0x217)]['deleteAttachmentId']),await this['salesforceSync'][_0x2bf5a4(0x1f0)](this[_0x2bf5a4(0x23a)],_0x2bf5a4(0x1e9));}async[a145_0x27da66(0x1ef)](_0x1f59d9){const _0x3fbe02=a145_0x27da66;try{this[_0x3fbe02(0x218)][_0x3fbe02(0x21b)]('[ERROR]\x20'+_0x1f59d9),await this[_0x3fbe02(0x218)][_0x3fbe02(0x1ee)](),await this['updateLastCommit'](!![]),await this[_0x3fbe02(0x1ec)][_0x3fbe02(0x1f0)](this[_0x3fbe02(0x23a)],_0x3fbe02(0x1f1));}catch(_0xd38036){logger[_0x3fbe02(0x1fb)](_0xd38036);}}async['run'](_0x1ba2ae,_0x2a2812){const _0x49732b=a145_0x27da66;try{this[_0x49732b(0x217)]=_0x1ba2ae,this['salesforceService'][_0x49732b(0x1f3)](_0x2a2812),this['logger']=this[_0x49732b(0x228)][_0x49732b(0x1f9)](),await this[_0x49732b(0x23d)]();if(!this[_0x49732b(0x23a)])throw new bad_request_error_1[(_0x49732b(0x1eb))](errors_1[_0x49732b(0x229)]);this['repository']=await this[_0x49732b(0x1e8)][_0x49732b(0x214)](this['repositoryData'][_0x49732b(0x1f5)]),this['branch']=await this[_0x49732b(0x201)]['branches'][_0x49732b(0x214)](this[_0x49732b(0x23a)][_0x49732b(0x20d)]),this[_0x49732b(0x21b)]('[INFO]\x20Start\x20commit\x20job'),this[_0x49732b(0x210)]()[_0x49732b(0x219)](_0x3f73e8=>this['handleCommitJobError'](_0x3f73e8));}catch(_0x509749){this[_0x49732b(0x217)]=undefined,logger[_0x49732b(0x1fb)](_0x509749);throw _0x509749;}}};FlosumCommitJob=__decorate([(0x0,typedi_1[a145_0x27da66(0x203)])({'transient':!![]}),__metadata(a145_0x27da66(0x20e),[salesforce_service_1[a145_0x27da66(0x1fc)],commit_components_job_1[a145_0x27da66(0x21f)],salesforce_sync_service_1[a145_0x27da66(0x246)],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports[a145_0x27da66(0x1f4)]=FlosumCommitJob;