const a119_0x2828=['sfdx-project.json','SFDX','https://','../../internal/shell.internal','info','send\x20DELETE\x20commit\x20id\x20%s','apply','186379CVBiIv','constructor','1gegZYL','../../shared/utils','status','path','sleep','__importStar','replace','fileName','default','defineProperty','GitProviderManager','splice','length','SalesforceService','Start\x20retrieve\x20components\x20job','../../shared/services/auth-settings.service','fileType','commitId','84127hleTkH','../../../core/errors/internal-server.error','mdapiToSource','salesforceService','includes','__metadata','__esModule','GIT_STATUS_CHECK_INTERVAL','baseDir','../../../core/errors/bad-request.error','call','currentJob','map','retrieve','exec','createEmptyPackageXml','Shell','FlosumCommitJob','deleteCommit','branches','MDAPI_DIR','branch','__setModuleDefault','push','mdapi','__decorate','BadRequestError','gitCredentials','InternalServerError','message','convertToSFDX','createEmptyProjectJson','run','prototype','data','retrieveComponents','return\x20/\x22\x20+\x20this\x20+\x20\x22/','5AMcQgU','add\x20retrieved\x20components\x20to\x20commit','../../sfdx/utils/sfdx','commit','__importDefault','Clonning\x20repository','47392DsJJXz','decorate','getOne','../../parsers/mdapi/writer','rm\x20-f\x20','1IHXIhW','251588zXaKTH','hasOwnProperty','add','metadata','now','set\x20credentials\x20{\x20name:\x20%s,\x20email:\x20%s\x20}','Logger','setCredentials','FlosumRetriever','./job','Push\x20commit\x20to\x20branch','COMPONENTS_PER_TICK','MDApiParser','remove\x20git\x20repository\x20folder\x20','4108KuEsGP','log','start\x20retrieving\x20components','AuthSettingsService','sfLogger','typedi','trim','credentials','create','rm\x20-rf\x20','[ERROR]\x20','MDApiWriter','Git','split','commit\x20%s\x20took\x20%dms\x20to\x20proceed\x20%d\x20components','731623zFJqSu','function','Job','object','get','__createBinding','catch','../../sfdx/utils/flosum-retriever.util','join','Done\x20','98337uBxtiT'];const a119_0x4d6715=a119_0xdf3c;(function(_0xd2bd4d,_0x170ef7){const _0x48cd1d=a119_0xdf3c;while(!![]){try{const _0x53cdfd=parseInt(_0x48cd1d(0x13f))*parseInt(_0x48cd1d(0x145))+parseInt(_0x48cd1d(0x17a))+parseInt(_0x48cd1d(0x172))+parseInt(_0x48cd1d(0x11a))*parseInt(_0x48cd1d(0x108))+parseInt(_0x48cd1d(0x14b))+parseInt(_0x48cd1d(0x159))+-parseInt(_0x48cd1d(0x168))*parseInt(_0x48cd1d(0x14a));if(_0x53cdfd===_0x170ef7)break;else _0xd2bd4d['push'](_0xd2bd4d['shift']());}catch(_0x1cb41a){_0xd2bd4d['push'](_0xd2bd4d['shift']());}}}(a119_0x2828,0x1fb54));const a119_0x1b7f22=function(){let _0x40bdbb=!![];return function(_0x27a632,_0x4e2c18){const _0x28a62d=_0x40bdbb?function(){const _0x59c53a=a119_0xdf3c;if(_0x4e2c18){const _0x54871d=_0x4e2c18[_0x59c53a(0x179)](_0x27a632,arguments);return _0x4e2c18=null,_0x54871d;}}:function(){};return _0x40bdbb=![],_0x28a62d;};}(),a119_0x202fcb=a119_0x1b7f22(this,function(){const _0xbd33ed=function(){const _0x546fea=a119_0xdf3c,_0x4bbe61=_0xbd33ed[_0x546fea(0x107)](_0x546fea(0x13e))()[_0x546fea(0x107)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x4bbe61['test'](a119_0x202fcb);};return _0xbd33ed();});a119_0x202fcb();'use strict';var __createBinding=this&&this[a119_0x4d6715(0x16d)]||(Object[a119_0x4d6715(0x161)]?function(_0x56c1bd,_0x1aec08,_0x4a4390,_0x5debb4){if(_0x5debb4===undefined)_0x5debb4=_0x4a4390;Object['defineProperty'](_0x56c1bd,_0x5debb4,{'enumerable':!![],'get':function(){return _0x1aec08[_0x4a4390];}});}:function(_0x336521,_0x1ec46c,_0x4947c7,_0x477734){if(_0x477734===undefined)_0x477734=_0x4947c7;_0x336521[_0x477734]=_0x1ec46c[_0x4947c7];}),__setModuleDefault=this&&this[a119_0x4d6715(0x130)]||(Object[a119_0x4d6715(0x161)]?function(_0x3e08c9,_0x39c9fb){const _0x5255da=a119_0x4d6715;Object[_0x5255da(0x111)](_0x3e08c9,_0x5255da(0x110),{'enumerable':!![],'value':_0x39c9fb});}:function(_0x169c91,_0x498a7d){const _0x9bf3ca=a119_0x4d6715;_0x169c91[_0x9bf3ca(0x110)]=_0x498a7d;}),__decorate=this&&this[a119_0x4d6715(0x133)]||function(_0x43c9ee,_0x25a780,_0xc15af2,_0x2dbd84){const _0x2ef417=a119_0x4d6715;var _0x484b3c=arguments[_0x2ef417(0x114)],_0xee9ef8=_0x484b3c<0x3?_0x25a780:_0x2dbd84===null?_0x2dbd84=Object['getOwnPropertyDescriptor'](_0x25a780,_0xc15af2):_0x2dbd84,_0x40d326;if(typeof Reflect===_0x2ef417(0x16b)&&typeof Reflect['decorate']===_0x2ef417(0x169))_0xee9ef8=Reflect[_0x2ef417(0x146)](_0x43c9ee,_0x25a780,_0xc15af2,_0x2dbd84);else{for(var _0x114af9=_0x43c9ee['length']-0x1;_0x114af9>=0x0;_0x114af9--)if(_0x40d326=_0x43c9ee[_0x114af9])_0xee9ef8=(_0x484b3c<0x3?_0x40d326(_0xee9ef8):_0x484b3c>0x3?_0x40d326(_0x25a780,_0xc15af2,_0xee9ef8):_0x40d326(_0x25a780,_0xc15af2))||_0xee9ef8;}return _0x484b3c>0x3&&_0xee9ef8&&Object[_0x2ef417(0x111)](_0x25a780,_0xc15af2,_0xee9ef8),_0xee9ef8;},__importStar=this&&this[a119_0x4d6715(0x10d)]||function(_0x563acb){const _0x582c59=a119_0x4d6715;if(_0x563acb&&_0x563acb[_0x582c59(0x120)])return _0x563acb;var _0x50ec92={};if(_0x563acb!=null){for(var _0x386702 in _0x563acb)if(_0x386702!==_0x582c59(0x110)&&Object[_0x582c59(0x13b)][_0x582c59(0x14c)][_0x582c59(0x124)](_0x563acb,_0x386702))__createBinding(_0x50ec92,_0x563acb,_0x386702);}return __setModuleDefault(_0x50ec92,_0x563acb),_0x50ec92;},__metadata=this&&this[a119_0x4d6715(0x11f)]||function(_0x5f0261,_0x260c26){const _0x107ec3=a119_0x4d6715;if(typeof Reflect===_0x107ec3(0x16b)&&typeof Reflect[_0x107ec3(0x14e)]===_0x107ec3(0x169))return Reflect['metadata'](_0x5f0261,_0x260c26);},__importDefault=this&&this[a119_0x4d6715(0x143)]||function(_0x2b30fd){const _0x21cdca=a119_0x4d6715;return _0x2b30fd&&_0x2b30fd[_0x21cdca(0x120)]?_0x2b30fd:{'default':_0x2b30fd};};Object[a119_0x4d6715(0x111)](exports,a119_0x4d6715(0x120),{'value':!![]}),exports[a119_0x4d6715(0x12b)]=void 0x0;const errors_1=require('../../../constants/errors'),core_1=require('../../../core'),bad_request_error_1=require(a119_0x4d6715(0x123)),git_internal_1=require('../../internal/git.internal'),shell_internal_1=require(a119_0x4d6715(0x176)),salesforce_service_1=require('../../sfdx/services/salesforce.service'),flosum_retriever_util_1=require(a119_0x4d6715(0x16f)),git_provider_manager_1=require('../../shared/git-provider.manager'),auth_settings_service_1=require(a119_0x4d6715(0x117)),utils_1=require(a119_0x4d6715(0x109)),path_1=__importDefault(require(a119_0x4d6715(0x10b))),typedi_1=__importStar(require(a119_0x4d6715(0x15e))),internal_server_error_1=require(a119_0x4d6715(0x11b)),mdapi_1=require('../../parsers/mdapi'),writer_1=require(a119_0x4d6715(0x148)),sfdx_1=require(a119_0x4d6715(0x141)),job_1=require(a119_0x4d6715(0x154)),logger=new core_1[(a119_0x4d6715(0x151))]('flosum-commit-job');function a119_0xdf3c(_0x16e0cd,_0x4f4843){return a119_0xdf3c=function(_0x377af2,_0x202fcb){_0x377af2=_0x377af2-0x107;let _0x1b7f22=a119_0x2828[_0x377af2];return _0x1b7f22;},a119_0xdf3c(_0x16e0cd,_0x4f4843);}let FlosumCommitJob=class FlosumCommitJob extends job_1[a119_0x4d6715(0x16a)]{constructor(_0x3dd1da,_0x533eea){const _0x36178c=a119_0x4d6715;super(),this['authSettings']=_0x3dd1da,this['salesforceService']=_0x533eea,this['MDAPI_DIR']=_0x36178c(0x132),this[_0x36178c(0x156)]=0x3e8,this['MAX_GIT_STATUS_CHECK']=0xa,this[_0x36178c(0x121)]=0xbb8;}get[a119_0x4d6715(0x160)](){const _0x18b1be=a119_0x4d6715;return this['authSettings'][_0x18b1be(0x135)];}get[a119_0x4d6715(0x119)](){var _0x12f514;return(_0x12f514=this['currentJob'])===null||_0x12f514===void 0x0?void 0x0:_0x12f514['id'];}async[a119_0x4d6715(0x15d)](_0x48a2c9){const _0x752b1a=a119_0x4d6715;return this[_0x752b1a(0x11d)]['log']('[CID:\x20'+this['commitId']+']\x20'+_0x48a2c9);}async[a119_0x4d6715(0x138)](_0x15df4b){const _0x20b827=a119_0x4d6715;try{const _0x3445e4=path_1['default']['join'](_0x15df4b,this[_0x20b827(0x12e)]);await sfdx_1['SFDX'][_0x20b827(0x139)](_0x15df4b),await sfdx_1[_0x20b827(0x174)][_0x20b827(0x129)](_0x3445e4),await sfdx_1[_0x20b827(0x174)][_0x20b827(0x11c)](_0x3445e4,_0x15df4b),await shell_internal_1[_0x20b827(0x12a)][_0x20b827(0x128)](_0x20b827(0x162)+_0x3445e4),await shell_internal_1[_0x20b827(0x12a)]['exec'](_0x20b827(0x149)+path_1['default'][_0x20b827(0x170)](_0x15df4b,_0x20b827(0x173)));}catch(_0x2a6d14){throw new internal_server_error_1[(_0x20b827(0x136))](_0x2a6d14);}}async[a119_0x4d6715(0x13d)](_0x35e8b3,_0x464d99){const _0x53873b=a119_0x4d6715;this[_0x53873b(0x15d)](_0x53873b(0x116));const _0x22b481=typedi_1['default'][_0x53873b(0x16c)](flosum_retriever_util_1[_0x53873b(0x153)]);_0x22b481['setComponentIds'](_0x464d99);const _0x3fa1e8=new mdapi_1[(_0x53873b(0x157))](),_0x47085f=await _0x22b481[_0x53873b(0x127)]();let _0xe49a10=0x0;while(_0x47085f[_0x53873b(0x114)]){const _0x1bfa3d=await _0x3fa1e8[_0x53873b(0x13a)](_0x47085f[_0x53873b(0x113)](0x0,this[_0x53873b(0x156)])[_0x53873b(0x126)](_0x3b0510=>({'name':_0x3b0510[_0x53873b(0x10f)],'type':_0x3b0510[_0x53873b(0x118)],'body':_0x3b0510['body']}))),_0x53aa00=new writer_1[(_0x53873b(0x164))](_0x1bfa3d,path_1['default']['join'](_0x35e8b3,this[_0x53873b(0x12e)]));await _0x53aa00['start'](),_0xe49a10+=_0x1bfa3d[_0x53873b(0x114)],logger[_0x53873b(0x15a)](_0x53873b(0x171)+_0xe49a10+'/'+_0x464d99[_0x53873b(0x114)]+'\x20components'),this[_0x53873b(0x15d)](_0x53873b(0x171)+_0xe49a10+'/'+_0x464d99[_0x53873b(0x114)]+'\x20components');}this[_0x53873b(0x125)][_0x53873b(0x13c)][_0x53873b(0x138)]&&await this[_0x53873b(0x138)](_0x35e8b3);}async['exec'](_0x2e7fbd){const _0x22d866=a119_0x4d6715,_0x477a36=Date[_0x22d866(0x14f)](),{commitId:_0x1f2dc9,branch:_0x10144c,attachmentId:_0x250411,message:_0x2ed6c9}=this[_0x22d866(0x125)]['data'];logger[_0x22d866(0x177)]('connect\x20to\x20salesforce'),await this['salesforceService']['connect'](),this[_0x22d866(0x15d)]('Recieved\x20commit\x20to\x20proceed.\x20Branch\x20-\x20'+_0x10144c);const _0x537c81=[];try{const _0x1ba9e7=await this[_0x22d866(0x11d)]['retrieveAttachment'](_0x250411);_0x537c81[_0x22d866(0x131)](..._0x1ba9e7[_0x22d866(0x166)]('\x20')[_0x22d866(0x126)](_0x4c090b=>_0x4c090b[_0x22d866(0x15f)]()));const {gitUrl:_0x5bea63}=_0x2e7fbd,_0xfcf76=_0x5bea63[_0x22d866(0x10e)](/https\:\/\/(.+@)?/,_0x22d866(0x175)+this[_0x22d866(0x160)]+'@');logger[_0x22d866(0x177)]('clonning\x20repository\x20from\x20%s',_0xfcf76),this[_0x22d866(0x15d)](_0x22d866(0x144));const _0x326fe3=await git_internal_1[_0x22d866(0x165)]['clone'](_0xfcf76,_0x1f2dc9,_0x10144c),{name:_0x4fbf35,email:_0x172897}=this['currentJob'][_0x22d866(0x13c)]['user'];logger['info'](_0x22d866(0x150),_0x4fbf35,_0x172897),await _0x326fe3[_0x22d866(0x152)](_0x4fbf35,_0x172897),logger[_0x22d866(0x177)](_0x22d866(0x15b)),await this[_0x22d866(0x13d)](_0x326fe3['baseDir'],_0x537c81),logger[_0x22d866(0x177)](_0x22d866(0x140)),await _0x326fe3[_0x22d866(0x14d)]('.'),logger[_0x22d866(0x177)]('commit\x20files\x20with\x20message\x20\x22%s\x22',_0x2ed6c9);try{await _0x326fe3[_0x22d866(0x142)](_0x2ed6c9);}catch(_0x43bf46){let _0x28a7c4=0x0;do{_0x28a7c4++;const _0x25361c=await _0x326fe3[_0x22d866(0x10a)]()[_0x22d866(0x16e)](_0x43549a=>_0x43549a[_0x22d866(0x137)]||_0x43549a);if(_0x25361c[_0x22d866(0x11e)]('nothing\x20to\x20commit')){_0x28a7c4=0x0;break;}await utils_1[_0x22d866(0x10c)](this[_0x22d866(0x121)]);}while(_0x28a7c4<this['MAX_GIT_STATUS_CHECK']);if(_0x28a7c4===this['MAX_GIT_STATUS_CHECK'])throw _0x43bf46;}this[_0x22d866(0x15d)](_0x22d866(0x155)),logger[_0x22d866(0x177)]('push\x20commit\x20to\x20branch\x20\x22%s\x22',_0x10144c),await _0x326fe3[_0x22d866(0x131)](_0x10144c),logger[_0x22d866(0x177)](_0x22d866(0x158)+_0x326fe3[_0x22d866(0x122)]),await shell_internal_1['Shell'][_0x22d866(0x128)](_0x22d866(0x162)+_0x326fe3[_0x22d866(0x122)]),logger[_0x22d866(0x177)](_0x22d866(0x178),_0x1f2dc9),await this[_0x22d866(0x11d)][_0x22d866(0x12c)](_0x1f2dc9);}catch(_0x2df623){this['sfLogger'](_0x22d866(0x163)+(_0x2df623[_0x22d866(0x137)]||_0x2df623)),console[_0x22d866(0x15a)]({'error':_0x2df623});}finally{logger[_0x22d866(0x177)](_0x22d866(0x167),_0x1f2dc9,Date[_0x22d866(0x14f)]()-_0x477a36,_0x537c81[_0x22d866(0x114)]),this[_0x22d866(0x125)]=undefined;}}async['run'](_0x473548){const _0x3408ad=a119_0x4d6715;if(this[_0x3408ad(0x125)])throw new bad_request_error_1[(_0x3408ad(0x134))](errors_1['ERR_JOB_IS_NOT_DONE']);try{this['currentJob']=_0x473548;const _0x55c96d=typedi_1['default'][_0x3408ad(0x16c)](git_provider_manager_1[_0x3408ad(0x112)])['getRepoService'](),_0x29e756=await _0x55c96d[_0x3408ad(0x147)](_0x473548['data']['repo']);await _0x29e756[_0x3408ad(0x12d)][_0x3408ad(0x147)](_0x473548['data'][_0x3408ad(0x12f)]),this[_0x3408ad(0x128)](_0x29e756);}catch(_0x5f232e){this[_0x3408ad(0x125)]=undefined;throw _0x5f232e;}}};FlosumCommitJob=__decorate([typedi_1['Service'](),__metadata('design:paramtypes',[auth_settings_service_1[a119_0x4d6715(0x15c)],salesforce_service_1[a119_0x4d6715(0x115)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;