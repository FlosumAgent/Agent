const a146_0x409616=a146_0x22e1;(function(_0x44ce5c,_0x4d8e0c){const _0x34adb9=a146_0x22e1,_0x99a0a9=_0x44ce5c();while(!![]){try{const _0x46d842=-parseInt(_0x34adb9(0xbd))/0x1*(parseInt(_0x34adb9(0xe8))/0x2)+-parseInt(_0x34adb9(0xb4))/0x3*(-parseInt(_0x34adb9(0xde))/0x4)+-parseInt(_0x34adb9(0x106))/0x5+-parseInt(_0x34adb9(0xce))/0x6*(parseInt(_0x34adb9(0xd4))/0x7)+-parseInt(_0x34adb9(0xf2))/0x8+parseInt(_0x34adb9(0x10a))/0x9*(parseInt(_0x34adb9(0xb5))/0xa)+-parseInt(_0x34adb9(0xd3))/0xb*(-parseInt(_0x34adb9(0xba))/0xc);if(_0x46d842===_0x4d8e0c)break;else _0x99a0a9['push'](_0x99a0a9['shift']());}catch(_0x398203){_0x99a0a9['push'](_0x99a0a9['shift']());}}}(a146_0x1863,0x4e2f0));const a146_0x5cdfdb=function(){let _0x94191f=!![];return function(_0x4f9eba,_0x25599a){const _0x47e67f=_0x94191f?function(){const _0x2c67a0=a146_0x22e1;if(_0x25599a){const _0x4d9c82=_0x25599a[_0x2c67a0(0xf5)](_0x4f9eba,arguments);return _0x25599a=null,_0x4d9c82;}}:function(){};return _0x94191f=![],_0x47e67f;};}(),a146_0x4b84e8=a146_0x5cdfdb(this,function(){const _0xfb3027=a146_0x22e1;return a146_0x4b84e8['toString']()[_0xfb3027(0xc4)](_0xfb3027(0xb0))[_0xfb3027(0x110)]()[_0xfb3027(0x109)](a146_0x4b84e8)[_0xfb3027(0xc4)]('(((.+)+)+)+$');});a146_0x4b84e8();'use strict';var __decorate=this&&this['__decorate']||function(_0x50dca0,_0x1e57fd,_0x595b73,_0x2c103b){const _0x5a0cc5=a146_0x22e1;var _0x4b1d5b=arguments[_0x5a0cc5(0xfc)],_0x114294=_0x4b1d5b<0x3?_0x1e57fd:_0x2c103b===null?_0x2c103b=Object[_0x5a0cc5(0xd5)](_0x1e57fd,_0x595b73):_0x2c103b,_0xca5818;if(typeof Reflect===_0x5a0cc5(0x10b)&&typeof Reflect[_0x5a0cc5(0xd6)]===_0x5a0cc5(0xfe))_0x114294=Reflect[_0x5a0cc5(0xd6)](_0x50dca0,_0x1e57fd,_0x595b73,_0x2c103b);else{for(var _0x4eb903=_0x50dca0[_0x5a0cc5(0xfc)]-0x1;_0x4eb903>=0x0;_0x4eb903--)if(_0xca5818=_0x50dca0[_0x4eb903])_0x114294=(_0x4b1d5b<0x3?_0xca5818(_0x114294):_0x4b1d5b>0x3?_0xca5818(_0x1e57fd,_0x595b73,_0x114294):_0xca5818(_0x1e57fd,_0x595b73))||_0x114294;}return _0x4b1d5b>0x3&&_0x114294&&Object['defineProperty'](_0x1e57fd,_0x595b73,_0x114294),_0x114294;},__metadata=this&&this['__metadata']||function(_0xced857,_0x112691){const _0x478236=a146_0x22e1;if(typeof Reflect===_0x478236(0x10b)&&typeof Reflect[_0x478236(0xd2)]===_0x478236(0xfe))return Reflect[_0x478236(0xd2)](_0xced857,_0x112691);};Object[a146_0x409616(0xb2)](exports,a146_0x409616(0xbe),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a146_0x409616(0xe6)),salesforce_service_1=require(a146_0x409616(0xe0)),git_provider_manager_1=require(a146_0x409616(0xbf)),typedi_1=require(a146_0x409616(0xe4)),errors_1=require(a146_0x409616(0xe5)),bad_request_error_1=require(a146_0x409616(0xcd)),salesforce_retriever_service_1=require(a146_0x409616(0xf8)),salesforce_sync_service_1=require(a146_0x409616(0x10e)),commit_components_dto_1=require(a146_0x409616(0xaf)),commit_components_job_1=require(a146_0x409616(0xec)),logger=new core_1[(a146_0x409616(0x10f))](a146_0x409616(0xdd));function a146_0x22e1(_0x238368,_0x1e5d8d){const _0x1438dd=a146_0x1863();return a146_0x22e1=function(_0x4b84e8,_0x5cdfdb){_0x4b84e8=_0x4b84e8-0xae;let _0x186358=_0x1438dd[_0x4b84e8];return _0x186358;},a146_0x22e1(_0x238368,_0x1e5d8d);}let FlosumCommitJob=class FlosumCommitJob{constructor(_0x5c26cc,_0x35c047,_0x51b5d4,_0x131c39){const _0xce0210=a146_0x409616;this[_0xce0210(0xc5)]=_0x5c26cc,this[_0xce0210(0xf7)]=_0x35c047,this[_0xce0210(0xd1)]=_0x51b5d4,this['gitManager']=_0x131c39,this[_0xce0210(0xb8)]=this[_0xce0210(0xb9)][_0xce0210(0xc8)]();}[a146_0x409616(0xc7)](_0x35111f){const _0x340eef=a146_0x409616;return this[_0x340eef(0xff)][_0x340eef(0xc7)](_0x340eef(0xdc)+this[_0x340eef(0xb9)][_0x340eef(0xe3)][_0x340eef(0xf9)]()+']\x20[Repository:\x20'+this['repository'][_0x340eef(0x108)]+_0x340eef(0xc2)+this[_0x340eef(0x111)][_0x340eef(0x108)]+']\x20'+_0x35111f);}async[a146_0x409616(0xb1)](){const _0x4081f5=a146_0x409616;try{if(this[_0x4081f5(0xf3)][_0x4081f5(0x105)])this[_0x4081f5(0xca)]=await this[_0x4081f5(0xd1)][_0x4081f5(0xfd)](this[_0x4081f5(0xf3)]['syncRepositoryId']);else this['commitData'][_0x4081f5(0x10d)]&&(this[_0x4081f5(0xca)]=await this['salesforceSync']['getBranchRecord'](this[_0x4081f5(0xf3)][_0x4081f5(0x10d)]));}catch(_0x15919e){throw new bad_request_error_1['BadRequestError'](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async[a146_0x409616(0xc3)](){const _0x2182a3=a146_0x409616;if(!this[_0x2182a3(0xf3)]['commitAttachmentId'])return[];const _0x55d612=await this[_0x2182a3(0xc5)]['retrieveAttachment'](this[_0x2182a3(0xf3)][_0x2182a3(0xc9)])[_0x2182a3(0xe1)](_0x2f5487=>_0x2f5487['split']('\x20')[_0x2182a3(0xfb)](_0x2b49c6=>_0x2b49c6['trim']())),_0xe6a9b8=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x2182a3(0xc5)]),_0x3511de=await _0xe6a9b8[_0x2182a3(0x104)](_0x55d612);return _0x3511de;}async[a146_0x409616(0x103)](){const _0xd7abc9=a146_0x409616;if(!this[_0xd7abc9(0xf3)][_0xd7abc9(0xf0)])return[];const _0x3fdd2c=await this[_0xd7abc9(0xc5)][_0xd7abc9(0xef)](this[_0xd7abc9(0xf3)][_0xd7abc9(0xf0)]);return _0x3fdd2c;}async[a146_0x409616(0x102)](){const _0x59c52b=a146_0x409616,_0x28bddf=new commit_components_dto_1[(_0x59c52b(0xda))](),[_0x2ee05b,_0x590577]=await Promise[_0x59c52b(0xb7)]([this[_0x59c52b(0xc3)](),this[_0x59c52b(0x103)]()]);return _0x28bddf[_0x59c52b(0xf1)]=this['commitData'][_0x59c52b(0xf1)],_0x28bddf[_0x59c52b(0xb3)]=this['commitData'][_0x59c52b(0xb3)],_0x28bddf[_0x59c52b(0xd7)]={'writed':_0x2ee05b,'deleted':_0x590577},_0x28bddf[_0x59c52b(0x100)]=this['commitData'][_0x59c52b(0x100)],_0x28bddf[_0x59c52b(0xe9)]=this[_0x59c52b(0xd0)],_0x28bddf[_0x59c52b(0x111)]=this[_0x59c52b(0x111)],_0x28bddf;}async['updateLastCommit'](_0x4f90bd=![]){const _0xa7548a=a146_0x409616;if(_0x4f90bd)await this[_0xa7548a(0xd1)]['updateRemoteState'](this[_0xa7548a(0xca)],{});else{const _0x4b6d5f=await this[_0xa7548a(0xd0)][_0xa7548a(0xeb)]['getOne'](this['branch']['name']);this[_0xa7548a(0xc7)](_0xa7548a(0xfa));const _0x449c6f={[this['repository'][_0xa7548a(0xed)]]:{'lastCommit':_0x4b6d5f[_0xa7548a(0x101)]}};await this[_0xa7548a(0xd1)][_0xa7548a(0xf6)](this[_0xa7548a(0xca)],_0x449c6f);}}async['exec'](){const _0x70baa=a146_0x409616,_0x26b119=await this['getCommitDto']();this[_0x70baa(0xf7)][_0x70baa(0xff)]=this['logger'],await this[_0x70baa(0xd1)][_0x70baa(0xc0)](this[_0x70baa(0xca)],_0x70baa(0xbb)),await this['commitJob'][_0x70baa(0x104)](_0x26b119),await this[_0x70baa(0x10c)](),this[_0x70baa(0xf3)][_0x70baa(0xc9)]&&await this[_0x70baa(0xc5)]['deleteAttachment'](this[_0x70baa(0xf3)][_0x70baa(0xc9)]),this[_0x70baa(0xf3)][_0x70baa(0xf0)]&&await this[_0x70baa(0xc5)]['deleteAttachment'](this[_0x70baa(0xf3)][_0x70baa(0xf0)]),await this[_0x70baa(0xd1)][_0x70baa(0xc0)](this['repositoryData'],'Completed');}async['handleCommitJobError'](_0x33144c){const _0x231f1c=a146_0x409616;try{this['logger'][_0x231f1c(0xc7)](_0x231f1c(0xdf)+_0x33144c),await this[_0x231f1c(0xff)]['send'](),await this[_0x231f1c(0x10c)](!![]),await this[_0x231f1c(0xd1)][_0x231f1c(0xc0)](this[_0x231f1c(0xca)],_0x231f1c(0xd8));}catch(_0xfbfc2c){logger[_0x231f1c(0xb6)](_0xfbfc2c);}}async[a146_0x409616(0x104)](_0x385d47,_0x59eb9e){const _0xca8c90=a146_0x409616;try{this['commitData']=_0x385d47,this[_0xca8c90(0xc5)][_0xca8c90(0xf4)](_0x59eb9e),this['logger']=this['salesforceService'][_0xca8c90(0xcf)](),await this[_0xca8c90(0xb1)]();if(!this['repositoryData'])throw new bad_request_error_1[(_0xca8c90(0xdb))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);this['repository']=await this['repoService'][_0xca8c90(0x107)](this[_0xca8c90(0xca)][_0xca8c90(0xbc)]),this['branch']=await this[_0xca8c90(0xd0)][_0xca8c90(0xeb)][_0xca8c90(0x107)](this['repositoryData'][_0xca8c90(0xc1)]),this['log'](_0xca8c90(0xd9)),this[_0xca8c90(0xe7)]()['catch'](_0x8ef13d=>this[_0xca8c90(0xc6)](_0x8ef13d));}catch(_0x864140){this['commitData']=undefined,logger[_0xca8c90(0xb6)](_0x864140);throw _0x864140;}}};function a146_0x1863(){const _0x3a9dc9=['SalesforceService','SalesforceSyncService','../../../core/errors/bad-request.error','702cvvDVm','getLogger','repository','salesforceSync','metadata','944526PtJPms','23093uXToaJ','getOwnPropertyDescriptor','decorate','components','Error','[INFO]\x20Start\x20commit\x20job','CommitComponentsDto','BadRequestError','[COMMIT]\x20[','flosum-commit-job','988VYjiDt','[ERROR]\x20','../../salesforce/services/salesforce.service','then','design:paramtypes','provider','typedi','../../../constants/errors','../../../core','exec','5054bBhrYo','repo','Service','branches','./commit-components.job','gitUrl','CommitComponentsJob','retrieveAttachment','deleteAttachmentId','message','98136OsCVYp','commitData','setLoggerId','apply','updateRemoteState','commitJob','../../salesforce/services/salesforce-retriever.service','toUpperCase','[INFO]\x20Update\x20remote\x20state.','map','length','getRepositoryRecord','function','logger','convertToSFDX','sha','getCommitDto','getComponentsToDelete','run','syncRepositoryId','743745GwggZu','getOne','name','constructor','99IHlbyh','object','updateLastCommit','syncBranchId','../../salesforce/services/salesforce-sync.service','Logger','toString','branch','FlosumCommitJob','GitProviderManager','../dto/commit-components.dto','(((.+)+)+)+$','fetchRepositoryData','defineProperty','user','723jUCEKB','406010uuyonL','error','all','repoService','gitManager','60YgAnqP','In\x20Progress','repositoryName','27Eayffv','__esModule','../../shared/git-provider.manager','setStatus','branchName',']\x20[Branch:\x20','getComponentsToWrite','search','salesforceService','handleCommitJobError','log','getRepoService','commitAttachmentId','repositoryData'];a146_0x1863=function(){return _0x3a9dc9;};return a146_0x1863();}FlosumCommitJob=__decorate([(0x0,typedi_1[a146_0x409616(0xea)])({'transient':!![]}),__metadata(a146_0x409616(0xe2),[salesforce_service_1[a146_0x409616(0xcb)],commit_components_job_1[a146_0x409616(0xee)],salesforce_sync_service_1[a146_0x409616(0xcc)],git_provider_manager_1[a146_0x409616(0xae)]])],FlosumCommitJob),exports[a146_0x409616(0x112)]=FlosumCommitJob;