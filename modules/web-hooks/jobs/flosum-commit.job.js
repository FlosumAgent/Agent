const a174_0x207a3c=a174_0x1ec3;(function(_0x5d879c,_0x5f27cf){const _0x204455=a174_0x1ec3,_0x1336b5=_0x5d879c();while(!![]){try{const _0x31e8ac=parseInt(_0x204455(0x23d))/0x1*(-parseInt(_0x204455(0x230))/0x2)+parseInt(_0x204455(0x222))/0x3*(parseInt(_0x204455(0x203))/0x4)+parseInt(_0x204455(0x1e0))/0x5*(-parseInt(_0x204455(0x20e))/0x6)+parseInt(_0x204455(0x214))/0x7+-parseInt(_0x204455(0x1e5))/0x8*(-parseInt(_0x204455(0x216))/0x9)+-parseInt(_0x204455(0x229))/0xa*(-parseInt(_0x204455(0x227))/0xb)+-parseInt(_0x204455(0x22f))/0xc;if(_0x31e8ac===_0x5f27cf)break;else _0x1336b5['push'](_0x1336b5['shift']());}catch(_0x570665){_0x1336b5['push'](_0x1336b5['shift']());}}}(a174_0x1de5,0x8f632));const a174_0xe45728=function(){let _0x460495=!![];return function(_0x5dc911,_0x1f9655){const _0x7e39a=_0x460495?function(){const _0x26a92a=a174_0x1ec3;if(_0x1f9655){const _0x379bde=_0x1f9655[_0x26a92a(0x1f8)](_0x5dc911,arguments);return _0x1f9655=null,_0x379bde;}}:function(){};return _0x460495=![],_0x7e39a;};}(),a174_0x29c131=a174_0xe45728(this,function(){const _0x2f5cfb=a174_0x1ec3;return a174_0x29c131[_0x2f5cfb(0x1e3)]()[_0x2f5cfb(0x1ec)](_0x2f5cfb(0x21e))[_0x2f5cfb(0x1e3)]()[_0x2f5cfb(0x1f1)](a174_0x29c131)[_0x2f5cfb(0x1ec)](_0x2f5cfb(0x21e));});a174_0x29c131();'use strict';var __decorate=this&&this[a174_0x207a3c(0x206)]||function(_0x2e0934,_0x423fe8,_0x164cc8,_0x5a7bec){const _0x579fa3=a174_0x207a3c;var _0x27e4d2=arguments['length'],_0x27a19d=_0x27e4d2<0x3?_0x423fe8:_0x5a7bec===null?_0x5a7bec=Object[_0x579fa3(0x21b)](_0x423fe8,_0x164cc8):_0x5a7bec,_0x26ec5e;if(typeof Reflect==='object'&&typeof Reflect[_0x579fa3(0x1e7)]===_0x579fa3(0x20b))_0x27a19d=Reflect[_0x579fa3(0x1e7)](_0x2e0934,_0x423fe8,_0x164cc8,_0x5a7bec);else{for(var _0x18da52=_0x2e0934[_0x579fa3(0x23c)]-0x1;_0x18da52>=0x0;_0x18da52--)if(_0x26ec5e=_0x2e0934[_0x18da52])_0x27a19d=(_0x27e4d2<0x3?_0x26ec5e(_0x27a19d):_0x27e4d2>0x3?_0x26ec5e(_0x423fe8,_0x164cc8,_0x27a19d):_0x26ec5e(_0x423fe8,_0x164cc8))||_0x27a19d;}return _0x27e4d2>0x3&&_0x27a19d&&Object[_0x579fa3(0x234)](_0x423fe8,_0x164cc8,_0x27a19d),_0x27a19d;},__metadata=this&&this[a174_0x207a3c(0x1e8)]||function(_0x2e193f,_0x4ebb6a){const _0x278391=a174_0x207a3c;if(typeof Reflect===_0x278391(0x204)&&typeof Reflect[_0x278391(0x205)]===_0x278391(0x20b))return Reflect['metadata'](_0x2e193f,_0x4ebb6a);},FlosumCommitJob_1;function a174_0x1ec3(_0x4e36f8,_0x571260){const _0x2a3630=a174_0x1de5();return a174_0x1ec3=function(_0x29c131,_0xe45728){_0x29c131=_0x29c131-0x1dd;let _0x1de588=_0x2a3630[_0x29c131];return _0x1de588;},a174_0x1ec3(_0x4e36f8,_0x571260);}Object[a174_0x207a3c(0x234)](exports,a174_0x207a3c(0x1f4),{'value':!![]}),exports[a174_0x207a3c(0x22d)]=void 0x0;function a174_0x1de5(){const _0x51729e=['gitUrl','name','77GPzdDD','deleteAttachmentId','1508600BSCtiP','components','send','branch','FlosumCommitJob','salesforceSync','9593184fvNOBW','62YoiHdw','ERR_UNKNOWN_SYNC_RECORD_ID','design:paramtypes','gitManager','defineProperty','error','\x20[COMMIT]','CommitComponentsDto','repoService','commitAttachmentId','fetchRepositoryData','getRepositoryRecord','length','26797cVoofo','getLoggerId','log','branches','../dto/commit-components.dto','sha','repo','126275qyuKPy','updateLastCommit','repository','toString','provider','55776pgMkBv','In\x20Progress','decorate','__metadata','[INFO]\x20Start\x20commit\x20job','then','repositoryName','search','repositoryData','getComponentsToWrite','getBranchRecord','catch','constructor','syncBranchId','setStatus','__esModule','branchName','../../../core/errors/bad-request.error','logger','apply','commitData','SalesforceSyncService','split','../../salesforce/services/salesforce.service','SalesforceLogger2','../../shared/git-provider.manager','deleteAttachment','sfLogger',']\x20[Repository:\x20','retrieveAttachment','49472lgLPYW','object','metadata','__decorate','salesforceService','user','../../../core','message','function','updateRemoteState','Service','90CVWYMk','BadRequestError','ERR_INVALID_SYNC_RECORD_ID','syncRepositoryId','convertToSFDX','../../salesforce/services/salesforce-logger-v2.service','6482742dYLmKN','GitProviderManager','234uIeYUX','[INFO]\x20Update\x20remote\x20state.','run','../../../constants/errors','getCommitDto','getOwnPropertyDescriptor','getComponentsToDelete','handleCommitJobError','(((.+)+)+)+$','commitJob',']\x20[Branch:\x20','getRepoService','105XeFPzq','all','exec'];a174_0x1de5=function(){return _0x51729e;};return a174_0x1de5();}const core_1=require(a174_0x207a3c(0x209)),salesforce_logger_v2_service_1=require(a174_0x207a3c(0x213)),salesforce_service_1=require(a174_0x207a3c(0x1fc)),git_provider_manager_1=require(a174_0x207a3c(0x1fe)),typedi_1=require('typedi'),errors_1=require(a174_0x207a3c(0x219)),bad_request_error_1=require(a174_0x207a3c(0x1f6)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require(a174_0x207a3c(0x1dd)),commit_components_job_1=require('./commit-components.job');let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x13739e,_0x43ffdd,_0x26a437,_0x212036){const _0x439b5d=a174_0x207a3c;this[_0x439b5d(0x207)]=_0x13739e,this[_0x439b5d(0x21f)]=_0x43ffdd,this[_0x439b5d(0x22e)]=_0x26a437,this['gitManager']=_0x212036,this['repoService']=this[_0x439b5d(0x233)][_0x439b5d(0x221)](),this['logger']=new core_1['Logger'](FlosumCommitJob_1[_0x439b5d(0x226)]);}async[a174_0x207a3c(0x23a)](){const _0x23558b=a174_0x207a3c;try{if(this[_0x23558b(0x1f9)][_0x23558b(0x211)])this[_0x23558b(0x1ed)]=await this[_0x23558b(0x22e)][_0x23558b(0x23b)](this[_0x23558b(0x1f9)][_0x23558b(0x211)]);else this['commitData']['syncBranchId']&&(this['repositoryData']=await this[_0x23558b(0x22e)][_0x23558b(0x1ef)](this[_0x23558b(0x1f9)][_0x23558b(0x1f2)]));}catch(_0x57288e){throw new bad_request_error_1[(_0x23558b(0x20f))](errors_1[_0x23558b(0x210)]);}}async[a174_0x207a3c(0x1ee)](){const _0x5ec754=a174_0x207a3c;if(!this['commitData'][_0x5ec754(0x239)])return[];const _0x5dd9e1=await this[_0x5ec754(0x207)][_0x5ec754(0x202)](this[_0x5ec754(0x1f9)][_0x5ec754(0x239)])[_0x5ec754(0x1ea)](_0x4edbe2=>_0x4edbe2[_0x5ec754(0x1fb)]('\x20')['map'](_0x1c4a82=>_0x1c4a82['trim']())),_0x4ec066=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x5ec754(0x207)]),_0x53a170=await _0x4ec066[_0x5ec754(0x218)](_0x5dd9e1);return _0x53a170;}async[a174_0x207a3c(0x21c)](){const _0x26d8bd=a174_0x207a3c;if(!this[_0x26d8bd(0x1f9)][_0x26d8bd(0x228)])return[];const _0x2e367d=await this[_0x26d8bd(0x207)][_0x26d8bd(0x202)](this[_0x26d8bd(0x1f9)][_0x26d8bd(0x228)]);return _0x2e367d;}async[a174_0x207a3c(0x21a)](){const _0x37efc7=a174_0x207a3c,_0x44a05b=new commit_components_dto_1[(_0x37efc7(0x237))](),[_0x14a40c,_0xc72624]=await Promise[_0x37efc7(0x223)]([this[_0x37efc7(0x1ee)](),this[_0x37efc7(0x21c)]()]);return _0x44a05b[_0x37efc7(0x20a)]=this[_0x37efc7(0x1f9)]['message'],_0x44a05b['user']=this[_0x37efc7(0x1f9)][_0x37efc7(0x208)],_0x44a05b[_0x37efc7(0x22a)]={'writed':_0x14a40c,'deleted':_0xc72624},_0x44a05b['convertToSFDX']=this[_0x37efc7(0x1f9)][_0x37efc7(0x212)],_0x44a05b[_0x37efc7(0x1df)]=this['repository'],_0x44a05b['branch']=this[_0x37efc7(0x22c)],_0x44a05b['provider']=this[_0x37efc7(0x1e4)],_0x44a05b;}async['updateLastCommit'](_0x81e3d3=![]){const _0x541ac6=a174_0x207a3c;if(_0x81e3d3)await this['salesforceSync']['updateRemoteState'](this[_0x541ac6(0x1ed)],{});else{const _0x1b180c=await this['repository'][_0x541ac6(0x240)]['getOne'](this[_0x541ac6(0x22c)]['name']);this[_0x541ac6(0x200)][_0x541ac6(0x23f)](_0x541ac6(0x217));const _0xb6dc6={[this[_0x541ac6(0x1e2)][_0x541ac6(0x225)]]:{'lastCommit':_0x1b180c[_0x541ac6(0x1de)]}};await this[_0x541ac6(0x22e)][_0x541ac6(0x20c)](this[_0x541ac6(0x1ed)],_0xb6dc6);}}async[a174_0x207a3c(0x224)](){const _0xf875f4=a174_0x207a3c,_0xcfd8d8=await this[_0xf875f4(0x21a)]();await this[_0xf875f4(0x22e)][_0xf875f4(0x1f3)](this[_0xf875f4(0x1ed)],_0xf875f4(0x1e6)),await this[_0xf875f4(0x21f)][_0xf875f4(0x218)](_0xcfd8d8,this[_0xf875f4(0x200)]),await this[_0xf875f4(0x1e1)](),this[_0xf875f4(0x1f9)][_0xf875f4(0x239)]&&await this['salesforceService'][_0xf875f4(0x1ff)](this[_0xf875f4(0x1f9)][_0xf875f4(0x239)]),this['commitData']['deleteAttachmentId']&&await this[_0xf875f4(0x207)]['deleteAttachment'](this[_0xf875f4(0x1f9)]['deleteAttachmentId']),await this[_0xf875f4(0x22e)][_0xf875f4(0x1f3)](this[_0xf875f4(0x1ed)],'Completed');}async[a174_0x207a3c(0x21d)](_0x126e54){const _0x44009c=a174_0x207a3c;try{this[_0x44009c(0x200)][_0x44009c(0x23f)]('[ERROR]\x20'+_0x126e54),await this[_0x44009c(0x200)][_0x44009c(0x22b)](),await this[_0x44009c(0x1e1)](!![]),await this[_0x44009c(0x22e)]['setStatus'](this[_0x44009c(0x1ed)],'Error');}catch(_0x4cffa5){this[_0x44009c(0x1f7)][_0x44009c(0x235)](_0x4cffa5);}}async[a174_0x207a3c(0x218)](_0x38302e,_0x585ae6,_0x9b4669){const _0x307bb7=a174_0x207a3c;try{this[_0x307bb7(0x1f9)]=_0x38302e,this['provider']=_0x9b4669,await this['fetchRepositoryData'](),this[_0x307bb7(0x200)]=new salesforce_logger_v2_service_1[(_0x307bb7(0x1fd))](_0x585ae6[_0x307bb7(0x23e)](),(_0x585ae6['getPrefix']()||'[FLOSUM\x20->\x20GIT]\x20['+_0x9b4669['toUpperCase']()+_0x307bb7(0x201)+this[_0x307bb7(0x1ed)][_0x307bb7(0x1eb)]+_0x307bb7(0x220)+this[_0x307bb7(0x1ed)][_0x307bb7(0x1f5)]+']')+_0x307bb7(0x236));if(!this[_0x307bb7(0x1ed)])throw new bad_request_error_1[(_0x307bb7(0x20f))](errors_1[_0x307bb7(0x231)]);this[_0x307bb7(0x1e2)]=await this[_0x307bb7(0x238)]['getOne'](this[_0x307bb7(0x1ed)][_0x307bb7(0x1eb)]),this['branch']=await this['repository'][_0x307bb7(0x240)]['getOne'](this[_0x307bb7(0x1ed)][_0x307bb7(0x1f5)]),this[_0x307bb7(0x200)][_0x307bb7(0x23f)](_0x307bb7(0x1e9)),this[_0x307bb7(0x224)]()[_0x307bb7(0x1f0)](_0x948fab=>this['handleCommitJobError'](_0x948fab));}catch(_0x58850a){this['commitData']=undefined,this[_0x307bb7(0x1f7)][_0x307bb7(0x235)](_0x58850a);throw _0x58850a;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1[a174_0x207a3c(0x20d)]({'transient':!![]}),__metadata(a174_0x207a3c(0x232),[salesforce_service_1['SalesforceService'],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a174_0x207a3c(0x1fa)],git_provider_manager_1[a174_0x207a3c(0x215)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;