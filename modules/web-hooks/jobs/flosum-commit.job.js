const a147_0x5202de=a147_0x22c2;(function(_0x4ae2b9,_0xad29f8){const _0x3fb767=a147_0x22c2,_0x47b2e3=_0x4ae2b9();while(!![]){try{const _0x2419ee=parseInt(_0x3fb767(0xad))/0x1+parseInt(_0x3fb767(0xc1))/0x2+-parseInt(_0x3fb767(0xb6))/0x3*(-parseInt(_0x3fb767(0xc3))/0x4)+-parseInt(_0x3fb767(0xaf))/0x5+parseInt(_0x3fb767(0xb7))/0x6+-parseInt(_0x3fb767(0xae))/0x7+-parseInt(_0x3fb767(0xd7))/0x8;if(_0x2419ee===_0xad29f8)break;else _0x47b2e3['push'](_0x47b2e3['shift']());}catch(_0x3f538b){_0x47b2e3['push'](_0x47b2e3['shift']());}}}(a147_0x5b24,0xa60ab));const a147_0x379800=function(){let _0x3bb3d8=!![];return function(_0x107da1,_0x400214){const _0x17bd57=_0x3bb3d8?function(){const _0x3ce039=a147_0x22c2;if(_0x400214){const _0x4889d2=_0x400214[_0x3ce039(0x102)](_0x107da1,arguments);return _0x400214=null,_0x4889d2;}}:function(){};return _0x3bb3d8=![],_0x17bd57;};}(),a147_0x16f93e=a147_0x379800(this,function(){const _0x10bcc6=a147_0x22c2;return a147_0x16f93e[_0x10bcc6(0xc7)]()[_0x10bcc6(0xd9)](_0x10bcc6(0xbc))[_0x10bcc6(0xc7)]()['constructor'](a147_0x16f93e)['search']('(((.+)+)+)+$');});function a147_0x5b24(){const _0x46d833=['branch','../../salesforce/services/salesforce-sync.service','apply','repoService','__esModule','handleCommitJobError','getRepositoryRecord','run','Completed','trim','flosum-commit-job','gitManager','commitJob','name','1226237HwKSpI','1634759ojZQCN','1527500lmFNJU','getComponentsToWrite','updateRemoteState','setStatus','SalesforceRetrieverService','[COMMIT]\x20[','repositoryName','141wFZbUx','1320738LoZOch','exec','getComponentsToDelete','ERR_UNKNOWN_SYNC_RECORD_ID','split','(((.+)+)+)+$','metadata','GitProviderManager','salesforceService','[INFO]\x20Start\x20commit\x20job','2605730KFNGXi','sha','62188bshWYA','logger','../../../constants/errors','getCommitDto','toString','FlosumCommitJob','repositoryData','fetchRepositoryData','Logger','[ERROR]\x20','syncBranchId','deleteAttachmentId','ERR_INVALID_SYNC_RECORD_ID','error','./commit-components.job','user','defineProperty','getOne','message','design:paramtypes','18086320jNosns','retrieveAttachment','search','all','components','commitAttachmentId','../dto/commit-components.dto','deleteAttachment','commitData','map','CommitComponentsDto','salesforceSync','syncRepositoryId','setLoggerId','SalesforceSyncService','CommitComponentsJob','function',']\x20[Repository:\x20','log','../../../core','branchName','BadRequestError','updateLastCommit','Error','repository','getLogger',']\x20[Branch:\x20','length','then','In\x20Progress','typedi','[INFO]\x20Update\x20remote\x20state.','branches','__metadata','send','object','getOwnPropertyDescriptor','toUpperCase','SalesforceService','../../../core/errors/bad-request.error','decorate'];a147_0x5b24=function(){return _0x46d833;};return a147_0x5b24();}a147_0x16f93e();'use strict';var __decorate=this&&this['__decorate']||function(_0x5d7e78,_0x2d0958,_0x58ec3e,_0x12daed){const _0x399475=a147_0x22c2;var _0x251845=arguments[_0x399475(0xf2)],_0xf16cb3=_0x251845<0x3?_0x2d0958:_0x12daed===null?_0x12daed=Object[_0x399475(0xfb)](_0x2d0958,_0x58ec3e):_0x12daed,_0xb626aa;if(typeof Reflect==='object'&&typeof Reflect[_0x399475(0xff)]==='function')_0xf16cb3=Reflect[_0x399475(0xff)](_0x5d7e78,_0x2d0958,_0x58ec3e,_0x12daed);else{for(var _0x1885fb=_0x5d7e78[_0x399475(0xf2)]-0x1;_0x1885fb>=0x0;_0x1885fb--)if(_0xb626aa=_0x5d7e78[_0x1885fb])_0xf16cb3=(_0x251845<0x3?_0xb626aa(_0xf16cb3):_0x251845>0x3?_0xb626aa(_0x2d0958,_0x58ec3e,_0xf16cb3):_0xb626aa(_0x2d0958,_0x58ec3e))||_0xf16cb3;}return _0x251845>0x3&&_0xf16cb3&&Object['defineProperty'](_0x2d0958,_0x58ec3e,_0xf16cb3),_0xf16cb3;},__metadata=this&&this[a147_0x5202de(0xf8)]||function(_0x53fecf,_0x1bcdd7){const _0x5629db=a147_0x5202de;if(typeof Reflect===_0x5629db(0xfa)&&typeof Reflect[_0x5629db(0xbd)]===_0x5629db(0xe7))return Reflect['metadata'](_0x53fecf,_0x1bcdd7);};Object[a147_0x5202de(0xd3)](exports,a147_0x5202de(0x104),{'value':!![]}),exports[a147_0x5202de(0xc8)]=void 0x0;function a147_0x22c2(_0x469f2a,_0x443fec){const _0x540ed8=a147_0x5b24();return a147_0x22c2=function(_0x16f93e,_0x379800){_0x16f93e=_0x16f93e-0xa5;let _0x5b2470=_0x540ed8[_0x16f93e];return _0x5b2470;},a147_0x22c2(_0x469f2a,_0x443fec);}const core_1=require(a147_0x5202de(0xea)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require('../../shared/git-provider.manager'),typedi_1=require(a147_0x5202de(0xf5)),errors_1=require(a147_0x5202de(0xc5)),bad_request_error_1=require(a147_0x5202de(0xfe)),salesforce_retriever_service_1=require('../../salesforce/services/salesforce-retriever.service'),salesforce_sync_service_1=require(a147_0x5202de(0x101)),commit_components_dto_1=require(a147_0x5202de(0xdd)),commit_components_job_1=require(a147_0x5202de(0xd1)),logger=new core_1[(a147_0x5202de(0xcb))](a147_0x5202de(0xa9));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x5467f6,_0x6dba8,_0x3b534a,_0x52c64f){const _0xe065e7=a147_0x5202de;this['salesforceService']=_0x5467f6,this['commitJob']=_0x6dba8,this[_0xe065e7(0xe2)]=_0x3b534a,this[_0xe065e7(0xaa)]=_0x52c64f,this[_0xe065e7(0x103)]=this[_0xe065e7(0xaa)]['getRepoService']();}[a147_0x5202de(0xe9)](_0x582a63){const _0x3aae66=a147_0x5202de;return this[_0x3aae66(0xc4)][_0x3aae66(0xe9)](_0x3aae66(0xb4)+this[_0x3aae66(0xaa)]['provider'][_0x3aae66(0xfc)]()+_0x3aae66(0xe8)+this[_0x3aae66(0xef)]['name']+_0x3aae66(0xf1)+this[_0x3aae66(0x100)][_0x3aae66(0xac)]+']\x20'+_0x582a63);}async[a147_0x5202de(0xca)](){const _0x1b6fe4=a147_0x5202de;try{if(this[_0x1b6fe4(0xdf)][_0x1b6fe4(0xe3)])this['repositoryData']=await this['salesforceSync'][_0x1b6fe4(0xa5)](this['commitData'][_0x1b6fe4(0xe3)]);else this[_0x1b6fe4(0xdf)]['syncBranchId']&&(this[_0x1b6fe4(0xc9)]=await this[_0x1b6fe4(0xe2)]['getBranchRecord'](this['commitData'][_0x1b6fe4(0xcd)]));}catch(_0x5919c8){throw new bad_request_error_1[(_0x1b6fe4(0xec))](errors_1[_0x1b6fe4(0xcf)]);}}async[a147_0x5202de(0xb0)](){const _0x31d3c1=a147_0x5202de;if(!this[_0x31d3c1(0xdf)][_0x31d3c1(0xdc)])return[];const _0x4ade2e=await this[_0x31d3c1(0xbf)][_0x31d3c1(0xd8)](this[_0x31d3c1(0xdf)][_0x31d3c1(0xdc)])[_0x31d3c1(0xf3)](_0x599f37=>_0x599f37[_0x31d3c1(0xbb)]('\x20')[_0x31d3c1(0xe0)](_0xa164fb=>_0xa164fb[_0x31d3c1(0xa8)]())),_0x5c8fc1=new salesforce_retriever_service_1[(_0x31d3c1(0xb3))](this[_0x31d3c1(0xbf)]),_0x5e49d6=await _0x5c8fc1['run'](_0x4ade2e);return _0x5e49d6;}async[a147_0x5202de(0xb9)](){const _0x1e8366=a147_0x5202de;if(!this[_0x1e8366(0xdf)][_0x1e8366(0xce)])return[];const _0x23d139=await this[_0x1e8366(0xbf)][_0x1e8366(0xd8)](this['commitData']['deleteAttachmentId']);return _0x23d139;}async['getCommitDto'](){const _0xdb9101=a147_0x5202de,_0x502227=new commit_components_dto_1[(_0xdb9101(0xe1))](),[_0x570943,_0xb9f7a0]=await Promise[_0xdb9101(0xda)]([this['getComponentsToWrite'](),this[_0xdb9101(0xb9)]()]);return _0x502227['message']=this[_0xdb9101(0xdf)][_0xdb9101(0xd5)],_0x502227[_0xdb9101(0xd2)]=this[_0xdb9101(0xdf)][_0xdb9101(0xd2)],_0x502227[_0xdb9101(0xdb)]={'writed':_0x570943,'deleted':_0xb9f7a0},_0x502227['convertToSFDX']=this[_0xdb9101(0xdf)]['convertToSFDX'],_0x502227['repo']=this['repository'],_0x502227['branch']=this[_0xdb9101(0x100)],_0x502227;}async[a147_0x5202de(0xed)](_0x3837ee=![]){const _0x46dc83=a147_0x5202de;if(_0x3837ee)await this[_0x46dc83(0xe2)][_0x46dc83(0xb1)](this[_0x46dc83(0xc9)],{});else{const _0xf3e375=await this[_0x46dc83(0xef)][_0x46dc83(0xf7)][_0x46dc83(0xd4)](this[_0x46dc83(0x100)][_0x46dc83(0xac)]);this[_0x46dc83(0xe9)](_0x46dc83(0xf6));const _0x843e58={[this[_0x46dc83(0xef)]['gitUrl']]:{'lastCommit':_0xf3e375[_0x46dc83(0xc2)]}};await this['salesforceSync'][_0x46dc83(0xb1)](this['repositoryData'],_0x843e58);}}async[a147_0x5202de(0xb8)](){const _0x27a9d6=a147_0x5202de,_0x31695f=await this[_0x27a9d6(0xc6)]();this['commitJob'][_0x27a9d6(0xc4)]=this[_0x27a9d6(0xc4)],await this[_0x27a9d6(0xe2)][_0x27a9d6(0xb2)](this['repositoryData'],_0x27a9d6(0xf4)),await this[_0x27a9d6(0xab)][_0x27a9d6(0xa6)](_0x31695f),await this['updateLastCommit'](),this[_0x27a9d6(0xdf)][_0x27a9d6(0xdc)]&&await this[_0x27a9d6(0xbf)][_0x27a9d6(0xde)](this[_0x27a9d6(0xdf)]['commitAttachmentId']),this[_0x27a9d6(0xdf)][_0x27a9d6(0xce)]&&await this['salesforceService'][_0x27a9d6(0xde)](this['commitData'][_0x27a9d6(0xce)]),await this['salesforceSync'][_0x27a9d6(0xb2)](this[_0x27a9d6(0xc9)],_0x27a9d6(0xa7));}async['handleCommitJobError'](_0x5988cb){const _0x2f0521=a147_0x5202de;try{this['logger']['log'](_0x2f0521(0xcc)+_0x5988cb),await this[_0x2f0521(0xc4)][_0x2f0521(0xf9)](),await this[_0x2f0521(0xed)](!![]),await this['salesforceSync'][_0x2f0521(0xb2)](this[_0x2f0521(0xc9)],_0x2f0521(0xee));}catch(_0x50d842){logger['error'](_0x50d842);}}async['run'](_0x224920,_0x2b9245){const _0x26c704=a147_0x5202de;try{this[_0x26c704(0xdf)]=_0x224920,this['salesforceService'][_0x26c704(0xe4)](_0x2b9245),this[_0x26c704(0xc4)]=this[_0x26c704(0xbf)][_0x26c704(0xf0)](),await this[_0x26c704(0xca)]();if(!this[_0x26c704(0xc9)])throw new bad_request_error_1[(_0x26c704(0xec))](errors_1[_0x26c704(0xba)]);this[_0x26c704(0xef)]=await this['repoService']['getOne'](this[_0x26c704(0xc9)][_0x26c704(0xb5)]),this[_0x26c704(0x100)]=await this['repository'][_0x26c704(0xf7)][_0x26c704(0xd4)](this[_0x26c704(0xc9)][_0x26c704(0xeb)]),this[_0x26c704(0xe9)](_0x26c704(0xc0)),this['exec']()['catch'](_0x316643=>this[_0x26c704(0x105)](_0x316643));}catch(_0x248bf3){this['commitData']=undefined,logger[_0x26c704(0xd0)](_0x248bf3);throw _0x248bf3;}}};FlosumCommitJob=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a147_0x5202de(0xd6),[salesforce_service_1[a147_0x5202de(0xfd)],commit_components_job_1[a147_0x5202de(0xe6)],salesforce_sync_service_1[a147_0x5202de(0xe5)],git_provider_manager_1[a147_0x5202de(0xbe)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;