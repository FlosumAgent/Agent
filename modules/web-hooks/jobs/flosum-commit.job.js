const a143_0x4b6f=['In\x20Progress','run','getLogger','1194kskQnx','97109ufopNI','defineProperty','repositoryName','307edWApl','convertToSFDX','getRepoService','repoService','function','provider','commitAttachmentId','setLoggerId','../../salesforce/services/salesforce-retriever.service','17BpbSUW','Service','salesforceService','all','Attachment','1mgKLPw','constructor','[INFO]\x20Update\x20remote\x20state.','../../salesforce/services/salesforce-sync.service','getComponentsToWrite','branch','sha','../../../core','stringify',']\x20[Repository:\x20','user','fetchRepositoryData','256640NwNInt','exec','log','logger','getRepositoryRecord','deleteAttachmentId','getOne','split','gitUrl','branches','CommitComponentsDto','repositoryData','branchName','components','catch','design:paramtypes','BadRequestError','repository','../../shared/git-provider.manager','updateLastCommit','syncBranchId','gitManager','commitData','deleteAttachment','typedi','patchObject','__metadata','getCommitDto','commitJob','193156acFIaa','getBranchRecord','map','1399OdpCsY','decorate','getComponentsToDelete','365794XCfZWF','error','retrieveAttachment','salesforceSync','encodeBase64','SalesforceService','FlosumCommitJob','[ERROR]\x20','setStatus','trim','Error','getOwnPropertyDescriptor','Logger','name','[COMMIT]\x20[','CommitComponentsJob',']\x20[Branch:\x20','flosum-commit-job','260088jnysSp','metadata','send','1ooPCzH','ERR_INVALID_SYNC_RECORD_ID','../dto/commit-components.dto','then','repo','syncRepositoryId','object','./commit-components.job','[INFO]\x20Start\x20commit\x20job','__decorate'];const a143_0x4f9bd9=a143_0x1c66;(function(_0x50b2ee,_0x435b79){const _0x26cb0b=a143_0x1c66;while(!![]){try{const _0x536b2d=-parseInt(_0x26cb0b(0x1bb))+-parseInt(_0x26cb0b(0x1ef))*parseInt(_0x26cb0b(0x1de))+parseInt(_0x26cb0b(0x1d0))*parseInt(_0x26cb0b(0x1cd))+-parseInt(_0x26cb0b(0x1dd))*-parseInt(_0x26cb0b(0x1e1))+-parseInt(_0x26cb0b(0x1b5))+parseInt(_0x26cb0b(0x1fb))+parseInt(_0x26cb0b(0x1ea))*-parseInt(_0x26cb0b(0x1b8));if(_0x536b2d===_0x435b79)break;else _0x50b2ee['push'](_0x50b2ee['shift']());}catch(_0x1acc37){_0x50b2ee['push'](_0x50b2ee['shift']());}}}(a143_0x4b6f,0x31ab4));const a143_0x3eeba2=function(){let _0x3e27b1=!![];return function(_0x20316b,_0x2c9ddf){const _0x56689b=_0x3e27b1?function(){if(_0x2c9ddf){const _0xc263e0=_0x2c9ddf['apply'](_0x20316b,arguments);return _0x2c9ddf=null,_0xc263e0;}}:function(){};return _0x3e27b1=![],_0x56689b;};}(),a143_0x4f5454=a143_0x3eeba2(this,function(){const _0x516022=function(){const _0x32b906=a143_0x1c66,_0x4a7d6e=_0x516022[_0x32b906(0x1f0)]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x32b906(0x1f0)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x4a7d6e['test'](a143_0x4f5454);};return _0x516022();});a143_0x4f5454();function a143_0x1c66(_0x3b8a80,_0x39993a){return a143_0x1c66=function(_0x185bdd,_0x4f5454){_0x185bdd=_0x185bdd-0x1a8;let _0x3eeba2=a143_0x4b6f[_0x185bdd];return _0x3eeba2;},a143_0x1c66(_0x3b8a80,_0x39993a);}'use strict';var __decorate=this&&this[a143_0x4f9bd9(0x1d9)]||function(_0x15f50a,_0x775576,_0x5072b6,_0x30d823){const _0x3923f3=a143_0x4f9bd9;var _0x17341e=arguments['length'],_0x96f21b=_0x17341e<0x3?_0x775576:_0x30d823===null?_0x30d823=Object[_0x3923f3(0x1c6)](_0x775576,_0x5072b6):_0x30d823,_0xa9f7bc;if(typeof Reflect===_0x3923f3(0x1d6)&&typeof Reflect[_0x3923f3(0x1b9)]==='function')_0x96f21b=Reflect['decorate'](_0x15f50a,_0x775576,_0x5072b6,_0x30d823);else{for(var _0x4894dc=_0x15f50a['length']-0x1;_0x4894dc>=0x0;_0x4894dc--)if(_0xa9f7bc=_0x15f50a[_0x4894dc])_0x96f21b=(_0x17341e<0x3?_0xa9f7bc(_0x96f21b):_0x17341e>0x3?_0xa9f7bc(_0x775576,_0x5072b6,_0x96f21b):_0xa9f7bc(_0x775576,_0x5072b6))||_0x96f21b;}return _0x17341e>0x3&&_0x96f21b&&Object[_0x3923f3(0x1df)](_0x775576,_0x5072b6,_0x96f21b),_0x96f21b;},__metadata=this&&this[a143_0x4f9bd9(0x1b2)]||function(_0x3b14ed,_0x4db77b){const _0x5851cc=a143_0x4f9bd9;if(typeof Reflect==='object'&&typeof Reflect[_0x5851cc(0x1ce)]===_0x5851cc(0x1e5))return Reflect[_0x5851cc(0x1ce)](_0x3b14ed,_0x4db77b);};Object[a143_0x4f9bd9(0x1df)](exports,'__esModule',{'value':!![]}),exports[a143_0x4f9bd9(0x1c1)]=void 0x0;const core_1=require(a143_0x4f9bd9(0x1f6)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a143_0x4f9bd9(0x1aa)),typedi_1=require(a143_0x4f9bd9(0x1b0)),errors_1=require('../../../constants/errors'),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a143_0x4f9bd9(0x1e9)),salesforce_sync_service_1=require(a143_0x4f9bd9(0x1f2)),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a143_0x4f9bd9(0x1d2)),commit_components_job_1=require(a143_0x4f9bd9(0x1d7)),logger=new core_1[(a143_0x4f9bd9(0x1c7))](a143_0x4f9bd9(0x1cc));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x139a64,_0x250d92,_0x470716,_0x23e1cc){const _0x30d72e=a143_0x4f9bd9;this[_0x30d72e(0x1ec)]=_0x139a64,this[_0x30d72e(0x1b4)]=_0x250d92,this[_0x30d72e(0x1be)]=_0x470716,this[_0x30d72e(0x1ad)]=_0x23e1cc,this[_0x30d72e(0x1e4)]=this[_0x30d72e(0x1ad)][_0x30d72e(0x1e3)]();}['log'](_0x523e63){const _0x2c533c=a143_0x4f9bd9;return this[_0x2c533c(0x1fe)][_0x2c533c(0x1fd)](_0x2c533c(0x1c9)+this['gitManager'][_0x2c533c(0x1e6)]['toUpperCase']()+_0x2c533c(0x1f8)+this['repository']['name']+_0x2c533c(0x1cb)+this['branch'][_0x2c533c(0x1c8)]+']\x20'+_0x523e63);}async[a143_0x4f9bd9(0x1fa)](){const _0x5f1c15=a143_0x4f9bd9;try{if(this[_0x5f1c15(0x1ae)][_0x5f1c15(0x1d5)])this[_0x5f1c15(0x206)]=await this['salesforceSync'][_0x5f1c15(0x1ff)](this['commitData'][_0x5f1c15(0x1d5)]);else this[_0x5f1c15(0x1ae)][_0x5f1c15(0x1ac)]&&(this[_0x5f1c15(0x206)]=await this[_0x5f1c15(0x1be)][_0x5f1c15(0x1b6)](this[_0x5f1c15(0x1ae)][_0x5f1c15(0x1ac)]));}catch(_0x46b89a){throw new bad_request_error_1['BadRequestError'](errors_1[_0x5f1c15(0x1d1)]);}}async[a143_0x4f9bd9(0x1f3)](){const _0x5c36bb=a143_0x4f9bd9;if(!this['commitData']['commitAttachmentId'])return[];const _0x2b64d2=await this[_0x5c36bb(0x1ec)]['retrieveAttachment'](this[_0x5c36bb(0x1ae)][_0x5c36bb(0x1e7)])[_0x5c36bb(0x1d3)](_0x445d40=>_0x445d40[_0x5c36bb(0x202)]('\x20')[_0x5c36bb(0x1b7)](_0x5f5b87=>_0x5f5b87[_0x5c36bb(0x1c4)]())),_0x2637ae=new salesforce_retriever_service_1['SalesforceRetrieverService'](this['salesforceService']),_0x4bf7c4=await _0x2637ae['run'](_0x2b64d2);return _0x4bf7c4;}async[a143_0x4f9bd9(0x1ba)](){const _0x54c602=a143_0x4f9bd9;if(!this[_0x54c602(0x1ae)]['deleteAttachmentId'])return[];const _0x4e9077=await this[_0x54c602(0x1ec)][_0x54c602(0x1bd)](this[_0x54c602(0x1ae)][_0x54c602(0x200)]);return _0x4e9077;}async[a143_0x4f9bd9(0x1b3)](){const _0x35fa5e=a143_0x4f9bd9,_0x2335f5=new commit_components_dto_1[(_0x35fa5e(0x205))](),[_0xcb7576,_0x527cc8]=await Promise[_0x35fa5e(0x1ed)]([this['getComponentsToWrite'](),this[_0x35fa5e(0x1ba)]()]);return _0x2335f5['message']=this[_0x35fa5e(0x1ae)]['message'],_0x2335f5[_0x35fa5e(0x1f9)]=this['commitData'][_0x35fa5e(0x1f9)],_0x2335f5[_0x35fa5e(0x208)]={'writed':_0xcb7576,'deleted':_0x527cc8},_0x2335f5[_0x35fa5e(0x1e2)]=this[_0x35fa5e(0x1ae)][_0x35fa5e(0x1e2)],_0x2335f5[_0x35fa5e(0x1d4)]=this[_0x35fa5e(0x1a9)],_0x2335f5[_0x35fa5e(0x1f4)]=this['branch'],_0x2335f5;}async[a143_0x4f9bd9(0x1ab)](){const _0x1658f9=a143_0x4f9bd9,_0x440832=await this['repository'][_0x1658f9(0x204)]['getOne'](this[_0x1658f9(0x1f4)][_0x1658f9(0x1c8)]);this[_0x1658f9(0x1fd)](_0x1658f9(0x1f1));const _0xf364e7=await this[_0x1658f9(0x1be)]['getAttachmentId'](this[_0x1658f9(0x206)]),_0x4f7a3f={[this[_0x1658f9(0x1a9)][_0x1658f9(0x203)]]:{'lastCommit':_0x440832[_0x1658f9(0x1f5)]}};await this[_0x1658f9(0x1ec)][_0x1658f9(0x1b1)](_0x1658f9(0x1ee),_0xf364e7,{'Body':utils_1[_0x1658f9(0x1bf)](JSON[_0x1658f9(0x1f7)](_0x4f7a3f))});}async[a143_0x4f9bd9(0x1fc)](){const _0x3971f7=a143_0x4f9bd9,_0x502d88=await this[_0x3971f7(0x1b3)]();this[_0x3971f7(0x1b4)][_0x3971f7(0x1fe)]=this[_0x3971f7(0x1fe)],await this[_0x3971f7(0x1be)]['setStatus'](this[_0x3971f7(0x206)],_0x3971f7(0x1da)),await this[_0x3971f7(0x1b4)][_0x3971f7(0x1db)](_0x502d88),await this[_0x3971f7(0x1ab)](),this['commitData'][_0x3971f7(0x1e7)]&&await this[_0x3971f7(0x1ec)][_0x3971f7(0x1af)](this[_0x3971f7(0x1ae)][_0x3971f7(0x1e7)]),this['commitData'][_0x3971f7(0x200)]&&await this[_0x3971f7(0x1ec)][_0x3971f7(0x1af)](this[_0x3971f7(0x1ae)][_0x3971f7(0x200)]),await this[_0x3971f7(0x1be)][_0x3971f7(0x1c3)](this[_0x3971f7(0x206)],'Completed');}async['handleCommitJobError'](_0x435cfa){const _0x36f834=a143_0x4f9bd9;try{this['logger']['log'](_0x36f834(0x1c2)+_0x435cfa),await this[_0x36f834(0x1fe)][_0x36f834(0x1cf)](),await this[_0x36f834(0x1be)][_0x36f834(0x1c3)](this['repositoryData'],_0x36f834(0x1c5));}catch(_0x57d0e8){logger[_0x36f834(0x1bc)](_0x57d0e8);}}async[a143_0x4f9bd9(0x1db)](_0x23ae8d,_0x1f65fe){const _0x337ef6=a143_0x4f9bd9;try{this[_0x337ef6(0x1ae)]=_0x23ae8d,this[_0x337ef6(0x1ec)][_0x337ef6(0x1e8)](_0x1f65fe),this[_0x337ef6(0x1fe)]=this[_0x337ef6(0x1ec)][_0x337ef6(0x1dc)](),await this[_0x337ef6(0x1fa)]();if(!this[_0x337ef6(0x206)])throw new bad_request_error_1[(_0x337ef6(0x1a8))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);this[_0x337ef6(0x1a9)]=await this[_0x337ef6(0x1e4)][_0x337ef6(0x201)](this[_0x337ef6(0x206)][_0x337ef6(0x1e0)]),this[_0x337ef6(0x1f4)]=await this[_0x337ef6(0x1a9)][_0x337ef6(0x204)]['getOne'](this[_0x337ef6(0x206)][_0x337ef6(0x207)]),this['log'](_0x337ef6(0x1d8)),this[_0x337ef6(0x1fc)]()[_0x337ef6(0x209)](_0x53c0ef=>this['handleCommitJobError'](_0x53c0ef));}catch(_0x5dd647){this[_0x337ef6(0x1ae)]=undefined,logger[_0x337ef6(0x1bc)](_0x5dd647);throw _0x5dd647;}}};FlosumCommitJob=__decorate([typedi_1[a143_0x4f9bd9(0x1eb)]({'transient':!![]}),__metadata(a143_0x4f9bd9(0x20a),[salesforce_service_1[a143_0x4f9bd9(0x1c0)],commit_components_job_1[a143_0x4f9bd9(0x1ca)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;