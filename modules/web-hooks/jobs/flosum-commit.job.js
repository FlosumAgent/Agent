const a146_0x5c6a3f=a146_0x4fd3;(function(_0x42607f,_0x13cbe2){const _0x5da1ab=a146_0x4fd3,_0x3ed363=_0x42607f();while(!![]){try{const _0x3084df=parseInt(_0x5da1ab(0x17f))/0x1+parseInt(_0x5da1ab(0x148))/0x2*(parseInt(_0x5da1ab(0x13e))/0x3)+-parseInt(_0x5da1ab(0x156))/0x4*(-parseInt(_0x5da1ab(0x168))/0x5)+parseInt(_0x5da1ab(0x133))/0x6+parseInt(_0x5da1ab(0x179))/0x7+-parseInt(_0x5da1ab(0x17d))/0x8+parseInt(_0x5da1ab(0x13c))/0x9*(-parseInt(_0x5da1ab(0x14e))/0xa);if(_0x3084df===_0x13cbe2)break;else _0x3ed363['push'](_0x3ed363['shift']());}catch(_0x2b616d){_0x3ed363['push'](_0x3ed363['shift']());}}}(a146_0x44cc,0xc6aa2));const a146_0x399aa7=function(){let _0x3743a2=!![];return function(_0x2b92f1,_0x29d2ce){const _0x55260b=_0x3743a2?function(){const _0x54d35c=a146_0x4fd3;if(_0x29d2ce){const _0x458a5e=_0x29d2ce[_0x54d35c(0x137)](_0x2b92f1,arguments);return _0x29d2ce=null,_0x458a5e;}}:function(){};return _0x3743a2=![],_0x55260b;};}(),a146_0x545039=a146_0x399aa7(this,function(){const _0x227930=a146_0x4fd3;return a146_0x545039[_0x227930(0x17c)]()[_0x227930(0x167)]('(((.+)+)+)+$')[_0x227930(0x17c)]()['constructor'](a146_0x545039)[_0x227930(0x167)](_0x227930(0x166));});function a146_0x4fd3(_0x39f244,_0x359ee9){const _0x1f0692=a146_0x44cc();return a146_0x4fd3=function(_0x545039,_0x399aa7){_0x545039=_0x545039-0x125;let _0x44cc74=_0x1f0692[_0x545039];return _0x44cc74;},a146_0x4fd3(_0x39f244,_0x359ee9);}a146_0x545039();'use strict';var __decorate=this&&this['__decorate']||function(_0x7850cf,_0x1aa48c,_0x36d8f0,_0x449b48){const _0x23def2=a146_0x4fd3;var _0x3b4cbb=arguments[_0x23def2(0x13a)],_0x549d7d=_0x3b4cbb<0x3?_0x1aa48c:_0x449b48===null?_0x449b48=Object[_0x23def2(0x155)](_0x1aa48c,_0x36d8f0):_0x449b48,_0x141a06;if(typeof Reflect===_0x23def2(0x171)&&typeof Reflect[_0x23def2(0x145)]===_0x23def2(0x181))_0x549d7d=Reflect['decorate'](_0x7850cf,_0x1aa48c,_0x36d8f0,_0x449b48);else{for(var _0x330c9b=_0x7850cf[_0x23def2(0x13a)]-0x1;_0x330c9b>=0x0;_0x330c9b--)if(_0x141a06=_0x7850cf[_0x330c9b])_0x549d7d=(_0x3b4cbb<0x3?_0x141a06(_0x549d7d):_0x3b4cbb>0x3?_0x141a06(_0x1aa48c,_0x36d8f0,_0x549d7d):_0x141a06(_0x1aa48c,_0x36d8f0))||_0x549d7d;}return _0x3b4cbb>0x3&&_0x549d7d&&Object[_0x23def2(0x138)](_0x1aa48c,_0x36d8f0,_0x549d7d),_0x549d7d;},__metadata=this&&this[a146_0x5c6a3f(0x14d)]||function(_0xe182f3,_0x44db23){const _0x31de20=a146_0x5c6a3f;if(typeof Reflect===_0x31de20(0x171)&&typeof Reflect[_0x31de20(0x142)]===_0x31de20(0x181))return Reflect[_0x31de20(0x142)](_0xe182f3,_0x44db23);};function a146_0x44cc(){const _0x292543=['[ERROR]\x20','send','getComponentsToWrite','fetchRepositoryData','[COMMIT]\x20[','BadRequestError','updateRemoteState','then','repo','run','getLogger','CommitComponentsJob','message','setLoggerId','(((.+)+)+)+$','search','10WEnfuG','../../shared/git-provider.manager','branches','branch','getCommitDto','components','trim','getBranchRecord','repository','object','SalesforceRetrieverService','deleteAttachment','catch','map','../../salesforce/services/salesforce-retriever.service','FlosumCommitJob','convertToSFDX','10399298qCbqeV','syncRepositoryId','../../../core','toString','10688536XrsZCk','Error','609743JWSTOx','exec','function','logger','Completed','handleCommitJobError','updateLastCommit','user','sha','commitData','ERR_UNKNOWN_SYNC_RECORD_ID','./commit-components.job','deleteAttachmentId','getComponentsToDelete','GitProviderManager','toUpperCase','syncBranchId','[INFO]\x20Update\x20remote\x20state.','name','../../salesforce/services/salesforce-sync.service','salesforceSync','2472462CmoYMy','salesforceService','design:paramtypes','provider','apply','defineProperty','getRepoService','length','getRepositoryRecord','2149299sKkFUN','In\x20Progress','3URuSOq','log','commitAttachmentId','retrieveAttachment','metadata','repositoryName','getOne','decorate','all','commitJob','2908322QAshSh','SalesforceService','../dto/commit-components.dto','CommitComponentsDto','repositoryData','__metadata','80lzycvP','Logger','typedi','gitUrl',']\x20[Branch:\x20','repoService','setStatus','getOwnPropertyDescriptor','197380rUTNKj','gitManager'];a146_0x44cc=function(){return _0x292543;};return a146_0x44cc();}Object[a146_0x5c6a3f(0x138)](exports,'__esModule',{'value':!![]}),exports[a146_0x5c6a3f(0x177)]=void 0x0;const core_1=require(a146_0x5c6a3f(0x17b)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a146_0x5c6a3f(0x169)),typedi_1=require(a146_0x5c6a3f(0x150)),errors_1=require('../../../constants/errors'),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a146_0x5c6a3f(0x176)),salesforce_sync_service_1=require(a146_0x5c6a3f(0x131)),commit_components_dto_1=require(a146_0x5c6a3f(0x14a)),commit_components_job_1=require(a146_0x5c6a3f(0x129)),logger=new core_1[(a146_0x5c6a3f(0x14f))]('flosum-commit-job');let FlosumCommitJob=class FlosumCommitJob{constructor(_0x392020,_0xfaebad,_0x26057a,_0x345d97){const _0x39ef83=a146_0x5c6a3f;this[_0x39ef83(0x134)]=_0x392020,this[_0x39ef83(0x147)]=_0xfaebad,this[_0x39ef83(0x132)]=_0x26057a,this['gitManager']=_0x345d97,this[_0x39ef83(0x153)]=this[_0x39ef83(0x157)][_0x39ef83(0x139)]();}[a146_0x5c6a3f(0x13f)](_0x206ccf){const _0x453231=a146_0x5c6a3f;return this[_0x453231(0x182)][_0x453231(0x13f)](_0x453231(0x15c)+this[_0x453231(0x157)][_0x453231(0x136)][_0x453231(0x12d)]()+']\x20[Repository:\x20'+this[_0x453231(0x170)][_0x453231(0x130)]+_0x453231(0x152)+this[_0x453231(0x16b)][_0x453231(0x130)]+']\x20'+_0x206ccf);}async['fetchRepositoryData'](){const _0x59e7ea=a146_0x5c6a3f;try{if(this['commitData'][_0x59e7ea(0x17a)])this[_0x59e7ea(0x14c)]=await this[_0x59e7ea(0x132)][_0x59e7ea(0x13b)](this['commitData'][_0x59e7ea(0x17a)]);else this[_0x59e7ea(0x127)][_0x59e7ea(0x12e)]&&(this[_0x59e7ea(0x14c)]=await this[_0x59e7ea(0x132)][_0x59e7ea(0x16f)](this['commitData'][_0x59e7ea(0x12e)]));}catch(_0x2d7afa){throw new bad_request_error_1[(_0x59e7ea(0x15d))](errors_1['ERR_INVALID_SYNC_RECORD_ID']);}}async['getComponentsToWrite'](){const _0x568e24=a146_0x5c6a3f;if(!this[_0x568e24(0x127)][_0x568e24(0x140)])return[];const _0x3279f4=await this['salesforceService'][_0x568e24(0x141)](this[_0x568e24(0x127)][_0x568e24(0x140)])[_0x568e24(0x15f)](_0x21353c=>_0x21353c['split']('\x20')[_0x568e24(0x175)](_0x3be6f6=>_0x3be6f6[_0x568e24(0x16e)]())),_0xfaf96c=new salesforce_retriever_service_1[(_0x568e24(0x172))](this[_0x568e24(0x134)]),_0x139143=await _0xfaf96c[_0x568e24(0x161)](_0x3279f4);return _0x139143;}async['getComponentsToDelete'](){const _0xd10d8c=a146_0x5c6a3f;if(!this[_0xd10d8c(0x127)]['deleteAttachmentId'])return[];const _0x20849f=await this[_0xd10d8c(0x134)][_0xd10d8c(0x141)](this[_0xd10d8c(0x127)][_0xd10d8c(0x12a)]);return _0x20849f;}async[a146_0x5c6a3f(0x16c)](){const _0x3aaf9b=a146_0x5c6a3f,_0x4d7a26=new commit_components_dto_1[(_0x3aaf9b(0x14b))](),[_0x2d1af7,_0x30c96b]=await Promise[_0x3aaf9b(0x146)]([this[_0x3aaf9b(0x15a)](),this[_0x3aaf9b(0x12b)]()]);return _0x4d7a26[_0x3aaf9b(0x164)]=this[_0x3aaf9b(0x127)][_0x3aaf9b(0x164)],_0x4d7a26[_0x3aaf9b(0x125)]=this[_0x3aaf9b(0x127)][_0x3aaf9b(0x125)],_0x4d7a26[_0x3aaf9b(0x16d)]={'writed':_0x2d1af7,'deleted':_0x30c96b},_0x4d7a26[_0x3aaf9b(0x178)]=this['commitData']['convertToSFDX'],_0x4d7a26[_0x3aaf9b(0x160)]=this[_0x3aaf9b(0x170)],_0x4d7a26[_0x3aaf9b(0x16b)]=this[_0x3aaf9b(0x16b)],_0x4d7a26;}async[a146_0x5c6a3f(0x185)](_0x3585e7=![]){const _0x5a8439=a146_0x5c6a3f;if(_0x3585e7)await this['salesforceSync'][_0x5a8439(0x15e)](this[_0x5a8439(0x14c)],{});else{const _0x539f18=await this['repository'][_0x5a8439(0x16a)]['getOne'](this['branch'][_0x5a8439(0x130)]);this['log'](_0x5a8439(0x12f));const _0x10a5a5={[this[_0x5a8439(0x170)][_0x5a8439(0x151)]]:{'lastCommit':_0x539f18[_0x5a8439(0x126)]}};await this[_0x5a8439(0x132)][_0x5a8439(0x15e)](this[_0x5a8439(0x14c)],_0x10a5a5);}}async[a146_0x5c6a3f(0x180)](){const _0x43449f=a146_0x5c6a3f,_0x2b49e9=await this[_0x43449f(0x16c)]();this[_0x43449f(0x147)][_0x43449f(0x182)]=this[_0x43449f(0x182)],await this[_0x43449f(0x132)][_0x43449f(0x154)](this['repositoryData'],_0x43449f(0x13d)),await this[_0x43449f(0x147)]['run'](_0x2b49e9),await this[_0x43449f(0x185)](),this[_0x43449f(0x127)]['commitAttachmentId']&&await this[_0x43449f(0x134)][_0x43449f(0x173)](this[_0x43449f(0x127)][_0x43449f(0x140)]),this[_0x43449f(0x127)][_0x43449f(0x12a)]&&await this[_0x43449f(0x134)][_0x43449f(0x173)](this[_0x43449f(0x127)][_0x43449f(0x12a)]),await this[_0x43449f(0x132)]['setStatus'](this['repositoryData'],_0x43449f(0x183));}async[a146_0x5c6a3f(0x184)](_0x8680a8){const _0x3589fc=a146_0x5c6a3f;try{this[_0x3589fc(0x182)][_0x3589fc(0x13f)](_0x3589fc(0x158)+_0x8680a8),await this['logger'][_0x3589fc(0x159)](),await this[_0x3589fc(0x185)](!![]),await this[_0x3589fc(0x132)]['setStatus'](this[_0x3589fc(0x14c)],_0x3589fc(0x17e));}catch(_0x5a92dc){logger['error'](_0x5a92dc);}}async[a146_0x5c6a3f(0x161)](_0x2a4d19,_0x1e5af3){const _0x268664=a146_0x5c6a3f;try{this[_0x268664(0x127)]=_0x2a4d19,this[_0x268664(0x134)][_0x268664(0x165)](_0x1e5af3),this[_0x268664(0x182)]=this['salesforceService'][_0x268664(0x162)](),await this[_0x268664(0x15b)]();if(!this[_0x268664(0x14c)])throw new bad_request_error_1[(_0x268664(0x15d))](errors_1[_0x268664(0x128)]);this[_0x268664(0x170)]=await this[_0x268664(0x153)]['getOne'](this[_0x268664(0x14c)][_0x268664(0x143)]),this[_0x268664(0x16b)]=await this[_0x268664(0x170)][_0x268664(0x16a)][_0x268664(0x144)](this[_0x268664(0x14c)]['branchName']),this['log']('[INFO]\x20Start\x20commit\x20job'),this[_0x268664(0x180)]()[_0x268664(0x174)](_0x3b712f=>this['handleCommitJobError'](_0x3b712f));}catch(_0x45ebbc){this['commitData']=undefined,logger['error'](_0x45ebbc);throw _0x45ebbc;}}};FlosumCommitJob=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a146_0x5c6a3f(0x135),[salesforce_service_1[a146_0x5c6a3f(0x149)],commit_components_job_1[a146_0x5c6a3f(0x163)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a146_0x5c6a3f(0x12c)]])],FlosumCommitJob),exports[a146_0x5c6a3f(0x177)]=FlosumCommitJob;