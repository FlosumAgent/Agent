const a180_0xf4bce8=a180_0x3258;(function(_0x1d4167,_0x527250){const _0x32cc5f=a180_0x3258,_0x1a5167=_0x1d4167();while(!![]){try{const _0x15ba17=parseInt(_0x32cc5f(0x21a))/0x1+-parseInt(_0x32cc5f(0x1d0))/0x2+-parseInt(_0x32cc5f(0x1e4))/0x3*(-parseInt(_0x32cc5f(0x208))/0x4)+-parseInt(_0x32cc5f(0x1fc))/0x5+parseInt(_0x32cc5f(0x1d7))/0x6+-parseInt(_0x32cc5f(0x1f0))/0x7+parseInt(_0x32cc5f(0x210))/0x8;if(_0x15ba17===_0x527250)break;else _0x1a5167['push'](_0x1a5167['shift']());}catch(_0x4d3070){_0x1a5167['push'](_0x1a5167['shift']());}}}(a180_0x5874,0x2d79b));const a180_0xf1726=function(){let _0x414aa6=!![];return function(_0x37acca,_0x130a7f){const _0x5b27e1=_0x414aa6?function(){const _0x51dce6=a180_0x3258;if(_0x130a7f){const _0x5c3276=_0x130a7f[_0x51dce6(0x1d6)](_0x37acca,arguments);return _0x130a7f=null,_0x5c3276;}}:function(){};return _0x414aa6=![],_0x5b27e1;};}(),a180_0x47332f=a180_0xf1726(this,function(){const _0x1ff40c=a180_0x3258;return a180_0x47332f[_0x1ff40c(0x1ff)]()[_0x1ff40c(0x214)](_0x1ff40c(0x203))['toString']()[_0x1ff40c(0x220)](a180_0x47332f)['search'](_0x1ff40c(0x203));});function a180_0x3258(_0x3dbc46,_0x12a102){const _0x484e27=a180_0x5874();return a180_0x3258=function(_0x47332f,_0xf1726){_0x47332f=_0x47332f-0x1c2;let _0x5874d3=_0x484e27[_0x47332f];return _0x5874d3;},a180_0x3258(_0x3dbc46,_0x12a102);}a180_0x47332f();'use strict';var __decorate=this&&this[a180_0xf4bce8(0x1cf)]||function(_0x2a2a2b,_0x4dc90e,_0x5b5e90,_0x5d16f8){const _0x588d61=a180_0xf4bce8;var _0x5258a9=arguments[_0x588d61(0x1f9)],_0x5cc0d9=_0x5258a9<0x3?_0x4dc90e:_0x5d16f8===null?_0x5d16f8=Object[_0x588d61(0x1da)](_0x4dc90e,_0x5b5e90):_0x5d16f8,_0x22457d;if(typeof Reflect===_0x588d61(0x20d)&&typeof Reflect[_0x588d61(0x1f6)]===_0x588d61(0x1e3))_0x5cc0d9=Reflect['decorate'](_0x2a2a2b,_0x4dc90e,_0x5b5e90,_0x5d16f8);else{for(var _0x508008=_0x2a2a2b[_0x588d61(0x1f9)]-0x1;_0x508008>=0x0;_0x508008--)if(_0x22457d=_0x2a2a2b[_0x508008])_0x5cc0d9=(_0x5258a9<0x3?_0x22457d(_0x5cc0d9):_0x5258a9>0x3?_0x22457d(_0x4dc90e,_0x5b5e90,_0x5cc0d9):_0x22457d(_0x4dc90e,_0x5b5e90))||_0x5cc0d9;}return _0x5258a9>0x3&&_0x5cc0d9&&Object[_0x588d61(0x213)](_0x4dc90e,_0x5b5e90,_0x5cc0d9),_0x5cc0d9;},__metadata=this&&this[a180_0xf4bce8(0x21f)]||function(_0x375156,_0x56d727){const _0xda16fd=a180_0xf4bce8;if(typeof Reflect===_0xda16fd(0x20d)&&typeof Reflect[_0xda16fd(0x1c2)]===_0xda16fd(0x1e3))return Reflect[_0xda16fd(0x1c2)](_0x375156,_0x56d727);},FlosumCommitJob_1;Object[a180_0xf4bce8(0x213)](exports,a180_0xf4bce8(0x1e8),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a180_0xf4bce8(0x209)),salesforce_logger_v2_service_1=require(a180_0xf4bce8(0x1ca)),salesforce_service_1=require(a180_0xf4bce8(0x205)),git_provider_manager_1=require(a180_0xf4bce8(0x216)),typedi_1=require(a180_0xf4bce8(0x1d1)),errors_1=require(a180_0xf4bce8(0x1e0)),bad_request_error_1=require(a180_0xf4bce8(0x1eb)),salesforce_retriever_service_1=require(a180_0xf4bce8(0x215)),salesforce_sync_service_1=require(a180_0xf4bce8(0x200)),commit_components_dto_1=require(a180_0xf4bce8(0x1ef)),commit_components_job_1=require('./commit-components.job');function a180_0x5874(){const _0x4842ea=['typedi','commitData','deleteAttachment','map','sfLogger','apply','56376ZxNjrD','gitManager','repoService','getOwnPropertyDescriptor','Error','commitAttachmentId','salesforceSync','error','SalesforceRetrieverService','../../../constants/errors','sha','commitJob','function','91947fqDvQy','updateRemoteState','convertToSFDX','branches','__esModule','ERR_INVALID_SYNC_RECORD_ID','getLoggerId','../../../core/errors/bad-request.error','getComponentsToWrite','setStatus','Completed','../dto/commit-components.dto','249718txMhLa','message','branch','BadRequestError','run','getBranchRecord','decorate','design:paramtypes','retrieveAttachment','length','[INFO]\x20Update\x20remote\x20state.','repositoryName','794480CVWXTd','log','repository','toString','../../salesforce/services/salesforce-sync.service','send','GitProviderManager','(((.+)+)+)+$','ERR_UNKNOWN_SYNC_RECORD_ID','../../salesforce/services/salesforce.service','salesforceService','catch','12qwRpEW','../../../core','name','getPrefix','exec','object','branchName','toUpperCase','1308000Ghbrbi','syncBranchId','getRepositoryRecord','defineProperty','search','../../salesforce/services/salesforce-retriever.service','../../shared/git-provider.manager','logger','FlosumCommitJob','provider','356052EmwEai','getOne','SalesforceLogger2','repo','then','__metadata','constructor','trim','syncRepositoryId','[ERROR]\x20',']\x20[Branch:\x20','SalesforceSyncService','metadata','all','user','components','getComponentsToDelete','fetchRepositoryData','SalesforceService','split','../../salesforce/services/salesforce-logger-v2.service','deleteAttachmentId','updateLastCommit','repositoryData','handleCommitJobError','__decorate','480116bZBeyi'];a180_0x5874=function(){return _0x4842ea;};return a180_0x5874();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x406707,_0x495d48,_0x25cfe4,_0x400afa){const _0x40aff5=a180_0xf4bce8;this[_0x40aff5(0x206)]=_0x406707,this[_0x40aff5(0x1e2)]=_0x495d48,this[_0x40aff5(0x1dd)]=_0x25cfe4,this['gitManager']=_0x400afa,this['repoService']=this[_0x40aff5(0x1d8)]['getRepoService'](),this[_0x40aff5(0x217)]=new core_1['Logger'](FlosumCommitJob_1[_0x40aff5(0x20a)]);}async['fetchRepositoryData'](){const _0x33ea57=a180_0xf4bce8;try{if(this[_0x33ea57(0x1d2)][_0x33ea57(0x222)])this['repositoryData']=await this['salesforceSync'][_0x33ea57(0x212)](this[_0x33ea57(0x1d2)]['syncRepositoryId']);else this['commitData'][_0x33ea57(0x211)]&&(this[_0x33ea57(0x1cd)]=await this[_0x33ea57(0x1dd)][_0x33ea57(0x1f5)](this[_0x33ea57(0x1d2)][_0x33ea57(0x211)]));}catch(_0x40dc2d){throw new bad_request_error_1['BadRequestError'](errors_1[_0x33ea57(0x1e9)]);}}async[a180_0xf4bce8(0x1ec)](){const _0x5b695c=a180_0xf4bce8;if(!this['commitData'][_0x5b695c(0x1dc)])return[];const _0x20d9da=await this['salesforceService'][_0x5b695c(0x1f8)](this[_0x5b695c(0x1d2)]['commitAttachmentId'])[_0x5b695c(0x21e)](_0x2b09f9=>_0x2b09f9[_0x5b695c(0x1c9)]('\x20')[_0x5b695c(0x1d4)](_0x341c4b=>_0x341c4b[_0x5b695c(0x221)]())),_0x359a13=new salesforce_retriever_service_1[(_0x5b695c(0x1df))](this[_0x5b695c(0x206)]),_0x411253=await _0x359a13['run'](_0x20d9da);return _0x411253;}async[a180_0xf4bce8(0x1c6)](){const _0x2f948d=a180_0xf4bce8;if(!this[_0x2f948d(0x1d2)][_0x2f948d(0x1cb)])return[];const _0x84f7b9=await this[_0x2f948d(0x206)]['retrieveAttachment'](this[_0x2f948d(0x1d2)][_0x2f948d(0x1cb)]);return _0x84f7b9;}async['getCommitDto'](){const _0x1da421=a180_0xf4bce8,_0x5112d0=new commit_components_dto_1['CommitComponentsDto'](),[_0x44f96e,_0x1961f3]=await Promise[_0x1da421(0x1c3)]([this[_0x1da421(0x1ec)](),this[_0x1da421(0x1c6)]()]);return _0x5112d0['message']=this[_0x1da421(0x1d2)][_0x1da421(0x1f1)],_0x5112d0[_0x1da421(0x1c4)]=this['commitData'][_0x1da421(0x1c4)],_0x5112d0[_0x1da421(0x1c5)]={'writed':_0x44f96e,'deleted':_0x1961f3},_0x5112d0[_0x1da421(0x1e6)]=this['commitData'][_0x1da421(0x1e6)],_0x5112d0[_0x1da421(0x21d)]=this[_0x1da421(0x1fe)],_0x5112d0[_0x1da421(0x1f2)]=this[_0x1da421(0x1f2)],_0x5112d0['provider']=this[_0x1da421(0x219)],_0x5112d0;}async[a180_0xf4bce8(0x1cc)](_0x43b67d=![]){const _0x4e888a=a180_0xf4bce8;if(_0x43b67d)await this[_0x4e888a(0x1dd)][_0x4e888a(0x1e5)](this[_0x4e888a(0x1cd)],{});else{const _0x16f047=await this[_0x4e888a(0x1fe)]['branches']['getOne'](this[_0x4e888a(0x1f2)][_0x4e888a(0x20a)]);this[_0x4e888a(0x1d5)][_0x4e888a(0x1fd)](_0x4e888a(0x1fa));const _0x2349ac={[this[_0x4e888a(0x1fe)]['gitUrl']]:{'lastCommit':_0x16f047[_0x4e888a(0x1e1)]}};await this[_0x4e888a(0x1dd)][_0x4e888a(0x1e5)](this[_0x4e888a(0x1cd)],_0x2349ac);}}async['exec'](){const _0x1c5f40=a180_0xf4bce8,_0xbed53c=await this['getCommitDto']();await this[_0x1c5f40(0x1dd)][_0x1c5f40(0x1ed)](this[_0x1c5f40(0x1cd)],'In\x20Progress'),await this[_0x1c5f40(0x1e2)][_0x1c5f40(0x1f4)](_0xbed53c,this['sfLogger']),await this[_0x1c5f40(0x1cc)](),this[_0x1c5f40(0x1d2)][_0x1c5f40(0x1dc)]&&await this[_0x1c5f40(0x206)]['deleteAttachment'](this[_0x1c5f40(0x1d2)]['commitAttachmentId']),this[_0x1c5f40(0x1d2)][_0x1c5f40(0x1cb)]&&await this[_0x1c5f40(0x206)][_0x1c5f40(0x1d3)](this[_0x1c5f40(0x1d2)][_0x1c5f40(0x1cb)]),await this[_0x1c5f40(0x1dd)][_0x1c5f40(0x1ed)](this[_0x1c5f40(0x1cd)],_0x1c5f40(0x1ee));}async[a180_0xf4bce8(0x1ce)](_0x519ada){const _0x27c043=a180_0xf4bce8;try{this[_0x27c043(0x1d5)]['log'](_0x27c043(0x223)+_0x519ada),await this[_0x27c043(0x1d5)][_0x27c043(0x201)](),await this[_0x27c043(0x1cc)](!![]),await this['salesforceSync'][_0x27c043(0x1ed)](this[_0x27c043(0x1cd)],_0x27c043(0x1db));}catch(_0x49a15c){this[_0x27c043(0x217)][_0x27c043(0x1de)](_0x49a15c);}}async['run'](_0x266cb9,_0x562768,_0x23e444){const _0x5f2419=a180_0xf4bce8;try{this['commitData']=_0x266cb9,this['provider']=_0x23e444,await this[_0x5f2419(0x1c7)](),this[_0x5f2419(0x1fe)]=await this[_0x5f2419(0x1d9)][_0x5f2419(0x21b)](this[_0x5f2419(0x1cd)][_0x5f2419(0x1fb)]),this[_0x5f2419(0x1f2)]=await this[_0x5f2419(0x1fe)][_0x5f2419(0x1e7)][_0x5f2419(0x21b)](this[_0x5f2419(0x1cd)][_0x5f2419(0x20e)]),this[_0x5f2419(0x1d5)]=new salesforce_logger_v2_service_1[(_0x5f2419(0x21c))](_0x562768[_0x5f2419(0x1ea)](),(_0x562768[_0x5f2419(0x20b)]()||'[FLOSUM\x20->\x20GIT]\x20['+_0x23e444[_0x5f2419(0x20f)]()+']\x20[Repository:\x20'+this[_0x5f2419(0x1cd)][_0x5f2419(0x1fb)]+_0x5f2419(0x224)+this[_0x5f2419(0x1cd)]['branchName']+']')+'\x20['+FlosumCommitJob_1['name']+']');if(!this[_0x5f2419(0x1cd)])throw new bad_request_error_1[(_0x5f2419(0x1f3))](errors_1[_0x5f2419(0x204)]);await this[_0x5f2419(0x1d5)][_0x5f2419(0x1fd)]('[INFO]\x20Start\x20commit\x20job')[_0x5f2419(0x201)](),this[_0x5f2419(0x20c)]()[_0x5f2419(0x207)](_0x12f5a4=>this[_0x5f2419(0x1ce)](_0x12f5a4));}catch(_0x24778b){this[_0x5f2419(0x1d2)]=undefined,this[_0x5f2419(0x217)][_0x5f2419(0x1de)](_0x24778b);throw _0x24778b;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a180_0xf4bce8(0x1f7),[salesforce_service_1[a180_0xf4bce8(0x1c8)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a180_0xf4bce8(0x225)],git_provider_manager_1[a180_0xf4bce8(0x202)]])],FlosumCommitJob),exports[a180_0xf4bce8(0x218)]=FlosumCommitJob;