const a147_0x19e6ee=a147_0x178e;(function(_0x1f2c86,_0x507169){const _0x4afd06=a147_0x178e,_0x560495=_0x1f2c86();while(!![]){try{const _0x133f31=-parseInt(_0x4afd06(0x1ec))/0x1+-parseInt(_0x4afd06(0x1e7))/0x2*(-parseInt(_0x4afd06(0x1ef))/0x3)+parseInt(_0x4afd06(0x1d6))/0x4*(parseInt(_0x4afd06(0x1c4))/0x5)+parseInt(_0x4afd06(0x1eb))/0x6+parseInt(_0x4afd06(0x1db))/0x7*(-parseInt(_0x4afd06(0x1a5))/0x8)+parseInt(_0x4afd06(0x1c8))/0x9+-parseInt(_0x4afd06(0x1c5))/0xa;if(_0x133f31===_0x507169)break;else _0x560495['push'](_0x560495['shift']());}catch(_0x288ea8){_0x560495['push'](_0x560495['shift']());}}}(a147_0x1bcb,0x5c005));const a147_0xf88fa1=function(){let _0x37d2d0=!![];return function(_0x3cc2ab,_0x26b84f){const _0x271af7=_0x37d2d0?function(){const _0x28679f=a147_0x178e;if(_0x26b84f){const _0x4191c2=_0x26b84f[_0x28679f(0x1a6)](_0x3cc2ab,arguments);return _0x26b84f=null,_0x4191c2;}}:function(){};return _0x37d2d0=![],_0x271af7;};}(),a147_0x4c8c08=a147_0xf88fa1(this,function(){const _0x551dd5=a147_0x178e;return a147_0x4c8c08[_0x551dd5(0x1bd)]()[_0x551dd5(0x1f4)]('(((.+)+)+)+$')[_0x551dd5(0x1bd)]()[_0x551dd5(0x1d3)](a147_0x4c8c08)['search'](_0x551dd5(0x1c2));});a147_0x4c8c08();'use strict';var __decorate=this&&this['__decorate']||function(_0x48a146,_0x3d20e4,_0x569db8,_0x1bfa00){const _0x581d8f=a147_0x178e;var _0xf28b67=arguments[_0x581d8f(0x1dc)],_0x334fca=_0xf28b67<0x3?_0x3d20e4:_0x1bfa00===null?_0x1bfa00=Object[_0x581d8f(0x1be)](_0x3d20e4,_0x569db8):_0x1bfa00,_0x5f5998;if(typeof Reflect===_0x581d8f(0x1e3)&&typeof Reflect['decorate']===_0x581d8f(0x1ac))_0x334fca=Reflect['decorate'](_0x48a146,_0x3d20e4,_0x569db8,_0x1bfa00);else{for(var _0x22f2c0=_0x48a146[_0x581d8f(0x1dc)]-0x1;_0x22f2c0>=0x0;_0x22f2c0--)if(_0x5f5998=_0x48a146[_0x22f2c0])_0x334fca=(_0xf28b67<0x3?_0x5f5998(_0x334fca):_0xf28b67>0x3?_0x5f5998(_0x3d20e4,_0x569db8,_0x334fca):_0x5f5998(_0x3d20e4,_0x569db8))||_0x334fca;}return _0xf28b67>0x3&&_0x334fca&&Object[_0x581d8f(0x1b0)](_0x3d20e4,_0x569db8,_0x334fca),_0x334fca;},__metadata=this&&this[a147_0x19e6ee(0x1c9)]||function(_0x177cba,_0xe18222){const _0x1b0b2a=a147_0x19e6ee;if(typeof Reflect===_0x1b0b2a(0x1e3)&&typeof Reflect[_0x1b0b2a(0x1b2)]===_0x1b0b2a(0x1ac))return Reflect[_0x1b0b2a(0x1b2)](_0x177cba,_0xe18222);};Object[a147_0x19e6ee(0x1b0)](exports,a147_0x19e6ee(0x1f2),{'value':!![]}),exports[a147_0x19e6ee(0x1d4)]=void 0x0;const core_1=require('../../../core'),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require('../../shared/git-provider.manager'),typedi_1=require(a147_0x19e6ee(0x19c)),errors_1=require(a147_0x19e6ee(0x1e9)),bad_request_error_1=require(a147_0x19e6ee(0x1b1)),salesforce_retriever_service_1=require(a147_0x19e6ee(0x1d0)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require('./commit-components.job'),logger=new core_1['Logger'](a147_0x19e6ee(0x1c1));let FlosumCommitJob=class FlosumCommitJob{constructor(_0xbd7128,_0x3c47fd,_0x5700c3,_0x497fb6){const _0x6382b3=a147_0x19e6ee;this[_0x6382b3(0x1b7)]=_0xbd7128,this['commitJob']=_0x3c47fd,this[_0x6382b3(0x1e1)]=_0x5700c3,this[_0x6382b3(0x1b9)]=_0x497fb6,this['repoService']=this[_0x6382b3(0x1b9)][_0x6382b3(0x1bb)]();}[a147_0x19e6ee(0x1cf)](_0x4eda51){const _0x2394a8=a147_0x19e6ee;return this['logger'][_0x2394a8(0x1cf)]('[COMMIT]\x20['+this[_0x2394a8(0x1b9)][_0x2394a8(0x1c7)][_0x2394a8(0x1d5)]()+_0x2394a8(0x1e0)+this[_0x2394a8(0x1a9)][_0x2394a8(0x1cc)]+_0x2394a8(0x1b8)+this[_0x2394a8(0x1c6)]['name']+']\x20'+_0x4eda51);}async[a147_0x19e6ee(0x1d9)](){const _0xc2f009=a147_0x19e6ee;try{if(this[_0xc2f009(0x1e6)][_0xc2f009(0x1dd)])this[_0xc2f009(0x1ea)]=await this['salesforceSync'][_0xc2f009(0x1d7)](this[_0xc2f009(0x1e6)][_0xc2f009(0x1dd)]);else this[_0xc2f009(0x1e6)]['syncBranchId']&&(this[_0xc2f009(0x1ea)]=await this['salesforceSync']['getBranchRecord'](this['commitData'][_0xc2f009(0x1a4)]));}catch(_0x19efa6){throw new bad_request_error_1[(_0xc2f009(0x1b4))](errors_1[_0xc2f009(0x19a)]);}}async[a147_0x19e6ee(0x1da)](){const _0x1f4fe5=a147_0x19e6ee;if(!this[_0x1f4fe5(0x1e6)][_0x1f4fe5(0x1cb)])return[];const _0x536797=await this[_0x1f4fe5(0x1b7)]['retrieveAttachment'](this[_0x1f4fe5(0x1e6)][_0x1f4fe5(0x1cb)])['then'](_0xd30922=>_0xd30922[_0x1f4fe5(0x1a1)]('\x20')['map'](_0x2727c8=>_0x2727c8[_0x1f4fe5(0x1a0)]())),_0x58e31d=new salesforce_retriever_service_1[(_0x1f4fe5(0x1d2))](this['salesforceService']),_0x522862=await _0x58e31d[_0x1f4fe5(0x1a7)](_0x536797);return _0x522862;}async[a147_0x19e6ee(0x1b6)](){const _0x204bdf=a147_0x19e6ee;if(!this[_0x204bdf(0x1e6)]['deleteAttachmentId'])return[];const _0xd44ddc=await this[_0x204bdf(0x1b7)][_0x204bdf(0x1f5)](this[_0x204bdf(0x1e6)][_0x204bdf(0x1bc)]);return _0xd44ddc;}async['getCommitDto'](){const _0x4aff4b=a147_0x19e6ee,_0x6ce30a=new commit_components_dto_1[(_0x4aff4b(0x1ba))](),[_0x4b2cf0,_0x164b40]=await Promise[_0x4aff4b(0x1de)]([this[_0x4aff4b(0x1da)](),this['getComponentsToDelete']()]);return _0x6ce30a['message']=this[_0x4aff4b(0x1e6)][_0x4aff4b(0x19b)],_0x6ce30a[_0x4aff4b(0x1f3)]=this['commitData'][_0x4aff4b(0x1f3)],_0x6ce30a['components']={'writed':_0x4b2cf0,'deleted':_0x164b40},_0x6ce30a[_0x4aff4b(0x1e4)]=this[_0x4aff4b(0x1e6)]['convertToSFDX'],_0x6ce30a[_0x4aff4b(0x1a2)]=this[_0x4aff4b(0x1a9)],_0x6ce30a[_0x4aff4b(0x1c6)]=this[_0x4aff4b(0x1c6)],_0x6ce30a;}async[a147_0x19e6ee(0x1f1)](_0xf1342e=![]){const _0x1962e1=a147_0x19e6ee;if(_0xf1342e)await this[_0x1962e1(0x1e1)][_0x1962e1(0x1ed)](this['repositoryData'],{});else{const _0xf8a131=await this[_0x1962e1(0x1a9)]['branches']['getOne'](this[_0x1962e1(0x1c6)]['name']);this['log'](_0x1962e1(0x1df));const _0x1f451b={[this['repository']['gitUrl']]:{'lastCommit':_0xf8a131[_0x1962e1(0x1ce)]}};await this[_0x1962e1(0x1e1)][_0x1962e1(0x1ed)](this['repositoryData'],_0x1f451b);}}async['exec'](){const _0xb4ac96=a147_0x19e6ee,_0x2a2033=await this[_0xb4ac96(0x1d1)]();this['commitJob'][_0xb4ac96(0x1ad)]=this['logger'],await this['salesforceSync']['setStatus'](this[_0xb4ac96(0x1ea)],_0xb4ac96(0x1cd)),await this[_0xb4ac96(0x19f)]['run'](_0x2a2033),await this['updateLastCommit'](),this[_0xb4ac96(0x1e6)][_0xb4ac96(0x1cb)]&&await this[_0xb4ac96(0x1b7)][_0xb4ac96(0x1e2)](this[_0xb4ac96(0x1e6)][_0xb4ac96(0x1cb)]),this[_0xb4ac96(0x1e6)][_0xb4ac96(0x1bc)]&&await this[_0xb4ac96(0x1b7)][_0xb4ac96(0x1e2)](this[_0xb4ac96(0x1e6)]['deleteAttachmentId']),await this[_0xb4ac96(0x1e1)][_0xb4ac96(0x1bf)](this[_0xb4ac96(0x1ea)],_0xb4ac96(0x19d));}async['handleCommitJobError'](_0x548c35){const _0xe2f878=a147_0x19e6ee;try{this[_0xe2f878(0x1ad)][_0xe2f878(0x1cf)](_0xe2f878(0x19e)+_0x548c35),await this['logger']['send'](),await this['updateLastCommit'](!![]),await this[_0xe2f878(0x1e1)][_0xe2f878(0x1bf)](this['repositoryData'],_0xe2f878(0x1c0));}catch(_0x2d1eb6){logger['error'](_0x2d1eb6);}}async['run'](_0x5a6ae4,_0x5a4507){const _0x1ad194=a147_0x19e6ee;try{this[_0x1ad194(0x1e6)]=_0x5a6ae4,this[_0x1ad194(0x1b7)][_0x1ad194(0x1ab)](_0x5a4507),this[_0x1ad194(0x1ad)]=this[_0x1ad194(0x1b7)][_0x1ad194(0x1a8)](),await this[_0x1ad194(0x1d9)]();if(!this['repositoryData'])throw new bad_request_error_1[(_0x1ad194(0x1b4))](errors_1[_0x1ad194(0x1ae)]);this[_0x1ad194(0x1a9)]=await this[_0x1ad194(0x1c3)][_0x1ad194(0x1f6)](this[_0x1ad194(0x1ea)][_0x1ad194(0x1e8)]),this[_0x1ad194(0x1c6)]=await this['repository'][_0x1ad194(0x1af)][_0x1ad194(0x1f6)](this['repositoryData'][_0x1ad194(0x1aa)]),this['log'](_0x1ad194(0x1a3)),this[_0x1ad194(0x1f0)]()['catch'](_0x3d7e0e=>this[_0x1ad194(0x1b5)](_0x3d7e0e));}catch(_0x54b80){this[_0x1ad194(0x1e6)]=undefined,logger[_0x1ad194(0x1b3)](_0x54b80);throw _0x54b80;}}};function a147_0x1bcb(){const _0x5411f2=['Completed','[ERROR]\x20','commitJob','trim','split','repo','[INFO]\x20Start\x20commit\x20job','syncBranchId','8hykBCt','apply','run','getLogger','repository','branchName','setLoggerId','function','logger','ERR_UNKNOWN_SYNC_RECORD_ID','branches','defineProperty','../../../core/errors/bad-request.error','metadata','error','BadRequestError','handleCommitJobError','getComponentsToDelete','salesforceService',']\x20[Branch:\x20','gitManager','CommitComponentsDto','getRepoService','deleteAttachmentId','toString','getOwnPropertyDescriptor','setStatus','Error','flosum-commit-job','(((.+)+)+)+$','repoService','314740VvIdHq','2741410WmJbFS','branch','provider','3859677vzZYLn','__metadata','GitProviderManager','commitAttachmentId','name','In\x20Progress','sha','log','../../salesforce/services/salesforce-retriever.service','getCommitDto','SalesforceRetrieverService','constructor','FlosumCommitJob','toUpperCase','4MxUqjY','getRepositoryRecord','SalesforceSyncService','fetchRepositoryData','getComponentsToWrite','1775053uhKwCs','length','syncRepositoryId','all','[INFO]\x20Update\x20remote\x20state.',']\x20[Repository:\x20','salesforceSync','deleteAttachment','object','convertToSFDX','SalesforceService','commitData','1118RqmhaO','repositoryName','../../../constants/errors','repositoryData','4284936ffKAVw','307549bZHnrD','updateRemoteState','design:paramtypes','33ldvpYI','exec','updateLastCommit','__esModule','user','search','retrieveAttachment','getOne','ERR_INVALID_SYNC_RECORD_ID','message','typedi'];a147_0x1bcb=function(){return _0x5411f2;};return a147_0x1bcb();}function a147_0x178e(_0xb0d8df,_0x17e071){const _0x1dae9e=a147_0x1bcb();return a147_0x178e=function(_0x4c8c08,_0xf88fa1){_0x4c8c08=_0x4c8c08-0x19a;let _0x1bcb74=_0x1dae9e[_0x4c8c08];return _0x1bcb74;},a147_0x178e(_0xb0d8df,_0x17e071);}FlosumCommitJob=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a147_0x19e6ee(0x1ee),[salesforce_service_1[a147_0x19e6ee(0x1e5)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a147_0x19e6ee(0x1d8)],git_provider_manager_1[a147_0x19e6ee(0x1ca)]])],FlosumCommitJob),exports[a147_0x19e6ee(0x1d4)]=FlosumCommitJob;