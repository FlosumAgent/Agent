const a174_0x546049=a174_0x568c;(function(_0x44cbf2,_0x425947){const _0x49922c=a174_0x568c,_0x1424b3=_0x44cbf2();while(!![]){try{const _0x5024a6=parseInt(_0x49922c(0x1ed))/0x1*(-parseInt(_0x49922c(0x210))/0x2)+-parseInt(_0x49922c(0x1ff))/0x3+-parseInt(_0x49922c(0x1da))/0x4+parseInt(_0x49922c(0x223))/0x5+-parseInt(_0x49922c(0x1ef))/0x6+parseInt(_0x49922c(0x1e1))/0x7*(parseInt(_0x49922c(0x212))/0x8)+parseInt(_0x49922c(0x1d1))/0x9*(parseInt(_0x49922c(0x1d2))/0xa);if(_0x5024a6===_0x425947)break;else _0x1424b3['push'](_0x1424b3['shift']());}catch(_0x15d3d7){_0x1424b3['push'](_0x1424b3['shift']());}}}(a174_0x583c,0x29dd0));const a174_0x3d1e45=function(){let _0x478e05=!![];return function(_0x4acc30,_0x56fc46){const _0x2b540c=_0x478e05?function(){const _0x3177cb=a174_0x568c;if(_0x56fc46){const _0x1bea32=_0x56fc46[_0x3177cb(0x1d3)](_0x4acc30,arguments);return _0x56fc46=null,_0x1bea32;}}:function(){};return _0x478e05=![],_0x2b540c;};}(),a174_0x4c826d=a174_0x3d1e45(this,function(){const _0x191bc1=a174_0x568c;return a174_0x4c826d[_0x191bc1(0x1cb)]()[_0x191bc1(0x1e3)]('(((.+)+)+)+$')[_0x191bc1(0x1cb)]()['constructor'](a174_0x4c826d)[_0x191bc1(0x1e3)](_0x191bc1(0x21d));});a174_0x4c826d();'use strict';var __decorate=this&&this[a174_0x546049(0x21f)]||function(_0x2b2841,_0x497909,_0x52d01f,_0x13108d){const _0x2584ac=a174_0x546049;var _0x3f0683=arguments['length'],_0x3afc97=_0x3f0683<0x3?_0x497909:_0x13108d===null?_0x13108d=Object['getOwnPropertyDescriptor'](_0x497909,_0x52d01f):_0x13108d,_0x217f85;if(typeof Reflect===_0x2584ac(0x1eb)&&typeof Reflect[_0x2584ac(0x1f0)]==='function')_0x3afc97=Reflect[_0x2584ac(0x1f0)](_0x2b2841,_0x497909,_0x52d01f,_0x13108d);else{for(var _0x88a5d3=_0x2b2841['length']-0x1;_0x88a5d3>=0x0;_0x88a5d3--)if(_0x217f85=_0x2b2841[_0x88a5d3])_0x3afc97=(_0x3f0683<0x3?_0x217f85(_0x3afc97):_0x3f0683>0x3?_0x217f85(_0x497909,_0x52d01f,_0x3afc97):_0x217f85(_0x497909,_0x52d01f))||_0x3afc97;}return _0x3f0683>0x3&&_0x3afc97&&Object[_0x2584ac(0x1cf)](_0x497909,_0x52d01f,_0x3afc97),_0x3afc97;},__metadata=this&&this[a174_0x546049(0x1ec)]||function(_0x52284c,_0x53efa1){const _0x3007da=a174_0x546049;if(typeof Reflect===_0x3007da(0x1eb)&&typeof Reflect[_0x3007da(0x204)]===_0x3007da(0x1fa))return Reflect['metadata'](_0x52284c,_0x53efa1);},FlosumCommitJob_1;Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a174_0x546049(0x213)]=void 0x0;function a174_0x568c(_0x4b254e,_0xdc082c){const _0xd9cbd2=a174_0x583c();return a174_0x568c=function(_0x4c826d,_0x3d1e45){_0x4c826d=_0x4c826d-0x1c7;let _0x583c4d=_0xd9cbd2[_0x4c826d];return _0x583c4d;},a174_0x568c(_0x4b254e,_0xdc082c);}const core_1=require('../../../core'),salesforce_logger_v2_service_1=require(a174_0x546049(0x1e9)),salesforce_service_1=require(a174_0x546049(0x1d8)),git_provider_manager_1=require(a174_0x546049(0x22b)),typedi_1=require(a174_0x546049(0x222)),errors_1=require(a174_0x546049(0x1cc)),bad_request_error_1=require(a174_0x546049(0x226)),salesforce_retriever_service_1=require(a174_0x546049(0x1d0)),salesforce_sync_service_1=require(a174_0x546049(0x214)),commit_components_dto_1=require('../dto/commit-components.dto'),commit_components_job_1=require(a174_0x546049(0x1fe));function a174_0x583c(){const _0x38d678=['error','1582002mamiJV','decorate','name','getCommitDto','split','Completed','deleteAttachment','CommitComponentsJob','trim','BadRequestError','getRepositoryRecord','function','all','logger','getComponentsToWrite','./commit-components.job','992253vwdTgZ','components','repositoryData','send','exec','metadata','provider','salesforceService','sha','repo','branch','getPrefix','handleCommitJobError','getBranchRecord','Logger','user','message','39578AfvagM','commitAttachmentId','8JQjcZy','FlosumCommitJob','../../salesforce/services/salesforce-sync.service','SalesforceService','getRepoService','gitUrl','deleteAttachmentId','syncRepositoryId','GitProviderManager','updateRemoteState','catch','(((.+)+)+)+$','setStatus','__decorate','convertToSFDX','SalesforceRetrieverService','typedi','1117460obXNrR','salesforceSync','sfLogger','../../../core/errors/bad-request.error','updateLastCommit','repositoryName','log','syncBranchId','../../shared/git-provider.manager','commitData','repository',']\x20[Repository:\x20','getOne','toString','../../../constants/errors','map','gitManager','defineProperty','../../salesforce/services/salesforce-retriever.service','27jGfblx','2478790RFTLDn','apply','getLoggerId','ERR_UNKNOWN_SYNC_RECORD_ID',']\x20[Branch:\x20','In\x20Progress','../../salesforce/services/salesforce.service','design:paramtypes','317332MeQogQ','[INFO]\x20Update\x20remote\x20state.','commitJob','\x20[COMMIT]','retrieveAttachment','[FLOSUM\x20->\x20GIT]\x20[','branches','1501549uDyhdK','run','search','repoService','getComponentsToDelete','branchName','then','ERR_INVALID_SYNC_RECORD_ID','../../salesforce/services/salesforce-logger-v2.service','fetchRepositoryData','object','__metadata','17VTXqxK'];a174_0x583c=function(){return _0x38d678;};return a174_0x583c();}let FlosumCommitJob=FlosumCommitJob_1=class FlosumCommitJob{constructor(_0x45a593,_0x39fba9,_0x48a9e5,_0x51865b){const _0xd017be=a174_0x546049;this[_0xd017be(0x206)]=_0x45a593,this[_0xd017be(0x1dc)]=_0x39fba9,this[_0xd017be(0x224)]=_0x48a9e5,this['gitManager']=_0x51865b,this[_0xd017be(0x1e4)]=this[_0xd017be(0x1ce)][_0xd017be(0x216)](),this['logger']=new core_1[(_0xd017be(0x20d))](FlosumCommitJob_1[_0xd017be(0x1f1)]);}async[a174_0x546049(0x1ea)](){const _0xe76299=a174_0x546049;try{if(this[_0xe76299(0x1c7)][_0xe76299(0x219)])this[_0xe76299(0x201)]=await this[_0xe76299(0x224)][_0xe76299(0x1f9)](this['commitData']['syncRepositoryId']);else this[_0xe76299(0x1c7)][_0xe76299(0x22a)]&&(this['repositoryData']=await this[_0xe76299(0x224)][_0xe76299(0x20c)](this[_0xe76299(0x1c7)]['syncBranchId']));}catch(_0x4e1fcb){throw new bad_request_error_1[(_0xe76299(0x1f8))](errors_1[_0xe76299(0x1e8)]);}}async[a174_0x546049(0x1fd)](){const _0x344a07=a174_0x546049;if(!this[_0x344a07(0x1c7)][_0x344a07(0x211)])return[];const _0x3332ff=await this[_0x344a07(0x206)][_0x344a07(0x1de)](this['commitData'][_0x344a07(0x211)])[_0x344a07(0x1e7)](_0x195da7=>_0x195da7[_0x344a07(0x1f3)]('\x20')[_0x344a07(0x1cd)](_0xaeaf3c=>_0xaeaf3c[_0x344a07(0x1f7)]())),_0x3d8027=new salesforce_retriever_service_1[(_0x344a07(0x221))](this[_0x344a07(0x206)]),_0x16654d=await _0x3d8027[_0x344a07(0x1e2)](_0x3332ff);return _0x16654d;}async['getComponentsToDelete'](){const _0x475557=a174_0x546049;if(!this[_0x475557(0x1c7)][_0x475557(0x218)])return[];const _0x91c4fa=await this[_0x475557(0x206)][_0x475557(0x1de)](this['commitData'][_0x475557(0x218)]);return _0x91c4fa;}async[a174_0x546049(0x1f2)](){const _0xc550ad=a174_0x546049,_0x3432bc=new commit_components_dto_1['CommitComponentsDto'](),[_0x531f44,_0x15fb0f]=await Promise[_0xc550ad(0x1fb)]([this[_0xc550ad(0x1fd)](),this[_0xc550ad(0x1e5)]()]);return _0x3432bc[_0xc550ad(0x20f)]=this[_0xc550ad(0x1c7)][_0xc550ad(0x20f)],_0x3432bc[_0xc550ad(0x20e)]=this['commitData'][_0xc550ad(0x20e)],_0x3432bc[_0xc550ad(0x200)]={'writed':_0x531f44,'deleted':_0x15fb0f},_0x3432bc[_0xc550ad(0x220)]=this['commitData']['convertToSFDX'],_0x3432bc[_0xc550ad(0x208)]=this[_0xc550ad(0x1c8)],_0x3432bc['branch']=this[_0xc550ad(0x209)],_0x3432bc['provider']=this[_0xc550ad(0x205)],_0x3432bc;}async['updateLastCommit'](_0x5a5816=![]){const _0x4e11d6=a174_0x546049;if(_0x5a5816)await this[_0x4e11d6(0x224)][_0x4e11d6(0x21b)](this[_0x4e11d6(0x201)],{});else{const _0x2ad907=await this[_0x4e11d6(0x1c8)][_0x4e11d6(0x1e0)]['getOne'](this['branch']['name']);this['sfLogger'][_0x4e11d6(0x229)](_0x4e11d6(0x1db));const _0x3e3bcc={[this[_0x4e11d6(0x1c8)][_0x4e11d6(0x217)]]:{'lastCommit':_0x2ad907[_0x4e11d6(0x207)]}};await this[_0x4e11d6(0x224)]['updateRemoteState'](this[_0x4e11d6(0x201)],_0x3e3bcc);}}async[a174_0x546049(0x203)](){const _0x37cdfa=a174_0x546049,_0x1b2be8=await this['getCommitDto']();await this[_0x37cdfa(0x224)][_0x37cdfa(0x21e)](this['repositoryData'],_0x37cdfa(0x1d7)),await this[_0x37cdfa(0x1dc)][_0x37cdfa(0x1e2)](_0x1b2be8,this['sfLogger']),await this[_0x37cdfa(0x227)](),this[_0x37cdfa(0x1c7)][_0x37cdfa(0x211)]&&await this[_0x37cdfa(0x206)][_0x37cdfa(0x1f5)](this['commitData']['commitAttachmentId']),this[_0x37cdfa(0x1c7)][_0x37cdfa(0x218)]&&await this[_0x37cdfa(0x206)]['deleteAttachment'](this[_0x37cdfa(0x1c7)][_0x37cdfa(0x218)]),await this['salesforceSync']['setStatus'](this['repositoryData'],_0x37cdfa(0x1f4));}async[a174_0x546049(0x20b)](_0x54a4c8){const _0x15ad9c=a174_0x546049;try{this['sfLogger'][_0x15ad9c(0x229)]('[ERROR]\x20'+_0x54a4c8),await this[_0x15ad9c(0x225)][_0x15ad9c(0x202)](),await this[_0x15ad9c(0x227)](!![]),await this[_0x15ad9c(0x224)][_0x15ad9c(0x21e)](this[_0x15ad9c(0x201)],'Error');}catch(_0x34b3f9){this[_0x15ad9c(0x1fc)][_0x15ad9c(0x1ee)](_0x34b3f9);}}async[a174_0x546049(0x1e2)](_0x122be3,_0x51d59c,_0x2c6915){const _0x25bef8=a174_0x546049;try{this[_0x25bef8(0x1c7)]=_0x122be3,this[_0x25bef8(0x205)]=_0x2c6915,await this['fetchRepositoryData'](),this['sfLogger']=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x51d59c[_0x25bef8(0x1d4)](),(_0x51d59c[_0x25bef8(0x20a)]()||_0x25bef8(0x1df)+_0x2c6915['toUpperCase']()+_0x25bef8(0x1c9)+this[_0x25bef8(0x201)][_0x25bef8(0x228)]+_0x25bef8(0x1d6)+this[_0x25bef8(0x201)][_0x25bef8(0x1e6)]+']')+_0x25bef8(0x1dd));if(!this[_0x25bef8(0x201)])throw new bad_request_error_1[(_0x25bef8(0x1f8))](errors_1[_0x25bef8(0x1d5)]);this[_0x25bef8(0x1c8)]=await this[_0x25bef8(0x1e4)][_0x25bef8(0x1ca)](this['repositoryData'][_0x25bef8(0x228)]),this[_0x25bef8(0x209)]=await this['repository']['branches'][_0x25bef8(0x1ca)](this[_0x25bef8(0x201)]['branchName']),this['sfLogger'][_0x25bef8(0x229)]('[INFO]\x20Start\x20commit\x20job'),this[_0x25bef8(0x203)]()[_0x25bef8(0x21c)](_0x536423=>this[_0x25bef8(0x20b)](_0x536423));}catch(_0x57183c){this[_0x25bef8(0x1c7)]=undefined,this[_0x25bef8(0x1fc)][_0x25bef8(0x1ee)](_0x57183c);throw _0x57183c;}}};FlosumCommitJob=FlosumCommitJob_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a174_0x546049(0x1d9),[salesforce_service_1[a174_0x546049(0x215)],commit_components_job_1[a174_0x546049(0x1f6)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a174_0x546049(0x21a)]])],FlosumCommitJob),exports[a174_0x546049(0x213)]=FlosumCommitJob;