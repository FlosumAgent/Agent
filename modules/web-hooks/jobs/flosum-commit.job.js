const a145_0x42a3=['salesforceService','branches','encodeBase64','CommitComponentsJob','length','getComponentsToWrite','SalesforceSyncService','deleteAttachmentId','ERR_INVALID_SYNC_RECORD_ID','getComponentsToDelete','name','Logger','SalesforceRetrieverService','repositoryData','handleCommitJobError','898135xkpDlU','../../salesforce/services/salesforce.service','toUpperCase','decorate','components','trim','salesforceSync','catch','log',']\x20[Branch:\x20','../../../constants/errors','811081nouLib','user','flosum-commit-job','In\x20Progress','repository','__esModule','commitJob','BadRequestError','__decorate','FlosumCommitJob','181587oRwUyx','Completed','Error','branch','setStatus','./commit-components.job','gitManager','defineProperty','../../../core','Service','exec','getRepoService','960381nsUjUy','constructor','1uKsqrN','return\x20/\x22\x20+\x20this\x20+\x20\x22/','then','metadata','[COMMIT]\x20[','syncBranchId','commitAttachmentId','getLogger','split','fetchRepositoryData','updateLastCommit','getBranchRecord','deleteAttachment','GitProviderManager','retrieveAttachment','4xevIFS','77303fOyFbH','getCommitDto','gitUrl','patchObject','[INFO]\x20Update\x20remote\x20state.','[INFO]\x20Start\x20commit\x20job','../../salesforce/services/salesforce-retriever.service','map','sha','../dto/commit-components.dto','error','getOwnPropertyDescriptor','test','convertToSFDX','run',']\x20[Repository:\x20','getRepositoryRecord','all','logger','../../salesforce/services/salesforce-sync.service','function','getOne','apply','302576XOvqGU','commitData','../../shared/git-provider.manager','repoService','repo','../../../core/errors/bad-request.error','stringify','message','getAttachmentId','syncRepositoryId','object','597500oVEeBh'];const a145_0x9842a0=a145_0x557b;(function(_0x1a86da,_0x248a7c){const _0x18b330=a145_0x557b;while(!![]){try{const _0x398549=-parseInt(_0x18b330(0xb4))+parseInt(_0x18b330(0xe7))*parseInt(_0x18b330(0xcf))+parseInt(_0x18b330(0xe5))+-parseInt(_0x18b330(0xf6))*-parseInt(_0x18b330(0xf7))+-parseInt(_0x18b330(0xd9))+parseInt(_0x18b330(0x10e))+-parseInt(_0x18b330(0xc4));if(_0x398549===_0x248a7c)break;else _0x1a86da['push'](_0x1a86da['shift']());}catch(_0x3d9e2e){_0x1a86da['push'](_0x1a86da['shift']());}}}(a145_0x42a3,0xac5ec));const a145_0x1bc14f=function(){let _0x1fba00=!![];return function(_0x57dde2,_0x2d5817){const _0x48e936=_0x1fba00?function(){const _0x52477c=a145_0x557b;if(_0x2d5817){const _0x3d71e9=_0x2d5817[_0x52477c(0x10d)](_0x57dde2,arguments);return _0x2d5817=null,_0x3d71e9;}}:function(){};return _0x1fba00=![],_0x48e936;};}(),a145_0x271b5b=a145_0x1bc14f(this,function(){const _0x5084e4=function(){const _0x2d1f38=a145_0x557b,_0x4099e2=_0x5084e4[_0x2d1f38(0xe6)](_0x2d1f38(0xe8))()[_0x2d1f38(0xe6)]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x4099e2[_0x2d1f38(0x103)](a145_0x271b5b);};return _0x5084e4();});a145_0x271b5b();'use strict';var __decorate=this&&this[a145_0x9842a0(0xd7)]||function(_0x52e30d,_0x1c5387,_0x11d8d0,_0x37982a){const _0x1896d7=a145_0x9842a0;var _0x678ab=arguments[_0x1896d7(0xb9)],_0x2c7add=_0x678ab<0x3?_0x1c5387:_0x37982a===null?_0x37982a=Object[_0x1896d7(0x102)](_0x1c5387,_0x11d8d0):_0x37982a,_0x58807c;if(typeof Reflect===_0x1896d7(0xb3)&&typeof Reflect[_0x1896d7(0xc7)]==='function')_0x2c7add=Reflect[_0x1896d7(0xc7)](_0x52e30d,_0x1c5387,_0x11d8d0,_0x37982a);else{for(var _0x59a248=_0x52e30d[_0x1896d7(0xb9)]-0x1;_0x59a248>=0x0;_0x59a248--)if(_0x58807c=_0x52e30d[_0x59a248])_0x2c7add=(_0x678ab<0x3?_0x58807c(_0x2c7add):_0x678ab>0x3?_0x58807c(_0x1c5387,_0x11d8d0,_0x2c7add):_0x58807c(_0x1c5387,_0x11d8d0))||_0x2c7add;}return _0x678ab>0x3&&_0x2c7add&&Object[_0x1896d7(0xe0)](_0x1c5387,_0x11d8d0,_0x2c7add),_0x2c7add;},__metadata=this&&this['__metadata']||function(_0x50529d,_0x5377ef){const _0x2e9fe3=a145_0x9842a0;if(typeof Reflect===_0x2e9fe3(0xb3)&&typeof Reflect['metadata']===_0x2e9fe3(0x10b))return Reflect[_0x2e9fe3(0xea)](_0x50529d,_0x5377ef);};Object[a145_0x9842a0(0xe0)](exports,a145_0x9842a0(0xd4),{'value':!![]}),exports[a145_0x9842a0(0xd8)]=void 0x0;const core_1=require(a145_0x9842a0(0xe1)),salesforce_service_1=require(a145_0x9842a0(0xc5)),git_provider_manager_1=require(a145_0x9842a0(0x110)),typedi_1=require('typedi'),errors_1=require(a145_0x9842a0(0xce)),bad_request_error_1=require(a145_0x9842a0(0x113)),salesforce_retriever_service_1=require(a145_0x9842a0(0xfd)),salesforce_sync_service_1=require(a145_0x9842a0(0x10a)),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a145_0x9842a0(0x100)),commit_components_job_1=require(a145_0x9842a0(0xde)),logger=new core_1[(a145_0x9842a0(0xc0))](a145_0x9842a0(0xd1));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x1ace77,_0xcb86b0,_0x22af51,_0x571f96){const _0x40a612=a145_0x9842a0;this[_0x40a612(0xb5)]=_0x1ace77,this['commitJob']=_0xcb86b0,this['salesforceSync']=_0x22af51,this['gitManager']=_0x571f96,this[_0x40a612(0x111)]=this['gitManager'][_0x40a612(0xe4)]();}[a145_0x9842a0(0xcc)](_0x5c51a4){const _0x2950e5=a145_0x9842a0;return this['logger']['log'](_0x2950e5(0xeb)+this[_0x2950e5(0xdf)]['provider'][_0x2950e5(0xc6)]()+_0x2950e5(0x106)+this[_0x2950e5(0xd3)]['name']+_0x2950e5(0xcd)+this['branch'][_0x2950e5(0xbf)]+']\x20'+_0x5c51a4);}async[a145_0x9842a0(0xf0)](){const _0x3fec5c=a145_0x9842a0;try{if(this[_0x3fec5c(0x10f)][_0x3fec5c(0xb2)])this[_0x3fec5c(0xc2)]=await this[_0x3fec5c(0xca)][_0x3fec5c(0x107)](this[_0x3fec5c(0x10f)][_0x3fec5c(0xb2)]);else this[_0x3fec5c(0x10f)][_0x3fec5c(0xec)]&&(this['repositoryData']=await this[_0x3fec5c(0xca)][_0x3fec5c(0xf2)](this[_0x3fec5c(0x10f)][_0x3fec5c(0xec)]));}catch(_0x2f99b0){throw new bad_request_error_1['BadRequestError'](errors_1[_0x3fec5c(0xbd)]);}}async[a145_0x9842a0(0xba)](){const _0xea1c14=a145_0x9842a0;if(!this[_0xea1c14(0x10f)][_0xea1c14(0xed)])return[];const _0x4dfc1d=await this[_0xea1c14(0xb5)][_0xea1c14(0xf5)](this[_0xea1c14(0x10f)][_0xea1c14(0xed)])[_0xea1c14(0xe9)](_0x482429=>_0x482429[_0xea1c14(0xef)]('\x20')[_0xea1c14(0xfe)](_0x3a31c5=>_0x3a31c5[_0xea1c14(0xc9)]())),_0x2c00c4=new salesforce_retriever_service_1[(_0xea1c14(0xc1))](this[_0xea1c14(0xb5)]),_0x4302de=await _0x2c00c4[_0xea1c14(0x105)](_0x4dfc1d);return _0x4302de;}async[a145_0x9842a0(0xbe)](){const _0x2f3c53=a145_0x9842a0;if(!this[_0x2f3c53(0x10f)][_0x2f3c53(0xbc)])return[];const _0x5119c5=await this['salesforceService'][_0x2f3c53(0xf5)](this['commitData'][_0x2f3c53(0xbc)]);return _0x5119c5;}async[a145_0x9842a0(0xf8)](){const _0x16f46a=a145_0x9842a0,_0x16e99=new commit_components_dto_1['CommitComponentsDto'](),[_0x24dc31,_0x2a343b]=await Promise[_0x16f46a(0x108)]([this[_0x16f46a(0xba)](),this[_0x16f46a(0xbe)]()]);return _0x16e99[_0x16f46a(0xb0)]=this[_0x16f46a(0x10f)][_0x16f46a(0xb0)],_0x16e99[_0x16f46a(0xd0)]=this[_0x16f46a(0x10f)][_0x16f46a(0xd0)],_0x16e99[_0x16f46a(0xc8)]={'writed':_0x24dc31,'deleted':_0x2a343b},_0x16e99[_0x16f46a(0x104)]=this[_0x16f46a(0x10f)]['convertToSFDX'],_0x16e99[_0x16f46a(0x112)]=this[_0x16f46a(0xd3)],_0x16e99['branch']=this[_0x16f46a(0xdc)],_0x16e99;}async['updateLastCommit'](_0x9b57aa=![]){const _0x2936b2=a145_0x9842a0,_0x29b7b8=await this['salesforceSync'][_0x2936b2(0xb1)](this[_0x2936b2(0xc2)]);if(_0x9b57aa)await this[_0x2936b2(0xb5)][_0x2936b2(0xfa)]('Attachment',_0x29b7b8,{'Body':utils_1[_0x2936b2(0xb7)](JSON[_0x2936b2(0xaf)]({}))});else{const _0x337e20=await this[_0x2936b2(0xd3)][_0x2936b2(0xb6)]['getOne'](this[_0x2936b2(0xdc)][_0x2936b2(0xbf)]);this[_0x2936b2(0xcc)](_0x2936b2(0xfb));const _0x3fa079={[this['repository'][_0x2936b2(0xf9)]]:{'lastCommit':_0x337e20[_0x2936b2(0xff)]}};await this['salesforceService'][_0x2936b2(0xfa)]('Attachment',_0x29b7b8,{'Body':utils_1['encodeBase64'](JSON[_0x2936b2(0xaf)](_0x3fa079))});}}async[a145_0x9842a0(0xe3)](){const _0x71f888=a145_0x9842a0,_0x282700=await this['getCommitDto']();this[_0x71f888(0xd5)]['logger']=this[_0x71f888(0x109)],await this[_0x71f888(0xca)][_0x71f888(0xdd)](this[_0x71f888(0xc2)],_0x71f888(0xd2)),await this[_0x71f888(0xd5)][_0x71f888(0x105)](_0x282700),await this['updateLastCommit'](),this['commitData'][_0x71f888(0xed)]&&await this[_0x71f888(0xb5)][_0x71f888(0xf3)](this[_0x71f888(0x10f)][_0x71f888(0xed)]),this[_0x71f888(0x10f)]['deleteAttachmentId']&&await this[_0x71f888(0xb5)]['deleteAttachment'](this[_0x71f888(0x10f)][_0x71f888(0xbc)]),await this['salesforceSync'][_0x71f888(0xdd)](this[_0x71f888(0xc2)],_0x71f888(0xda));}async['handleCommitJobError'](_0x2aa995){const _0x1a4dfb=a145_0x9842a0;try{this[_0x1a4dfb(0x109)][_0x1a4dfb(0xcc)]('[ERROR]\x20'+_0x2aa995),await this[_0x1a4dfb(0x109)]['send'](),await this[_0x1a4dfb(0xf1)](!![]),await this[_0x1a4dfb(0xca)][_0x1a4dfb(0xdd)](this['repositoryData'],_0x1a4dfb(0xdb));}catch(_0x3340d5){logger[_0x1a4dfb(0x101)](_0x3340d5);}}async[a145_0x9842a0(0x105)](_0x56f653,_0x54622f){const _0x2b15c2=a145_0x9842a0;try{this['commitData']=_0x56f653,this['salesforceService']['setLoggerId'](_0x54622f),this[_0x2b15c2(0x109)]=this['salesforceService'][_0x2b15c2(0xee)](),await this[_0x2b15c2(0xf0)]();if(!this['repositoryData'])throw new bad_request_error_1[(_0x2b15c2(0xd6))](errors_1['ERR_UNKNOWN_SYNC_RECORD_ID']);this[_0x2b15c2(0xd3)]=await this['repoService'][_0x2b15c2(0x10c)](this[_0x2b15c2(0xc2)]['repositoryName']),this[_0x2b15c2(0xdc)]=await this[_0x2b15c2(0xd3)]['branches'][_0x2b15c2(0x10c)](this['repositoryData']['branchName']),this[_0x2b15c2(0xcc)](_0x2b15c2(0xfc)),this[_0x2b15c2(0xe3)]()[_0x2b15c2(0xcb)](_0x298a03=>this[_0x2b15c2(0xc3)](_0x298a03));}catch(_0x37b2c3){this['commitData']=undefined,logger[_0x2b15c2(0x101)](_0x37b2c3);throw _0x37b2c3;}}};function a145_0x557b(_0x158e72,_0x10b86f){return a145_0x557b=function(_0x40420d,_0x271b5b){_0x40420d=_0x40420d-0xaf;let _0x1bc14f=a145_0x42a3[_0x40420d];return _0x1bc14f;},a145_0x557b(_0x158e72,_0x10b86f);}FlosumCommitJob=__decorate([typedi_1[a145_0x9842a0(0xe2)]({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1['SalesforceService'],commit_components_job_1[a145_0x9842a0(0xb8)],salesforce_sync_service_1[a145_0x9842a0(0xbb)],git_provider_manager_1[a145_0x9842a0(0xf4)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;