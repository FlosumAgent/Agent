const a145_0x22d2=['245184zmVWaa','toUpperCase','../../../constants/errors','repositoryName','commitAttachmentId','__esModule','../../salesforce/services/salesforce-retriever.service','SalesforceSyncService','100137NEisQC','../dto/commit-components.dto','message','components','379731gWVwuF','repository','object','getCommitDto','923569XTNnYk','28486jDMGJL','ERR_UNKNOWN_SYNC_RECORD_ID','test','getComponentsToWrite','convertToSFDX','branch','1tPBvdZ','getOwnPropertyDescriptor','gitManager','[INFO]\x20Start\x20commit\x20job','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','syncBranchId','patchObject','CommitComponentsDto','../../salesforce/services/salesforce-sync.service','__decorate','BadRequestError','Logger','getBranchRecord','trim','salesforceService','getRepoService','Error','[INFO]\x20Update\x20remote\x20state.','updateLastCommit','stringify','1IFfQEc','repoService','metadata','230181XnLYSX','split','branchName','deleteAttachment','__metadata','log','defineProperty','commitJob',']\x20[Repository:\x20','retrieveAttachment','commitData','logger','./commit-components.job','flosum-commit-job','Completed',']\x20[Branch:\x20','repositoryData','length','then','salesforceSync','syncRepositoryId','decorate','setLoggerId','error','function','provider','SalesforceService','branches','gitUrl','setStatus','../../../core','name','encodeBase64','getLogger','3TZALqS','return\x20/\x22\x20+\x20this\x20+\x20\x22/','fetchRepositoryData','../../shared/git-provider.manager','Attachment','GitProviderManager','constructor','../../shared/utils','getComponentsToDelete','Service','repo','handleCommitJobError','run','design:paramtypes','catch','10819pMVwxO','deleteAttachmentId','1cAyfJm','getRepositoryRecord','FlosumCommitJob','[COMMIT]\x20[','getOne','ERR_INVALID_SYNC_RECORD_ID'];const a145_0x345e98=a145_0x44b9;(function(_0x6e02b5,_0x457661){const _0x20429=a145_0x44b9;while(!![]){try{const _0x87efd6=parseInt(_0x20429(0x14b))*parseInt(_0x20429(0x16a))+parseInt(_0x20429(0x16e))+parseInt(_0x20429(0x190))+parseInt(_0x20429(0x162))+-parseInt(_0x20429(0x18d))*parseInt(_0x20429(0x173))+parseInt(_0x20429(0x15a))*-parseInt(_0x20429(0x179))+parseInt(_0x20429(0x15c))*-parseInt(_0x20429(0x172));if(_0x87efd6===_0x457661)break;else _0x6e02b5['push'](_0x6e02b5['shift']());}catch(_0x286232){_0x6e02b5['push'](_0x6e02b5['shift']());}}}(a145_0x22d2,0x2f079));const a145_0x20343b=function(){let _0x3b235b=!![];return function(_0x20b3d1,_0x2be63a){const _0x297fb5=_0x3b235b?function(){if(_0x2be63a){const _0x484605=_0x2be63a['apply'](_0x20b3d1,arguments);return _0x2be63a=null,_0x484605;}}:function(){};return _0x3b235b=![],_0x297fb5;};}(),a145_0x53e66f=a145_0x20343b(this,function(){const _0x6e9e70=function(){const _0x1b7838=a145_0x44b9,_0x393b99=_0x6e9e70[_0x1b7838(0x151)](_0x1b7838(0x14c))()[_0x1b7838(0x151)](_0x1b7838(0x17d));return!_0x393b99[_0x1b7838(0x175)](a145_0x53e66f);};return _0x6e9e70();});a145_0x53e66f();function a145_0x44b9(_0x56e46c,_0x2c88db){return a145_0x44b9=function(_0x9ce53,_0x53e66f){_0x9ce53=_0x9ce53-0x13d;let _0x20343b=a145_0x22d2[_0x9ce53];return _0x20343b;},a145_0x44b9(_0x56e46c,_0x2c88db);}'use strict';var __decorate=this&&this[a145_0x345e98(0x182)]||function(_0x5bdf31,_0x4498c2,_0x221d17,_0x1c37c7){const _0x23bda4=a145_0x345e98;var _0x4156a5=arguments[_0x23bda4(0x1a1)],_0x4ae78e=_0x4156a5<0x3?_0x4498c2:_0x1c37c7===null?_0x1c37c7=Object[_0x23bda4(0x17a)](_0x4498c2,_0x221d17):_0x1c37c7,_0x37d551;if(typeof Reflect===_0x23bda4(0x170)&&typeof Reflect[_0x23bda4(0x13e)]==='function')_0x4ae78e=Reflect[_0x23bda4(0x13e)](_0x5bdf31,_0x4498c2,_0x221d17,_0x1c37c7);else{for(var _0x30e880=_0x5bdf31[_0x23bda4(0x1a1)]-0x1;_0x30e880>=0x0;_0x30e880--)if(_0x37d551=_0x5bdf31[_0x30e880])_0x4ae78e=(_0x4156a5<0x3?_0x37d551(_0x4ae78e):_0x4156a5>0x3?_0x37d551(_0x4498c2,_0x221d17,_0x4ae78e):_0x37d551(_0x4498c2,_0x221d17))||_0x4ae78e;}return _0x4156a5>0x3&&_0x4ae78e&&Object[_0x23bda4(0x196)](_0x4498c2,_0x221d17,_0x4ae78e),_0x4ae78e;},__metadata=this&&this[a145_0x345e98(0x194)]||function(_0x39e499,_0x395572){const _0x151386=a145_0x345e98;if(typeof Reflect==='object'&&typeof Reflect[_0x151386(0x18f)]===_0x151386(0x141))return Reflect[_0x151386(0x18f)](_0x39e499,_0x395572);};Object['defineProperty'](exports,a145_0x345e98(0x167),{'value':!![]}),exports[a145_0x345e98(0x15e)]=void 0x0;const core_1=require(a145_0x345e98(0x147)),salesforce_service_1=require('../../salesforce/services/salesforce.service'),git_provider_manager_1=require(a145_0x345e98(0x14e)),typedi_1=require('typedi'),errors_1=require(a145_0x345e98(0x164)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a145_0x345e98(0x168)),salesforce_sync_service_1=require(a145_0x345e98(0x181)),utils_1=require(a145_0x345e98(0x152)),commit_components_dto_1=require(a145_0x345e98(0x16b)),commit_components_job_1=require(a145_0x345e98(0x19c)),logger=new core_1[(a145_0x345e98(0x184))](a145_0x345e98(0x19d));let FlosumCommitJob=class FlosumCommitJob{constructor(_0xcc40a5,_0x3a2fd0,_0x4260ca,_0x10d775){const _0x1cb5e1=a145_0x345e98;this[_0x1cb5e1(0x187)]=_0xcc40a5,this['commitJob']=_0x3a2fd0,this['salesforceSync']=_0x4260ca,this[_0x1cb5e1(0x17b)]=_0x10d775,this[_0x1cb5e1(0x18e)]=this[_0x1cb5e1(0x17b)][_0x1cb5e1(0x188)]();}[a145_0x345e98(0x195)](_0x9e3b3d){const _0x59fad2=a145_0x345e98;return this['logger'][_0x59fad2(0x195)](_0x59fad2(0x15f)+this[_0x59fad2(0x17b)][_0x59fad2(0x142)][_0x59fad2(0x163)]()+_0x59fad2(0x198)+this['repository'][_0x59fad2(0x148)]+_0x59fad2(0x19f)+this[_0x59fad2(0x178)][_0x59fad2(0x148)]+']\x20'+_0x9e3b3d);}async[a145_0x345e98(0x14d)](){const _0x1ab16b=a145_0x345e98;try{if(this[_0x1ab16b(0x19a)][_0x1ab16b(0x13d)])this[_0x1ab16b(0x1a0)]=await this[_0x1ab16b(0x1a3)][_0x1ab16b(0x15d)](this['commitData'][_0x1ab16b(0x13d)]);else this[_0x1ab16b(0x19a)][_0x1ab16b(0x17e)]&&(this[_0x1ab16b(0x1a0)]=await this['salesforceSync'][_0x1ab16b(0x185)](this['commitData']['syncBranchId']));}catch(_0x29c1d){throw new bad_request_error_1[(_0x1ab16b(0x183))](errors_1[_0x1ab16b(0x161)]);}}async[a145_0x345e98(0x176)](){const _0x4e200a=a145_0x345e98;if(!this[_0x4e200a(0x19a)]['commitAttachmentId'])return[];const _0x5546c6=await this[_0x4e200a(0x187)][_0x4e200a(0x199)](this[_0x4e200a(0x19a)][_0x4e200a(0x166)])[_0x4e200a(0x1a2)](_0x27f1f1=>_0x27f1f1[_0x4e200a(0x191)]('\x20')['map'](_0x3c1172=>_0x3c1172[_0x4e200a(0x186)]())),_0x1bb03b=new salesforce_retriever_service_1['SalesforceRetrieverService'](this[_0x4e200a(0x187)]),_0x591ab6=await _0x1bb03b[_0x4e200a(0x157)](_0x5546c6);return _0x591ab6;}async[a145_0x345e98(0x153)](){const _0x1d3d70=a145_0x345e98;if(!this['commitData'][_0x1d3d70(0x15b)])return[];const _0x4101d6=await this['salesforceService'][_0x1d3d70(0x199)](this['commitData']['deleteAttachmentId']);return _0x4101d6;}async[a145_0x345e98(0x171)](){const _0x30cea8=a145_0x345e98,_0x409d46=new commit_components_dto_1[(_0x30cea8(0x180))](),[_0x5bffe5,_0x3c6d43]=await Promise['all']([this[_0x30cea8(0x176)](),this[_0x30cea8(0x153)]()]);return _0x409d46[_0x30cea8(0x16c)]=this[_0x30cea8(0x19a)]['message'],_0x409d46['user']=this['commitData']['user'],_0x409d46[_0x30cea8(0x16d)]={'writed':_0x5bffe5,'deleted':_0x3c6d43},_0x409d46[_0x30cea8(0x177)]=this['commitData']['convertToSFDX'],_0x409d46[_0x30cea8(0x155)]=this[_0x30cea8(0x16f)],_0x409d46[_0x30cea8(0x178)]=this['branch'],_0x409d46;}async[a145_0x345e98(0x18b)](_0x30e31e=![]){const _0x29f56f=a145_0x345e98,_0x2621ac=await this[_0x29f56f(0x1a3)]['getAttachmentId'](this['repositoryData']);if(_0x30e31e)await this['salesforceService'][_0x29f56f(0x17f)](_0x29f56f(0x14f),_0x2621ac,{'Body':utils_1[_0x29f56f(0x149)](JSON['stringify']({}))});else{const _0x36ad00=await this['repository'][_0x29f56f(0x144)][_0x29f56f(0x160)](this[_0x29f56f(0x178)][_0x29f56f(0x148)]);this['log'](_0x29f56f(0x18a));const _0x567fb4={[this[_0x29f56f(0x16f)][_0x29f56f(0x145)]]:{'lastCommit':_0x36ad00['sha']}};await this[_0x29f56f(0x187)][_0x29f56f(0x17f)](_0x29f56f(0x14f),_0x2621ac,{'Body':utils_1[_0x29f56f(0x149)](JSON[_0x29f56f(0x18c)](_0x567fb4))});}}async['exec'](){const _0x5b7b82=a145_0x345e98,_0x27d2ab=await this['getCommitDto']();this[_0x5b7b82(0x197)][_0x5b7b82(0x19b)]=this[_0x5b7b82(0x19b)],await this[_0x5b7b82(0x1a3)]['setStatus'](this[_0x5b7b82(0x1a0)],'In\x20Progress'),await this[_0x5b7b82(0x197)][_0x5b7b82(0x157)](_0x27d2ab),await this[_0x5b7b82(0x18b)](),this['commitData'][_0x5b7b82(0x166)]&&await this[_0x5b7b82(0x187)][_0x5b7b82(0x193)](this[_0x5b7b82(0x19a)][_0x5b7b82(0x166)]),this[_0x5b7b82(0x19a)]['deleteAttachmentId']&&await this[_0x5b7b82(0x187)]['deleteAttachment'](this['commitData'][_0x5b7b82(0x15b)]),await this[_0x5b7b82(0x1a3)][_0x5b7b82(0x146)](this[_0x5b7b82(0x1a0)],_0x5b7b82(0x19e));}async[a145_0x345e98(0x156)](_0x5bc68f){const _0x57019b=a145_0x345e98;try{this[_0x57019b(0x19b)]['log']('[ERROR]\x20'+_0x5bc68f),await this['logger']['send'](),await this['updateLastCommit'](!![]),await this['salesforceSync']['setStatus'](this['repositoryData'],_0x57019b(0x189));}catch(_0x439397){logger[_0x57019b(0x140)](_0x439397);}}async['run'](_0x43d0c5,_0x47cb98){const _0x2fbde5=a145_0x345e98;try{this[_0x2fbde5(0x19a)]=_0x43d0c5,this['salesforceService'][_0x2fbde5(0x13f)](_0x47cb98),this[_0x2fbde5(0x19b)]=this[_0x2fbde5(0x187)][_0x2fbde5(0x14a)](),await this[_0x2fbde5(0x14d)]();if(!this[_0x2fbde5(0x1a0)])throw new bad_request_error_1[(_0x2fbde5(0x183))](errors_1[_0x2fbde5(0x174)]);this[_0x2fbde5(0x16f)]=await this['repoService'][_0x2fbde5(0x160)](this[_0x2fbde5(0x1a0)][_0x2fbde5(0x165)]),this[_0x2fbde5(0x178)]=await this['repository'][_0x2fbde5(0x144)][_0x2fbde5(0x160)](this[_0x2fbde5(0x1a0)][_0x2fbde5(0x192)]),this[_0x2fbde5(0x195)](_0x2fbde5(0x17c)),this['exec']()[_0x2fbde5(0x159)](_0x14fceb=>this['handleCommitJobError'](_0x14fceb));}catch(_0x178e46){this['commitData']=undefined,logger[_0x2fbde5(0x140)](_0x178e46);throw _0x178e46;}}};FlosumCommitJob=__decorate([typedi_1[a145_0x345e98(0x154)]({'transient':!![]}),__metadata(a145_0x345e98(0x158),[salesforce_service_1[a145_0x345e98(0x143)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1[a145_0x345e98(0x169)],git_provider_manager_1[a145_0x345e98(0x150)]])],FlosumCommitJob),exports[a145_0x345e98(0x15e)]=FlosumCommitJob;