const a145_0x3b8002=a145_0x10fa;(function(_0x15eda8,_0x4946f6){const _0x5d0c2c=a145_0x10fa,_0x35be64=_0x15eda8();while(!![]){try{const _0x9ecac0=parseInt(_0x5d0c2c(0x1ad))/0x1+parseInt(_0x5d0c2c(0x1a8))/0x2+parseInt(_0x5d0c2c(0x1a3))/0x3*(-parseInt(_0x5d0c2c(0x19f))/0x4)+parseInt(_0x5d0c2c(0x18e))/0x5+-parseInt(_0x5d0c2c(0x19d))/0x6+-parseInt(_0x5d0c2c(0x14c))/0x7*(parseInt(_0x5d0c2c(0x161))/0x8)+parseInt(_0x5d0c2c(0x186))/0x9;if(_0x9ecac0===_0x4946f6)break;else _0x35be64['push'](_0x35be64['shift']());}catch(_0x3a684c){_0x35be64['push'](_0x35be64['shift']());}}}(a145_0x4161,0x672fd));const a145_0x521b00=function(){let _0x5c2841=!![];return function(_0x23c3bc,_0x268c44){const _0x3d3f91=_0x5c2841?function(){if(_0x268c44){const _0x11d015=_0x268c44['apply'](_0x23c3bc,arguments);return _0x268c44=null,_0x11d015;}}:function(){};return _0x5c2841=![],_0x3d3f91;};}(),a145_0x4fac46=a145_0x521b00(this,function(){const _0xfc31f1=a145_0x10fa;return a145_0x4fac46[_0xfc31f1(0x193)]()[_0xfc31f1(0x174)](_0xfc31f1(0x1a9))[_0xfc31f1(0x193)]()[_0xfc31f1(0x192)](a145_0x4fac46)[_0xfc31f1(0x174)](_0xfc31f1(0x1a9));});function a145_0x10fa(_0x101f3c,_0x1692e2){const _0x4a8bfa=a145_0x4161();return a145_0x10fa=function(_0x4fac46,_0x521b00){_0x4fac46=_0x4fac46-0x14c;let _0x416169=_0x4a8bfa[_0x4fac46];return _0x416169;},a145_0x10fa(_0x101f3c,_0x1692e2);}a145_0x4fac46();'use strict';var __decorate=this&&this[a145_0x3b8002(0x16d)]||function(_0x436c9b,_0x35dc9f,_0x4a65b1,_0x1d1250){const _0x230ef3=a145_0x3b8002;var _0x3eaea8=arguments[_0x230ef3(0x197)],_0x133b4d=_0x3eaea8<0x3?_0x35dc9f:_0x1d1250===null?_0x1d1250=Object['getOwnPropertyDescriptor'](_0x35dc9f,_0x4a65b1):_0x1d1250,_0x3ae088;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x230ef3(0x195))_0x133b4d=Reflect[_0x230ef3(0x15a)](_0x436c9b,_0x35dc9f,_0x4a65b1,_0x1d1250);else{for(var _0x1a3847=_0x436c9b['length']-0x1;_0x1a3847>=0x0;_0x1a3847--)if(_0x3ae088=_0x436c9b[_0x1a3847])_0x133b4d=(_0x3eaea8<0x3?_0x3ae088(_0x133b4d):_0x3eaea8>0x3?_0x3ae088(_0x35dc9f,_0x4a65b1,_0x133b4d):_0x3ae088(_0x35dc9f,_0x4a65b1))||_0x133b4d;}return _0x3eaea8>0x3&&_0x133b4d&&Object[_0x230ef3(0x1a1)](_0x35dc9f,_0x4a65b1,_0x133b4d),_0x133b4d;},__metadata=this&&this['__metadata']||function(_0x1c244d,_0x226327){const _0x3958bb=a145_0x3b8002;if(typeof Reflect===_0x3958bb(0x198)&&typeof Reflect[_0x3958bb(0x153)]==='function')return Reflect['metadata'](_0x1c244d,_0x226327);};Object[a145_0x3b8002(0x1a1)](exports,'__esModule',{'value':!![]}),exports[a145_0x3b8002(0x16f)]=void 0x0;function a145_0x4161(){const _0x42cb6b=[']\x20[Repository:\x20','102571bfbucN','Logger','encodeBase64','Service','getComponentsToWrite','repoService','updateLastCommit','metadata','SalesforceSyncService','logger','deleteAttachment','getBranchRecord','syncRepositoryId','getComponentsToDelete','decorate','[INFO]\x20Update\x20remote\x20state.','components','retrieveAttachment','name','fetchRepositoryData','[INFO]\x20Start\x20commit\x20job','16cnBstV','getRepositoryRecord','ERR_INVALID_SYNC_RECORD_ID',']\x20[Branch:\x20','repositoryData','getRepoService','../../../core/errors/bad-request.error','toUpperCase','getAttachmentId','../../shared/utils','In\x20Progress','branches','__decorate','BadRequestError','FlosumCommitJob','../../salesforce/services/salesforce-retriever.service','getOne','syncBranchId','trim','search','SalesforceService','commitAttachmentId','user','Error','exec','CommitComponentsJob','gitUrl','provider','send','patchObject','sha','commitJob','salesforceSync','branch','../../../constants/errors','GitProviderManager','log','3623274xjBGaN','handleCommitJobError','then','../../salesforce/services/salesforce.service','repositoryName','message','../../shared/git-provider.manager','deleteAttachmentId','1892885UAGVSj','flosum-commit-job','setStatus','map','constructor','toString','ERR_UNKNOWN_SYNC_RECORD_ID','function','run','length','object','[ERROR]\x20','salesforceService','convertToSFDX','commitData','2616870VsjzZz','typedi','1674412lfanCM','../../../core','defineProperty','CommitComponentsDto','3JybSeJ','gitManager','../dto/commit-components.dto','repository','../../salesforce/services/salesforce-sync.service','809750AqITKW','(((.+)+)+)+$','repo','error','getCommitDto','120669XbVlcm'];a145_0x4161=function(){return _0x42cb6b;};return a145_0x4161();}const core_1=require(a145_0x3b8002(0x1a0)),salesforce_service_1=require(a145_0x3b8002(0x189)),git_provider_manager_1=require(a145_0x3b8002(0x18c)),typedi_1=require(a145_0x3b8002(0x19e)),errors_1=require(a145_0x3b8002(0x183)),bad_request_error_1=require(a145_0x3b8002(0x167)),salesforce_retriever_service_1=require(a145_0x3b8002(0x170)),salesforce_sync_service_1=require(a145_0x3b8002(0x1a7)),utils_1=require(a145_0x3b8002(0x16a)),commit_components_dto_1=require(a145_0x3b8002(0x1a5)),commit_components_job_1=require('./commit-components.job'),logger=new core_1[(a145_0x3b8002(0x14d))](a145_0x3b8002(0x18f));let FlosumCommitJob=class FlosumCommitJob{constructor(_0xd0092d,_0xa014f1,_0x4d1695,_0x16571a){const _0x2f10b2=a145_0x3b8002;this[_0x2f10b2(0x19a)]=_0xd0092d,this[_0x2f10b2(0x180)]=_0xa014f1,this[_0x2f10b2(0x181)]=_0x4d1695,this[_0x2f10b2(0x1a4)]=_0x16571a,this[_0x2f10b2(0x151)]=this[_0x2f10b2(0x1a4)][_0x2f10b2(0x166)]();}[a145_0x3b8002(0x185)](_0x207c65){const _0x5bfff5=a145_0x3b8002;return this['logger'][_0x5bfff5(0x185)]('[COMMIT]\x20['+this['gitManager'][_0x5bfff5(0x17c)][_0x5bfff5(0x168)]()+_0x5bfff5(0x1ae)+this['repository'][_0x5bfff5(0x15e)]+_0x5bfff5(0x164)+this[_0x5bfff5(0x182)][_0x5bfff5(0x15e)]+']\x20'+_0x207c65);}async['fetchRepositoryData'](){const _0x40b84c=a145_0x3b8002;try{if(this['commitData']['syncRepositoryId'])this[_0x40b84c(0x165)]=await this['salesforceSync'][_0x40b84c(0x162)](this[_0x40b84c(0x19c)][_0x40b84c(0x158)]);else this[_0x40b84c(0x19c)][_0x40b84c(0x172)]&&(this[_0x40b84c(0x165)]=await this[_0x40b84c(0x181)][_0x40b84c(0x157)](this[_0x40b84c(0x19c)][_0x40b84c(0x172)]));}catch(_0xd0aa78){throw new bad_request_error_1['BadRequestError'](errors_1[_0x40b84c(0x163)]);}}async['getComponentsToWrite'](){const _0x4ab89f=a145_0x3b8002;if(!this['commitData']['commitAttachmentId'])return[];const _0x422611=await this['salesforceService'][_0x4ab89f(0x15d)](this[_0x4ab89f(0x19c)][_0x4ab89f(0x176)])[_0x4ab89f(0x188)](_0x2485f5=>_0x2485f5['split']('\x20')[_0x4ab89f(0x191)](_0x134291=>_0x134291[_0x4ab89f(0x173)]())),_0x595d05=new salesforce_retriever_service_1['SalesforceRetrieverService'](this['salesforceService']),_0x45c509=await _0x595d05[_0x4ab89f(0x196)](_0x422611);return _0x45c509;}async[a145_0x3b8002(0x159)](){const _0x5a83d0=a145_0x3b8002;if(!this[_0x5a83d0(0x19c)][_0x5a83d0(0x18d)])return[];const _0x434ca5=await this[_0x5a83d0(0x19a)][_0x5a83d0(0x15d)](this['commitData']['deleteAttachmentId']);return _0x434ca5;}async[a145_0x3b8002(0x1ac)](){const _0x54493e=a145_0x3b8002,_0x375818=new commit_components_dto_1[(_0x54493e(0x1a2))](),[_0xa25b4a,_0x4d8b02]=await Promise['all']([this[_0x54493e(0x150)](),this[_0x54493e(0x159)]()]);return _0x375818[_0x54493e(0x18b)]=this[_0x54493e(0x19c)][_0x54493e(0x18b)],_0x375818[_0x54493e(0x177)]=this[_0x54493e(0x19c)][_0x54493e(0x177)],_0x375818[_0x54493e(0x15c)]={'writed':_0xa25b4a,'deleted':_0x4d8b02},_0x375818['convertToSFDX']=this['commitData'][_0x54493e(0x19b)],_0x375818[_0x54493e(0x1aa)]=this[_0x54493e(0x1a6)],_0x375818['branch']=this[_0x54493e(0x182)],_0x375818;}async['updateLastCommit'](_0x119e34=![]){const _0x5be841=a145_0x3b8002,_0xf33dc7=await this[_0x5be841(0x181)][_0x5be841(0x169)](this[_0x5be841(0x165)]);if(_0x119e34)await this[_0x5be841(0x19a)][_0x5be841(0x17e)]('Attachment',_0xf33dc7,{'Body':(0x0,utils_1[_0x5be841(0x14e)])(JSON['stringify']({}))});else{const _0x13c34c=await this['repository'][_0x5be841(0x16c)]['getOne'](this[_0x5be841(0x182)][_0x5be841(0x15e)]);this[_0x5be841(0x185)](_0x5be841(0x15b));const _0x42e982={[this[_0x5be841(0x1a6)][_0x5be841(0x17b)]]:{'lastCommit':_0x13c34c[_0x5be841(0x17f)]}};await this[_0x5be841(0x19a)][_0x5be841(0x17e)]('Attachment',_0xf33dc7,{'Body':(0x0,utils_1[_0x5be841(0x14e)])(JSON['stringify'](_0x42e982))});}}async['exec'](){const _0x38334f=a145_0x3b8002,_0x378730=await this[_0x38334f(0x1ac)]();this[_0x38334f(0x180)][_0x38334f(0x155)]=this[_0x38334f(0x155)],await this[_0x38334f(0x181)][_0x38334f(0x190)](this['repositoryData'],_0x38334f(0x16b)),await this[_0x38334f(0x180)][_0x38334f(0x196)](_0x378730),await this[_0x38334f(0x152)](),this['commitData'][_0x38334f(0x176)]&&await this[_0x38334f(0x19a)][_0x38334f(0x156)](this['commitData']['commitAttachmentId']),this[_0x38334f(0x19c)][_0x38334f(0x18d)]&&await this['salesforceService']['deleteAttachment'](this['commitData'][_0x38334f(0x18d)]),await this[_0x38334f(0x181)][_0x38334f(0x190)](this['repositoryData'],'Completed');}async['handleCommitJobError'](_0x1b4bdc){const _0x4407c0=a145_0x3b8002;try{this[_0x4407c0(0x155)][_0x4407c0(0x185)](_0x4407c0(0x199)+_0x1b4bdc),await this[_0x4407c0(0x155)][_0x4407c0(0x17d)](),await this[_0x4407c0(0x152)](!![]),await this[_0x4407c0(0x181)][_0x4407c0(0x190)](this[_0x4407c0(0x165)],_0x4407c0(0x178));}catch(_0x4411e6){logger['error'](_0x4411e6);}}async['run'](_0x4ee882,_0x5bb4eb){const _0xa71cb=a145_0x3b8002;try{this['commitData']=_0x4ee882,this[_0xa71cb(0x19a)]['setLoggerId'](_0x5bb4eb),this[_0xa71cb(0x155)]=this[_0xa71cb(0x19a)]['getLogger'](),await this[_0xa71cb(0x15f)]();if(!this[_0xa71cb(0x165)])throw new bad_request_error_1[(_0xa71cb(0x16e))](errors_1[_0xa71cb(0x194)]);this[_0xa71cb(0x1a6)]=await this[_0xa71cb(0x151)][_0xa71cb(0x171)](this[_0xa71cb(0x165)][_0xa71cb(0x18a)]),this[_0xa71cb(0x182)]=await this[_0xa71cb(0x1a6)][_0xa71cb(0x16c)][_0xa71cb(0x171)](this[_0xa71cb(0x165)]['branchName']),this[_0xa71cb(0x185)](_0xa71cb(0x160)),this[_0xa71cb(0x179)]()['catch'](_0x356b43=>this[_0xa71cb(0x187)](_0x356b43));}catch(_0xfaf891){this['commitData']=undefined,logger[_0xa71cb(0x1ab)](_0xfaf891);throw _0xfaf891;}}};FlosumCommitJob=__decorate([(0x0,typedi_1[a145_0x3b8002(0x14f)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a145_0x3b8002(0x175)],commit_components_job_1[a145_0x3b8002(0x17a)],salesforce_sync_service_1[a145_0x3b8002(0x154)],git_provider_manager_1[a145_0x3b8002(0x184)]])],FlosumCommitJob),exports[a145_0x3b8002(0x16f)]=FlosumCommitJob;