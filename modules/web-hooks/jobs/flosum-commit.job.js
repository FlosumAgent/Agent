const a146_0x4c4181=a146_0x3278;function a146_0x3278(_0xe0f576,_0x52685e){const _0x30e17b=a146_0x5ee2();return a146_0x3278=function(_0x31e4cc,_0x2df6f9){_0x31e4cc=_0x31e4cc-0x1e3;let _0x5ee285=_0x30e17b[_0x31e4cc];return _0x5ee285;},a146_0x3278(_0xe0f576,_0x52685e);}(function(_0x2a6466,_0x1ecaea){const _0x4835dd=a146_0x3278,_0x355be5=_0x2a6466();while(!![]){try{const _0x15b273=-parseInt(_0x4835dd(0x216))/0x1+parseInt(_0x4835dd(0x1f5))/0x2*(-parseInt(_0x4835dd(0x210))/0x3)+-parseInt(_0x4835dd(0x221))/0x4*(parseInt(_0x4835dd(0x213))/0x5)+-parseInt(_0x4835dd(0x239))/0x6+parseInt(_0x4835dd(0x21f))/0x7+parseInt(_0x4835dd(0x1ee))/0x8*(parseInt(_0x4835dd(0x248))/0x9)+parseInt(_0x4835dd(0x24b))/0xa;if(_0x15b273===_0x1ecaea)break;else _0x355be5['push'](_0x355be5['shift']());}catch(_0xe0a7eb){_0x355be5['push'](_0x355be5['shift']());}}}(a146_0x5ee2,0x83997));const a146_0x2df6f9=function(){let _0x49b8c6=!![];return function(_0x3847d5,_0x470441){const _0x55f96a=_0x49b8c6?function(){const _0x1c8693=a146_0x3278;if(_0x470441){const _0x123282=_0x470441[_0x1c8693(0x1e8)](_0x3847d5,arguments);return _0x470441=null,_0x123282;}}:function(){};return _0x49b8c6=![],_0x55f96a;};}(),a146_0x31e4cc=a146_0x2df6f9(this,function(){const _0x4d4001=a146_0x3278;return a146_0x31e4cc[_0x4d4001(0x249)]()[_0x4d4001(0x244)](_0x4d4001(0x20d))['toString']()[_0x4d4001(0x1fa)](a146_0x31e4cc)['search'](_0x4d4001(0x20d));});a146_0x31e4cc();'use strict';var __decorate=this&&this[a146_0x4c4181(0x235)]||function(_0x3515fe,_0x5a4b9e,_0x5d60b2,_0x760244){const _0x3ac8bc=a146_0x4c4181;var _0x1a312a=arguments[_0x3ac8bc(0x1f4)],_0xcd644d=_0x1a312a<0x3?_0x5a4b9e:_0x760244===null?_0x760244=Object[_0x3ac8bc(0x1e7)](_0x5a4b9e,_0x5d60b2):_0x760244,_0x476287;if(typeof Reflect==='object'&&typeof Reflect[_0x3ac8bc(0x1f1)]===_0x3ac8bc(0x238))_0xcd644d=Reflect[_0x3ac8bc(0x1f1)](_0x3515fe,_0x5a4b9e,_0x5d60b2,_0x760244);else{for(var _0x4ed0fb=_0x3515fe['length']-0x1;_0x4ed0fb>=0x0;_0x4ed0fb--)if(_0x476287=_0x3515fe[_0x4ed0fb])_0xcd644d=(_0x1a312a<0x3?_0x476287(_0xcd644d):_0x1a312a>0x3?_0x476287(_0x5a4b9e,_0x5d60b2,_0xcd644d):_0x476287(_0x5a4b9e,_0x5d60b2))||_0xcd644d;}return _0x1a312a>0x3&&_0xcd644d&&Object[_0x3ac8bc(0x24a)](_0x5a4b9e,_0x5d60b2,_0xcd644d),_0xcd644d;},__metadata=this&&this[a146_0x4c4181(0x232)]||function(_0x68e093,_0xe462ec){const _0x2c2707=a146_0x4c4181;if(typeof Reflect==='object'&&typeof Reflect[_0x2c2707(0x1e6)]===_0x2c2707(0x238))return Reflect['metadata'](_0x68e093,_0xe462ec);};Object[a146_0x4c4181(0x24a)](exports,a146_0x4c4181(0x226),{'value':!![]}),exports[a146_0x4c4181(0x1e4)]=void 0x0;const core_1=require(a146_0x4c4181(0x20e)),salesforce_service_1=require(a146_0x4c4181(0x21b)),git_provider_manager_1=require(a146_0x4c4181(0x231)),typedi_1=require(a146_0x4c4181(0x201)),errors_1=require('../../../constants/errors'),bad_request_error_1=require(a146_0x4c4181(0x205)),salesforce_retriever_service_1=require(a146_0x4c4181(0x236)),salesforce_sync_service_1=require(a146_0x4c4181(0x21d)),utils_1=require('../../shared/utils'),commit_components_dto_1=require(a146_0x4c4181(0x22e)),commit_components_job_1=require(a146_0x4c4181(0x242)),logger=new core_1[(a146_0x4c4181(0x21e))](a146_0x4c4181(0x20a));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x11b670,_0x2a0ba5,_0x51b07c,_0x245ca8){const _0x5e1b69=a146_0x4c4181;this[_0x5e1b69(0x234)]=_0x11b670,this['commitJob']=_0x2a0ba5,this[_0x5e1b69(0x218)]=_0x51b07c,this[_0x5e1b69(0x1ec)]=_0x245ca8,this[_0x5e1b69(0x1e9)]=this[_0x5e1b69(0x1ec)][_0x5e1b69(0x1fd)]();}['log'](_0x16cb09){const _0x467e9e=a146_0x4c4181;return this[_0x467e9e(0x217)][_0x467e9e(0x230)](_0x467e9e(0x229)+this['gitManager'][_0x467e9e(0x207)][_0x467e9e(0x241)]()+']\x20[Repository:\x20'+this['repository'][_0x467e9e(0x1eb)]+']\x20[Branch:\x20'+this[_0x467e9e(0x23f)][_0x467e9e(0x1eb)]+']\x20'+_0x16cb09);}async[a146_0x4c4181(0x22f)](){const _0x4f7139=a146_0x4c4181;try{if(this[_0x4f7139(0x1f8)][_0x4f7139(0x204)])this[_0x4f7139(0x21a)]=await this[_0x4f7139(0x218)][_0x4f7139(0x223)](this[_0x4f7139(0x1f8)][_0x4f7139(0x204)]);else this['commitData'][_0x4f7139(0x214)]&&(this[_0x4f7139(0x21a)]=await this[_0x4f7139(0x218)][_0x4f7139(0x200)](this['commitData'][_0x4f7139(0x214)]));}catch(_0x3f8cc4){throw new bad_request_error_1[(_0x4f7139(0x1f3))](errors_1[_0x4f7139(0x1fb)]);}}async['getComponentsToWrite'](){const _0x4c560c=a146_0x4c4181;if(!this['commitData'][_0x4c560c(0x1f2)])return[];const _0x13e2e5=await this[_0x4c560c(0x234)][_0x4c560c(0x1ff)](this[_0x4c560c(0x1f8)][_0x4c560c(0x1f2)])[_0x4c560c(0x23a)](_0x371c4c=>_0x371c4c[_0x4c560c(0x245)]('\x20')[_0x4c560c(0x243)](_0x24cdd0=>_0x24cdd0[_0x4c560c(0x22d)]())),_0x3275e3=new salesforce_retriever_service_1[(_0x4c560c(0x240))](this[_0x4c560c(0x234)]),_0x2dcbd9=await _0x3275e3['run'](_0x13e2e5);return _0x2dcbd9;}async[a146_0x4c4181(0x1e3)](){const _0x1776ef=a146_0x4c4181;if(!this[_0x1776ef(0x1f8)][_0x1776ef(0x215)])return[];const _0x29af76=await this[_0x1776ef(0x234)]['retrieveAttachment'](this[_0x1776ef(0x1f8)][_0x1776ef(0x215)]);return _0x29af76;}async[a146_0x4c4181(0x23e)](){const _0x2b61c5=a146_0x4c4181,_0x2a94c7=new commit_components_dto_1[(_0x2b61c5(0x20c))](),[_0x42a5b7,_0x10cfa6]=await Promise[_0x2b61c5(0x227)]([this[_0x2b61c5(0x237)](),this['getComponentsToDelete']()]);return _0x2a94c7['message']=this[_0x2b61c5(0x1f8)][_0x2b61c5(0x1f9)],_0x2a94c7[_0x2b61c5(0x23c)]=this[_0x2b61c5(0x1f8)][_0x2b61c5(0x23c)],_0x2a94c7[_0x2b61c5(0x1fc)]={'writed':_0x42a5b7,'deleted':_0x10cfa6},_0x2a94c7[_0x2b61c5(0x23b)]=this[_0x2b61c5(0x1f8)][_0x2b61c5(0x23b)],_0x2a94c7['repo']=this[_0x2b61c5(0x209)],_0x2a94c7[_0x2b61c5(0x23f)]=this[_0x2b61c5(0x23f)],_0x2a94c7;}async[a146_0x4c4181(0x1ef)](_0x938212=![]){const _0x3b81a2=a146_0x4c4181,_0x22eac2=await this['salesforceSync'][_0x3b81a2(0x220)](this[_0x3b81a2(0x21a)]);if(_0x938212)await this[_0x3b81a2(0x234)][_0x3b81a2(0x212)](_0x3b81a2(0x1f6),_0x22eac2,{'Body':(0x0,utils_1[_0x3b81a2(0x222)])(JSON[_0x3b81a2(0x247)]({}))});else{const _0x2f7f80=await this[_0x3b81a2(0x209)][_0x3b81a2(0x203)][_0x3b81a2(0x206)](this[_0x3b81a2(0x23f)]['name']);this['log'](_0x3b81a2(0x219));const _0x2f1c6d={[this['repository']['gitUrl']]:{'lastCommit':_0x2f7f80[_0x3b81a2(0x1ea)]}};await this['salesforceService'][_0x3b81a2(0x212)](_0x3b81a2(0x1f6),_0x22eac2,{'Body':(0x0,utils_1[_0x3b81a2(0x222)])(JSON[_0x3b81a2(0x247)](_0x2f1c6d))});}}async[a146_0x4c4181(0x21c)](){const _0x561830=a146_0x4c4181,_0x28349e=await this[_0x561830(0x23e)]();this['commitJob'][_0x561830(0x217)]=this[_0x561830(0x217)],await this[_0x561830(0x218)][_0x561830(0x23d)](this[_0x561830(0x21a)],_0x561830(0x22c)),await this[_0x561830(0x22a)][_0x561830(0x224)](_0x28349e),await this[_0x561830(0x1ef)](),this[_0x561830(0x1f8)][_0x561830(0x1f2)]&&await this['salesforceService']['deleteAttachment'](this[_0x561830(0x1f8)][_0x561830(0x1f2)]),this[_0x561830(0x1f8)]['deleteAttachmentId']&&await this[_0x561830(0x234)]['deleteAttachment'](this[_0x561830(0x1f8)][_0x561830(0x215)]),await this['salesforceSync']['setStatus'](this['repositoryData'],_0x561830(0x228));}async[a146_0x4c4181(0x1e5)](_0x1c5909){const _0xb91b1c=a146_0x4c4181;try{this[_0xb91b1c(0x217)][_0xb91b1c(0x230)](_0xb91b1c(0x1fe)+_0x1c5909),await this['logger'][_0xb91b1c(0x1f0)](),await this['updateLastCommit'](!![]),await this[_0xb91b1c(0x218)][_0xb91b1c(0x23d)](this[_0xb91b1c(0x21a)],_0xb91b1c(0x246));}catch(_0x541600){logger[_0xb91b1c(0x1ed)](_0x541600);}}async['run'](_0x3f808d,_0x23a107){const _0x28853f=a146_0x4c4181;try{this['commitData']=_0x3f808d,this['salesforceService'][_0x28853f(0x20f)](_0x23a107),this[_0x28853f(0x217)]=this['salesforceService'][_0x28853f(0x211)](),await this['fetchRepositoryData']();if(!this[_0x28853f(0x21a)])throw new bad_request_error_1[(_0x28853f(0x1f3))](errors_1[_0x28853f(0x22b)]);this[_0x28853f(0x209)]=await this[_0x28853f(0x1e9)]['getOne'](this[_0x28853f(0x21a)]['repositoryName']),this[_0x28853f(0x23f)]=await this['repository']['branches'][_0x28853f(0x206)](this[_0x28853f(0x21a)]['branchName']),this['log'](_0x28853f(0x233)),this['exec']()[_0x28853f(0x202)](_0x262d7f=>this[_0x28853f(0x1e5)](_0x262d7f));}catch(_0x11ee35){this[_0x28853f(0x1f8)]=undefined,logger[_0x28853f(0x1ed)](_0x11ee35);throw _0x11ee35;}}};function a146_0x5ee2(){const _0x21a341=['getComponentsToWrite','function','4074666DAFbAo','then','convertToSFDX','user','setStatus','getCommitDto','branch','SalesforceRetrieverService','toUpperCase','./commit-components.job','map','search','split','Error','stringify','11907kJCied','toString','defineProperty','22077340ClgHRx','getComponentsToDelete','FlosumCommitJob','handleCommitJobError','metadata','getOwnPropertyDescriptor','apply','repoService','sha','name','gitManager','error','3408ScmVSb','updateLastCommit','send','decorate','commitAttachmentId','BadRequestError','length','1466150SCwMQk','Attachment','SalesforceService','commitData','message','constructor','ERR_INVALID_SYNC_RECORD_ID','components','getRepoService','[ERROR]\x20','retrieveAttachment','getBranchRecord','typedi','catch','branches','syncRepositoryId','../../../core/errors/bad-request.error','getOne','provider','CommitComponentsJob','repository','flosum-commit-job','Service','CommitComponentsDto','(((.+)+)+)+$','../../../core','setLoggerId','3AVkUtL','getLogger','patchObject','243665LCHRhk','syncBranchId','deleteAttachmentId','893857jCsnQM','logger','salesforceSync','[INFO]\x20Update\x20remote\x20state.','repositoryData','../../salesforce/services/salesforce.service','exec','../../salesforce/services/salesforce-sync.service','Logger','6997683IowXSk','getAttachmentId','76zosljA','encodeBase64','getRepositoryRecord','run','SalesforceSyncService','__esModule','all','Completed','[COMMIT]\x20[','commitJob','ERR_UNKNOWN_SYNC_RECORD_ID','In\x20Progress','trim','../dto/commit-components.dto','fetchRepositoryData','log','../../shared/git-provider.manager','__metadata','[INFO]\x20Start\x20commit\x20job','salesforceService','__decorate','../../salesforce/services/salesforce-retriever.service'];a146_0x5ee2=function(){return _0x21a341;};return a146_0x5ee2();}FlosumCommitJob=__decorate([(0x0,typedi_1[a146_0x4c4181(0x20b)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a146_0x4c4181(0x1f7)],commit_components_job_1[a146_0x4c4181(0x208)],salesforce_sync_service_1[a146_0x4c4181(0x225)],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;