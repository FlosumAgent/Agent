const a145_0x56c8=['handleCommitJobError','[INFO]\x20Update\x20remote\x20state.','BadRequestError','../../shared/git-provider.manager','setStatus','salesforceService','design:paramtypes','salesforceSync','168017dhbZaA','deleteAttachment','logger','getBranchRecord','gitManager','Service','decorate','./commit-components.job','fetchRepositoryData','__esModule','message','return\x20/\x22\x20+\x20this\x20+\x20\x22/','getComponentsToDelete','gitUrl','In\x20Progress','metadata','defineProperty','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','../../salesforce/services/salesforce-sync.service','convertToSFDX','object','updateLastCommit','patchObject','encodeBase64','153466uIbFWE','ERR_UNKNOWN_SYNC_RECORD_ID','ERR_INVALID_SYNC_RECORD_ID','getRepoService','getCommitDto','catch','61FMfmCr','__metadata','branches','provider','3474ZApNDe','4971pZUQsZ','deleteAttachmentId','constructor','../../salesforce/services/salesforce-retriever.service','143419OYHTvU','1MRTVWP','[INFO]\x20Start\x20commit\x20job','FlosumCommitJob','exec','getComponentsToWrite','[ERROR]\x20','flosum-commit-job','error','Attachment','length','GitProviderManager','Logger','repository','run','branchName','typedi','../../shared/utils','commitAttachmentId','repoService','getRepositoryRecord','repositoryData','function','../../../core','getOne','SalesforceService','getAttachmentId','getOwnPropertyDescriptor','retrieveAttachment','log','../../../constants/errors','CommitComponentsJob','../dto/commit-components.dto','send','commitData','name','561902paMWev','map','split','branch',']\x20[Branch:\x20','repositoryName',']\x20[Repository:\x20','Error','syncBranchId','SalesforceRetrieverService','../../salesforce/services/salesforce.service','__decorate','trim','stringify','then','toUpperCase','76Mmfouj','components','user','153747HISCuB'];const a145_0x3ddfb0=a145_0x4ae6;(function(_0x1abd3a,_0x503619){const _0x468eca=a145_0x4ae6;while(!![]){try{const _0x34efdb=-parseInt(_0x468eca(0xfd))+-parseInt(_0x468eca(0x120))*-parseInt(_0x468eca(0x11b))+parseInt(_0x468eca(0x148))+-parseInt(_0x468eca(0xf1))*parseInt(_0x468eca(0x11f))+-parseInt(_0x468eca(0x115))+parseInt(_0x468eca(0x124))*-parseInt(_0x468eca(0x125))+parseInt(_0x468eca(0xf4));if(_0x34efdb===_0x503619)break;else _0x1abd3a['push'](_0x1abd3a['shift']());}catch(_0x57ba82){_0x1abd3a['push'](_0x1abd3a['shift']());}}}(a145_0x56c8,0x46ca2));const a145_0x1153f0=function(){let _0x49bff9=!![];return function(_0x58ec3c,_0x57e333){const _0x51b1ae=_0x49bff9?function(){if(_0x57e333){const _0x5b52a7=_0x57e333['apply'](_0x58ec3c,arguments);return _0x57e333=null,_0x5b52a7;}}:function(){};return _0x49bff9=![],_0x51b1ae;};}(),a145_0x2c8e9b=a145_0x1153f0(this,function(){const _0x4f4b66=function(){const _0x22e78d=a145_0x4ae6,_0x1008a5=_0x4f4b66[_0x22e78d(0x122)](_0x22e78d(0x108))()[_0x22e78d(0x122)](_0x22e78d(0x10e));return!_0x1008a5['test'](a145_0x2c8e9b);};return _0x4f4b66();});a145_0x2c8e9b();'use strict';var __decorate=this&&this[a145_0x3ddfb0(0xec)]||function(_0x3fa988,_0x516943,_0x316d52,_0x1582ee){const _0x24b548=a145_0x3ddfb0;var _0x261971=arguments[_0x24b548(0x12e)],_0x19b1dc=_0x261971<0x3?_0x516943:_0x1582ee===null?_0x1582ee=Object[_0x24b548(0x13f)](_0x516943,_0x316d52):_0x1582ee,_0x1ea2c4;if(typeof Reflect===_0x24b548(0x111)&&typeof Reflect[_0x24b548(0x103)]===_0x24b548(0x13a))_0x19b1dc=Reflect[_0x24b548(0x103)](_0x3fa988,_0x516943,_0x316d52,_0x1582ee);else{for(var _0x32f930=_0x3fa988[_0x24b548(0x12e)]-0x1;_0x32f930>=0x0;_0x32f930--)if(_0x1ea2c4=_0x3fa988[_0x32f930])_0x19b1dc=(_0x261971<0x3?_0x1ea2c4(_0x19b1dc):_0x261971>0x3?_0x1ea2c4(_0x516943,_0x316d52,_0x19b1dc):_0x1ea2c4(_0x516943,_0x316d52))||_0x19b1dc;}return _0x261971>0x3&&_0x19b1dc&&Object['defineProperty'](_0x516943,_0x316d52,_0x19b1dc),_0x19b1dc;},__metadata=this&&this[a145_0x3ddfb0(0x11c)]||function(_0x2abe0a,_0x13b3d7){const _0x4696b5=a145_0x3ddfb0;if(typeof Reflect==='object'&&typeof Reflect[_0x4696b5(0x10c)]==='function')return Reflect[_0x4696b5(0x10c)](_0x2abe0a,_0x13b3d7);};Object[a145_0x3ddfb0(0x10d)](exports,a145_0x3ddfb0(0x106),{'value':!![]}),exports[a145_0x3ddfb0(0x127)]=void 0x0;const core_1=require(a145_0x3ddfb0(0x13b)),salesforce_service_1=require(a145_0x3ddfb0(0xeb)),git_provider_manager_1=require(a145_0x3ddfb0(0xf8)),typedi_1=require(a145_0x3ddfb0(0x134)),errors_1=require(a145_0x3ddfb0(0x142)),bad_request_error_1=require('../../../core/errors/bad-request.error'),salesforce_retriever_service_1=require(a145_0x3ddfb0(0x123)),salesforce_sync_service_1=require(a145_0x3ddfb0(0x10f)),utils_1=require(a145_0x3ddfb0(0x135)),commit_components_dto_1=require(a145_0x3ddfb0(0x144)),commit_components_job_1=require(a145_0x3ddfb0(0x104)),logger=new core_1[(a145_0x3ddfb0(0x130))](a145_0x3ddfb0(0x12b));let FlosumCommitJob=class FlosumCommitJob{constructor(_0x286a82,_0x47a8fe,_0x47657c,_0xbf1ca0){const _0x4accfc=a145_0x3ddfb0;this[_0x4accfc(0xfa)]=_0x286a82,this['commitJob']=_0x47a8fe,this[_0x4accfc(0xfc)]=_0x47657c,this[_0x4accfc(0x101)]=_0xbf1ca0,this[_0x4accfc(0x137)]=this[_0x4accfc(0x101)][_0x4accfc(0x118)]();}[a145_0x3ddfb0(0x141)](_0x57e0d7){const _0x221ddd=a145_0x3ddfb0;return this[_0x221ddd(0xff)]['log']('[COMMIT]\x20['+this[_0x221ddd(0x101)][_0x221ddd(0x11e)][_0x221ddd(0xf0)]()+_0x221ddd(0xe7)+this[_0x221ddd(0x131)][_0x221ddd(0x147)]+_0x221ddd(0x14c)+this[_0x221ddd(0x14b)][_0x221ddd(0x147)]+']\x20'+_0x57e0d7);}async[a145_0x3ddfb0(0x105)](){const _0x3f5031=a145_0x3ddfb0;try{if(this[_0x3f5031(0x146)]['syncRepositoryId'])this[_0x3f5031(0x139)]=await this['salesforceSync'][_0x3f5031(0x138)](this[_0x3f5031(0x146)]['syncRepositoryId']);else this[_0x3f5031(0x146)][_0x3f5031(0xe9)]&&(this[_0x3f5031(0x139)]=await this[_0x3f5031(0xfc)][_0x3f5031(0x100)](this[_0x3f5031(0x146)][_0x3f5031(0xe9)]));}catch(_0x346f94){throw new bad_request_error_1['BadRequestError'](errors_1[_0x3f5031(0x117)]);}}async[a145_0x3ddfb0(0x129)](){const _0x50c05c=a145_0x3ddfb0;if(!this['commitData'][_0x50c05c(0x136)])return[];const _0x1aacfb=await this['salesforceService'][_0x50c05c(0x140)](this['commitData'][_0x50c05c(0x136)])[_0x50c05c(0xef)](_0x2c00db=>_0x2c00db[_0x50c05c(0x14a)]('\x20')[_0x50c05c(0x149)](_0x5d244d=>_0x5d244d[_0x50c05c(0xed)]())),_0x231c1a=new salesforce_retriever_service_1[(_0x50c05c(0xea))](this[_0x50c05c(0xfa)]),_0x5ebe4a=await _0x231c1a[_0x50c05c(0x132)](_0x1aacfb);return _0x5ebe4a;}async['getComponentsToDelete'](){const _0x54968a=a145_0x3ddfb0;if(!this[_0x54968a(0x146)][_0x54968a(0x121)])return[];const _0x4cf7fe=await this[_0x54968a(0xfa)]['retrieveAttachment'](this[_0x54968a(0x146)]['deleteAttachmentId']);return _0x4cf7fe;}async['getCommitDto'](){const _0x2b026b=a145_0x3ddfb0,_0x10209a=new commit_components_dto_1['CommitComponentsDto'](),[_0x26f3f8,_0x292aa0]=await Promise['all']([this[_0x2b026b(0x129)](),this[_0x2b026b(0x109)]()]);return _0x10209a['message']=this[_0x2b026b(0x146)][_0x2b026b(0x107)],_0x10209a[_0x2b026b(0xf3)]=this['commitData'][_0x2b026b(0xf3)],_0x10209a[_0x2b026b(0xf2)]={'writed':_0x26f3f8,'deleted':_0x292aa0},_0x10209a[_0x2b026b(0x110)]=this[_0x2b026b(0x146)][_0x2b026b(0x110)],_0x10209a['repo']=this[_0x2b026b(0x131)],_0x10209a[_0x2b026b(0x14b)]=this[_0x2b026b(0x14b)],_0x10209a;}async[a145_0x3ddfb0(0x112)](_0x1a7e02=![]){const _0x569e82=a145_0x3ddfb0,_0x526159=await this[_0x569e82(0xfc)][_0x569e82(0x13e)](this[_0x569e82(0x139)]);if(_0x1a7e02)await this['salesforceService']['patchObject'](_0x569e82(0x12d),_0x526159,{'Body':utils_1[_0x569e82(0x114)](JSON[_0x569e82(0xee)]({}))});else{const _0xeecae4=await this[_0x569e82(0x131)][_0x569e82(0x11d)][_0x569e82(0x13c)](this[_0x569e82(0x14b)]['name']);this[_0x569e82(0x141)](_0x569e82(0xf6));const _0x1b5fdb={[this[_0x569e82(0x131)][_0x569e82(0x10a)]]:{'lastCommit':_0xeecae4['sha']}};await this[_0x569e82(0xfa)][_0x569e82(0x113)](_0x569e82(0x12d),_0x526159,{'Body':utils_1[_0x569e82(0x114)](JSON[_0x569e82(0xee)](_0x1b5fdb))});}}async['exec'](){const _0x21b5e7=a145_0x3ddfb0,_0x5a7910=await this[_0x21b5e7(0x119)]();this['commitJob'][_0x21b5e7(0xff)]=this['logger'],await this[_0x21b5e7(0xfc)][_0x21b5e7(0xf9)](this[_0x21b5e7(0x139)],_0x21b5e7(0x10b)),await this['commitJob']['run'](_0x5a7910),await this[_0x21b5e7(0x112)](),this['commitData'][_0x21b5e7(0x136)]&&await this[_0x21b5e7(0xfa)]['deleteAttachment'](this[_0x21b5e7(0x146)][_0x21b5e7(0x136)]),this['commitData'][_0x21b5e7(0x121)]&&await this[_0x21b5e7(0xfa)][_0x21b5e7(0xfe)](this[_0x21b5e7(0x146)][_0x21b5e7(0x121)]),await this['salesforceSync'][_0x21b5e7(0xf9)](this[_0x21b5e7(0x139)],'Completed');}async[a145_0x3ddfb0(0xf5)](_0xe85030){const _0x2cc4f8=a145_0x3ddfb0;try{this['logger'][_0x2cc4f8(0x141)](_0x2cc4f8(0x12a)+_0xe85030),await this['logger'][_0x2cc4f8(0x145)](),await this['updateLastCommit'](!![]),await this[_0x2cc4f8(0xfc)][_0x2cc4f8(0xf9)](this[_0x2cc4f8(0x139)],_0x2cc4f8(0xe8));}catch(_0x5961a1){logger[_0x2cc4f8(0x12c)](_0x5961a1);}}async[a145_0x3ddfb0(0x132)](_0x33385c,_0x4839d1){const _0x47d4f3=a145_0x3ddfb0;try{this[_0x47d4f3(0x146)]=_0x33385c,this['salesforceService']['setLoggerId'](_0x4839d1),this[_0x47d4f3(0xff)]=this[_0x47d4f3(0xfa)]['getLogger'](),await this['fetchRepositoryData']();if(!this['repositoryData'])throw new bad_request_error_1[(_0x47d4f3(0xf7))](errors_1[_0x47d4f3(0x116)]);this[_0x47d4f3(0x131)]=await this[_0x47d4f3(0x137)]['getOne'](this[_0x47d4f3(0x139)][_0x47d4f3(0x14d)]),this[_0x47d4f3(0x14b)]=await this[_0x47d4f3(0x131)][_0x47d4f3(0x11d)][_0x47d4f3(0x13c)](this['repositoryData'][_0x47d4f3(0x133)]),this[_0x47d4f3(0x141)](_0x47d4f3(0x126)),this[_0x47d4f3(0x128)]()[_0x47d4f3(0x11a)](_0x376054=>this[_0x47d4f3(0xf5)](_0x376054));}catch(_0x108e84){this[_0x47d4f3(0x146)]=undefined,logger['error'](_0x108e84);throw _0x108e84;}}};function a145_0x4ae6(_0x1cc781,_0xf0e35){return a145_0x4ae6=function(_0x4bcd13,_0x2c8e9b){_0x4bcd13=_0x4bcd13-0xe7;let _0x1153f0=a145_0x56c8[_0x4bcd13];return _0x1153f0;},a145_0x4ae6(_0x1cc781,_0xf0e35);}FlosumCommitJob=__decorate([typedi_1[a145_0x3ddfb0(0x102)]({'transient':!![]}),__metadata(a145_0x3ddfb0(0xfb),[salesforce_service_1[a145_0x3ddfb0(0x13d)],commit_components_job_1[a145_0x3ddfb0(0x143)],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1[a145_0x3ddfb0(0x12f)]])],FlosumCommitJob),exports['FlosumCommitJob']=FlosumCommitJob;