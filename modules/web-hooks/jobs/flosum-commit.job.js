const a147_0x350578=a147_0x37c5;(function(_0x4552d1,_0x5d9d91){const _0x359a48=a147_0x37c5,_0x2c8c75=_0x4552d1();while(!![]){try{const _0x553e79=parseInt(_0x359a48(0xe5))/0x1+-parseInt(_0x359a48(0xbc))/0x2+-parseInt(_0x359a48(0xed))/0x3+parseInt(_0x359a48(0xee))/0x4+-parseInt(_0x359a48(0xdf))/0x5+-parseInt(_0x359a48(0xb1))/0x6*(parseInt(_0x359a48(0xbd))/0x7)+-parseInt(_0x359a48(0xd3))/0x8*(-parseInt(_0x359a48(0xf3))/0x9);if(_0x553e79===_0x5d9d91)break;else _0x2c8c75['push'](_0x2c8c75['shift']());}catch(_0x435046){_0x2c8c75['push'](_0x2c8c75['shift']());}}}(a147_0x5304,0xecddb));const a147_0x5bf11d=function(){let _0x2ef59e=!![];return function(_0xd1960a,_0x2edde3){const _0x42ffd8=_0x2ef59e?function(){const _0x3d295d=a147_0x37c5;if(_0x2edde3){const _0x56f951=_0x2edde3[_0x3d295d(0xc2)](_0xd1960a,arguments);return _0x2edde3=null,_0x56f951;}}:function(){};return _0x2ef59e=![],_0x42ffd8;};}(),a147_0x7b6dae=a147_0x5bf11d(this,function(){const _0x5e6f34=a147_0x37c5;return a147_0x7b6dae[_0x5e6f34(0xa7)]()[_0x5e6f34(0xf9)](_0x5e6f34(0xc9))['toString']()[_0x5e6f34(0xce)](a147_0x7b6dae)['search'](_0x5e6f34(0xc9));});a147_0x7b6dae();'use strict';var __decorate=this&&this[a147_0x350578(0xd1)]||function(_0x20cae6,_0x303d63,_0x36d348,_0x43df2c){const _0x206181=a147_0x350578;var _0x59d49a=arguments[_0x206181(0xa5)],_0x38c71f=_0x59d49a<0x3?_0x303d63:_0x43df2c===null?_0x43df2c=Object['getOwnPropertyDescriptor'](_0x303d63,_0x36d348):_0x43df2c,_0x2feb58;if(typeof Reflect===_0x206181(0xe0)&&typeof Reflect[_0x206181(0xc7)]==='function')_0x38c71f=Reflect[_0x206181(0xc7)](_0x20cae6,_0x303d63,_0x36d348,_0x43df2c);else{for(var _0x338da1=_0x20cae6[_0x206181(0xa5)]-0x1;_0x338da1>=0x0;_0x338da1--)if(_0x2feb58=_0x20cae6[_0x338da1])_0x38c71f=(_0x59d49a<0x3?_0x2feb58(_0x38c71f):_0x59d49a>0x3?_0x2feb58(_0x303d63,_0x36d348,_0x38c71f):_0x2feb58(_0x303d63,_0x36d348))||_0x38c71f;}return _0x59d49a>0x3&&_0x38c71f&&Object[_0x206181(0xac)](_0x303d63,_0x36d348,_0x38c71f),_0x38c71f;},__metadata=this&&this[a147_0x350578(0xc6)]||function(_0x3479ce,_0xdcff36){const _0x185582=a147_0x350578;if(typeof Reflect===_0x185582(0xe0)&&typeof Reflect['metadata']===_0x185582(0xf5))return Reflect[_0x185582(0xea)](_0x3479ce,_0xdcff36);};function a147_0x37c5(_0x518ab2,_0x5a39d4){const _0x1e8a9e=a147_0x5304();return a147_0x37c5=function(_0x7b6dae,_0x5bf11d){_0x7b6dae=_0x7b6dae-0xa5;let _0x5304e3=_0x1e8a9e[_0x7b6dae];return _0x5304e3;},a147_0x37c5(_0x518ab2,_0x5a39d4);}Object[a147_0x350578(0xac)](exports,a147_0x350578(0xae),{'value':!![]}),exports['FlosumCommitJob']=void 0x0;const core_1=require(a147_0x350578(0xb4)),salesforce_service_1=require(a147_0x350578(0xc4)),git_provider_manager_1=require(a147_0x350578(0xe2)),typedi_1=require('typedi'),errors_1=require(a147_0x350578(0xb7)),bad_request_error_1=require(a147_0x350578(0xd2)),salesforce_retriever_service_1=require(a147_0x350578(0xdc)),salesforce_sync_service_1=require(a147_0x350578(0xe4)),commit_components_dto_1=require(a147_0x350578(0xe8)),commit_components_job_1=require(a147_0x350578(0xa6)),logger=new core_1[(a147_0x350578(0xfa))]('flosum-commit-job');let FlosumCommitJob=class FlosumCommitJob{constructor(_0x6d9535,_0x17c23c,_0x402df1,_0x3e3269){const _0x5d26e0=a147_0x350578;this[_0x5d26e0(0x100)]=_0x6d9535,this[_0x5d26e0(0xe7)]=_0x17c23c,this[_0x5d26e0(0xd4)]=_0x402df1,this[_0x5d26e0(0xc5)]=_0x3e3269,this[_0x5d26e0(0xc3)]=this[_0x5d26e0(0xc5)][_0x5d26e0(0xef)]();}[a147_0x350578(0xaf)](_0xbdab64){const _0x527e54=a147_0x350578;return this[_0x527e54(0xb0)][_0x527e54(0xaf)]('[COMMIT]\x20['+this[_0x527e54(0xc5)][_0x527e54(0xc0)]['toUpperCase']()+_0x527e54(0xad)+this[_0x527e54(0xcb)]['name']+']\x20[Branch:\x20'+this['branch']['name']+']\x20'+_0xbdab64);}async['fetchRepositoryData'](){const _0x3bd4f2=a147_0x350578;try{if(this[_0x3bd4f2(0xaa)][_0x3bd4f2(0xba)])this[_0x3bd4f2(0xfe)]=await this[_0x3bd4f2(0xd4)]['getRepositoryRecord'](this[_0x3bd4f2(0xaa)]['syncRepositoryId']);else this[_0x3bd4f2(0xaa)][_0x3bd4f2(0xf8)]&&(this[_0x3bd4f2(0xfe)]=await this['salesforceSync']['getBranchRecord'](this[_0x3bd4f2(0xaa)][_0x3bd4f2(0xf8)]));}catch(_0x4876ef){throw new bad_request_error_1[(_0x3bd4f2(0xd5))](errors_1[_0x3bd4f2(0xb6)]);}}async[a147_0x350578(0xb8)](){const _0x23bea2=a147_0x350578;if(!this['commitData'][_0x23bea2(0x101)])return[];const _0x12355f=await this[_0x23bea2(0x100)][_0x23bea2(0xb9)](this[_0x23bea2(0xaa)][_0x23bea2(0x101)])['then'](_0xb8c557=>_0xb8c557[_0x23bea2(0xf2)]('\x20')[_0x23bea2(0xd0)](_0x158c13=>_0x158c13[_0x23bea2(0xbb)]())),_0x1ca616=new salesforce_retriever_service_1[(_0x23bea2(0xe9))](this['salesforceService']),_0x158db0=await _0x1ca616[_0x23bea2(0xe1)](_0x12355f);return _0x158db0;}async[a147_0x350578(0xf1)](){const _0x279312=a147_0x350578;if(!this[_0x279312(0xaa)][_0x279312(0xb3)])return[];const _0x4ba8ad=await this['salesforceService'][_0x279312(0xb9)](this[_0x279312(0xaa)][_0x279312(0xb3)]);return _0x4ba8ad;}async[a147_0x350578(0xfc)](){const _0x1c235c=a147_0x350578,_0x24cffe=new commit_components_dto_1[(_0x1c235c(0xd8))](),[_0x333b63,_0x3421f9]=await Promise[_0x1c235c(0xb2)]([this[_0x1c235c(0xb8)](),this[_0x1c235c(0xf1)]()]);return _0x24cffe[_0x1c235c(0xcc)]=this['commitData'][_0x1c235c(0xcc)],_0x24cffe[_0x1c235c(0xe3)]=this[_0x1c235c(0xaa)][_0x1c235c(0xe3)],_0x24cffe['components']={'writed':_0x333b63,'deleted':_0x3421f9},_0x24cffe[_0x1c235c(0xff)]=this[_0x1c235c(0xaa)][_0x1c235c(0xff)],_0x24cffe[_0x1c235c(0xf7)]=this[_0x1c235c(0xcb)],_0x24cffe[_0x1c235c(0xda)]=this[_0x1c235c(0xda)],_0x24cffe;}async[a147_0x350578(0xd7)](_0x510ecd=![]){const _0x19e179=a147_0x350578;if(_0x510ecd)await this[_0x19e179(0xd4)][_0x19e179(0xc1)](this['repositoryData'],{});else{const _0x5660fa=await this['repository'][_0x19e179(0xf6)][_0x19e179(0xab)](this['branch'][_0x19e179(0xfb)]);this[_0x19e179(0xaf)](_0x19e179(0xd9));const _0x786ab6={[this[_0x19e179(0xcb)]['gitUrl']]:{'lastCommit':_0x5660fa[_0x19e179(0xec)]}};await this[_0x19e179(0xd4)][_0x19e179(0xc1)](this[_0x19e179(0xfe)],_0x786ab6);}}async[a147_0x350578(0xc8)](){const _0x159496=a147_0x350578,_0x30e457=await this['getCommitDto']();this[_0x159496(0xe7)][_0x159496(0xb0)]=this[_0x159496(0xb0)],await this['salesforceSync'][_0x159496(0xcf)](this['repositoryData'],'In\x20Progress'),await this[_0x159496(0xe7)][_0x159496(0xe1)](_0x30e457),await this[_0x159496(0xd7)](),this['commitData'][_0x159496(0x101)]&&await this[_0x159496(0x100)][_0x159496(0xdd)](this[_0x159496(0xaa)][_0x159496(0x101)]),this['commitData'][_0x159496(0xb3)]&&await this[_0x159496(0x100)][_0x159496(0xdd)](this[_0x159496(0xaa)][_0x159496(0xb3)]),await this['salesforceSync'][_0x159496(0xcf)](this[_0x159496(0xfe)],_0x159496(0xca));}async[a147_0x350578(0xdb)](_0x371495){const _0x1fff79=a147_0x350578;try{this['logger']['log']('[ERROR]\x20'+_0x371495),await this[_0x1fff79(0xb0)][_0x1fff79(0xe6)](),await this[_0x1fff79(0xd7)](!![]),await this[_0x1fff79(0xd4)][_0x1fff79(0xcf)](this['repositoryData'],_0x1fff79(0xcd));}catch(_0x5f4f53){logger[_0x1fff79(0xde)](_0x5f4f53);}}async[a147_0x350578(0xe1)](_0x518648,_0x334ef8){const _0x37d36d=a147_0x350578;try{this[_0x37d36d(0xaa)]=_0x518648,this[_0x37d36d(0x100)][_0x37d36d(0xb5)](_0x334ef8),this[_0x37d36d(0xb0)]=this['salesforceService'][_0x37d36d(0xbe)](),await this[_0x37d36d(0xfd)]();if(!this[_0x37d36d(0xfe)])throw new bad_request_error_1[(_0x37d36d(0xd5))](errors_1[_0x37d36d(0xf4)]);this['repository']=await this[_0x37d36d(0xc3)][_0x37d36d(0xab)](this[_0x37d36d(0xfe)][_0x37d36d(0xd6)]),this[_0x37d36d(0xda)]=await this[_0x37d36d(0xcb)]['branches'][_0x37d36d(0xab)](this[_0x37d36d(0xfe)][_0x37d36d(0xbf)]),this[_0x37d36d(0xaf)]('[INFO]\x20Start\x20commit\x20job'),this[_0x37d36d(0xc8)]()[_0x37d36d(0xf0)](_0x65afbb=>this['handleCommitJobError'](_0x65afbb));}catch(_0x56689c){this[_0x37d36d(0xaa)]=undefined,logger[_0x37d36d(0xde)](_0x56689c);throw _0x56689c;}}};FlosumCommitJob=__decorate([(0x0,typedi_1[a147_0x350578(0xeb)])({'transient':!![]}),__metadata('design:paramtypes',[salesforce_service_1[a147_0x350578(0xa8)],commit_components_job_1['CommitComponentsJob'],salesforce_sync_service_1['SalesforceSyncService'],git_provider_manager_1['GitProviderManager']])],FlosumCommitJob),exports[a147_0x350578(0xa9)]=FlosumCommitJob;function a147_0x5304(){const _0x3ae7cc=['../../shared/git-provider.manager','user','../../salesforce/services/salesforce-sync.service','39145oEDjiM','send','commitJob','../dto/commit-components.dto','SalesforceRetrieverService','metadata','Service','sha','4356528NkHkKg','609156celkmd','getRepoService','catch','getComponentsToDelete','split','10970442FNlWhy','ERR_UNKNOWN_SYNC_RECORD_ID','function','branches','repo','syncBranchId','search','Logger','name','getCommitDto','fetchRepositoryData','repositoryData','convertToSFDX','salesforceService','commitAttachmentId','length','./commit-components.job','toString','SalesforceService','FlosumCommitJob','commitData','getOne','defineProperty',']\x20[Repository:\x20','__esModule','log','logger','6773766oWtxez','all','deleteAttachmentId','../../../core','setLoggerId','ERR_INVALID_SYNC_RECORD_ID','../../../constants/errors','getComponentsToWrite','retrieveAttachment','syncRepositoryId','trim','2216368dGxRNB','7MKWBue','getLogger','branchName','provider','updateRemoteState','apply','repoService','../../salesforce/services/salesforce.service','gitManager','__metadata','decorate','exec','(((.+)+)+)+$','Completed','repository','message','Error','constructor','setStatus','map','__decorate','../../../core/errors/bad-request.error','32bAVWEh','salesforceSync','BadRequestError','repositoryName','updateLastCommit','CommitComponentsDto','[INFO]\x20Update\x20remote\x20state.','branch','handleCommitJobError','../../salesforce/services/salesforce-retriever.service','deleteAttachment','error','2038310hQarWI','object','run'];a147_0x5304=function(){return _0x3ae7cc;};return a147_0x5304();}