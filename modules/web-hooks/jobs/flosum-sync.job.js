const a146_0x2017f1=a146_0x32b5;(function(_0xdd7f2d,_0x28f83c){const _0x2e6a9b=a146_0x32b5,_0x2f4124=_0xdd7f2d();while(!![]){try{const _0x5315ab=parseInt(_0x2e6a9b(0x18b))/0x1+parseInt(_0x2e6a9b(0x179))/0x2*(-parseInt(_0x2e6a9b(0x17f))/0x3)+-parseInt(_0x2e6a9b(0x171))/0x4+parseInt(_0x2e6a9b(0x17d))/0x5+parseInt(_0x2e6a9b(0x191))/0x6*(parseInt(_0x2e6a9b(0x1a0))/0x7)+parseInt(_0x2e6a9b(0x169))/0x8*(-parseInt(_0x2e6a9b(0x173))/0x9)+parseInt(_0x2e6a9b(0x1a1))/0xa;if(_0x5315ab===_0x28f83c)break;else _0x2f4124['push'](_0x2f4124['shift']());}catch(_0x1650b5){_0x2f4124['push'](_0x2f4124['shift']());}}}(a146_0x47f7,0x40efb));const a146_0x137b42=function(){let _0x20ccd6=!![];return function(_0x5d765f,_0x50a28f){const _0x24fd5a=_0x20ccd6?function(){const _0x5abb42=a146_0x32b5;if(_0x50a28f){const _0x5238c0=_0x50a28f[_0x5abb42(0x19e)](_0x5d765f,arguments);return _0x50a28f=null,_0x5238c0;}}:function(){};return _0x20ccd6=![],_0x24fd5a;};}(),a146_0x5496a3=a146_0x137b42(this,function(){const _0x43a2f9=a146_0x32b5;return a146_0x5496a3[_0x43a2f9(0x1be)]()[_0x43a2f9(0x19a)]('(((.+)+)+)+$')['toString']()[_0x43a2f9(0x197)](a146_0x5496a3)['search'](_0x43a2f9(0x192));});function a146_0x32b5(_0x30d4bf,_0x1de721){const _0x5335a4=a146_0x47f7();return a146_0x32b5=function(_0x5496a3,_0x137b42){_0x5496a3=_0x5496a3-0x169;let _0x47f7c6=_0x5335a4[_0x5496a3];return _0x47f7c6;},a146_0x32b5(_0x30d4bf,_0x1de721);}a146_0x5496a3();'use strict';var __createBinding=this&&this[a146_0x2017f1(0x19f)]||(Object[a146_0x2017f1(0x18f)]?function(_0x48d0ea,_0x11a05a,_0x2f320c,_0x2b37ab){const _0x5e38a0=a146_0x2017f1;if(_0x2b37ab===undefined)_0x2b37ab=_0x2f320c;Object[_0x5e38a0(0x183)](_0x48d0ea,_0x2b37ab,{'enumerable':!![],'get':function(){return _0x11a05a[_0x2f320c];}});}:function(_0x38e678,_0x4e2755,_0x12be13,_0x48bce4){if(_0x48bce4===undefined)_0x48bce4=_0x12be13;_0x38e678[_0x48bce4]=_0x4e2755[_0x12be13];}),__setModuleDefault=this&&this[a146_0x2017f1(0x1b5)]||(Object[a146_0x2017f1(0x18f)]?function(_0x2320b3,_0x14344a){const _0x6d7e40=a146_0x2017f1;Object[_0x6d7e40(0x183)](_0x2320b3,_0x6d7e40(0x16d),{'enumerable':!![],'value':_0x14344a});}:function(_0x576af7,_0x186228){const _0xaf6aeb=a146_0x2017f1;_0x576af7[_0xaf6aeb(0x16d)]=_0x186228;}),__decorate=this&&this[a146_0x2017f1(0x170)]||function(_0x569446,_0x103ede,_0x936ed5,_0x3d37f4){const _0x533b9d=a146_0x2017f1;var _0x289ccd=arguments[_0x533b9d(0x1b6)],_0x28ae0b=_0x289ccd<0x3?_0x103ede:_0x3d37f4===null?_0x3d37f4=Object[_0x533b9d(0x1b2)](_0x103ede,_0x936ed5):_0x3d37f4,_0x14aed2;if(typeof Reflect===_0x533b9d(0x195)&&typeof Reflect[_0x533b9d(0x1a6)]===_0x533b9d(0x1b9))_0x28ae0b=Reflect['decorate'](_0x569446,_0x103ede,_0x936ed5,_0x3d37f4);else{for(var _0x1da28a=_0x569446[_0x533b9d(0x1b6)]-0x1;_0x1da28a>=0x0;_0x1da28a--)if(_0x14aed2=_0x569446[_0x1da28a])_0x28ae0b=(_0x289ccd<0x3?_0x14aed2(_0x28ae0b):_0x289ccd>0x3?_0x14aed2(_0x103ede,_0x936ed5,_0x28ae0b):_0x14aed2(_0x103ede,_0x936ed5))||_0x28ae0b;}return _0x289ccd>0x3&&_0x28ae0b&&Object[_0x533b9d(0x183)](_0x103ede,_0x936ed5,_0x28ae0b),_0x28ae0b;},__importStar=this&&this[a146_0x2017f1(0x1b1)]||function(_0x4368cc){const _0x13eb59=a146_0x2017f1;if(_0x4368cc&&_0x4368cc[_0x13eb59(0x1c3)])return _0x4368cc;var _0x5b2db0={};if(_0x4368cc!=null){for(var _0x125d19 in _0x4368cc)if(_0x125d19!==_0x13eb59(0x16d)&&Object[_0x13eb59(0x178)][_0x13eb59(0x16b)][_0x13eb59(0x17a)](_0x4368cc,_0x125d19))__createBinding(_0x5b2db0,_0x4368cc,_0x125d19);}return __setModuleDefault(_0x5b2db0,_0x4368cc),_0x5b2db0;},__metadata=this&&this[a146_0x2017f1(0x18d)]||function(_0x4e04d4,_0x5b92f7){const _0x4f32ba=a146_0x2017f1;if(typeof Reflect===_0x4f32ba(0x195)&&typeof Reflect['metadata']===_0x4f32ba(0x1b9))return Reflect[_0x4f32ba(0x1a8)](_0x4e04d4,_0x5b92f7);};Object[a146_0x2017f1(0x183)](exports,'__esModule',{'value':!![]}),exports['FlosumSyncJob']=void 0x0;function a146_0x47f7(){const _0x1068d6=['logger','55743xEHGSt','toLowerCase','__metadata','repositoryId','create','Attachment','366dyTVJO','(((.+)+)+)+$','repositoryName','\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.','object','../../../constants','constructor','[INFO]\x20Start\x20sync\x20job','branchName','search','\x27\x20in\x20repository\x20\x27','provider','salesforceService','apply','__createBinding','2345yUOiRw','6458870ynqLmP','handleRecordSyncError','isIntersects','Error','have\x20to\x20synchronize\x20%d\x20branches','decorate','../../shared/services/app-settings.service','metadata','FlosumSyncJob','REPOSITORY_NAME_REGEXP','get','bitbucket','typedi','flosum-sync-job','setStatus','encodeBase64','__importStar','getOwnPropertyDescriptor','\x27\x20[','stringify','__setModuleDefault','length','getLogger','SalesforceError','function','sleep','SalesforceSyncService','design:paramtypes','getAttachmentId','toString','AppSettingsService','BITBUCEKT_FREEZE_AFTER_EACH_RECORDS_COUNT','BRANCH_NAME_REGEXP','checkValidNaming','__esModule','../../../core','64RXEwMQ','../../salesforce/errors/salesforce.error','hasOwnProperty','salesforceSync','default','[INFO]\x20Sync\x20job\x20done.','patchObject','__decorate','499224jfszlp','Logger','193248vijbTf','run','\x27\x20-\x20\x27','SalesforceService','test','prototype','2rwHuAi','call','setLoggerId','../../salesforce/services/salesforce.service','1235995CaDahe','Unable\x20to\x20synchronize\x20repository\x20\x27','1220109xNSSYR','log','repositoriesIntersections','send','defineProperty','error','branchId','SyncJob','getBranchRecords','appSettings','\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.'];a146_0x47f7=function(){return _0x1068d6;};return a146_0x47f7();}const constants_1=require(a146_0x2017f1(0x196)),typedi_1=__importStar(require(a146_0x2017f1(0x1ad))),core_1=require(a146_0x2017f1(0x1c4)),salesforce_error_1=require(a146_0x2017f1(0x16a)),salesforce_sync_service_1=require('../../salesforce/services/salesforce-sync.service'),salesforce_service_1=require(a146_0x2017f1(0x17c)),app_settings_service_1=require(a146_0x2017f1(0x1a7)),utils_1=require('../../shared/utils'),sync_job_1=require('./sync.job'),logger=new core_1[(a146_0x2017f1(0x172))](a146_0x2017f1(0x1ae));let FlosumSyncJob=class FlosumSyncJob{constructor(_0x39b555,_0x51a206,_0x43921f){const _0x376a30=a146_0x2017f1;this[_0x376a30(0x19d)]=_0x39b555,this[_0x376a30(0x16c)]=_0x51a206,this['appSettings']=_0x43921f,this[_0x376a30(0x1c0)]=0xc8,this[_0x376a30(0x181)]={};}get['provider'](){const _0x2f8078=a146_0x2017f1;return this[_0x2f8078(0x188)][_0x2f8078(0x19c)];}async[a146_0x2017f1(0x1a2)](_0x13cad3,_0x440929){const _0xa756e=a146_0x2017f1;try{const _0x16ea39=await this[_0xa756e(0x16c)][_0xa756e(0x1bd)](_0x13cad3);this[_0xa756e(0x18a)][_0xa756e(0x180)]('[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27'+_0x13cad3['repositoryName']+_0xa756e(0x1b3)+_0x13cad3['branchName']+']\x20due\x20error\x20-\x20'+_0x440929),await this['logger'][_0xa756e(0x182)](),await this[_0xa756e(0x19d)][_0xa756e(0x16f)](_0xa756e(0x190),_0x16ea39,{'Body':(0x0,utils_1[_0xa756e(0x1b0)])(JSON[_0xa756e(0x1b4)]({}))}),await this[_0xa756e(0x16c)][_0xa756e(0x1af)](_0x13cad3,_0xa756e(0x1a4));}catch(_0x4e49ed){logger[_0xa756e(0x184)](_0x4e49ed);if(_0x4e49ed instanceof salesforce_error_1[_0xa756e(0x1b8)])throw _0x4e49ed;}}async[a146_0x2017f1(0x1a3)](_0x19b847){const _0x4f6363=a146_0x2017f1;if(_0x19b847[_0x4f6363(0x18e)]){const _0x551eeb=_0x19b847[_0x4f6363(0x193)][_0x4f6363(0x18c)](),_0x820009=this[_0x4f6363(0x181)][_0x551eeb];if(!_0x820009)this[_0x4f6363(0x181)][_0x551eeb]=_0x19b847[_0x4f6363(0x193)];else{if(_0x820009&&_0x820009!==_0x19b847[_0x4f6363(0x193)])return await this[_0x4f6363(0x1a2)](_0x19b847,new Error(_0x4f6363(0x17e)+_0x19b847[_0x4f6363(0x193)]+'\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27'+_0x551eeb+_0x4f6363(0x175)+_0x820009+'\x27')),!![];}}return![];}async[a146_0x2017f1(0x1c2)](_0x4b7942){const _0x14bd67=a146_0x2017f1;if(!constants_1[_0x14bd67(0x1aa)][_0x14bd67(0x177)](_0x4b7942[_0x14bd67(0x193)]))return await this['handleRecordSyncError'](_0x4b7942,new Error(_0x14bd67(0x17e)+_0x4b7942[_0x14bd67(0x193)]+_0x14bd67(0x189))),![];if(!constants_1[_0x14bd67(0x1c1)]['test'](_0x4b7942[_0x14bd67(0x199)]))return await this[_0x14bd67(0x1a2)](_0x4b7942,new Error('Unable\x20to\x20synchronize\x20branch\x20\x27'+_0x4b7942['branchName']+_0x14bd67(0x19b)+_0x4b7942[_0x14bd67(0x193)]+_0x14bd67(0x194))),![];return!![];}async['run'](_0x2be68b,_0x446620){const _0x1521fd=a146_0x2017f1;this['salesforceService'][_0x1521fd(0x17b)](_0x446620),this[_0x1521fd(0x18a)]=this[_0x1521fd(0x19d)][_0x1521fd(0x1b7)]();try{this[_0x1521fd(0x18a)]['log'](_0x1521fd(0x198)),await this[_0x1521fd(0x18a)][_0x1521fd(0x182)]();const [_0x32ea8a,_0x59d350]=await Promise['all']([this[_0x1521fd(0x16c)][_0x1521fd(0x187)](),this[_0x1521fd(0x16c)]['getRepositoryRecords']()]),_0x23d9cb=[..._0x59d350,..._0x32ea8a];logger[_0x1521fd(0x180)](_0x1521fd(0x1a5),_0x23d9cb[_0x1521fd(0x1b6)]);let _0x5cfa77=0x0;for(const _0x1eda29 of _0x23d9cb){this[_0x1521fd(0x19c)]===_0x1521fd(0x1ac)&&_0x5cfa77>0x0&&_0x5cfa77%this['BITBUCEKT_FREEZE_AFTER_EACH_RECORDS_COUNT']===0x0&&await(0x0,utils_1[_0x1521fd(0x1ba)])(0x3c*0x3c*0x3e8);const _0x1bbe43=typedi_1['default'][_0x1521fd(0x1ab)](sync_job_1[_0x1521fd(0x186)]);logger[_0x1521fd(0x180)]('syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch',_0x1eda29[_0x1521fd(0x193)],_0x1eda29[_0x1521fd(0x18e)],_0x1eda29[_0x1521fd(0x199)],_0x1eda29[_0x1521fd(0x185)]);const _0x3baf35=await this[_0x1521fd(0x1c2)](_0x1eda29);if(!_0x3baf35)continue;const _0x1e4437=await this['isIntersects'](_0x1eda29);if(_0x1e4437)continue;await _0x1bbe43[_0x1521fd(0x174)](_0x1eda29,_0x446620,_0x2be68b['convertToSFDX'])['catch'](_0x5c5177=>this[_0x1521fd(0x1a2)](_0x1eda29,_0x5c5177)),_0x5cfa77++;}}catch(_0x2557c0){logger[_0x1521fd(0x184)](_0x2557c0),this[_0x1521fd(0x18a)]['log']('[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20'+_0x2557c0),await this[_0x1521fd(0x18a)][_0x1521fd(0x182)]()['catch'](()=>void 0x0);return;}this[_0x1521fd(0x18a)]['log'](_0x1521fd(0x16e)),await this['logger'][_0x1521fd(0x182)](),await this[_0x1521fd(0x16c)]['disableSync'](_0x2be68b['syncID']);}};FlosumSyncJob=__decorate([(0x0,typedi_1['Service'])({'transient':!![]}),__metadata(a146_0x2017f1(0x1bc),[salesforce_service_1[a146_0x2017f1(0x176)],salesforce_sync_service_1[a146_0x2017f1(0x1bb)],app_settings_service_1[a146_0x2017f1(0x1bf)]])],FlosumSyncJob),exports[a146_0x2017f1(0x1a9)]=FlosumSyncJob;