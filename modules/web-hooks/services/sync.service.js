const a179_0x569bc7=a179_0x3e41;(function(_0x4f56fa,_0x5e43c6){const _0x29cc7e=a179_0x3e41,_0x5e1ae4=_0x4f56fa();while(!![]){try{const _0x58ead0=-parseInt(_0x29cc7e(0x104))/0x1*(parseInt(_0x29cc7e(0xa6))/0x2)+parseInt(_0x29cc7e(0xda))/0x3+parseInt(_0x29cc7e(0xed))/0x4*(parseInt(_0x29cc7e(0xb5))/0x5)+-parseInt(_0x29cc7e(0x10d))/0x6*(-parseInt(_0x29cc7e(0xc2))/0x7)+-parseInt(_0x29cc7e(0xdd))/0x8+parseInt(_0x29cc7e(0xa2))/0x9+-parseInt(_0x29cc7e(0xe2))/0xa;if(_0x58ead0===_0x5e43c6)break;else _0x5e1ae4['push'](_0x5e1ae4['shift']());}catch(_0x489b8a){_0x5e1ae4['push'](_0x5e1ae4['shift']());}}}(a179_0x56d4,0x9320e));const a179_0x12bd0c=function(){let _0x489545=!![];return function(_0x4aedca,_0x2a0b16){const _0x2044d8=_0x489545?function(){if(_0x2a0b16){const _0x566f1e=_0x2a0b16['apply'](_0x4aedca,arguments);return _0x2a0b16=null,_0x566f1e;}}:function(){};return _0x489545=![],_0x2044d8;};}(),a179_0x3e8e39=a179_0x12bd0c(this,function(){const _0x466e75=a179_0x3e41;return a179_0x3e8e39[_0x466e75(0xb3)]()[_0x466e75(0xeb)](_0x466e75(0xfa))[_0x466e75(0xb3)]()['constructor'](a179_0x3e8e39)[_0x466e75(0xeb)](_0x466e75(0xfa));});a179_0x3e8e39();'use strict';var __createBinding=this&&this[a179_0x569bc7(0xb0)]||(Object['create']?function(_0x21c641,_0x5167c4,_0xef3b6e,_0x54bece){const _0x31cb0e=a179_0x569bc7;if(_0x54bece===undefined)_0x54bece=_0xef3b6e;Object[_0x31cb0e(0xd8)](_0x21c641,_0x54bece,{'enumerable':!![],'get':function(){return _0x5167c4[_0xef3b6e];}});}:function(_0x55eb40,_0x101401,_0x4089c4,_0x1e2434){if(_0x1e2434===undefined)_0x1e2434=_0x4089c4;_0x55eb40[_0x1e2434]=_0x101401[_0x4089c4];}),__setModuleDefault=this&&this[a179_0x569bc7(0xe7)]||(Object[a179_0x569bc7(0xe4)]?function(_0x9d6ce0,_0x5ac2b8){const _0x2530c0=a179_0x569bc7;Object[_0x2530c0(0xd8)](_0x9d6ce0,_0x2530c0(0xf0),{'enumerable':!![],'value':_0x5ac2b8});}:function(_0x154731,_0x594225){_0x154731['default']=_0x594225;}),__decorate=this&&this[a179_0x569bc7(0xd7)]||function(_0x204a09,_0x25bde5,_0x57db17,_0x21104f){const _0x54dc41=a179_0x569bc7;var _0x13dbe9=arguments[_0x54dc41(0xc5)],_0x173e49=_0x13dbe9<0x3?_0x25bde5:_0x21104f===null?_0x21104f=Object[_0x54dc41(0xc6)](_0x25bde5,_0x57db17):_0x21104f,_0x54d0c2;if(typeof Reflect===_0x54dc41(0xe9)&&typeof Reflect[_0x54dc41(0xc7)]===_0x54dc41(0xa8))_0x173e49=Reflect[_0x54dc41(0xc7)](_0x204a09,_0x25bde5,_0x57db17,_0x21104f);else{for(var _0x16777e=_0x204a09[_0x54dc41(0xc5)]-0x1;_0x16777e>=0x0;_0x16777e--)if(_0x54d0c2=_0x204a09[_0x16777e])_0x173e49=(_0x13dbe9<0x3?_0x54d0c2(_0x173e49):_0x13dbe9>0x3?_0x54d0c2(_0x25bde5,_0x57db17,_0x173e49):_0x54d0c2(_0x25bde5,_0x57db17))||_0x173e49;}return _0x13dbe9>0x3&&_0x173e49&&Object[_0x54dc41(0xd8)](_0x25bde5,_0x57db17,_0x173e49),_0x173e49;},__importStar=this&&this[a179_0x569bc7(0x107)]||function(_0x38454b){const _0x51ba11=a179_0x569bc7;if(_0x38454b&&_0x38454b[_0x51ba11(0xd3)])return _0x38454b;var _0x14996a={};if(_0x38454b!=null){for(var _0x13f9c9 in _0x38454b)if(_0x13f9c9!==_0x51ba11(0xf0)&&Object[_0x51ba11(0xe0)]['hasOwnProperty'][_0x51ba11(0x10a)](_0x38454b,_0x13f9c9))__createBinding(_0x14996a,_0x38454b,_0x13f9c9);}return __setModuleDefault(_0x14996a,_0x38454b),_0x14996a;},__metadata=this&&this[a179_0x569bc7(0xb9)]||function(_0x33e435,_0x43f511){const _0x13372d=a179_0x569bc7;if(typeof Reflect==='object'&&typeof Reflect[_0x13372d(0xec)]===_0x13372d(0xa8))return Reflect[_0x13372d(0xec)](_0x33e435,_0x43f511);},SyncService_1;function a179_0x3e41(_0x55b651,_0x4ce1c8){const _0x34f212=a179_0x56d4();return a179_0x3e41=function(_0x3e8e39,_0x12bd0c){_0x3e8e39=_0x3e8e39-0xa2;let _0x56d41c=_0x34f212[_0x3e8e39];return _0x56d41c;},a179_0x3e41(_0x55b651,_0x4ce1c8);}Object[a179_0x569bc7(0xd8)](exports,a179_0x569bc7(0xd3),{'value':!![]}),exports[a179_0x569bc7(0xd1)]=void 0x0;const constants_1=require(a179_0x569bc7(0xbf)),core_1=require(a179_0x569bc7(0xf1)),too_many_requests_error_1=require(a179_0x569bc7(0xe6)),flosum_repository_sync_dto_1=require('../../salesforce/dto/flosum-repository-sync.dto'),salesforce_error_1=require('../../salesforce/errors/salesforce.error'),salesforce_logger_v2_service_1=require(a179_0x569bc7(0xbc)),salesforce_sync_service_1=require(a179_0x569bc7(0xbd)),salesforce_service_1=require(a179_0x569bc7(0xf7)),git_provider_manager_1=require(a179_0x569bc7(0xf8)),utils_1=require(a179_0x569bc7(0xd0)),typedi_1=__importStar(require('typedi')),hooks_utils_1=require(a179_0x569bc7(0xcb)),flosum_sync_job_1=require('../jobs/flosum-sync.job'),git_sync_job_1=require(a179_0x569bc7(0x100));let SyncService=SyncService_1=class SyncService{constructor(_0x3f56ef,_0xe160a,_0x4592b5){const _0x5bc543=a179_0x569bc7;this[_0x5bc543(0xac)]=_0x3f56ef,this[_0x5bc543(0xcc)]=_0xe160a,this[_0x5bc543(0xb7)]=_0x4592b5,this[_0x5bc543(0xa4)]=new core_1[(_0x5bc543(0xba))](SyncService_1[_0x5bc543(0xa9)]),this[_0x5bc543(0xd4)]={},this[_0x5bc543(0xd5)]=[];}async[a179_0x569bc7(0xf5)](_0x797fca,_0x12aef3){const _0x5e2bd3=a179_0x569bc7;if(_0x12aef3 instanceof too_many_requests_error_1['TooManyRequests']){await this[_0x5e2bd3(0xcc)][_0x5e2bd3(0xd9)](_0x797fca,_0x5e2bd3(0xd6));throw _0x12aef3;}try{await this[_0x5e2bd3(0x106)][_0x5e2bd3(0xa5)](_0x5e2bd3(0xde)+_0x797fca['repositoryName']+_0x5e2bd3(0x101)+_0x797fca[_0x5e2bd3(0xe3)]+']\x20due\x20error\x20-\x20'+_0x12aef3)[_0x5e2bd3(0xca)](),await this[_0x5e2bd3(0xcc)]['updateRemoteState'](_0x797fca,{}),await this['salesforceSync'][_0x5e2bd3(0xd9)](_0x797fca,_0x5e2bd3(0x102));}catch(_0x96685f){if(_0x96685f instanceof salesforce_error_1['SalesforceError'])throw _0x96685f;}}async[a179_0x569bc7(0xcf)](_0x3c8c84){const _0x2ac416=a179_0x569bc7;if(_0x3c8c84[_0x2ac416(0xcd)]){const _0x1a0be3=_0x3c8c84[_0x2ac416(0xee)]['toLowerCase'](),_0x334c8c=this[_0x2ac416(0xd4)][_0x1a0be3];if(!_0x334c8c)this['repositoriesIntersections'][_0x1a0be3]=_0x3c8c84['repositoryName'];else{if(_0x334c8c&&_0x334c8c!==_0x3c8c84[_0x2ac416(0xee)])return await this['handleRecordSyncError'](_0x3c8c84,new Error(_0x2ac416(0xd2)+_0x3c8c84[_0x2ac416(0xee)]+_0x2ac416(0xc3)+_0x1a0be3+_0x2ac416(0xbe)+_0x334c8c+'\x27')),!![];}}return![];}async['checkValidNaming'](_0x59e2cd){const _0x4c63c9=a179_0x569bc7;if(!constants_1[_0x4c63c9(0xce)][_0x4c63c9(0xb8)](_0x59e2cd['repositoryName']))return await this['handleRecordSyncError'](_0x59e2cd,new Error(_0x4c63c9(0xd2)+_0x59e2cd[_0x4c63c9(0xee)]+'\x27\x20due\x20repository\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];if(!constants_1['BRANCH_NAME_REGEXP']['test'](_0x59e2cd[_0x4c63c9(0xe3)]))return await this[_0x4c63c9(0xf5)](_0x59e2cd,new Error(_0x4c63c9(0xfc)+_0x59e2cd['branchName']+_0x4c63c9(0xf9)+_0x59e2cd[_0x4c63c9(0xee)]+'\x27\x20due\x20branch\x20name\x20does\x20not\x20meet\x20the\x20naming\x20requirements.')),![];return!![];}async['getOrCreateRepo'](_0x339ffd,_0x21a7d3){const _0x5a0322=a179_0x569bc7;let _0x5c80c7=this[_0x5a0322(0xd5)][_0x5a0322(0x105)](_0x5673c7=>_0x339ffd['repositoryName']===_0x5673c7[_0x5a0322(0xa9)]);!_0x5c80c7&&(this[_0x5a0322(0x106)][_0x5a0322(0xa5)](_0x5a0322(0xaa)+_0x339ffd['repositoryName']+_0x5a0322(0xff)),_0x5c80c7=await this['repoService']['create']({'name':_0x339ffd[_0x5a0322(0xee)],'autoInit':!![],'defaultBranch':_0x339ffd[_0x5a0322(0xe3)],'private':!![]}));const _0x164234=await _0x5c80c7['hooks'][_0x5a0322(0xc4)]();return!_0x164234[_0x5a0322(0x105)](_0x5b590a=>_0x5b590a['url']===hooks_utils_1['HooksUtils'][_0x5a0322(0xf6)](_0x21a7d3))&&(this[_0x5a0322(0x106)][_0x5a0322(0xa5)]('[INFO]\x20Repository\x20\x22'+_0x339ffd[_0x5a0322(0xee)]+'\x22\x20does\x20not\x20has\x20the\x20agent\x20webhook.\x20Creating\x20a\x20new\x20one.'),await _0x5c80c7[_0x5a0322(0xab)][_0x5a0322(0xe4)](hooks_utils_1[_0x5a0322(0xc1)][_0x5a0322(0xae)](_0x21a7d3,_0x5c80c7['hooks']))),this[_0x5a0322(0xd5)][_0x5a0322(0xb2)](_0x5c80c7),_0x5c80c7;}async['run'](_0x80982e,_0x3e27ea,_0x20c757){const _0x49387b=a179_0x569bc7;this[_0x49387b(0xac)][_0x49387b(0xfe)](_0x3e27ea),this[_0x49387b(0xf3)]=this[_0x49387b(0xb7)][_0x49387b(0xa3)](_0x20c757),this['sfLogger']=new salesforce_logger_v2_service_1['SalesforceLogger2'](_0x3e27ea,'[SYNC]\x20['+_0x20c757['toUpperCase']()+']');try{await this[_0x49387b(0x106)][_0x49387b(0xa5)]('[INFO]\x20Start\x20sync\x20job')[_0x49387b(0xca)]();const [_0x450347,_0x11e4d0]=await Promise[_0x49387b(0xaf)]([this[_0x49387b(0xcc)][_0x49387b(0xc9)](),this['salesforceSync'][_0x49387b(0xa7)]()]);this[_0x49387b(0xd5)]=await this['repoService']['getAll']();const _0x46edad=[..._0x11e4d0,..._0x450347];this[_0x49387b(0xa4)][_0x49387b(0xa5)](_0x49387b(0xfd),_0x46edad['length']);for(const _0x8db40d of _0x46edad){this[_0x49387b(0xa4)][_0x49387b(0xa5)](_0x49387b(0xef),_0x8db40d[_0x49387b(0xee)],_0x8db40d['repositoryId'],_0x8db40d[_0x49387b(0xe3)],_0x8db40d[_0x49387b(0xb6)]);const _0x2c42dc=await this[_0x49387b(0xfb)](_0x8db40d);if(!_0x2c42dc)continue;const _0x13ee6b=await this[_0x49387b(0xcf)](_0x8db40d);if(_0x13ee6b)continue;let _0x58438a;try{_0x58438a=await this['getOrCreateRepo'](_0x8db40d,_0x20c757);}catch(_0x4ca1d8){await this[_0x49387b(0xf5)](_0x8db40d,_0x4ca1d8 instanceof too_many_requests_error_1[_0x49387b(0x108)]?_0x4ca1d8:new Error(_0x49387b(0xe8)+_0x4ca1d8));continue;}if(_0x8db40d[_0x49387b(0x103)]===flosum_repository_sync_dto_1['SyncDirection'][_0x49387b(0xf2)]){const _0x1e47d5=typedi_1[_0x49387b(0xf0)][_0x49387b(0xe5)](flosum_sync_job_1[_0x49387b(0xe1)]);await _0x1e47d5[_0x49387b(0xdb)]({'repository':_0x58438a,'convertToSFDX':_0x80982e[_0x49387b(0xf4)],'syncRecord':_0x8db40d,'provider':_0x20c757,'logger':this[_0x49387b(0x106)]})[_0x49387b(0xdf)](_0x2727d4=>this[_0x49387b(0xf5)](_0x8db40d,_0x2727d4));}else{const _0x278267=typedi_1[_0x49387b(0xf0)][_0x49387b(0xe5)](git_sync_job_1['GitSyncJob']);await _0x278267['run']({'repository':_0x58438a,'branch':_0x8db40d[_0x49387b(0xe3)],'provider':_0x20c757,'repositoryGit':_0x58438a[_0x49387b(0xb1)],'syncRecord':_0x8db40d,'logger':this[_0x49387b(0x106)]})['catch'](_0x42d10c=>this[_0x49387b(0xf5)](_0x8db40d,_0x42d10c));}}}catch(_0x458c00){this[_0x49387b(0xa4)][_0x49387b(0xb4)](_0x458c00);_0x458c00 instanceof too_many_requests_error_1[_0x49387b(0x108)]?(await this['sfLogger']['log'](_0x49387b(0xdc))[_0x49387b(0xca)](),await utils_1[_0x49387b(0x10c)](0x3c*0x3c*0x3e8),this[_0x49387b(0xdb)](_0x80982e,_0x3e27ea,_0x20c757)):await this[_0x49387b(0x106)][_0x49387b(0xa5)](_0x49387b(0xad)+_0x458c00)[_0x49387b(0xca)]();return;}await this[_0x49387b(0x106)][_0x49387b(0xa5)](_0x49387b(0xbb))[_0x49387b(0xca)](),await this[_0x49387b(0xcc)][_0x49387b(0xea)](_0x80982e['syncID'])[_0x49387b(0xdf)](()=>null);}};SyncService=SyncService_1=__decorate([typedi_1['Service']({'transient':!![]}),__metadata(a179_0x569bc7(0x109),[salesforce_service_1[a179_0x569bc7(0x10b)],salesforce_sync_service_1[a179_0x569bc7(0xc0)],git_provider_manager_1[a179_0x569bc7(0xc8)]])],SyncService),exports[a179_0x569bc7(0xd1)]=SyncService;function a179_0x56d4(){const _0x383da6=['prototype','FlosumSyncJob','4054100VWQdfb','branchName','create','get','../../../core/errors/too-many-requests.error','__setModuleDefault','[ERROR]\x20Could\x20not\x20find/create\x20repository.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Possible\x20error\x20reasons:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201.\x20Git\x20service\x20is\x20unavailable\x20for\x20the\x20moment.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x202.\x20Repository\x20with\x20this\x20name\x20already\x20created\x20in\x20git,\x20but\x20with\x20another\x20lettercase\x20(repository\x20names\x20are\x20case-sensitive\x20and\x20should\x20be\x20identical).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x203.\x20The\x20agent\x20could\x20not\x20recieve\x20all\x20repositories\x20from\x20git\x20service\x20due\x20permissions\x20that\x20you\x20provided.\x20(See\x20guide\x20how\x20to\x20setup\x20environment\x20variables\x20for\x20this\x20service).\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Original\x20error:\x20','object','disableSync','search','metadata','120GtjCRA','repositoryName','syncing\x20%s[%s]\x20repository\x20%s[%s]\x20branch','default','../../../core','FlosumToGit','repoService','convertToSFDX','handleRecordSyncError','getHookLinkFor','../../salesforce/services/salesforce.service','../../shared/git-provider.manager','\x27\x20in\x20repository\x20\x27','(((.+)+)+)+$','checkValidNaming','Unable\x20to\x20synchronize\x20branch\x20\x27','have\x20to\x20synchronize\x20%d\x20branches','setLoggerId','\x22\x20does\x20not\x20exists.\x20Creating\x20it\x20on\x20git\x20service.','../jobs/git-sync.job','\x27\x20[','Error','direction','10VNvvXq','find','sfLogger','__importStar','TooManyRequests','design:paramtypes','call','SalesforceService','sleep','2826312xzlWUA','2566296QYtpMc','getRepoService','logger','log','101020hkmwKI','getRepositoryRecords','function','name','[INFO]\x20Repository\x20\x22','hooks','salesforceService','[ERROR]\x20Stop\x20sync\x20job\x20due\x20error\x20-\x20','createHookPayload','all','__createBinding','gitUrl','push','toString','error','198820LlpzBU','branchId','gitManager','test','__metadata','Logger','[INFO]\x20Sync\x20job\x20done.','../../salesforce/services/salesforce-logger-v2.service','../../salesforce/services/salesforce-sync.service','\x27\x20-\x20\x27','../../../constants','SalesforceSyncService','HooksUtils','7ESnuXN','\x27\x20due\x20it\x20intersects\x20with\x20another\x20repository\x20by\x20repository\x20key\x20\x27','getAll','length','getOwnPropertyDescriptor','decorate','GitProviderManager','getBranchRecords','send','../../hooks/hooks.utils','salesforceSync','repositoryId','REPOSITORY_NAME_REGEXP','isIntersects','../../shared/utils','SyncService','Unable\x20to\x20synchronize\x20repository\x20\x27','__esModule','repositoriesIntersections','repoList','Waiting','__decorate','defineProperty','setStatus','1634739wugNuf','run','[PAUSE]\x20Pause\x20sync\x20job\x20due\x20error\x20-\x20Rate\x20limit\x20quota\x20for\x20git\x20service\x20exceeded.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Paused\x20for\x201h\x20to\x20refill\x20limit\x20quota\x20continue.\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20This\x20kind\x20of\x20error\x20is\x20not\x20critical\x20just\x20need\x20to\x20wait\x20until\x20we\x20can\x20continue\x20work\x20with\x20git\x20service.','7847048TEaaFk','[ERROR]\x20Stop\x20sync\x20job\x20for\x20\x27','catch'];a179_0x56d4=function(){return _0x383da6;};return a179_0x56d4();}